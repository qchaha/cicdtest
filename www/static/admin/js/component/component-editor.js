define("component/component-editor",["common/util","H5-editor/config"],function(t){"use strict";function e(){return function(t){t=t||$(document);var e=t.find('[data-component="'+i+'"]');e.each(function(){function t(t){if(t.val()){var e=$('<button class="app-route-cleaner" style="position: absolute;margin:0 5px;right:0;top:50%;transform:translateY(-50%);padding:0 10px;">').text("清空路由").click(function(){t.val(""),console.log("清空路由"),s(),e.remove()});t.siblings(".app-route-cleaner").remove(),t.after(e).parent().css("position","relative")}}function e(e,i,n,o){$(e).attr("data-module-id",o),"模块"==x[n.componentIndex].name?($(e).addClass("module1"),e.key="模块",e.elements=[]):($(e).addClass("module"),e.key="元素"),$(e).html(x[n.componentIndex].html),n.ele=e,e.index=n.componentIndex,$(e).find("div > .editable").each(function(e){var i=$(this);i.val(n.val[e]),"路由:"===i.prev("span").text()&&i.val()&&t(i)}),i.append(e)}function i(t){for(var e=[],i=t.childNodes,n=i.length,o=0;o<n;o++)i[o].className||$(i[o]).find(".editable").get(0)&&e.push($(i[o]).find(".editable").val());return e}function a(t){for(var e=t.clientY,i=0;i<g.length;i++)if(e<=$(g[i]).offset().top+$(g[i]).height()&&e>=$(g[i]).offset().top+10&&"absolute"!=$(g[i]).css("position")&&"模块"==g[i].key){for(var n=0;n<g[i].elements.length;n++)e<=$(g[i].elements[n]).offset().top+$(g[i].elements[n]).height()&&e>=$(g[i].elements[n]).offset().top+10&&"absolute"!=$(g[i].elements[n]).css("position")?($(g[i].elements[n]).css("border","2px solid #28A3EF"),$(g[i].elements[n]).siblings().css("border","1px solid #999"),$(".note").parent().css("border","none"),$(".module div").eq(0).css("border","none"),$(".module1 div").eq(0).css("border","none"),g[i].select=n):e<=$(g[i].elements[0]).offset().top?g[i].select=-1:$(g[i].elements[n]).css("border","1px solid #999");$(g[i]).css("border","2px solid #28A3EF"),$(g[i]).siblings().css("border","1px solid #999"),$(".note").parent().css("border","none"),$(".module div").eq(0).css("border","none"),$(".module1 div").eq(0).css("border","none"),z=i,G=0}else e<=$(g[i]).offset().top+$(g[i]).height()&&e>=$(g[i]).offset().top+10&&"absolute"!=$(g[i]).css("position")?($(g[i]).css("border","2px solid #28A3EF"),$(g[i]).siblings().css("border","1px solid #999"),$(".note").parent().css("border","none"),$(".module div").eq(0).css("border","none"),$(".module1 div").eq(0).css("border","none"),z=i,G=0):e>=$(g[i]).offset().top&&e<=$(g[i]).offset().top+10&&"absolute"!=$(g[i]).css("position")?($(g[i]).css("border","1px solid #999"),$(g[i]).css("borderTop","4px solid red"),$(g[i]).siblings().css("border","1px solid #999"),$(".note").parent().css("border","none"),$(".module div").eq(0).css("border","none"),$(".module1 div").eq(0).css("border","none"),G=i):e>=$(g[g.length-1]).offset().top+$(g[g.length-1]).height()&&("模块"==g[i].key?$(g[i]).css("border","2px solid red"):$(g[i]).css("border","1px solid #999"),z=g.length)}function s(){if(b)for(var t=b.length,e=0;e<t;e++)if(b[e].val=i(b[e].ele),b[e].componentChild)for(var o=b[e].componentChild.length,a=0;a<o;a++)if(b[e].componentChild[a].val=i(b[e].componentChild[a].ele),b[e].componentChild[a].componentChild)for(var s=b[e].componentChild[a].componentChild.length,d=0;d<s;d++)b[e].componentChild[a].componentChild[d].val=i(b[e].componentChild[a].componentChild[d].ele);for(var l="",e=0;e<g.length;e++)if("快速添加商品静态化"==x[g[e].index].component_name)x[g[e].index].str(g[e]),l+=$(g[e]).attr("data-value");else{var r={elements:g},p=f(x,r,e);l+=p}var c=$(".show"),v=c.contents().find("body");v.html(n.parseImageTag(l)+'<script src="http://m.meijiabang.cn/js/single-page/single-page-lib.js"></script><script></script>'),c[0]&&c[0].contentWindow&&c[0].contentWindow.App&&c[0].contentWindow.App.Util&&"function"==typeof c[0].contentWindow.App.Util.init?c[0].contentWindow.App.Util.init():console.log("刷新失败"),$("#"+h).val(n.parseImageTag(l));var _=JSON.stringify(b);$("#"+m).val(_),$(u).find(".html-show").hide()}function d(t){P=t,t.setAttribute("data-module-id",(new Date).getTime()),document.onmousemove=function(e){var i=e.clientX,n=e.clientY,o=$(u).find(".editor").offset().left,a=$(u).find(".editor").offset().top;$(t).css("top",n-a-$(t).height()/2+"px"),$(t).css("left",i-o-$(t).width()/2+"px"),document.onmouseup=function(){var e={};g[z]&&null!=g[z].select&&g[z].select!=-1&&g[z].elements[g[z].select]&&"模块"==g[z].elements[g[z].select].key?($(g[z].elements[g[z].select]).append(t),$(g[z].elements[g[z].select]).css("border","2px solid red"),g[z].elements[g[z].select].elements.push(t),b[z].componentChild[g[z].select].componentChild||(b[z].componentChild[g[z].select].componentChild=[]),e.componentIndex=t.index,e.ele=t,b[z].componentChild[g[z].select].componentChild.push(e),$(t).css({position:"relative",top:"0",left:"0"})):g[z]&&"模块"==g[z].key?0==G?($(g[z]).append(t),$(t).css({position:"relative",top:"0",left:"0"}),g[z].elements.push(t),b[z].componentChild||(b[z].componentChild=[]),e.componentIndex=t.index,e.ele=t,b[z].componentChild.push(e)):($(g[G]).before(t),$(t).css({position:"relative",top:"0",left:"0"}),g.splice(G,0,t),e.componentIndex=t.index,e.ele=t,b.splice(G,0,e)):0==G?($(u).find("#box").append(t),$(t).css({position:"relative",top:"0",left:"0"}),g.push(t),e.componentIndex=t.index,e.ele=t,console.log("add",b),b.push(e)):($(g[G]).before(t),$(t).css({position:"relative",top:"0",left:"0"}),g.splice(G,0,t),e.componentIndex=t.index,e.ele=t,b.splice(G,0,e)),r(g),s(),$(t).find(".close").on("click",l),document.onmouseup=null,document.onmousemove=null,P=null}}}function l(){$(u).find(".confirm-popup").show(),window.onmousemove=null,$(u).find(".confirm-popup .yes").off(),$(u).find(".confirm-popup .yes").one("click",[z],function(t){$(u).find(".confirm-popup").hide();var e=t.data[0];g[e]&&g[e].elements&&g[e].elements.length&&g[e].select!=-1?g[e].elements[g[e].select].elements&&0!=g[e].elements[g[e].select].elements.length?($(g[e].elements[g[e].select].elements[g[e].elements[g[e].select].elements.length-1]).remove(),g[e].elements[g[e].select].elements.pop(),b[e].componentChild[g[e].select].componentChild.pop()):($(g[e].elements[g[e].select]).remove(),g[e].elements.splice(g[e].select,1),b[e].componentChild.splice(g[e].select,1)):($(g[e]).remove(),g.splice(e,1),b.splice(e,1)),s(),setTimeout(function(){window.onmousemove=a},100)}),$(u).find(".confirm-popup .no").one("click",function(){$(u).find(".confirm-popup").hide()})}function r(t){for(var e=0;e<t.length;e++)if($(t[e]).css("backgroundColor","#E0E0E0"),t[e].elements)for(var i=0;i<t[e].elements.length;i++)if($(t[e].elements[i]).css("backgroundColor","#D7D7D7"),t[e].elements[i].elements)for(var n=0;n<t[e].elements[i].elements.length;n++)$(t[e].elements[i].elements[n]).css("backgroundColor","#BDBDBD")}var p='<style>body,li,ul{margin:0;padding:0;}.admin-body .fb-body{overflow-y: hidden;}ul{list-style:none}body{font:13px/1.5 Tahoma}button{border:none;margin:5px;background-color:#00c;color:#fff}.editor{position:relative;min-width:500px;margin:10px;border-radius: 5px;overflow:hidden;}.editor .components-btn{background-color:#ccc;border-bottom: 1px solid #b5b5b5;}.editor .components-btn div span{color:#28A3EF;display:inline-block;text-align:center;vertical-align:top;padding:6px 10px;}.editor .components-btn div div{width:80%;display:inline-block}.editor .components-btn div div .div{background-color:#fff;color:#333;border-radius:3px;cursor:pointer;display: inline-block;margin: 5px;padding: 3px 5px;text-align: center;width: auto;}.editor .components-btn div div .div:hover{background-color:#0a8ddf;color:#fff}.editor #box{position:relative;width:100%;height:460px;padding:5px;overflow-y:auto;background-color:#eee}::-webkit-scrollbar, ::-webkit-scrollbar-track {background-color: transparent!important;box-shadow: 0 0 1px 0px #ccc;}::-webkit-scrollbar-thumb{background-color: rgba(0,0,0,.1);border-radius: 5px;box-shadow: inset 0px 0px 20px 0px #ccc;}.editor #box .module{width:auto;overflow:hidden;background:#ccc;border:1px solid #999;padding:.2rem;position:relative;}.module{border:1px solid #999;padding:.2rem;margin:0.2rem;border-radius: 5px;}.editor #box .module div{padding:.2rem}.editor #box .module div:nth-child(1), .editor #box .module div:nth-child(3){padding:0}.editor #box .module div span{display:inline-block;width:15%;text-align:right;padding-right:.2rem}.editor #box .module div input{width:85%;border-radius:2px;border: #e9e9e9 solid 1px;padding: 0.2rem;}.editor #box .module div select{width:85%;border-radius:0;border: #e9e9e9 solid 1px;padding: 0.2rem;background:#ffffff;}.editor #box .module1 div{padding:.2rem}.editor #box .module1 div span{display:inline-block;width:15%;text-align:right;padding-right:.2rem}.editor #box .module1 div input{width:85%;border-radius:2px;border: none;padding: 0.2rem;}.editor #box .module1 div:nth-child(1) span,.editor #box .module div:nth-child(1) span,.editor #box .module1{width:auto;text-align:center;position:relative;}.editor #box .module div:nth-child(1){text-align:center}.editor #box .module1{overflow:hidden;border:2px solid red;background:#ccc;padding:.5rem}.editor #box .module1 p{color:#333}.editor .submit{background-color:#eee;text-align:center}.editor .submit div:nth-child(1){display:inline-block;width:2.5rem;text-decoration:underline;color:#666;cursor:pointer;padding-bottom:0.5rem;}.editor .submit div:nth-child(1) .show-content{width:100px;margin:.5rem 0 .5rem 200px;background-color:#0c5dbf;color:#fff;border-radius:3px;padding:.2rem 0;text-align:center;cursor:pointer}.editor .submit div:nth-child(2){display:inline-block;text-align:center;text-decoration:underline;color:#666;cursor:pointer;padding-bottom:0.5rem;}.editor .submit div:nth-child(3){display:inline-block;text-align:center;text-decoration:underline;color:#666;cursor:pointer;padding:0 0 0.5rem 0.2rem}.editor .submit div:nth-child(4){display:inline-block;text-align:center;text-decoration:underline;color:#666;cursor:pointer;padding:0 0 0.5rem 0.2rem}#show{margin:10px;margin-top:0;left:217px;padding:10px 5px 10px 10px;border:1px solid #e9e9e9;border-radius:5px;width:375px;overflow-y:auto;overflow-x:hidden;}.module,.module1{width:180px;overflow:hidden;background:#ccc}.module1{border-radius: 5px;border:1px solid green;text-align:center;margin:0.2rem}.module1 div:nth-child(1){border:0}.module1 .note{border:0}.module1 p{color:#333}textarea{width:100%;height:60px;border:1px solid #333;resize:none}.editor .active{border:2px dashed red}.close{position: absolute;top: 5px;right: 5px;width: 20px;height: 20px;line-height: 7px;text-align: center;cursor: pointer;border: #333 solid 1px;border-radius: 10px;background-color:#ccc}.note{width:100% !important;padding:0 !important;border:none !important;background-color:#ccc!important;text-align:center;color:#999;}</style><div><div id=show style="float: left;"><iframe class=show src="" style="width: 320px;border: none;"></iframe><textarea class=html-show style="width: 100%;resize: none;height: 580px;border: none;display: none;"></textarea></div><div class=editor><div class=components-btn><div><span>常用:</span><div>'+o.html.replace("<div class=div>快速添加商品静态化</div>","")+"<div class=div>添加html</div><div class=div>吸底图片框架</div><div class=div>插入图片</div><div class=div>领优惠券</div><div class=div>插入视频</div><div class=div>关注某人</div><div class=div>直播信息</div><div class=div>轮播</div><div class=div>倒计时</div><div class=div>快速添加商品(两)</div><div class=div>快速添加商品(一)</div></div></div><div><span>锚点:</span><div><div class=div>锚点框架</div><div class=div>锚点导航栏基础</div><div class=div>锚点导航栏</div><div class=div>结束符</div><div class=div>锚点</div></div></div><div><span>导航:</span><div><div class=div>导航栏基础</div><div class=div>导航栏</div><div class=div>侧边导航栏基础</div><div class=div>侧边导航栏</div><div class=div>返回顶部按钮</div><div class=div>购物车按钮</div></div></div></div><div id=box></div><div class=submit><div class=all-screen>全屏模式</div><div class=change-to-html>切换为html模式</div><div class=update>更新</div><div class=locate-component>定位组件</div></div></div><div style=clear:both;></div></div>";$(this).append(p),$(this).append('<div class="confirm-popup" style="display: none;position: fixed;top: 50%;left: 50%;transform: translate(-50%,-50%);z-index: 100;background-color: #fff;width: 10rem;padding: 0.5rem;"><div style="text-align: center;margin: 0.5rem;font-size: 0.7rem">是否删除该组件?</div><div><span class="yes" style="display: inline-block;width: 50%;text-align: center;cursor: pointer;font-size: 0.7rem">是</span><span class="no" style="display: inline-block;width: 50%;text-align: center;cursor: pointer;font-size: 0.7rem">否</span></div></div>'),$(this).css("position","relative");var c=$(this).attr("data-url"),v=$("#show .show");v.attr("src",c);var h=$(this).attr("data-text-id"),m=$(this).attr("data-editor-id"),u=this;$(u).find("#show").css("padding",0),$(u).find(".show").css("height",$(u).find(".editor").height()-22+"px"),$(u).find(".show").css("width","375px"),$(u).find(".html-show").css("height",$(u).find(".editor").height()-22+"px"),$(u).find(".html-show").css("width","100%");var f=function(t,e,i){var n=t[e.elements[i].index].str(e.elements[i]);return n.replace(/^<(div|img|video)/,'<$1 data-module-id="'+e.elements[i].getAttribute("data-module-id")+'"')},g=[],x=[{name:"添加html",component_name:"添加html",html:'<div><span>--添加html--</span><div class="close">x</div></div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><textarea class="editable" style="margin: 0.3rem 0;height: 200px;" ></textarea></div>',str:function(t){return $(t).find("textarea").val()}},{name:"快速添加商品(两)",component_name:"快速添加商品(两)",html:'<div><span>--快速添加商品(两)--</span><div class="close">x</div></div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>商品id:</span><input class="id editable" type="text"></div><div style="display:none;"><span>按键文案:</span><input class="text editable" placeholder="此字段已被废弃" type="text"></div><div><span>背景颜色:</span><input class="bg-color editable" placeholder="不填则背景色默认为f8f8f8" type="text"></div><div><span>商品详情类型:</span><select class="sale-mode editable"><option value="">自动商品详情</option><option value="common">普通商品详情</option><option value="presale">预售商品详情</option></select></div>',str:function(t){return'<div data-component="add-goods" data-id="'+$(t).find(".id").val()+'" data-bg-color="'+$(t).find(".bg-color").val()+'" data-sale-mode="'+$(t).find(".sale-mode").val()+'" ></div>'}},{name:"快速添加商品(一)",component_name:"快速添加商品(一)",html:'<div><span>--快速添加商品(一)--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>商品id:</span><input class="id editable" type="text"></div><div style="display:none;"><span>按键文案:</span><input class="text editable" placeholder="此字段已被废弃" type="text"></div><div style="display:none;"><span>背景颜色:</span><input class="bg-color editable" placeholder="不填则背景色默认为f8f8f8" type="text"></div><div><span>商品详情类型:</span><select class="sale-mode editable"><option value="">自动商品详情</option><option value="common">普通商品详情</option><option value="presale">预售商品详情</option></select></div>',str:function(t){return'<div data-component="add-good" data-id="'+$(t).find(".id").val()+'" data-bg-color="'+$(t).find(".bg-color").val()+'" data-sale-mode="'+$(t).find(".sale-mode").val()+'" ></div>'}},{name:"模块",component_name:"锚点框架",html:'<p>--锚点跳转--</p><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div>',str:function(t){for(var e="",i=0;i<t.elements.length;i++)e+=f(x,t,i);return'<div data-component="tab-location-1" class="tab-location-container"><div class="nav-contain">'+e+"</div>"}},{name:"结束符",component_name:"结束符",html:'<div><div class="close">x</div><span>--------------------------------结束符--------------------------------</span></div>',str:function(t){return"</div>"}},{name:"模块",component_name:"锚点导航栏基础",html:'<p>--锚点导航栏基础--</p><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div>',str:function(t){for(var e="",i=0;i<t.elements.length;i++)e+=f(x,t,i);return'<div class="nav clear-float">'+e+"</div>"}},{name:"模块",component_name:"导航栏基础",html:'<div><span>--导航栏基础--</span><div class="close">x</div></div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>宽度:</span><input class="width editable" type="text"></div><div><span>高度:</span><input class="height editable" type="text"></div>',str:function(t){for(var e="",i=0;i<t.elements.length;i++)e+=f(x,t,i);return'<div data-component="navigator-tabs-base" data-width="'+$(t).find(".width").val()+'" data-height="'+$(t).find(".height").val()+'">'+e+"</div>"}},{name:"模块",component_name:"侧边导航栏基础",html:'<div><span>--侧边导航栏基础--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>宽度:</span><input class="width editable" type="text"></div><div><span>激活图片:</span><input class="active-image editable insert-image" type="text"></div>',str:function(t){for(var e="",i=0;i<t.elements.length;i++)console.log(1,f(x,t,i)),e+=f(x,t,i);return'<div data-component="navigator-side-base" data-width="'+$(t).find(".width").val()+'" data-action-tab-image="'+$(t).find(".active-image").val()+'">'+e+"</div>"}},{name:"模块",component_name:"轮播",html:'<p>--轮播--</p><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div>',str:function(t){for(var e="",i=0;i<t.elements.length;i++)e+=f(x,t,i);return'<div data-component="carousel"><div class="carousel"><div class="img clearfloat">'+e+"</div></div></div>"}},{name:"模块",component_name:"模块",html:'<p>--模块--</p><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div>',str:function(t){for(var e="",i=0;i<t.elements.length;i++)e+=f(x,t,i);return"<div>"+e+"</div>"}},{name:"模块",component_name:"锚点",html:'<div><span>--锚点--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>锚点名:</span><input class="id editable" type="text"></div>',str:function(t){for(var e="",i=0;i<t.elements.length;i++)e+=f(x,t,i);return'<div data-component="add-content" id="'+$(t).find(".id").val()+'">'+e+"</div>"}},{name:"锚点导航栏",component_name:"锚点导航栏",html:'<div><span>--锚点导航栏--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>tab名:</span><input class="tab-name editable" type="text"></div><div><span>激活前图片:</span><input class="tab-img insert-image editable" type="text"></div><div><span>激活图片:</span><input class="tab-active-img insert-image editable" type="text"></div>',str:function(t){return'<div data-component="add-nav" data-img="'+$(t).find(".tab-img").val()+'" data-img-active="'+$(t).find(".tab-active-img").val()+'" data-class="'+$(t).find(".tab-name").val()+'" data-height=""></div>'}},{name:"倒计时",component_name:"倒计时",html:'<div><span>--倒计时--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>开始时间:</span><input class="start-time time editable" type="text"></div><div><span>结束时间:</span><input class="end-time time editable" type="text"></div><div><span>背景图:</span><input class="insert-image editable" type="text"></div>',str:function(t){return'<div data-component="count-down" data-start-time="'+$(t).find(".start-time").val()+'" data-end-time="'+$(t).find(".end-time").val()+'" data-bg-img="'+$(t).find(".insert-image").val()+'"></div>'}},{name:"导航栏",component_name:"导航栏",html:'<div><span>--导航栏--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>链接:</span><input class="tab-link editable" type="text"></div><div><span>激活前图片:</span><input class="tab-img insert-image editable" type="text"></div><div><span>激活图片:</span><input class="tab-active-img insert-image editable" type="text"></div>',str:function(t){return'<div data-component="navigator-tabs" data-image="'+$(t).find(".tab-img").val()+'" data-active-image="'+$(t).find(".tab-active-img").val()+'" data-url="'+$(t).find(".tab-link").val()+'"></div>'}},{name:"侧边导航栏",component_name:"侧边导航栏",html:'<div><span>--侧边导航栏--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>链接:</span><input class="tab-link editable" type="text"></div><div><span>导航图片:</span><input class="tab-img insert-image editable" type="text"></div>',str:function(t){return'<div data-component="navigator-side" data-image="'+$(t).find(".tab-img").val()+'" data-url="'+$(t).find(".tab-link").val()+'"></div>'}},{name:"模块",component_name:"拼图图片框架",html:'<div><span>--拼图图片框架--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div>',str:function(t){for(var e="",i=0;i<t.elements.length;i++)e+=f(x,t,i);return'<div class="img-content">'+e+'<div style="clear:both"></div><style>.img-content img{float:left}</style></div>'}},{name:"插入图片",component_name:"插入图片",html:'<div><span>--插入图片--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>插入图片:</span><input class="insert-image editable" type="text"></div><div><span>路由:</span><input class="app-route editable" type="text"></div><div><span>图片宽度:</span><input class="wd editable" type="text"></div>',str:function(t){return'<img src="'+$(t).find(".insert-image").val()+'" style="width:'+($(t).find(".wd").val()||"100%")+';vertical-align: top;" app_route="'+$(t).find(".app-route").val()+'">'}},{name:"领优惠券",component_name:"领优惠券",html:'<div><span>--领优惠券--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>券id:</span><input class="ticket-id editable" type="text"></div><div><span>领取前图片:</span><input class="fore-image insert-image editable" type="text"></div><div><span>领取后图片:</span><input class="after-image insert-image editable" type="text"></div>',str:function(t){return'<img data-component="coupon-obtain" data-coupon-ids="'+$(t).find(".ticket-id").val()+'" data-obtained-src="'+$(t).find(".after-image").val()+'" src="'+$(t).find(".fore-image").val()+'" data-stats-category="点击领优惠券" data-stats-action="券'+$(t).find(".ticket-id").val()+'">'}},{name:"插入视频",component_name:"插入视频",html:'<div><span>--插入视频--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>封面图:</span><input class="insert-image editable" type="text"></div><div><span>视频连接:</span><input class="vedio-url editable" type="text"></div>',str:function(t){return'<div data-component="video" data-poster="'+$(t).find(".insert-image").val()+'" data-src="'+$(t).find(".vedio-url").val()+'"></div>'}},{name:"插入视频-帖子",component_name:"插入视频-帖子",html:'<div><span>--插入视频-帖子--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>封面图:</span><input class="insert-image editable" type="text"></div><div><span>视频连接:</span><input class="vedio-url editable" type="text"></div>',str:function(t){return'<video width="100%" controls="controls" preload="preload" poster="'+$(t).find(".insert-image").val()+'"><source src="'+$(t).find(".vedio-url").val()+'">您的版本不支持视频</video>'}},{name:"申请试用单元",component_name:"申请试用单元",html:'<div><span>--申请试用单元--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>封面图:</span><input class="insert-image editable" type="text"></div><div><span>标题:</span><input class="title-1 editable" type="text"></div><div><span>描述1:</span><input class="describe-1 editable" type="text"></div><div><span>描述2:</span><input class="describe-2 editable" type="text"></div><div><span>开始时间:</span><input class="start-time time editable" type="text"></div><div><span>结束时间:</span><input class="end-time time editable" type="text"></div><div><span>路由:</span><input class="app-route editable" type="text"></div>',str:function(t){return'<div data-component="apply-test" data-image="'+$(t).find(".insert-image").val()+'" data-title="'+$(t).find(".title-1").val()+'" data-desc1="'+$(t).find(".describe-1").val()+'" data-desc2="'+$(t).find(".describe-2").val()+'" data-start-time="'+$(t).find(".start-time").val()+'" data-end-time="'+$(t).find(".end-time").val()+'" data-app-route="'+$(t).find(".app-route").val()+'"></div>'}},{name:"关注某人",component_name:"关注某人",html:'<div><span>--关注某人--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>用户ID:</span><input class="user-id editable" type="text"></div>',str:function(t){return'<div data-component="follow-user" data-uid="'+$(t).find(".user-id").val()+'"></div>'}},{name:"定时组件",component_name:"定时组件",html:'<div><span>--定时组件--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>商品ID:</span><input class="good-id editable" type="text"></div><div><span>开售图:</span><input class="on-sale insert-image editable" type="text"></div><div><span>未售图:</span><input class="not-on-sale insert-image editable" type="text"></div><div><span>售完图:</span><input class="all-sale insert-image editable" type="text"></div><div><span>开售时间:</span><input class="start-time time editable" type="text"></div><div><span>下架时间:</span><input class="end-time time editable" type="text"></div>',str:function(t){return'<div data-component="timing" data-start-image="'+$(t).find(".on-sale").val()+'" data-not-start-image="'+$(t).find(".not-on-sale").val()+'" data-out-image="'+$(t).find(".all-sale").val()+'" data-time="'+$(t).find(".start-time").val()+'" data-end-time="'+$(t).find(".end-time").val()+'" data-id="'+$(t).find(".good-id").val()+'"></div>'}},{name:"直播信息",component_name:"直播信息",html:'<div><span>--直播信息--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div><div><span>直播ID:</span><input class="live-detail-id editable" type="text"></div>',str:function(t){return'<div data-component="live-detail" data-live-id="'+$(t).find(".live-detail-id").val()+'"></div>'}},{name:"模块",component_name:"滑动图片框架",html:'<div><span>--滑动图片框架--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div>',str:function(t){for(var e="",i=0;i<t.elements.length;i++)e+=f(x,t,i);return'<div class="move-container" style="overflow-x: auto;overflow-y: hidden;width: 100%;white-space: nowrap">'+e+"</div>"}},{name:"模块",component_name:"吸底图片框架",html:'<div><span>--吸底图片框架--</span></div><div class="close">x</div><div><input class="note editable" type="text" placeholder="备注" value="备注"></div>',str:function(t){for(var e="",i=0;i<t.elements.length;i++)e+=f(x,t,i);return'<div class="move-container" style="position: fixed;bottom: 0;">'+e+"</div>"}}],x=x.concat(o.component).concat([{name:"返回顶部按钮",component_name:"返回顶部按钮",html:'<div><span>--返回顶部按钮--</span></div><div class="close">x</div>',str:function(t){var e="http://m.meijiabang.cn/img/icon/to-top.png";return'<div class="to-top" data-component="to-top" style=" position: fixed; z-index: 200; bottom: 20px; right: 10px; width: 50px; height: 50px; border-radius: 50%; box-shadow: 1px 1px 5px 1px #e9e9e9; background: url('+e+') center center no-repeat #fff; background-size: 60%;"></div>'}},{name:"购物车按钮",component_name:"购物车按钮",html:'<div><span>--购物车按钮--</span></div><div class="close">x</div>',str:function(t){var e="http://m.meijiabang.cn/img/icon/shopping-cart.png";return'<div class="shopping-cart" data-component="shopping-cart" style=" position: fixed; z-index: 200; bottom: 84px; right: 10px; width: 50px; height: 50px; border-radius: 50%; box-shadow: 1px 1px 5px 1px #e9e9e9; background: url('+e+') center center no-repeat #fff; background-size: 60%;"></div>'}}]),b=[];if($("#editor_content").val()&&(b=JSON.parse($("#editor_content").val())),b){for(var _=b.length,y=0;y<_;y++){var w=""+y,k=document.createElement("div");if(k.setAttribute("data-module-id",w),e(k,$(u).find(".editor #box"),b[y],w),g.push(k),b[y].componentChild)for(var T=b[y].componentChild.length,C=0;C<T;C++){var E=""+y+C,A=document.createElement("div");if(A.setAttribute("data-module-id",E),e(A,$(k),b[y].componentChild[C],E),g[y].elements.push(A),b[y].componentChild[C].componentChild)for(var N=b[y].componentChild[C].componentChild.length,I=0;I<N;I++){var O=""+y+C+I,j=document.createElement("div");j.setAttribute("data-module-id",O),e(j,$(A),b[y].componentChild[C].componentChild[I],O),g[y].elements[C].elements.push(j)}}}$(u).find(".insert-image").each(function(){var t=this;$(this).imagePicker({el:$(t),mode:"replace",format:"shortTag",objType:"h5SimplePage",objId:0,callback:function(){$(t).change()}})}),$(u).find(".app-route").appRoutePicker(),$(u).find(".time").datetimepicker({}),$(u).find(".editable").on("change",function(){var e=$(this);e.hasClass("app-route")&&t(e),s()}),$(u).find("#select_approute .s_submit").on("click",function(){s()}),$(document.body).on("click",".s_submit, .utm-btn, .app-route-cleaner, .update",function(){s()}),$(window).on("load",function(){v.contents().find("head").append("<style>*{box-sizing: content-box;}</style>")});var S={},U=function(t,e){var i=null,n=null;"editor"===t?(i=$("#box"),n=i):(n=$(".show"),i=n.contents().find("body"));var o=i.find('[data-module-id="'+e+'"]');o.length>0&&(S.oldTarget&&S.oldTarget.css("border",S.oldBorder),S.oldTarget=o,S.oldBorder=o.css("border"),o.css({border:"2px solid #06ff60"}),o.find("input:not(.note)").first().focus(),i.scrollTop(o.offset().top-n.offset().top+n.scrollTop()))};$(u).find(".locate-component").on("click",function(t){s();var e=$(this);e.text("请选择需要定位的组件");var i=$("#show .show"),n=i[0].contentWindow,o=i.contents().find("body"),a=n.$(o[0]),d=$("#box");a.off("click"),a.off("click","[app_route], [app-route]"),a.off("scroll"),n.onscroll=function(){},a.on("click","[data-module-id]",function(t){t.stopPropagation(),U("editor",$(this).attr("data-module-id")),e.text("定位组件")}),d.on("click","div.module[data-module-id], div.module1[data-module-id]",function(t){var i=$(t.target);i.hasClass("insert-image")||(t.stopPropagation(),U("iframe",$(this).attr("data-module-id")),e.text("定位组件"))})})}$(u).find(".div").each(function(){for(var e=0,i=0;i<x.length;i++)if($(this).html()==x[i].component_name){e=i;break}$(this).on("mousedown",function(){var i=document.createElement("div");"模块"==x[e].name?($(i).addClass("module1"),i.key="模块",i.elements=[]):($(i).addClass("module"),i.key="元素"),$(i).html(x[e].html),i.index=e,$(u).find(".editor").append(i),$(i).css("position","absolute"),d(i),$(u).find(".insert-image").on("click",function(t){}),$(u).find(".insert-image").each(function(){var t=this;$(this).imagePicker({el:$(t),mode:"replace",format:"shortTag",objType:"h5SimplePage",objId:0,callback:function(){$(t).change()}})}),$(u).find(".app-route").appRoutePicker(),$(u).find(".time").datetimepicker({}),$(u).find(".editable").on("change",function(){var e=$(this);e.hasClass("app-route")&&t(e),s()}),$(u).find("textarea").off(),$(u).find("textarea").on("propertychange",function(){this.style.height=this.scrollHeight+"px"}),$(u).find("textarea").on("input",function(){this.style.height=this.scrollHeight+"px"}),$(u).find(".update").on("click",function(){console.log("更新"),s()})})}),$(document).on("mousewheel",function(t){t=t||window.event;var e=$("#box").offset().left,i=e+$("#box").width(),n=$("#box").offset().top,o=n+$("#box").height(),a=t.originalEvent.clientX,s=t.originalEvent.clientY,d=$("#box").scrollTop();e<a&&a<i&&n<s&&s<o&&(t.originalEvent.wheelDelta<0?d+=30:d-=30,$("#box").scrollTop(d))});var D=$(window).height()-$(".components-btn").height()-$(".submit").height();$("#box").css("height",D-60+"px"),$(".show").css("height",$(window).height()-80+"px"),$("#show").css("height",$(window).height()-60+"px"),$(u).find(".all-screen").on("click",function(){
"全屏模式"==$(this).html()?($("#box").css("height",D-20+"px"),$(".show").css("height",$(window).height()-40+"px"),$("#show").css("height",$(window).height()-20+"px"),$(u).css({position:"fixed",top:0,left:0,backgroundColor:"#fff",height:"100%",width:"100%"}),$(this).html("取消全屏")):($("#box").css("height",D-60+"px"),$(".show").css("height",$(window).height()-80+"px"),$("#show").css("height",$(window).height()-60+"px"),$(u).css({position:"relative",top:0,left:0,backgroundColor:"#fff"}),$(this).html("全屏模式"))});var K=0;$(u).find(".change-to-html").on("click",function(){K++;for(var t="",e=0;e<g.length;e++)t+=x[g[e].index].str(g[e]);2==K?($(u).find(".html-show").hide(),$(u).find(".show").show(),$(u).find(".change-to-html").html("切换为html模式"),K=0):($(u).find(".html-show").show().val(R($("#"+h).val())),$(u).find(".change-to-html").html("切换为预览模式"),$(u).find(".show").hide())});var z=0,G=0;window.onmousemove=a;var P;$(document).on("mousedown",function(t){3==t.which&&($(".editor #box").one("contextmenu",function(){return!1}),$(P).remove(),document.onmouseup=null,document.onmousemove=null)}),$(u).find(".close").off(),$(u).find(".close").on("click",l);var R=function(){function t(t,e,i,n){function o(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.Utils={whitespace:"\n\r\t ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed".split(","),extra_liners:"head,body,/html".split(","),in_array:function(t,e){for(var i=0;i<e.length;i++)if(t===e[i])return!0;return!1}},this.get_content=function(){for(var t="",e=[],i=!1;"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return e.length?e.join(""):["","TK_EOF"];if(t=this.input.charAt(this.pos),this.pos++,this.line_char_count++,this.Utils.in_array(t,this.Utils.whitespace))e.length&&(i=!0),this.line_char_count--;else{if(i){if(this.line_char_count>=this.max_char){e.push("\n");for(var n=0;n<this.indent_level;n++)e.push(this.indent_string);this.line_char_count=0}else e.push(" "),this.line_char_count++;i=!1}e.push(t)}}return e.length?e.join(""):""},this.get_script=function(){var t="",e=[],i=new RegExp("</script>","igm");i.lastIndex=this.pos;for(var n=i.exec(this.input),o=n?n.index:this.input.length;this.pos<o;){if(this.pos>=this.input.length)return e.length?e.join(""):["","TK_EOF"];t=this.input.charAt(this.pos),this.pos++,e.push(t)}return e.length?e.join(""):""},this.record_tag=function(t){this.tags[t+"count"]?(this.tags[t+"count"]++,this.tags[t+this.tags[t+"count"]]=this.indent_level):(this.tags[t+"count"]=1,this.tags[t+this.tags[t+"count"]]=this.indent_level),this.tags[t+this.tags[t+"count"]+"parent"]=this.tags.parent,this.tags.parent=t+this.tags[t+"count"]},this.retrieve_tag=function(t){if(this.tags[t+"count"]){for(var e=this.tags.parent;e&&t+this.tags[t+"count"]!==e;)e=this.tags[e+"parent"];e&&(this.indent_level=this.tags[t+this.tags[t+"count"]],this.tags.parent=this.tags[e+"parent"]),delete this.tags[t+this.tags[t+"count"]+"parent"],delete this.tags[t+this.tags[t+"count"]],1==this.tags[t+"count"]?delete this.tags[t+"count"]:this.tags[t+"count"]--}},this.get_tag=function(){var t="",e=[],i=!1;do{if(this.pos>=this.input.length)return e.length?e.join(""):["","TK_EOF"];t=this.input.charAt(this.pos),this.pos++,this.line_char_count++,this.Utils.in_array(t,this.Utils.whitespace)?(i=!0,this.line_char_count--):("'"!==t&&'"'!==t||e[1]&&"!"===e[1]||(t+=this.get_unformatted(t),i=!0),"="===t&&(i=!1),e.length&&"="!==e[e.length-1]&&">"!==t&&i&&(this.line_char_count>=this.max_char?(this.print_newline(!1,e),this.line_char_count=0):(e.push(" "),this.line_char_count++),i=!1),e.push(t))}while(">"!==t);var n,o=e.join("");n=o.indexOf(" ")!=-1?o.indexOf(" "):o.indexOf(">");var a=o.substring(1,n).toLowerCase();if("/"===o.charAt(o.length-2)||this.Utils.in_array(a,this.Utils.single_token))this.tag_type="SINGLE";else if("script"===a)this.record_tag(a),this.tag_type="SCRIPT";else if("style"===a)this.record_tag(a),this.tag_type="STYLE";else if("!"===a.charAt(0))if(a.indexOf("[if")!=-1){if(o.indexOf("!IE")!=-1){var s=this.get_unformatted("-->",o);e.push(s)}this.tag_type="START"}else if(a.indexOf("[endif")!=-1)this.tag_type="END",this.unindent();else if(a.indexOf("[cdata[")!=-1){var s=this.get_unformatted("]]>",o);e.push(s),this.tag_type="SINGLE"}else{var s=this.get_unformatted("-->",o);e.push(s),this.tag_type="SINGLE"}else"/"===a.charAt(0)?(this.retrieve_tag(a.substring(1)),this.tag_type="END"):(this.record_tag(a),this.tag_type="START"),this.Utils.in_array(a,this.Utils.extra_liners)&&this.print_newline(!0,this.output);return e.join("")},this.get_unformatted=function(t,e){if(e&&e.indexOf(t)!=-1)return"";var i="",n="",o=!0;do{if(i=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(i,this.Utils.whitespace)){if(!o){this.line_char_count--;continue}if("\n"===i||"\r"===i){n+="\n";for(var a=0;a<this.indent_level;a++)n+=this.indent_string;o=!1,this.line_char_count=0;continue}}n+=i,this.line_char_count++,o=!0}while(n.indexOf(t)==-1);return n},this.get_token=function(){var t;if("TK_TAG_SCRIPT"===this.last_token){var e=this.get_script();return"string"!=typeof e?e:[e,"TK_CONTENT"]}if("CONTENT"===this.current_mode)return t=this.get_content(),"string"!=typeof t?t:[t,"TK_CONTENT"];if("TAG"===this.current_mode){if(t=this.get_tag(),"string"!=typeof t)return t;var i="TK_TAG_"+this.tag_type;return[t,i]}},this.printer=function(t,e,i,n){this.input=t||"",this.output=[],this.indent_character=e||" ",this.indent_string="",this.indent_size=i||2,this.indent_level=0,this.max_char=n||70,this.line_char_count=0;for(var o=0;o<this.indent_size;o++)this.indent_string+=this.indent_character;this.print_newline=function(t,e){if(this.line_char_count=0,e&&e.length){if(!t)for(;this.Utils.in_array(e[e.length-1],this.Utils.whitespace);)e.pop();e.push("\n");for(var i=0;i<this.indent_level;i++)e.push(this.indent_string)}},this.print_token=function(t){this.output.push(t)},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this}var o,a;for(a=new o,a.printer(t,i,e);;){var s=a.get_token();if(a.token_text=s[0],a.token_type=s[1],"TK_EOF"===a.token_type)break;switch(a.token_type){case"TK_TAG_START":case"TK_TAG_SCRIPT":case"TK_TAG_STYLE":a.print_newline(!1,a.output),a.print_token(a.token_text),a.indent(),a.current_mode="CONTENT";break;case"TK_TAG_END":a.print_newline(!0,a.output),a.print_token(a.token_text),a.current_mode="CONTENT";break;case"TK_TAG_SINGLE":a.print_newline(!1,a.output),a.print_token(a.token_text),a.current_mode="CONTENT";break;case"TK_CONTENT":""!==a.token_text&&(a.print_newline(!1,a.output),a.print_token(a.token_text)),a.current_mode="TAG"}a.last_token=a.token_type,a.last_text=a.token_text}return a.output.join("")}return function(e){var i=["__dataHolder_",[Math.random(),Math.random(),Math.random(),Math.random()].join("_").replace(/[^0-9]/g,"_"),"_"].join("_"),n={},o=0;return e=e.replace(/(\")(data:[^\"]*)(\")/g,function(t,e,a,s){var d=i+o++;return n[d]=a,e+d+s}),e=t(e,1,"\t",268435456),e=e.replace(new RegExp(i+"[0-9]+","g"),function(t){return n[t]})}}()})}}var i="component-editor",n=t("common/util"),o=t("H5-editor/config");return e()});