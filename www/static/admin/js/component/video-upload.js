define("component/video-upload",["common/util","component/image-upload","app/config"],function(e){"use strict";function t(e){e=e||$(document);var t=e.find('[data-component="'+d+'"]');n.init(),t.each(function(e,t){var i={target:$(t),id:$(t).attr("data-id"),objId:$(t).attr("data-obj-id"),prefix:$(t).attr("data-prefix"),coverName:$(t).attr("data-cover-name"),coverPath:$(t).attr("data-cover-path"),videoIdName:$(t).attr("data-video-id-name"),videoName:$(t).attr("data-video-name"),videoPath:$(t).attr("data-video-path"),videoId:$(t).attr("data-video-id"),isFree:$(t).attr("data-is-free")},a=new r(i);a.init()})}var i=(e("common/util"),e("component/image-upload")),a=e("app/config"),d="video-upload",o='<div id="uploadVideoBtn" data-toggle="modal" data-target="#upload-video" data-keyboard="false" data-backdrop="false" class="sui-btn btn-primary btn-lg">        </div>                <div id="upload-video" tabindex="-1" role="dialog" data-hasfoot="false"class="sui-modal hide fade">                <div class="modal-dialog">                <div class="modal-content">                <div class="modal-header">                <button type="button" data-dismiss="modal" aria-hidden="true" class="sui-close">×</button>        <h4 class="modal-title">视频上传</h4>        </div>        <div class="modal-body">        <table>        <tr>        <td>封面图：</td>        <td><div data-component="image-upload" class="image-upload" data-count="1" data-obj-id="" data-name="temp_cover" data-value="" data-format="path" data-obj-type="course_video_cover">1</div>        </div></td>        </tr>        <tr>        <td>乐视视频ID：</td>        <td><input name="temp_video" id="temp_video"></td>        </tr>        <tr>        <td>OSS视频链接：</td>        <td>        <span temp_video_path ></span>        <input type="text" style="display: none;" size="40" name="temp_video_path" id="temp_video_path">        </td>        </tr>        </table>        <div class="modal-footer">            <button type="button" data-ok="modal" class="sui-btn btn-primary btn-large">确定</button>            <button type="button" data-dismiss="modal" class="sui-btn btn-default btn-large">取消</button>        </div>        </div>        </div>        </div>',n={videoDomain:["",""],template:o,currentVideo:{},leftPad:function(e,t){return e="00000"+e,e.substring(e.length-t,e.length)},generateDefaultVideoPath:function(){var e=new Date;return"course/"+e.getFullYear()+n.leftPad(e.getMonth()+1+"",2)+"/"+n.leftPad(e.getDate()+"",2)+n.leftPad(e.getHours()+"",2)+n.leftPad(e.getMinutes()+"",2)+(Math.random()+"").substr(2,6)+".mp4"},setCurrentVideo:function(e){this.currentVideo=e},show:function(e){var t=this.tpl;t.find("[data-component=image-upload]").attr("data-value",e.coverPath),t.find("#temp_video").val(e.videoId),t.find("#temp_video_path").val(n.videoDomain[n.currentVideo.item.isFree-0]+(e.videoPath||e.defaultVideoPath)),t.find("span[temp_video_path]").html(n.videoDomain[n.currentVideo.item.isFree-0]+(e.videoPath||e.defaultVideoPath)),i(t),$("#uploadVideoBtn").click()},hide:function(){},ok:function(){return n.currentVideo.item.coverPath=$("#upload-video").find("[name=temp_cover]").val(),n.currentVideo.item.videoId=$("#upload-video").find("[name=temp_video]").val(),n.currentVideo.item.videoPath=$("#upload-video").find("[name=temp_video_path]").val().replace(n.videoDomain[n.currentVideo.item.isFree-0],""),n.currentVideo.render(),!0},remove:function(){if(!confirm("你确定要删除视频吗？"))return!1;if(n.currentVideo.item.id){var e=n.currentVideo.item.id;if(!e)return $.toast("别闹了！"),!1;$.post("/admin.php?m=Admin&c=Course&a=removeVideoAjax",{id:e},function(e){1==e.status?(n.currentVideo.item.coverPath="",n.currentVideo.item.videoId=0,n.currentVideo.item.videoPath="",n.currentVideo.render()):$.toast("删除失败！")},"JSON")}else n.currentVideo.item.coverPath="",n.currentVideo.item.videoId=0,n.currentVideo.item.videoPath="",n.currentVideo.render()},init:function(){this.tpl=$(this.template),$("body").append(this.tpl),i(this.tpl),$("#upload-video").on("okHide",function(){var e=n.ok();return e}),$("#upload-video").on("click","span[temp_video_path]",function(){$(this).hide(),console.log($(this).html()),$("#upload-video").find("input[name=temp_video_path]").val($(this).html()).show()}),$("#upload-video").on("blur","input[name=temp_video_path]",function(){$(this).hide(),console.log($(this).html()),$("#upload-video").find("span[temp_video_path]").html($(this).val()).show()})}},r=function(e){var t=this,i={id:0,objId:0,prefix:"",coverName:"cover_path",coverPath:"",videoIdName:"lecloud_video_id",videoName:"video_path",videoId:0,videoPath:"",isFree:1,defaultVideoPath:n.generateDefaultVideoPath()};this.item={},$.extend(this.item,i,e),this.defaultTemplate='<div class="video-default-btn"><i class="sui-icon icon-touch-plus"></i></div>',this.template='<div class="video-item">                    <a class="del" href="javascript:;"></a>                    <div video-cover="">                    <img width="100" src="'+a.imgCdnUrl+'{{coverPath}}">                <input type="hidden" name="{{prefix}}{{coverName}}" value="{{coverPath}}">                <input type="hidden" name="{{prefix}}{{videoIdName}}" value="{{videoId}}">                <input type="hidden" name="{{prefix}}{{videoName}}" value="{{videoPath}}">                    <input type="hidden" name="{{prefix}}is_free" value="{{isFree}}">                    </div>                </div>',this._getTemplate=function(e){switch(!0){case""!=e.coverPath||0!=e.videoId:return this.template;default:return this.defaultTemplate}},this._compile=function(e){var t=this._getTemplate(e);if(t.indexOf("video-default-btn")==-1)for(var i in e){var a=new RegExp("{{"+i+"}}","g");t=t.replace(a,e[i])}return t},this.render=function(){this.item.target.html(this._compile(this.item))},this.init=function(){var e=this.item.target;this.render(),e.on("click",function(){n.setCurrentVideo(t),console.log(t.item),n.show(t.item)}),e.on("click",".del",function(e){n.setCurrentVideo(t),n.remove(),e.stopPropagation()})}};return t});