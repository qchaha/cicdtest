webpackJsonp([263],{IlOL:function(e,t,i){var a=i("VU/8")(i("ev7+"),i("U8vb"),null,null);e.exports=a.exports},U8vb:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("m-page-list",{attrs:{path:e.api.path,params:e.api.params,columns:e.columns,methods:e.methods,"response-handle":e.responseHandle,"page-info-path":e.pageInfoApi.path,"page-info-params":e.pageInfoApi.params}},[i("m-action-bar",{attrs:{slot:"search"},slot:"search"},[i("m-action-search-bar",{attrs:{"search-condition":e.searchCondition,"search-condition-handle":e.searchConditionHandle}},[i("m-form-item",{attrs:{label:""}},[i("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"datetimerange",format:"yyyy-MM-dd HH:mm",placeholder:"推送时间"},model:{value:e.searchCondition.push_time_selected,callback:function(t){e.$set(e.searchCondition,"push_time_selected",t)},expression:"searchCondition.push_time_selected"}})],1),e._v(" "),i("m-form-item",{attrs:{label:""}},[i("Select",{staticStyle:{width:"200px"},model:{value:e.searchCondition.push_object,callback:function(t){e.$set(e.searchCondition,"push_object",t)},expression:"searchCondition.push_object"}},[i("Option",{attrs:{value:"ALL"}},[e._v("全量")]),e._v(" "),i("Option",{attrs:{value:"TAG"}},[e._v("指定标签")]),e._v(" "),i("Option",{attrs:{value:"UID"}},[e._v("指定uid")]),e._v(" "),i("Option",{attrs:{value:"FILE"}},[e._v("文件播")])],1)],1)],1)],1),e._v(" "),i("m-action-bar",[i("Dropdown",{attrs:{placement:"bottom-start"},on:{"on-click":function(e){}}},[i("Button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.exportData()}}},[i("Icon",{attrs:{type:"ios-download-outline"}}),e._v("\n                导出表格\n            ")],1)],1)],1)],1)},staticRenderFns:[]}},"ev7+":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"list",data:function(){var e=this;return{api:{path:"/boss/backend/push/find-list",params:{fields:"{id,android_title,android_description,ios_description,push_time,create_time,push_object,app_route,audience_count,accept_count,sent_count,open_count,open_rate,status}",push_time:[],push_object:"",limit:24,offset:0}},newSearchApi:{path:"/boss/backend/push/find-list",params:{fields:"{id,android_title,android_description,ios_description,push_time,create_time,push_object,app_route,audience_count,accept_count,sent_count,open_count,open_rate,status}",push_time:[],push_object:"",limit:1e3,offset:0}},cancelApi:{path:"/boss/backend/push/cancel",params:{id:""}},pageInfoApi:{path:"/boss/backend/push/list-page-info",params:{}},searchCondition:{push_object:"",push_time_selected:[],push_time:[]},columns:[{title:"推送内容",key:"ios_description",render:function(e,t){return e("div",[e("p",t.row.id),e("p",t.row.ios_description)])}},{title:"推送时间",width:180,key:"push_time"},{title:"推送对象",key:"push_object"},{title:"理想目标数",width:124,key:"audience_count",sortable:!0},{title:"实际送达数",width:124,key:"sent_count",sortable:!0},{title:"打开量",width:95,key:"open_count",sortable:!0},{title:"打开率",width:95,key:"open_rate",sortable:!0},{title:"操作",key:"action",width:150,align:"center",render:function(t,i){return e.getOperationByStatus(t,i)}}]}},methods:{transformAudience:function(e){var t={UNION:"并集",INTERSECTION:"交集",EXCEPT:"差集",NOT:"非"},i="";if(e){var a=e.split("|"),n=a[1]?a[1]:"";switch(a[0].toUpperCase()){case"ALL":i="全量";break;case"UID":i=e;break;case"TAG":i="标签 "+t[n]+"："+a[2];break;case"FILE_CAST":case"FILE":i="文件播";break;default:i=e}}return i},responseHandle:function(e,t,i){var a=this;return e.data.map(function(e,n){e.push_time=e.push_time?t.$Util.dateFormat(e.push_time,"yyyy-MM-dd hh:mm:ss"):t.$Util.dateFormat(e.create_time,"yyyy-MM-dd hh:mm:ss"),e.open_rate=isNaN(e.open_rate)?e.open_rate:(100*e.open_rate).toFixed(2)+"%",e.push_object=a.transformAudience(e.push_object),1==i&&(e.android_title=e.android_title.replace(/,/g,"，"),e.android_description=e.android_description.replace(/,/g,"，"),e.ios_description=e.ios_description.replace(/,/g,"，"),e.push_object=e.push_object.replace(/,/g,"，"),e.app_route=decodeURI(e.app_route))}),e},exportData:function(){this.newSearchApi.params.push_object=this.searchCondition.push_object,this.newSearchApi.params.push_time=this.getPushTimeDatePickerArray();var e={api:this.newSearchApi};this.$Util.api.get(e,this).then(function(e){e=this.responseHandle(e,this,!0),this.exportCsv({title:["ID","安卓标题","安卓摘要","苹果消息内容","推送对象","跳转路由","推送时间","理想目标数","实际送达数","打开数","打开量"],titleForKey:["id","android_title","android_description","ios_description","push_object","app_route","push_time","audience_count","sent_count","open_count","open_rate"],data:e.data});var t="col1,col2,col3\nvalue1,value2,value3";t=encodeURIComponent(t),aLink.href="data:text/csv;charset=utf-8,"+t,aLink.click()},function(){})},show:function(e){window.location.href="//"+location.hostname+"/admin.php?m=Admin&c=MessagePush&a=detail&id="+e.row.id},searchConditionHandle:function(e){return e.push_time=this.getPushTimeDatePickerArray(),e},getPushTimeDatePickerArray:function(){var e=[];return this.searchCondition.push_time_selected&&(e[0]=this.searchCondition.push_time_selected[0]?Date.parse(this.searchCondition.push_time_selected[0])/1e3:0,e[1]=this.searchCondition.push_time_selected[1]?Date.parse(this.searchCondition.push_time_selected[1])/1e3:0),e},exportCsv:function(e){var t=(e.title,e.titleForKey),i=e.data,a=[];a.push(e.title.join(",")+"\n");for(var n=0;n<i.length;n++){for(var o=[],s=0;s<t.length;s++)o.push(i[n][t[s]]);a.push(o.join(",")+"\n")}var r="data:text/csv;charset=utf-8,"+encodeURIComponent(a.join("")),c=document.createElement("a");c.href=r;var p=this.searchCondition.push_object+Date.parse(new Date)/1e3;c.download="推送数据下载_"+p+".csv",document.body.appendChild(c),c.click(),document.body.removeChild(c)},cancel:function(e,t){this.cancelApi.params.id=e;var i={api:this.cancelApi};this.$Util.api.get(i,this).then(function(e){e.data.result&&(t.elm.disabled=!0,t.elm.innerText="已撤销")})},getOperationByStatus:function(e,t){var i=this,a=[],n=t.row.status;switch(a[0]=e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){i.show(t)}}},"查看"),n){case 0:a[1]=e("Button",{props:{type:"error",size:"small"},on:{click:function(){}}},"失败");break;case 1:a[1]=e("Button",{props:{type:"success",size:"small"},on:{click:function(){}}},"成功");break;case 3:a[1]=e("Button",{props:{type:"info",size:"small"},on:{click:function(){i.cancel(t.row.id,a[1])}}},"撤销");break;case 4:a[1]=e("Button",{props:{type:"warning",size:"small"},on:{click:function(){}}},"已撤销")}return e("div",a)}}}}});