webpackJsonp([183],{"1Yyu":function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Form",{attrs:{model:e.formItem,"label-width":80}},[i("m-card",[i("h3",{staticStyle:{"margin-bottom":"10px"}},[e._v("基本信息")]),e._v(" "),i("Form-item",{attrs:{label:"名称"}},[i("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"名称"},model:{value:e.formItem.name,callback:function(t){e.$set(e.formItem,"name",t)},expression:"formItem.name"}})],1),e._v(" "),i("Form-item",{attrs:{label:"图片"}},[i("m-upload-image",{attrs:{"default-images":e.formItem.imgUrl},on:{"on-success":e.getImageUrl}})],1),e._v(" "),i("Form-item",{attrs:{label:"路由"}},[i("m-app-route",{attrs:{"default-route":e.formItem.appRoute},model:{value:e.formItem.appRoute,callback:function(t){e.$set(e.formItem,"appRoute",t)},expression:"formItem.appRoute"}})],1)],1),e._v(" "),i("m-card",[i("h3",{staticStyle:{"margin-bottom":"10px"}},[e._v("定向投放")]),e._v(" "),i("Form-item",{attrs:{label:"展示对象"}},[i("Select",{staticStyle:{width:"200px"},attrs:{clearable:"",filterable:"",placeholder:"请选择"},model:{value:e.formItem.audience,callback:function(t){e.$set(e.formItem,"audience",t)},expression:"formItem.audience"}},e._l(e.audiences,function(t){return i("Option",{key:t.id,attrs:{value:t.audience}},[e._v(e._s(t.title))])}))],1),e._v(" "),i("Form-item",{attrs:{label:"版本"}},[i("Checkbox-group",{on:{"on-change":e.getPlatforms},model:{value:e.formItem.platforms,callback:function(t){e.$set(e.formItem,"platforms",t)},expression:"formItem.platforms"}},[i("Checkbox",{attrs:{label:"inIos"}},[e._v("iOS")]),e._v(" "),i("Checkbox",{attrs:{label:"inAndroid"}},[e._v("Android")]),e._v(" "),i("Checkbox",{attrs:{label:"inH5"}},[e._v("H5")])],1)],1)],1),e._v(" "),i("m-card",[i("h3",{staticStyle:{"margin-bottom":"10px"}},[e._v("广告位")]),e._v(" "),i("Form-item",{directives:[{name:"show",rawName:"v-show",value:e.showTitleCodes.indexOf(e.formItem.posCode)>=0,expression:"showTitleCodes.indexOf(formItem.posCode) >= 0"}],attrs:{label:"展示标题"}},[i("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"展示标题"},model:{value:e.formItem.title,callback:function(t){e.$set(e.formItem,"title",t)},expression:"formItem.title"}})],1),e._v(" "),i("Form-item",{attrs:{label:"投放位置"}},[i("Select",{staticStyle:{width:"200px"},attrs:{clearable:"",filterable:"",placeholder:"请选择"},model:{value:e.formItem.posCode,callback:function(t){e.$set(e.formItem,"posCode",t)},expression:"formItem.posCode"}},e._l(e.positions,function(t){return i("Option",{key:t.id,attrs:{value:t.pos_code}},[e._v(e._s(t.name))])})),e._v(" "),i("Select",{directives:[{name:"show",rawName:"v-show",value:"mjb_group_s"===e.formItem.posCode,expression:"formItem.posCode==='mjb_group_s'"}],staticStyle:{width:"200px"},attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.formItem.groupId,callback:function(t){e.$set(e.formItem,"groupId",t)},expression:"formItem.groupId"}},e._l(e.groups,function(t){return i("Option",{key:t.group_id,attrs:{value:t.group_id}},[e._v(e._s(t.name))])}))],1),e._v(" "),i("Form-item",{directives:[{name:"show",rawName:"v-show",value:"share_recommend_activity"===e.formItem.posCode||"course_detail"===e.formItem.posCode,expression:"(formItem.posCode ==='share_recommend_activity'||formItem.posCode==='course_detail')"}],attrs:{label:"显示概率"}},[i("Input-number",{staticStyle:{width:"200px"},attrs:{max:100,min:1,placeholder:"概率"},model:{value:e.formItem.displayProbability,callback:function(t){e.$set(e.formItem,"displayProbability",t)},expression:"formItem.displayProbability"}})],1),e._v(" "),e._e(),e._v(" "),i("Form-item",{attrs:{label:"投放时间"}},[i("Row",[i("div",{staticClass:"time"},[i("Date-picker",{attrs:{type:"datetime",placeholder:"选择开始日期"},model:{value:e.formItem.beginTime,callback:function(t){e.$set(e.formItem,"beginTime",t)},expression:"formItem.beginTime"}})],1),e._v(" "),i("div",{staticClass:"time"},[i("Date-picker",{attrs:{type:"datetime",placeholder:"选择结束日期"},model:{value:e.formItem.endTime,callback:function(t){e.$set(e.formItem,"endTime",t)},expression:"formItem.endTime"}})],1)])],1)],1),e._v(" "),i("m-card",[i("Button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("提交")])],1)],1)},staticRenderFns:[]}},"4+30":function(e,t,i){i("LzA9");var o=i("VU/8")(i("itcX"),i("1Yyu"),"data-v-5c52fb96",null);e.exports=o.exports},"4Cwf":function(e,t,i){t=e.exports=i(0)(),t.push([e.i,".time[data-v-5c52fb96]{display:inline-block;width:200px}",""])},LzA9:function(e,t,i){var o=i("4Cwf");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);i("rjj0")("20234f28",o,!0)},itcX:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={update:{api:{path:"/boss/common/banner/banner/update"}},find:{api:{path:"/boss/common/banner/banner/find",params:{fields:"{id,name,title,app_route,img_url,height,width,audience,in_ios,in_android,in_h5,pos_code,display_probability,weight,begin_time,end_time,group_id}",id:0}},responseHandle:function(e){if(0!==e.data.begin_time){var t=new Date;t.setTime(1e3*e.data.begin_time),e.data.begin_time=t}if(0!==e.data.end_time){var i=new Date;i.setTime(1e3*e.data.end_time),e.data.end_time=i}return e}},resource:{api:{path:"/boss/common/banner/banner/edit-page-info",params:{fields:"{positions{id,pos_code,name},audiences{id,title,audience},groups{group_id,name}}"}}}};t.default={name:"edit",data:function(){return{modal:!1,id:this.$route.params.id,formItem:{id:"",name:"",imgUrl:[],width:0,height:0,appRoute:"",audience:"",platforms:[],inIos:0,inAndroid:0,inH5:0,title:"",posCode:"",displayProbability:100,groupId:[],beginTime:"",endTime:"",weight:1},positions:[],audiences:[],showTitleCodes:[],groups:[],loadingState:!1}},methods:{back:function(){location.hash="/common/banner/banner/list"},loadResource:function(){bus.$emit("on-loading");var e=this;this.$Util.api.get(o.resource,e).then(function(t){e.loadingState=!1,e.positions=t.data.form.positions,e.audiences=t.data.form.audiences,e.showTitleCodes=t.data.form.showTitleCodes,e.groups=t.data.form.groups},function(t){bus.$emit("on-loading"),e.$Message.warning("加载资源失败")})},initIds:function(){var e=this.id;if(!parseInt(e))return alert("活动id格式有误"),!1;e=parseInt(e),o.find.api.params.id=e,this.loadFormData(e)},loadFormData:function(e){o.find.api.params.id=e;var t=this;bus.$emit("on-loading"),this.$Util.api.get(o.find,this).then(function(e){if(bus.$emit("on-loading"),!e.data)return t.$Message.warning("活动不存在或数据有误"),!1;e.data.imgUrl=[{url:e.data.img_url}];var i=e.data.group_id.split(",");e.data.groupId=i.map(function(e){return parseInt(e)}),e.data.appRoute=e.data.app_route,e.data.displayProbability=e.data.display_probability,e.data.posCode=e.data.pos_code,e.data.beginTime=e.data.begin_time,e.data.endTime=e.data.end_time,e.data.platforms=[],1===e.data.in_ios&&e.data.platforms.push("inIos"),1===e.data.in_h5&&e.data.platforms.push("inH5"),1===e.data.in_android&&e.data.platforms.push("inAndroid"),this.formItem=e.data,this.formItem.inAndroid=e.data.in_android,this.formItem.inIos=e.data.in_ios,this.formItem.inH5=e.data.in_h5,this.submitEnable=!1},function(e){})},edit:function(){this.modal=!0},getImageUrl:function(e){this.formItem.imgUrl=[{url:e[0].url||""}],this.formItem.height=parseInt(e[0].height)||0,this.formItem.width=parseInt(e[0].width)||0},getPlatforms:function(e){this.formItem.inIos=e.includes("inIos")?1:0,this.formItem.inAndroid=e.includes("inAndroid")?1:0,this.formItem.inH5=e.includes("inH5")?1:0},errorMessage:function(e){this.$Notice.error({title:e})},validateFormData:function(){return""===this.formItem.name||void 0===this.formItem.name?(this.errorMessage("请填写活动名称"),!1):""===this.formItem.imgUrl[0].url||void 0===this.formItem.imgUrl[0].url?(this.errorMessage("请上传图片"),!1):0===this.formItem.posCode.length||this.formItem.posCode==={}||void 0===this.formItem.posCode?(this.errorMessage("广告位信息不能为空"),!1):!(Date.parse(this.formItem.beginTime)>Date.parse(this.formItem.endTime))||(this.errorMessage("开始时间必须小于结束时间"),!1)},getRequestParams:function(){return{id:this.formItem.id,name:this.formItem.name,title:this.formItem.title,width:this.formItem.width,height:this.formItem.height,appRoute:this.formItem.appRoute,audience:this.formItem.audience,inIos:this.formItem.inIos,inAndroid:this.formItem.inAndroid,inH5:this.formItem.inH5,posCode:this.formItem.posCode,displayProbability:this.formItem.displayProbability,groupId:this.formItem.groupId,beginTime:this.formItem.beginTime,endTime:this.formItem.endTime,weight:this.formItem.weight,imgUrl:this.formItem.imgUrl.length>0?this.formItem.imgUrl[0].url:""}},submit:function(){if(this.submitEnable=!0,bus.$emit("on-loading"),this.validateFormData()){var e=this.getRequestParams();this.submitRequest(e)}},submitRequest:function(e){var t=this,i={};i=o.update,this.$Util.api.post(i,JSON.stringify(e),t).then(function(e){if(bus.$emit("on-loading"),0===e.error_code)t.back();else{t.submitEnable=!1;var i="";i+=null===e.error_message?"":e.error_message,i+=null===e.error_description?"":e.error_description,alert(i)}},function(e){})}},created:function(){this.initIds(),this.$nextTick(function(){this.loadResource()})}}}});