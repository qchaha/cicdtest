webpackJsonp([49],{"0gTP":function(e,t,a){var s=a("VU/8")(a("hN5H"),a("Mq3j"),null,null);e.exports=s.exports},"4mPw":function(e,t,a){var s=a("GJtA");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);a("rjj0")("5f1dff55",s,!0)},BVqJ:function(e,t,a){t=e.exports=a(0)(),t.push([e.i,".ivu-card{background:0 0}.ivu-card-shadow,.ivu-card.ivu-card-shadow:hover{box-shadow:none}",""])},GJtA:function(e,t,a){t=e.exports=a(0)(),t.push([e.i,"[class*=span][data-v-ead437ac]{margin-left:0!important}.inlineCard[data-v-ead437ac]{display:inline-block}.inlineCard.A1[data-v-ead437ac]{width:100%}.inlineCard.A2[data-v-ead437ac]{width:50%}.inlineCard.A3[data-v-ead437ac]{width:33.33%}.inlineCard.A4[data-v-ead437ac]{width:25%}.inlineCard.A5[data-v-ead437ac]{width:33.33%}.B1[data-v-ead437ac]{width:400px;float:left}.inlineCard.B2[data-v-ead437ac]{width:100%}.adSenseGroup[data-v-ead437ac],.infomationPanel[data-v-ead437ac]{margin:20px 0}.clear[data-v-ead437ac]{clear:both;overflow:hidden}.hidden[data-v-ead437ac]{display:none!important}.ivu-card[data-v-ead437ac]{background:#fff}.ivu-card-shadow[data-v-ead437ac],.ivu-card.ivu-card-shadow[data-v-ead437ac]:hover{box-shadow:0 1px 1px 0 rgba(0,0,0,.1)}#bottomSubmitCard[data-v-ead437ac]{position:fixed;bottom:0;left:0;width:100%;text-align:center}",""])},Mq3j:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("m-page-edit",{attrs:{"is-loading":e.loadingState}},[a("m-ad-sense-group-form",{attrs:{usage:"add",format:e.format},on:{loading:e.changeLoadingState}})],1)},staticRenderFns:[]}},X5Bp:function(e,t,a){var s=a("BVqJ");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);a("rjj0")("4d7f491f",s,!0)},hN5H:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("uT5Z"),n=a.n(s);t.default={name:"app",components:{MAdSenseGroupForm:n.a},data:function(){return{format:this.$route.params.format,loadingState:!1}},methods:{changeLoadingState:function(){this.loadingState=!this.loadingState}}}},tKwI:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={create:{api:{path:"/boss/common/banner/ad-sense-group/create"}},update:{api:{path:"/boss/common/banner/ad-sense-group/update"}},find:{api:{path:"/boss/common/banner/ad-sense-group/find",params:{fields:"{id,name,business_id,start_time,end_time,adsenses{id,type,format,ratio,items{id,title,subtitle,cover(w:80,h:80){origin},app_route,sort}}}",id:0}},responseHandle:function(e,t){var a=new Date;a.setTime(1e3*e.data.start_time),e.data.start_time=a;var s=new Date;return s.setTime(1e3*e.data.end_time),e.data.end_time=s,e}},resource:{api:{path:"/boss/common/banner/ad-sense-group/add-page-info",params:{}},responseHandle:function(e){return e}}};t.default={name:"MAdSenseGroupForm",props:{format:{type:String,default:"mix"},usage:{type:String,default:"edit"},id:{type:String,default:"0"}},data:function(){return{realFormat:this.format,needClearImage:!1,detailReady:!1,resourceReady:!1,appRouteModelShow:!1,operatingAdSenseGroupIndex:0,operatingAdSenseIndex:0,formatNameMap:{mix:"广告组",B2:"教程",B1:"美图标签"},selectableFormats:{A1:1,A2:2,A3:3,A4:4,A5:5},formats:{A1:1,A2:2,A3:3,A4:4,A5:5,B1:6,B2:7,B4:8},adSenseGroupBaseInfo:{id:0,businessId:0,name:"",startTime:"",endTime:""},adSenseGroups:[],businessList:[]}},computed:{formatName:function(){return this.formatNameMap[this.realFormat]},isB1Format:function(){return"B1"===this.realFormat},isB2Format:function(){return"B2"===this.realFormat},isMixFormat:function(){return"mix"===this.realFormat},titleLength:function(){return"B1"===this.realFormat?4:"B2"===this.realFormat?14:100},subTitleLength:function(){return"B2"===this.realFormat?9:200}},methods:{back:function(){location.hash="/common/banner/ad-sense-group/list"},markOperatingIndexesAfter:function(){if(this.needClearImage){this.adSenseGroups[this.operatingAdSenseGroupIndex].adSenses[this.operatingAdSenseIndex].image=[],this.needClearImage=!1,this.clearOperatingIndexes()}},markOperatingIndexes:function(e,t){this.operatingAdSenseGroupIndex=e,this.operatingAdSenseIndex=t,this.markOperatingIndexesAfter()},isOperatingIndexesUsable:function(){return null!==this.operatingAdSenseGroupIndex&&null!==this.operatingAdSenseIndex},clearOperatingIndexes:function(){this.operatingAdSenseGroupIndex=null,this.operatingAdSenseIndex=null},syncStartTime:function(e){this.adSenseGroupBaseInfo.startTime=new Date(e)},syncEndTime:function(e){this.adSenseGroupBaseInfo.endTime=new Date(e)},syncImages:function(e){return 0===e.lenght||""===e[0].url?(this.needClearImage=!0,!0):!!this.isOperatingIndexesUsable()&&(this.adSenseGroups[this.operatingAdSenseGroupIndex].adSenses[this.operatingAdSenseIndex].image=e,void this.clearOperatingIndexes())},moveUpAdSenseGroup:function(e){if(0===e)return!1;var t=e-1,a=this.adSenseGroups[e];this.$set(this.adSenseGroups,e,this.adSenseGroups[t]),this.$set(this.adSenseGroups,t,a)},moveDownAdSenseGroup:function(e){if(e===this.adSenseGroups.length-1)return!1;var t=e+1,a=this.adSenseGroups[e];this.$set(this.adSenseGroups,e,this.adSenseGroups[t]),this.$set(this.adSenseGroups,t,a)},addAdSenseGroup:function(e){e=e&&"string"==typeof e?e:"A1",e=this.formats[e],this.adSenseGroups.push({id:0,ratio:"1",format:e,adSenses:[{id:0,sort:0,title:"",subTitle:"",route:"",image:[]}]})},removeAdSenseGroup:function(e){if(void 0===this.adSenseGroups[e])return!1;this.adSenseGroups.splice(e,1)},addAdSenseItem:function(e){this.adSenseGroups[e].adSenses.push({id:0,sort:0,title:"",subTitle:"",route:"",image:[]})},removeAdSenseItem:function(e,t){this.adSenseGroups[e].adSenses.splice(t,1)},correctAdSenseItemCountWithFormat:function(e){if(!this.isOperatingIndexesUsable())return!1;var t={1:1,2:2,3:3,4:4,5:3,6:1,7:1,8:4},a=t[e],s=this.adSenseGroups[this.operatingAdSenseGroupIndex].adSenses.length;if(s>a){var n=this.adSenseGroups[this.operatingAdSenseGroupIndex].adSenses.slice(0,a);this.adSenseGroups[this.operatingAdSenseGroupIndex].adSenses=n}else for(var i=0;i<a-s;i++)this.adSenseGroups[this.operatingAdSenseGroupIndex].adSenses.push({id:0,title:"",subTitle:"",route:"",image:[]});this.clearOperatingIndexes()},submit:function(){if(this.validateFormData()){var e=this.getRequestParams(),t=s.create;"edit"===this.usage&&(t=s.update),this.submitRequest(e,t)}},validateFormData:function(){if(""===this.adSenseGroupBaseInfo.name)return this.$Message.warning("基本信息-名称不能为空"),!1;if(""===this.adSenseGroupBaseInfo.startTime)return this.$Message.warning("基本信息-开始时间不能为空"),!1;if(0===this.adSenseGroups.length)return this.$Message.warning("请先添加广告组"),!1;var e=this,t=!0;return this.adSenseGroups.map(function(a){return!/^\d{1,2}(\.\d{1,4})?$/.test(a.ratio)&&e.isMixFormat?(e.$Message.warning("宽高比格式错误"),void(t=!1)):0===a.adSenses.length?(e.$Message.warning("请先添加"+(e.isB1Format?"美图标签":"信息")),void(t=!1)):void a.adSenses.map(function(a){return""===a.title?(e.$Message.warning((e.isB2Format?"标题":"名称")+"不能为空"),void(t=!1)):""===a.subTitle&&e.isB2Format?(e.$Message.warning("描述不能为空"),void(t=!1)):""===a.route?(e.$Message.warning("路由不能为空"),void(t=!1)):0===a.image.length?(e.$Message.warning("图片不能为空"),void(t=!1)):void 0})}),t},getRequestParams:function(){var e={businessId:this.adSenseGroupBaseInfo.businessId,name:this.adSenseGroupBaseInfo.name,startTime:this.adSenseGroupBaseInfo.startTime.getTime()/1e3,endTime:""===this.adSenseGroupBaseInfo.endTime?0:this.adSenseGroupBaseInfo.endTime.getTime()/1e3,adSenses:[]};"edit"===this.usage&&(e.id=this.adSenseGroupBaseInfo.id);var t=this;this.adSenseGroups.map(function(a){var s={id:a.id,ratio:a.ratio,format:a.format,items:[]};if(a.adSenses.map(function(e){var t={id:e.id,title:e.title,subTitle:e.subTitle,route:e.route,sort:e.sort,image:e.image[0].url};s.items.push(t)}),!t.isB1Format){var n=s.items.length;s.items.map(function(e){e.sort=n,n--})}e.adSenses.push(s)});var a=e.adSenses.length;return e.adSenses.map(function(e){e.sort=a,a--}),e},submitRequest:function(e,t){bus.$emit("on-loading");var a=this;this.$Util.api.post(t,e,a).then(function(e){a.$Notice.success({title:"请求成功",desc:""}),a.back()},function(e){bus.$emit("on-loading"),a.$Notice.warning({title:"请求失败",desc:""})})},loadResource:function(){var e=this;this.$Util.api.get(s.resource,e).then(function(t){e.businessList=t.data.form.businesses,this.resourceReady=!0;var a="add"===e.usage||("edit"===e.usage||"copy"===e.usage)&&e.detailReady;e.resourceReady&&a&&bus.$emit("on-loading")},function(t){this.resourceReady=!0;var a="add"===e.usage||("edit"===e.usage||"copy"===e.usage)&&e.detailReady;e.resourceReady&&a&&bus.$emit("on-loading"),e.$Notice.warning({title:"加载资源失败",desc:""})})},loadAdSenseGroup:function(){var e=this;this.$Util.api.get(s.find,e).then(function(t){this.detailReady=!0,e.resourceReady&&e.detailReady&&bus.$emit("on-loading"),1===t.data.adsenses.length?e.realFormat=e.getRealFormatByFormat(t.data.adsenses[0].type):e.realFormat="mix",e.adSenseGroupBaseInfo.name=t.data.name,e.adSenseGroupBaseInfo.businessId=parseInt(t.data.business_id),e.adSenseGroupBaseInfo.startTime=t.data.start_time,e.adSenseGroupBaseInfo.endTime=0===parseInt(t.data.end_time.getTime())?"":t.data.end_time;var a=[];t.data.adsenses.map(function(e){var t={id:e.id,ratio:e.ratio,format:e.format,adSenses:[]};e.items.map(function(e){var a={id:e.id,title:e.title,subTitle:e.subtitle,route:e.app_route,sort:e.sort,image:[{url:e.cover.origin}]};t.adSenses.push(a)}),a.push(t)}),e.adSenseGroups=a},function(t){this.detailReady=!0,e.resourceReady&&e.detailReady&&bus.$emit("on-loading"),e.$Notice.warning({title:"加载广告组详情失败",desc:""})})},getRealFormatByFormat:function(e){return"B1"===e?"B1":"B2"===e?"B2":"mix"},initIds:function(){if("edit"===this.usage||"copy"===this.usage){var e=this.id;if(!parseInt(e))return alert("广告组格式有误"),!1;e=parseInt(e),this.adSenseGroupBaseInfo.id=e,s.find.api.params.id=e}}},created:function(){this.initIds(),"add"===this.usage&&("B1"===this.realFormat&&this.addAdSenseGroup("B1"),"B2"===this.realFormat&&this.addAdSenseGroup("B2")),"edit"!==this.usage&&"copy"!==this.usage||(s.resource.api.path="/boss/common/banner/ad-sense-group/edit-page-info"),this.$nextTick(function(){bus.$emit("on-loading"),this.loadResource(),"edit"!==this.usage&&"copy"!==this.usage||this.loadAdSenseGroup()})}}},uT5Z:function(e,t,a){a("4mPw"),a("X5Bp");var s=a("VU/8")(a("tKwI"),a("xvfw"),"data-v-ead437ac",null);e.exports=s.exports},xvfw:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Form",{attrs:{"label-width":60}},[a("Card",{staticClass:"infomationPanel"},[a("h2",{staticStyle:{margin:"10px 0"}},[e._v("\n                基本信息\n            ")]),e._v(" "),a("Form-item",{attrs:{required:"",label:"部门"}},[a("Select",{staticStyle:{width:"300px"},model:{value:e.adSenseGroupBaseInfo.businessId,callback:function(t){e.$set(e.adSenseGroupBaseInfo,"businessId",t)},expression:"adSenseGroupBaseInfo.businessId"}},e._l(e.businessList,function(t,s){return a("Option",{key:t.id,attrs:{value:s}},[e._v("\n                        "+e._s(t)+"\n                    ")])}))],1),e._v(" "),a("Form-item",{attrs:{required:"",label:"名称"}},[a("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:100,placeholder:"请输入...(100个字以内)"},model:{value:e.adSenseGroupBaseInfo.name,callback:function(t){e.$set(e.adSenseGroupBaseInfo,"name",t)},expression:"adSenseGroupBaseInfo.name"}})],1),e._v(" "),a("Form-item",{attrs:{label:""}},[a("Tag",{attrs:{type:"border",color:"blue"}},[e._v("开始时间必选,结束时间非必须")])],1),e._v(" "),a("Form-item",{attrs:{label:"投放时间"}},[a("Date-picker",{staticStyle:{width:"170px",display:"inline-block"},attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:"选择开始日期和时间"},on:{"on-change":e.syncStartTime},model:{value:e.adSenseGroupBaseInfo.startTime,callback:function(t){e.$set(e.adSenseGroupBaseInfo,"startTime",t)},expression:"adSenseGroupBaseInfo.startTime"}}),e._v(" "),a("Date-picker",{staticStyle:{width:"170px",display:"inline-block"},attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:"选择结束日期和时间"},on:{"on-change":e.syncEndTime},model:{value:e.adSenseGroupBaseInfo.endTime,callback:function(t){e.$set(e.adSenseGroupBaseInfo,"endTime",t)},expression:"adSenseGroupBaseInfo.endTime"}})],1)],1),e._v(" "),a("Card",{staticClass:"infomationPanel",staticStyle:{"margin-bottom":"100px"}},[a("h2",{staticStyle:{margin:"10px 0"}},[e._v("\n                "+e._s(e.formatName)+"\n            ")]),e._v(" "),e._l(e.adSenseGroups,function(t,s){return a("div",{key:t.id,staticClass:"adSenseGroup clear"},[a("Rol",[a("Col",{attrs:{span:"23"}},[a("Card",{staticClass:"clear",attrs:{bordered:e.isMixFormat,"dis-hover":!e.isMixFormat,padding:"2"}},[a("Form-item",{class:{hidden:!e.isMixFormat},staticStyle:{width:"300px"},attrs:{required:"",label:"类型"}},[a("Select",{staticStyle:{width:"300px"},on:{"on-change":e.correctAdSenseItemCountWithFormat},nativeOn:{click:function(t){e.markOperatingIndexes(s,0)}},model:{value:t.format,callback:function(a){e.$set(t,"format",a)},expression:"adSenseGroup.format"}},e._l(e.selectableFormats,function(t,s){return a("Option",{key:t,attrs:{value:t}},[e._v(e._s(s)+"\n                                ")])}))],1),e._v(" "),a("Form-item",{class:{hidden:!e.isMixFormat},attrs:{required:"",label:"宽高比"}},[a("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:7,placeholder:"请输入...(2位整数+4位小数)"},model:{value:t.ratio,callback:function(a){e.$set(t,"ratio",a)},expression:"adSenseGroup.ratio"}})],1),e._v(" "),e._l(t.adSenses,function(n,i){return a("div",{staticClass:"clear",staticStyle:{margin:"10px 0"},style:{display:e.isMixFormat?"inline-block":"block",width:e.isMixFormat?"auto":"100%"}},[a("Card",{key:n.id,class:{A1:1===t.format,A2:2===t.format,A3:3===t.format,A4:4===t.format,A5:5===t.format,B1:6===t.format,B2:7===t.format,inlineCard:!e.isB1Format},attrs:{padding:e.isB1Format?10:0,bordered:e.isB1Format,"dis-hover":!e.isB1Format}},[a("Form-item",{class:{hidden:!e.isB1Format},attrs:{required:"",label:"权重"}},[a("Input-number",{staticStyle:{width:"300px"},attrs:{max:65535,min:0},model:{value:n.sort,callback:function(t){e.$set(n,"sort",t)},expression:"adSense.sort"}})],1),e._v(" "),a("Form-item",{attrs:{required:"",label:e.isB2Format?"标题":"名称"}},[a("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:e.titleLength,placeholder:"请输入...("+e.titleLength+"个字以内)"},model:{value:n.title,callback:function(t){e.$set(n,"title",t)},expression:"adSense.title"}})],1),e._v(" "),a("Form-item",{class:{hidden:!e.isB2Format},attrs:{required:"",label:"描述"}},[a("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:e.subTitleLength,placeholder:"请输入...("+e.subTitleLength+"个字以内)"},model:{value:n.subTitle,callback:function(t){e.$set(n,"subTitle",t)},expression:"adSense.subTitle"}})],1),e._v(" "),e.isB2Format?a("Form-item",{attrs:{required:"",label:"图片"}},[a("m-upload-image",{attrs:{"default-images":n.image},on:{"on-success":e.syncImages},nativeOn:{click:function(t){e.markOperatingIndexes(s,i)}}})],1):e._e(),e._v(" "),a("Form-item",{attrs:{required:"",label:"路由"}},[a("m-app-route",{staticStyle:{width:"100%"},attrs:{"default-route":n.route},model:{value:n.route,callback:function(t){e.$set(n,"route",t)},expression:"adSense.route"}})],1),e._v(" "),e.isB2Format?e._e():a("Form-item",{attrs:{required:"",label:"图片"}},[a("m-upload-image",{attrs:{"default-images":n.image},on:{"on-success":e.syncImages},nativeOn:{click:function(t){e.markOperatingIndexes(s,i)}}})],1)],1),e._v(" "),a("Button",{class:{hidden:!e.isB1Format},staticStyle:{margin:"0 10px"},attrs:{type:"ghost",size:"small"},on:{click:function(t){e.removeAdSenseItem(s,i)}}},[e._v("删除\n                                ")])],1)}),e._v(" "),a("Rol",[a("Col",{attrs:{span:"24"}},[a("Button",{class:{hidden:!e.isB1Format},staticStyle:{margin:"10px 0"},attrs:{type:"ghost",size:"small"},on:{click:function(t){e.addAdSenseItem(s)}}},[e._v("+ 添加\n\n                            ")])],1)],1)],2)],1),e._v(" "),a("Col",{attrs:{span:"1"}},[a("Button-group",{class:{hidden:!e.isMixFormat},attrs:{vertical:"",size:"small"}},[a("Button",{attrs:{type:"ghost",disabled:0==s},on:{click:function(t){e.moveUpAdSenseGroup(s)}}},[e._v("上移\n                        ")]),e._v(" "),a("Button",{attrs:{type:"ghost",disabled:s==e.adSenseGroups.length-1},on:{click:function(t){e.moveDownAdSenseGroup(s)}}},[e._v("下移\n                        ")]),e._v(" "),a("Button",{attrs:{type:"ghost"},on:{click:function(t){e.removeAdSenseGroup(s)}}},[e._v("删除")])],1)],1)],1)],1)}),e._v(" "),a("p",[a("Button",{class:{hidden:!e.isMixFormat},attrs:{type:"ghost"},on:{click:e.addAdSenseGroup}},[e._v("+ 添加")])],1)],2),e._v(" "),a("Card",{attrs:{id:"bottomSubmitCard"}},[a("Form-item",[a("i-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("保存")]),e._v(" "),a("i-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:e.back}},[e._v("取消")])],1)],1)],1)],1)},staticRenderFns:[]}}});