webpackJsonp([84],{"13mc":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={create:{api:{path:"/boss/common/banner/ad-sense-group/create"}},update:{api:{path:"/boss/common/banner/ad-sense-group/update"}},find:{api:{path:"/boss/common/banner/ad-sense-group/find",params:{fields:"{id,name,business_id,start_time,end_time,audience,adsenses{id,type,format,ratio,items{id,title,subtitle,cover(w:80,h:80){origin},app_route,sort}}}",id:0}},responseHandle:function(e,t){var a=new Date;a.setTime(1e3*e.data.start_time),e.data.start_time=a;var i=new Date;return i.setTime(1e3*e.data.end_time),e.data.end_time=i,e}},resource:{api:{path:"/boss/common/banner/ad-sense-group/add-page-info",params:{fields:"{audience{id,title}}"}},responseHandle:function(e){return e}}};t.default={name:"MAdSenseGroupFormWithPosition",props:{usage:{type:String,default:"edit"},id:{type:String,default:"0"}},data:function(){return{formats:"",adSenses:[],audiences:[],adSenseGroupBaseInfo:{id:0,businessId:0,position:0,name:"",startTime:"",endTime:"",audience:0}}},computed:{fromUserList:function(){return-1!=[2,5,6,7,11,12,13].indexOf(parseInt(this.adSenseGroupBaseInfo.position))}},methods:{back:function(){location.hash="/common/banner/ad-sense-group/"+bus.data.listRouteTail},syncStartTime:function(e){this.adSenseGroupBaseInfo.startTime=new Date(e)},syncEndTime:function(e){this.adSenseGroupBaseInfo.endTime=new Date(e)},submit:function(){if(!this.validateBusData())return!1;if(this.validateFormData()){var e=this.getRequestParams(),t=i.create;"edit"===this.usage&&(t=i.update),this.submitRequest(e,t)}},validateFormData:function(){if(""===this.adSenseGroupBaseInfo.name)return this.$Notice.warning({title:"基本信息-名称不能为空",desc:""}),!1;if(""===this.adSenseGroupBaseInfo.startTime)return this.$Notice.warning({title:"基本信息-开始时间不能为空",desc:""}),!1;if(this.adSenseGroupBaseInfo.endTime instanceof Date&&this.adSenseGroupBaseInfo.startTime>=this.adSenseGroupBaseInfo.endTime)return this.$Notice.warning({title:"基本信息-开始时间须小于结束时间",desc:""}),!1;if(0===this.adSenses.length)return this.$Notice.warning({title:"请先添加广告组",desc:""}),!1;var e=this,t=!0;return this.adSenses.map(function(a){if(!/^\d{1,2}(\.\d{1,4})?$/.test(a.ratio))return e.$Notice.warning({title:"宽高比格式错误",desc:""}),void(t=!1);a.items.map(function(a){return""===a.title?(e.$Notice.warning({title:"名称不能为空",desc:""}),void(t=!1)):""===a.app_route?(e.$Notice.warning({title:"路由不能为空",desc:""}),void(t=!1)):0===a.image.length||""===a.image[0].url?(e.$Notice.warning({title:"图片不能为空",desc:""}),void(t=!1)):void 0})}),t},validateBusData:function(){var e=!0;return void 0!==bus.data&&void 0!==bus.data.position&&void 0!==bus.data.adSenseFormats&&void 0!==bus.data.listRouteTail||(this.$Notice.warning({title:"请从列表页正常操作进入此页面...",desc:""}),e=!1),e},getRequestParams:function(){var e={businessId:this.adSenseGroupBaseInfo.businessId,position:this.adSenseGroupBaseInfo.position,name:this.adSenseGroupBaseInfo.name,startTime:this.adSenseGroupBaseInfo.startTime.getTime()/1e3,endTime:""===this.adSenseGroupBaseInfo.endTime?0:this.adSenseGroupBaseInfo.endTime.getTime()/1e3,audience:this.adSenseGroupBaseInfo.audience,adSenses:[]};"edit"===this.usage&&(e.id=this.adSenseGroupBaseInfo.id);return this.adSenses.map(function(t){var a={id:t.id,ratio:t.ratio,format:t.format,sort:t.sort,items:[]};t.items.map(function(e){var t={id:e.id,title:e.title,subTitle:e.subTitle,route:e.app_route,sort:e.sort,image:e.image[0].url};a.items.push(t)}),e.adSenses.push(a)}),e},submitRequest:function(e,t){bus.$emit("on-loading");var a=this;this.$Util.api.post(t,e,a).then(function(e){a.$Notice.success({title:"请求成功",desc:""}),a.back()},function(e){bus.$emit("on-loading"),a.$Notice.warning({title:"请求失败",desc:""})})},loadResource:function(){bus.$emit("on-loading");var e=this;return this.$Util.api.get(i.resource,e).then(function(e){var t=e.data.form.audiences?e.data.form.audiences:[],a=this;t.map(function(e){a.audiences.push({id:e.id,title:e.title})}),bus.$emit("on-loading"),"edit"!==this.usage&&"copy"!==this.usage||a.$nextTick(function(){a.loadAdSenseGroup()})},function(t){bus.$emit("on-loading"),e.$Notice.warning({title:"加载广告组详情失败",desc:""})}),!1},loadAdSenseGroup:function(){bus.$emit("on-loading");var e=this;this.$Util.api.get(i.find,e).then(function(t){e.adSenseGroupBaseInfo.name=t.data.name,e.adSenseGroupBaseInfo.businessId=parseInt(t.data.business_id),e.adSenseGroupBaseInfo.startTime=t.data.start_time,e.adSenseGroupBaseInfo.endTime=0===parseInt(t.data.end_time.getTime())?"":t.data.end_time,e.adSenseGroupBaseInfo.audience=parseInt(t.data.audience);var a=[];t.data.adsenses.map(function(e){var t={id:e.id,ratio:e.ratio,format:e.format,items:[]};e.items.map(function(e){var a={id:e.id,title:e.title,subTitle:e.subtitle,app_route:e.app_route,sort:e.sort,image:[{url:e.cover.origin}]};t.items.push(a)}),a.push(t)}),e.adSenses=a,bus.$emit("on-loading")},function(t){bus.$emit("on-loading"),e.$Notice.warning({title:"加载广告组详情失败",desc:""})})},initIds:function(){if("edit"===this.usage||"copy"===this.usage){var e=this.id;if(!parseInt(e))return alert("广告组格式有误"),!1;e=parseInt(e),this.adSenseGroupBaseInfo.id=e,i.find.api.params.id=e}},initBusData:function(){this.formats=bus.data.adSenseFormats,this.adSenseGroupBaseInfo.position=bus.data.position}},created:function(){this.validateBusData(),this.initIds(),this.initBusData(),this.usage,"edit"!==this.usage&&"copy"!==this.usage||(i.resource.api.path="/boss/common/banner/ad-sense-group/edit-page-info"),this.$nextTick(function(){this.loadResource()})}}},"1XGy":function(e,t,a){t=e.exports=a(0)(),t.push([e.i,".adSenseGroup[data-v-0ea88326],.infomationPanel[data-v-0ea88326]{margin:20px 0}#bottomSubmitCard[data-v-0ea88326]{position:fixed;bottom:0;left:0;width:100%;text-align:center}",""])},"1z1H":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("PVoo"),n=a.n(i);t.default={name:"app",components:{MAdSenseGroupFormWithPosition:n.a},data:function(){return{id:this.$route.params.id,loadingState:!1}},methods:{changeLoadingState:function(){this.loadingState=!this.loadingState}}}},CgPm:function(e,t,a){var i=a("VU/8")(a("1z1H"),a("oHAT"),null,null);e.exports=i.exports},PVoo:function(e,t,a){a("thRt");var i=a("VU/8")(a("13mc"),a("yrNQ"),"data-v-0ea88326",null);e.exports=i.exports},oHAT:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("m-page-edit",{attrs:{"is-loading":e.loadingState}},[a("m-ad-sense-group-form-with-position",{attrs:{usage:"edit",id:e.id},on:{loading:e.changeLoadingState}})],1)},staticRenderFns:[]}},thRt:function(e,t,a){var i=a("1XGy");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("50cc172a",i,!0)},yrNQ:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Form",{attrs:{"label-width":60}},[a("Card",{staticClass:"infomationPanel"},[a("h2",{staticStyle:{margin:"10px 0"}},[e._v("\n                基本信息\n            ")]),e._v(" "),a("Form-item",{attrs:{required:"",label:"名称"}},[a("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:100,placeholder:"请输入...(100个字以内)"},model:{value:e.adSenseGroupBaseInfo.name,callback:function(t){e.$set(e.adSenseGroupBaseInfo,"name",t)},expression:"adSenseGroupBaseInfo.name"}})],1),e._v(" "),a("Form-item",{attrs:{label:""}},[a("Tag",{attrs:{type:"border",color:"blue"}},[e._v("开始时间必选,结束时间非必须")])],1),e._v(" "),e.fromUserList?a("Form-item",{attrs:{label:"展示人群",required:""}},[a("Select",{staticStyle:{width:"200px"},attrs:{filterable:""},model:{value:e.adSenseGroupBaseInfo.audience,callback:function(t){e.$set(e.adSenseGroupBaseInfo,"audience",t)},expression:"adSenseGroupBaseInfo.audience"}},[a("Option",{attrs:{value:0}},[e._v("不限")]),e._v(" "),e._l(e.audiences,function(t){return a("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.title))])})],2)],1):e._e(),e._v(" "),a("Form-item",{attrs:{label:"投放时间"}},[a("Date-picker",{staticStyle:{width:"170px",display:"inline-block"},attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:"选择开始日期和时间"},on:{"on-change":e.syncStartTime},model:{value:e.adSenseGroupBaseInfo.startTime,callback:function(t){e.$set(e.adSenseGroupBaseInfo,"startTime",t)},expression:"adSenseGroupBaseInfo.startTime"}}),e._v(" "),a("Date-picker",{staticStyle:{width:"170px",display:"inline-block"},attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:"选择结束日期和时间"},on:{"on-change":e.syncEndTime},model:{value:e.adSenseGroupBaseInfo.endTime,callback:function(t){e.$set(e.adSenseGroupBaseInfo,"endTime",t)},expression:"adSenseGroupBaseInfo.endTime"}})],1)],1),e._v(" "),a("Card",{staticClass:"infomationPanel",staticStyle:{"margin-bottom":"100px"}},[a("h2",{staticStyle:{margin:"10px 0"}},[e._v("\n                广告组\n            ")]),e._v(" "),a("MAdSenseGroup",{attrs:{formats:e.formats,b1Combinable:!0,b2Combinable:!0,c1Combinable:!0},model:{value:e.adSenses,callback:function(t){e.adSenses=t},expression:"adSenses"}})],1),e._v(" "),a("Card",{attrs:{id:"bottomSubmitCard"}},[a("Form-item",[a("i-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("保存")]),e._v(" "),a("i-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:e.back}},[e._v("取消")])],1)],1)],1)],1)},staticRenderFns:[]}}});