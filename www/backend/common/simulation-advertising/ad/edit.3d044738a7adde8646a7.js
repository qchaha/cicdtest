webpackJsonp([72],{"8HBi":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"padding-top":"20px"}},[a("Form",{ref:"formItem",attrs:{model:t.formItem,"label-width":60,rules:t.ruleValidate}},[a("Form-item",{attrs:{label:"广告名称",prop:"name"}},[a("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"广告名称"},model:{value:t.formItem.name,callback:function(e){t.$set(t.formItem,"name",e)},expression:"formItem.name"}})],1),t._v(" "),a("Form-item",{attrs:{label:"投放位置",prop:"position_id"}},[a("i-select",{staticStyle:{width:"260px"},model:{value:t.formItem.position_id,callback:function(e){t.$set(t.formItem,"position_id",e)},expression:"formItem.position_id"}},t._l(t.formItem.positions,function(e){return a("i-option",{attrs:{value:e.id}},[t._v("\n                    "+t._s(e.name)+"\n                ")])}))],1),t._v(" "),a("Form-item",{attrs:{label:"图片"}},[a("m-upload-image",{attrs:{"default-images":t.formItem.image},on:{"on-success":t.syncImage}})],1),t._v(" "),a("Form-item",{attrs:{label:"标签",prop:"label"}},t._l(t.formItem.labels,function(e,i){return a("RadioGroup",{on:{"on-change":t.changeLabel},model:{value:t.formItem.label,callback:function(e){t.$set(t.formItem,"label",e)},expression:"formItem.label"}},[a("Radio",{attrs:{value:i,label:i}},[a("span",[t._v(t._s(e))])])],1)})),t._v(" "),a("Form-item",{attrs:{label:"头像文案",prop:"avatar_title"}},[a("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"默认提示文字"},model:{value:t.formItem.avatar_title,callback:function(e){t.$set(t.formItem,"avatar_title",e)},expression:"formItem.avatar_title"}})],1),t._v(" "),a("Form-item",{attrs:{label:"头像"}},[a("m-upload-image",{attrs:{"default-images":t.formItem.avatar},on:{"on-success":t.syncAvatar}})],1),t._v(" "),a("Form-item",{attrs:{label:"置顶时间"}},[a("Row",[a("div",{staticClass:"time"},[a("Date-picker",{attrs:{type:"datetime",placeholder:"置顶开始日期时间"},model:{value:t.formItem.top_start_time,callback:function(e){t.$set(t.formItem,"top_start_time",e)},expression:"formItem.top_start_time"}})],1),t._v(" "),a("div",{staticClass:"time"},[a("Date-picker",{attrs:{type:"datetime",placeholder:"置顶结束日期时间"},model:{value:t.formItem.top_end_time,callback:function(e){t.$set(t.formItem,"top_end_time",e)},expression:"formItem.top_end_time"}})],1)])],1),t._v(" "),t._l(t.formItem.show_times,function(e,i){return a("Form-item",{attrs:{label:"投放时间",prop:"show_times"}},[a("Row",[a("div",{staticClass:"time"},[a("Date-picker",{attrs:{type:"datetime",placeholder:"选择开始日期时间"},model:{value:e.start_time,callback:function(a){t.$set(e,"start_time",a)},expression:"item.start_time"}})],1),t._v(" "),a("div",{staticClass:"time"},[a("Date-picker",{attrs:{type:"datetime",placeholder:"选择结束日期时间"},model:{value:e.end_time,callback:function(a){t.$set(e,"end_time",a)},expression:"item.end_time"}})],1),t._v(" "),a("div",{staticClass:"delete"},[a("Button",{staticStyle:{"background-color":"#fff"},attrs:{type:"ghost"},on:{click:function(e){t.handleDelete(i)}}},[t._v("删除")])],1)])],1)}),t._v(" "),"add"==t.usage?a("Form-item",[a("Row",{attrs:{span:"3"}},[a("i-col",{attrs:{span:"3"}},[a("Button",{staticStyle:{"background-color":"#fff"},attrs:{type:"ghost",long:"",icon:"plus-round"},on:{click:t.handleAdd}},[t._v("新增")])],1)],1)],1):t._e(),t._v(" "),a("Form-item",{attrs:{label:"路由"}},[a("m-app-route",{attrs:{placeholder:"选择路由","default-route":t.formItem.app_route},on:{"on-ok":t.handleRoute}})],1),t._v(" "),a("Form-item",[a("i-button",{attrs:{type:"primary",disabled:t.submitEnable},on:{click:function(e){t.handleSubmit("formItem")}}},[t._v("提交")])],1)],2)],1)},staticRenderFns:[]}},NPF1:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={create:{api:{path:"/boss/common/simulation-advertising/ad/create"}},update:{api:{path:"/boss/common/simulation-advertising/ad/update"}},find:{api:{path:"/boss/common/simulation-advertising/ad/find",params:{fields:"{id,name,start_time,end_time,image(w:80,h:80){origin,width,height},avatar_title,avatar(w:80,h:80){origin,width,height},top_start_time,top_end_time,app_route,positions{id,name},position_id,labels,label}",id:0}},responseHandle:function(t){for(var e=["top_start_time","top_end_time","start_time","end_time"],a=0;a<e.length;a++)if(0!==t.data[e[a]]){var i=new Date;i.setTime(1e3*t.data[e[a]]),t.data[e[a]]=i}else t.data[e[a]]="";return t}},findResources:{api:{path:"/boss/common/simulation-advertising/ad/find-resources"}}};e.default={name:"MSimulationAdvertisingForm",props:{id:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{formItem:{id:"",name:"",position_id:0,positions:[],image:[],label:0,labels:[],avatar_title:"",avatar:[],top_start_time:"",top_end_time:"",show_times:[{start_time:0,end_time:0}],app_route:""},ruleValidate:{name:[{required:!0,message:"名称不能为空",trigger:"blur"}],avatar_title:[{type:"string",required:!0,message:"头像文案不能为空",trigger:"blur"}],position_id:[{type:"number",required:!0,message:"投放位置不能为空",trigger:"blur"}],label:[{type:"number",required:!0,message:"请选择标签",trigger:"change"}],show_times:[{type:"array",required:!0,message:"投放时间不能为空",trigger:"blur"}]}}},methods:{back:function(){location.hash="/common/simulation-advertising/ad/list"},handleDelete:function(t){this.formItem.show_times.splice(t,1)},handleAdd:function(){this.formItem.show_times.push({start_time:0,end_time:0})},changeLabel:function(t){this.formItem.label=t},syncImage:function(t){this.formItem.image=t},syncAvatar:function(t){this.formItem.avatar=t},loadAddFormData:function(){var t=this;this.$Util.api.get(i.findResources,this).then(function(e){if(bus.$emit("on-loading"),!e.data)return t.$Message.warning("位置不存在或数据有误"),!1;t.formItem.positions=e.data.positions,t.formItem.labels=e.data.labels},function(t){})},loadEditFormData:function(t){i.find.api.params.id=t;var e=this;this.$Util.api.get(i.find,this).then(function(t){if(bus.$emit("on-loading"),!t.data)return e.$Message.warning("广告不存在或数据有误"),!1;if(e.submitEnable=!1,e.formItem=t.data,""!==t.data.labels)for(var a in t.data.labels)t.data.label==t.data.labels[a]&&(e.formItem.label=parseInt(a));e.formItem.position_id=parseInt(t.data.position_id),""!==t.data.image.origin&&(e.formItem.image=[{url:t.data.image.origin}]),""!==t.data.avatar.origin&&(e.formItem.avatar=[{url:t.data.avatar.origin}]),e.formItem.show_times=[{start_time:t.data.start_time,end_time:t.data.end_time}]},function(t){})},handleRoute:function(t){this.formItem.app_route=t},handleSubmit:function(t){var e=this;this.$refs[t].validate(function(t){if(t){if(!e.validateFormData())return;var a=e.getRequestParams();e.$Message.success("提交成功!"),e.submitRequest(a)}else e.$Message.error("表单验证失败!")})},validateFormData:function(){if((""!==this.formItem.top_start_time||""!==this.formItem.top_end_time)&&this.formItem.top_start_time>=this.formItem.top_end_time)return this.$Notice.warning({title:"置顶开始时间必须小于结束时间",desc:""}),!1;if(""===this.formItem.app_route)return this.$Notice.warning({title:"路由不能为空",desc:""}),!1;for(var t in this.formItem.show_times){var e=this.formItem.show_times[t];if((""!==e.end_time||void 0!==e.end_time)&&Date.parse(e.start_time)>=Date.parse(e.end_time))return this.$Notice.warning({title:"投放开始时间必须小于结束时间",desc:""}),!1}return!0},getRequestParams:function(){var t={id:this.formItem.id,name:this.formItem.name,position_id:this.formItem.position_id,avatar_title:this.formItem.avatar_title,image:[],avatar:[],app_route:this.formItem.app_route,show_times:[],label:this.formItem.label};""!==this.formItem.top_start_time&&(t.top_start_time=this.formItem.top_start_time.getTime()/1e3),""!==this.formItem.top_end_time&&(t.top_end_time=this.formItem.top_end_time.getTime()/1e3);for(var e in this.formItem.image){var a=this.formItem.image[e];if(""!==a.url){var i={width:a.width,height:a.height,path:a.url};t.image.push(i)}}for(var r in this.formItem.avatar){var o=this.formItem.avatar[r];if(""!==o.url){var s={width:o.width,height:o.height,path:o.url};t.avatar.push(s)}}for(var m in this.formItem.show_times){var n=this.formItem.show_times[m],l={start_time:n.start_time.getTime()/1e3,end_time:n.end_time.getTime()/1e3};t.show_times.push(l)}return t},submitRequest:function(t){this.submitEnable=!0,bus.$emit("on-loading");var e={};e="edit"===this.usage?i.update:i.create;var a=this;this.$Util.api.post(e,t,a).then(function(){a.back()},function(){bus.$emit("on-loading"),a.$Message.warning(""),a.submitEnable=!1})}},created:function(){var t=this;this.$nextTick(function(){if("edit"===t.usage){bus.$emit("on-loading");var e=t.id;if(t.formItem.id=e,!parseInt(t.formItem.id))return alert("广告id格式有误"),!1;this.loadEditFormData(e)}else"add"===t.usage&&(bus.$emit("on-loading"),this.loadAddFormData())})}}},gMW3:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("qDCx"),r=a.n(i);e.default={name:"app",components:{MSimulationAdvertisingForm:r.a},data:function(){return{id:this.$route.params.id}}}},"ltT+":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("m-page-edit",[a("m-simulation-advertising-form",{attrs:{usage:"edit",id:t.id}})],1)},staticRenderFns:[]}},plkb:function(t,e,a){var i=a("VU/8")(a("gMW3"),a("ltT+"),null,null);t.exports=i.exports},qDCx:function(t,e,a){a("qwq9");var i=a("VU/8")(a("NPF1"),a("8HBi"),"data-v-50b37cd0",null);t.exports=i.exports},qwq9:function(t,e,a){var i=a("tLcM");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("862b36e2",i,!0)},tLcM:function(t,e,a){e=t.exports=a(0)(),e.push([t.i,".time[data-v-50b37cd0]{display:inline-block;width:200px}.delete[data-v-50b37cd0]{display:inline-block}[class*=span][data-v-50b37cd0]{margin-left:0}",""])}});