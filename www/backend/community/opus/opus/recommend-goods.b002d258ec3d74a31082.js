webpackJsonp([93],{"4Lkl":function(o,e,s){var t=s("8ZTF");"string"==typeof t&&(t=[[o.i,t,""]]),t.locals&&(o.exports=t.locals);s("rjj0")("704e6310",t,!0)},"8ZTF":function(o,e,s){e=o.exports=s(0)(),e.push([o.i,".infoItem[data-v-40114206]{margin:10px;overflow:hidden}.inlineInfo[data-v-40114206]{float:left;margin-right:20px}#opusImage[data-v-40114206]{max-width:300px;max-height:300px}",""])},Opy4:function(o,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t={find:{api:{path:"/boss/community/opus/opus/find",params:{fields:"{opus_id,show_time,tags{name},cover{s(w:1080){url,width,height,origin}},user{nickname},recommend_goods{relation_id,goods_id,preview{name,cover,sale_price},goods_items{spec_name,item_id,image{s(w:200){url}}}}}",id:0}}},update:{api:{path:"/boss/community/opus/opus/update-recommend-goods",params:{id:0,goods:[]}}}},i=null;e.default={name:"app",data:function(){return{id:this.$route.params.id,columns:[{title:"商品ID",key:"goodsId"},{title:"商品名称",key:"goodsName"},{title:"商品图片",render:function(o,e){return o("div",{class:{goodsInfoImageContainer:!0}},[o("img",{attrs:{src:e.row.goodsImageUrl},style:{maxWidth:"100px",maxHeight:"100px"}})])}},{title:"销售价",key:"price"},{title:"规格名称",render:function(o,e){return""===e.row.specName?o("span",{},"未选择规格"):o("span",{},e.row.specName)}},{title:"规格图片",render:function(o,e){return""===e.row.specImageUrl?o("span",{},"未选择规格"):o("div",{class:{goodsInfoImageContainer:!0}},[o("img",{attrs:{src:e.row.specImageUrl},style:{maxWidth:"100px",maxHeight:"100px"}})])}},{title:"排序",render:function(o,e){var s=[];return 0!==parseInt(e.index)&&s.push(o("Icon",{props:{type:"arrow-up-a"},style:{cursor:"pointer",margin:"0px 5px",fontSize:"20px"},nativeOn:{click:function(){i.moveUp(e.index)}}})),parseInt(e.index)!==i.opus.goods.length-1&&s.push(o("Icon",{props:{type:"arrow-down-a"},style:{cursor:"pointer",margin:"0px 5px",fontSize:"20px"},nativeOn:{click:function(){i.moveDown(e.index)}}})),o("div",s)}},{title:"操作",render:function(o,e){return o("div",[o("Button",{props:{type:"text"},style:{color:"red"},on:{click:function(){i.removeGoods(e.index)}}},"删除该商品"),o("MGoodsPicking",{props:{goodsId:i.opus.goods[e.index].goodsId,specId:i.opus.goods[e.index].specId},on:{"on-pick-success":function(o){i.handleEditSuccess(o,e.index)}}},[o("div",{slot:"trigger"},[o("Button",{props:{type:"text"},style:{color:"#2d8cf0"}},"编辑")])])])}}],opus:{imageUrl:"",user:"",showTime:"",tags:[],goods:[]},uploadExcelPath:"/boss/community/opus/opus/convert-excel-to-goods",uploadFormats:["xls","xlsx","csv"],uploadFileName:"recommendGoods",uploadData:{fields:"{relation_id,goods_id,preview{name,cover,sale_price},goods_items{spec_name,item_id,image{s(w:200){url}}}}"},uploading:!1}},methods:{back:function(){window.location.hash="/community/opus/opus/recommend-goods-list"},submit:function(){bus.$emit("on-loading"),t.update.api.params.id=this.id;var o=this.opus.goods.length;t.update.api.params.goods=[],this.opus.goods.map(function(e){t.update.api.params.goods.push({ordering:o,goodsId:e.goodsId,specId:e.specId,id:e.id}),o--});var e=this;this.$Util.api.post(t.update,t.update.api.params,e).then(function(o){e.$Notice.success({title:"保存成功",desc:""}),e.back()},function(o){bus.$emit("on-loading"),e.$Notice.warning({title:"保存失败",desc:""})})},handleBeforeUpload:function(){this.uploading=!0},handleUploadFormatSuccess:function(o){this.$Notice.error({title:"文件格式错误",desc:"仅支持xls,xlsx,csv文件"})},handleExcelUploadSuccess:function(o,e,s){null!==o.data&&0!==o.data.length&&this.addRecommendGoods(o.data),this.uploading=!1},handlePickSuccess:function(o){if(this.checkGoodsOrSpecAlreadyExist(o))return this.$Notice.error({title:"商品已存在",desc:""}),!1;this.opus.goods.push({id:0,goodsId:o.goodsId,specId:o.specId,goodsName:o.goodsName,goodsImageUrl:o.imagePath,price:o.price,specName:o.specName1,specImageUrl:o.specImagePath})},handleEditSuccess:function(o,e){var s={id:this.opus.goods[e].id,goodsId:o.goodsId,specId:o.specId,goodsName:o.goodsName,goodsImageUrl:o.imagePath,price:o.price,specName:o.specName1,specImageUrl:o.specImagePath},t=this.opus.goods[e];if(this.opus.goods.splice(e,1),this.checkGoodsOrSpecAlreadyExist(o))return this.$Notice.error({title:"商品已存在",desc:""}),this.opus.goods.splice(e,0,t),!1;this.opus.goods.splice(e,0,s)},checkGoodsOrSpecAlreadyExist:function(o){var e=!1;return this.opus.goods.map(function(s){var t=parseInt(s.goodsId)===parseInt(o.goodsId),i=""===s.specId&&""===o.specId||parseInt(s.specId)===parseInt(o.specId);t&&i&&(e=!0)}),e},loadOpusDetail:function(){bus.$emit("on-loading"),t.find.api.params.id=this.id;var o=this;this.$Util.api.get(t.find,o).then(function(e){bus.$emit("on-loading"),o.opus.imageUrl=e.data.cover.s.url,o.opus.user=e.data.user.nickname,o.opus.showTime=o.$Util.dateFormat(e.data.show_time,"yyyy-MM-dd hh:mm:ss"),o.opus.tags=[],e.data.tags.map(function(e){o.opus.tags.push(e.name)}),o.opus.goods=[],null!==e.data.recommend_goods&&o.addRecommendGoods(e.data.recommend_goods)},function(e){bus.$emit("on-loading"),o.$Notice.warning({title:"加载opus详情失败",desc:""})})},addRecommendGoods:function(o){this.opus.goods=[];var e=this;o.map(function(o){var s={id:void 0===o.relation_id?0:o.relation_id,goodsId:o.goods_id,goodsName:o.preview.name,goodsImageUrl:o.preview.cover,price:o.preview.sale_price,specName:null===o.goods_items?"":o.goods_items[0].spec_name,specId:null===o.goods_items?"":o.goods_items[0].item_id,specImageUrl:null===o.goods_items?"":o.goods_items[0].image.s.url};e.checkGoodsOrSpecAlreadyExist(s)||e.opus.goods.push(s)})},removeGoods:function(o){this.opus.goods.splice(o,1)},moveUp:function(o){var e=this.opus.goods[o];this.opus.goods.splice(o,1),this.opus.goods.splice(o-1,0,e)},moveDown:function(o){var e=this.opus.goods[o];this.opus.goods.splice(o,1),this.opus.goods.splice(o+1,0,e)}},created:function(){i=this,this.$nextTick(function(){this.loadOpusDetail()})}}},RcOd:function(o,e){o.exports={render:function(){var o=this,e=o.$createElement,s=o._self._c||e;return s("m-page",[s("div",{staticClass:"infoItem"},[s("Button",{attrs:{type:"primary"},on:{click:o.back}},[o._v("返回")]),o._v(" "),s("Button",{attrs:{type:"primary"},on:{click:o.submit}},[o._v("保存")])],1),o._v(" "),s("div",{staticClass:"infoItem"},[s("div",{staticClass:"inlineInfo"},[s("div",{staticClass:"opusInfoImageContainer"},[s("img",{attrs:{id:"opusImage",src:o.opus.imageUrl}})])]),o._v(" "),s("div",{staticClass:"inlineInfo"},[s("h3",[o._v(o._s(o.opus.user))]),o._v(" "),s("h3",[o._v("显示时间："),s("span",{staticStyle:{color:"#2d8cf0"}},[o._v(o._s(o.opus.showTime))])]),o._v(" "),o._l(o.opus.tags,function(e){return s("Tag",[o._v(o._s(e))])})],2)]),o._v(" "),s("div",{staticClass:"infoItem"},[s("Card",[s("h3",[o._v("推荐商品")]),o._v(" "),o.uploading?s("div",{staticStyle:{margin:"20px 0"}},[s("Spin",{staticStyle:{display:"inline-block"}}),o._v("\n                正在上传,请稍等\n\n\n            ")],1):o._e(),o._v(" "),o.uploading?o._e():s("div",{staticStyle:{margin:"20px 0"}},[o.opus.goods.length>0?s("Table",{attrs:{data:o.opus.goods,columns:o.columns,id:"opusRecommendGoodsTable"}}):o._e(),o._v(" "),s("div",{staticStyle:{margin:"20px 0"}},[s("MGoodsPicking",{on:{"on-pick-success":o.handlePickSuccess}},[s("div",{attrs:{slot:"trigger"},slot:"trigger"},[s("Button",{staticStyle:{width:"300px"},attrs:{type:"ghost"}},[o._v("+添加推荐商品")])],1)]),o._v(" "),s("Upload",{attrs:{action:o.uploadExcelPath,format:o.uploadFormats,name:o.uploadFileName,data:o.uploadData,"on-format-error":o.handleUploadFormatSuccess,"on-success":o.handleExcelUploadSuccess,"before-upload":o.handleBeforeUpload}},[s("Button",{staticStyle:{width:"300px",margin:"5px 0px"},attrs:{type:"ghost"}},[o._v("导入excel文件")])],1)],1),o._v(" "),s("p",[o._v("\n                    文件要求:两列数据 第一列 GOODS_ID 第二列 SPEC_ID 第一列必填,第二列非必填\n                ")]),o._v(" "),s("p",[s("span",{staticStyle:{color:"red"}},[o._v("*")]),o._v("新导入的文件会全部覆盖之前已上传的内容\n            ")]),o._v(" "),s("p",[s("a",{attrs:{href:"/static/admin/Static/excel/opus_recommend_goods_tpl.xls"}},[o._v("点击下载模板文件")])])],1)])],1)])},staticRenderFns:[]}},lUib:function(o,e,s){s("sXIp"),s("4Lkl");var t=s("VU/8")(s("Opy4"),s("RcOd"),"data-v-40114206",null);o.exports=t.exports},qLzj:function(o,e,s){e=o.exports=s(0)(),e.push([o.i,".goodsInfoImageContainer,.opusInfoImageContainer{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;background:#efefef}.opusInfoImageContainer{width:300px;height:300px}.goodsInfoImageContainer{width:100px;height:100px}#opusRecommendGoodsTable .ivu-table{display:block!important}",""])},sXIp:function(o,e,s){var t=s("qLzj");"string"==typeof t&&(t=[[o.i,t,""]]),t.locals&&(o.exports=t.locals);s("rjj0")("277aaf04",t,!0)}});