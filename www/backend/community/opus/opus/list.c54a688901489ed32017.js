webpackJsonp([32,70],{"1SQ8":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("gHc0"),s=a.n(i),o=null;t.default={name:"app",components:{Edit:s.a},data:function(){return{addRoute:"/community/opus/opus/add/0/0/0/0",api:{path:"/boss/community/opus/opus/find-list",params:{fields:'{opus_id,collect_count,user{nickname},show_time,grade_time,tags{name},course_tags{name},cover{s(w:200){url},l(format:"jpg",quality:100){url}}}',limit:80}},pageInfoApi:{path:"/boss/community/opus/opus/list-page-info",params:{}},searchCondition:{opusId:"",opusTags:[],courseTags:[],sortBy:"show_time|desc",grade:0,valueType:"username",value:""},searchResource:{opusTags:[],courseTags:[],sortBy:[{name:"显示时间降序",value:"show_time|desc"},{name:"评分时间降序",value:"grade_time|desc"},{name:"收藏量降序",value:"collect_count|desc,show_time|desc"}],valueTypes:[{name:"用户昵称",value:"username"},{name:"用户ID",value:"uid"},{name:"美图标题",value:"title"},{name:"旧美图标签内容",value:"content_match"}],grades:[{value:0,name:"不限"},{value:5,name:"精"},{value:4,name:"优"},{value:3,name:"良"},{value:2,name:"中"},{value:1,name:"差"}]},columns:[],pageDataToShow:[],editModelShow:!1,previewModalShow:!1,previewImageUrl:"",previewOpusId:"",opusId:0,methods:{},responseHandle:function(e,t){return o.pageDataToShow=[],e.data.map(function(e){var t=void 0===e.cover.s?"":void 0===e.cover.s.url?"":e.cover.s.url,a=void 0===e.cover.l?"":void 0===e.cover.l.url?"":e.cover.l.url,i=void 0===e.user||null===e.user?"":e.user.nickname;o.pageDataToShow.push({id:e.opus_id,url:t,largeUrl:a,user:i,collectCount:e.collect_count,time:o.$Util.dateFormat(e[o.timeDisplayKey],"yyyy-MM-dd hh:mm:ss"),opusTags:e.tags,courseTags:e.course_tags,showButton:!1})}),e}}},computed:{timeDisplayKey:function(){return"grade_time|desc"===this.searchCondition.sortBy?"grade_time":"show_time"}},methods:{toAdd:function(){window.location.hash=this.addRoute},handleListPageInfoSuccess:function(e){var t=[];e.data.filter.opusTags.map(function(e){var a={label:e.name,value:e.name,children:[]};e.son.map(function(e){a.children.push({label:e.name,value:e.name})}),t.push(a)}),this.searchResource.opusTags=t;var a=[],i=function(t){var i=e.data.filter.courseTags[t],s={label:i.cate_name,value:i.cate_name,children:[]};for(var o in i.courseTagsOfGroupId){i.courseTagsOfGroupId[o].map(function(e){s.children.push({label:e.name,value:e.name})})}a.push(s)};for(var s in e.data.filter.courseTags)i(s);this.searchResource.courseTags=a},toggleButtonShow:function(e,t){if(this.pageDataToShow[e].showButton===t)return!1;this.pageDataToShow[e].showButton=t},edit:function(e){this.editModelShow=!0,this.opusId=this.pageDataToShow[e].id},preview:function(e){this.previewImageUrl=this.pageDataToShow[e].largeUrl,this.previewModalShow=!0,this.previewOpusId=this.pageDataToShow[e].id},opusEditSuccessHandler:function(e){this.editModelShow=!1,this.opusId=0,bus.$emit("on-loading")}},created:function(){o=this}}},HMeG:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("m-page-list",{attrs:{path:e.api.path,params:e.api.params,methods:e.methods,"response-handle":e.responseHandle,"page-info-path":e.pageInfoApi.path,"page-info-params":e.pageInfoApi.params},on:{"on-page-info-success":e.handleListPageInfoSuccess}},[a("m-action-bar",[a("Button",{attrs:{type:"primary"},on:{click:e.toAdd}},[e._v("上传美图")])],1),e._v(" "),a("m-action-bar",{attrs:{slot:"search"},slot:"search"},[a("m-action-search-bar",{attrs:{"search-condition":e.searchCondition}},[a("div",{staticClass:"searchItems"},[a("m-form-item",{attrs:{label:"美图id"}},[a("Input",{staticStyle:{width:"200px"},model:{value:e.searchCondition.opusId,callback:function(t){e.$set(e.searchCondition,"opusId",t)},expression:"searchCondition.opusId"}})],1),e._v(" "),a("m-form-item",{attrs:{label:"美图标签"}},[a("Select",{staticStyle:{width:"200px"},attrs:{filterable:"",multiple:""},model:{value:e.searchCondition.opusTags,callback:function(t){e.$set(e.searchCondition,"opusTags",t)},expression:"searchCondition.opusTags"}},e._l(e.searchResource.opusTags,function(t){return a("Option-group",{attrs:{label:t.label}},e._l(t.children,function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label)+"\n                            ")])}))}))],1),e._v(" "),a("m-form-item",{attrs:{label:"教程标签"}},[a("Select",{staticStyle:{width:"200px"},attrs:{filterable:"",multiple:""},model:{value:e.searchCondition.courseTags,callback:function(t){e.$set(e.searchCondition,"courseTags",t)},expression:"searchCondition.courseTags"}},e._l(e.searchResource.courseTags,function(t){return a("Option-group",{attrs:{label:t.label}},e._l(t.children,function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label)+"\n                            ")])}))}))],1)],1),e._v(" "),a("div",{staticClass:"searchItems"},[a("m-form-item",{attrs:{label:"排序规则"}},[a("Select",{staticStyle:{width:"200px"},model:{value:e.searchCondition.sortBy,callback:function(t){e.$set(e.searchCondition,"sortBy",t)},expression:"searchCondition.sortBy"}},e._l(e.searchResource.sortBy,function(t){return a("Option",{attrs:{value:t.value}},[e._v(" "+e._s(t.name)+"\n\n                        ")])}))],1),e._v(" "),a("m-form-item",{attrs:{label:"评分等级"}},[a("Select",{staticStyle:{width:"200px"},model:{value:e.searchCondition.grade,callback:function(t){e.$set(e.searchCondition,"grade",t)},expression:"searchCondition.grade"}},e._l(e.searchResource.grades,function(t){return a("Option",{attrs:{value:t.value}},[e._v(" "+e._s(t.name)+"\n\n                        ")])}))],1),e._v(" "),a("m-form-item",{attrs:{label:"搜索"}},[a("Input",{staticStyle:{width:"280px"},model:{value:e.searchCondition.value,callback:function(t){e.$set(e.searchCondition,"value",t)},expression:"searchCondition.value"}},[a("Select",{staticStyle:{width:"120px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:e.searchCondition.valueType,callback:function(t){e.$set(e.searchCondition,"valueType",t)},expression:"searchCondition.valueType"}},e._l(e.searchResource.valueTypes,function(t){return a("Option",{attrs:{value:t.value}},[e._v("\n                            "+e._s(t.name)+"\n\n                        ")])}))],1)],1)],1)])],1),e._v(" "),a("div",[a("Modal",{attrs:{title:"预览",width:"700",id:"previewModal"},model:{value:e.previewModalShow,callback:function(t){e.previewModalShow=t},expression:"previewModalShow"}},[a("div",{staticClass:"previewImage"},[a("img",{attrs:{src:e.previewImageUrl}})]),e._v(" "),a("div",{staticStyle:{"text-align":"center"}},[e._v("\n                美图ID: "+e._s(e.previewOpusId)+"\n            ")])]),e._v(" "),a("Modal",{attrs:{title:"修改美图信息",width:"700"},model:{value:e.editModelShow,callback:function(t){e.editModelShow=t},expression:"editModelShow"}},[a("Edit",{attrs:{"opus-id":e.opusId,"load-detail":e.editModelShow},on:{"on-opus-edit-success":e.opusEditSuccessHandler}}),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"})],1),e._v(" "),e._l(e.pageDataToShow,function(t,i){return a("Card",{staticClass:"imageCard",attrs:{padding:5},nativeOn:{mouseover:function(t){e.toggleButtonShow(i,!0)},mouseout:function(t){e.toggleButtonShow(i,!1)}}},[a("div",{staticClass:"opusImage"},[a("img",{attrs:{src:t.url},on:{click:function(t){e.preview(i)}}})]),e._v(" "),a("div",[e._v("\n                "+e._s(t.user)+"\n            ")]),e._v(" "),a("div",[e._v("\n                "+e._s(t.collectCount)+"\n            ")]),e._v(" "),a("div",[e._v("\n                "+e._s(t.time)+"\n            ")]),e._v(" "),a("div",e._l(t.opusTags,function(t){return a("Tag",[e._v(e._s(t.name))])})),e._v(" "),a("div",e._l(t.courseTags,function(t){return a("Tag",{attrs:{color:"green"}},[e._v(e._s(t.name))])})),e._v(" "),a("Button",{class:{imageCardButton:!0,hidden:!t.showButton},on:{click:function(t){e.edit(i)}},nativeOn:{mouseover:function(t){e.toggleButtonShow(i,!0)},mouseout:function(t){e.toggleButtonShow(i,!1)}}},[e._v("编辑")])],1)})],2)],1)},staticRenderFns:[]}},JwvJ:function(e,t,a){var i=a("f66a");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("cdd66f20",i,!0)},"M+im":function(e,t,a){a("b1J0");var i=a("VU/8")(a("sNwv"),a("jWep"),null,null);e.exports=i.exports},Z0v3:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("m-page-edit",[a("m-opus-form",{attrs:{usage:"edit",id:e.id,"load-detail":e.loadDetail},on:{"on-opus-edit-success":e.opusEditSuccessHandler}})],1)},staticRenderFns:[]}},b1J0:function(e,t,a){var i=a("nSUR");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("262d2e43",i,!0)},f66a:function(e,t,a){t=e.exports=a(0)(),t.push([e.i,".ivu-table{display:none}.imageCard .ivu-card-body{height:347px;overflow-y:hidden}.searchItems .m-form-item{line-height:32px}#previewModal .ivu-modal-body{max-height:700px}",""])},gHc0:function(e,t,a){var i=a("VU/8")(a("ltvX"),a("Z0v3"),null,null);e.exports=i.exports},iuF5:function(e,t,a){t=e.exports=a(0)(),t.push([e.i,".hidden[data-v-23ab40ed]{display:none}.m-form-item[data-v-23ab40ed]{margin:5px 20px}.imageCard[data-v-23ab40ed]{display:inline-block;width:210px;margin:10px}#previewModal .previewImage[data-v-23ab40ed],.imageCard .opusImage[data-v-23ab40ed]{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;background:#efefef}.imageCard .opusImage[data-v-23ab40ed]{width:200px;height:200px}.imageCard img[data-v-23ab40ed]{max-width:200px;max-height:200px;cursor:pointer}#previewModal .previewImage[data-v-23ab40ed]{width:668px;height:668px}.previewImage img[data-v-23ab40ed]{max-width:668px;max-height:668px}.imageCard .imageCardButton[data-v-23ab40ed]{position:absolute;right:0;top:0}",""])},jWep:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{"padding-top":"20px"}},[a("Form",{attrs:{"label-width":60}},[e._l(e.opuses,function(t,i){return a("Row",[a("Col",{attrs:{span:"23"}},[a("Card",{staticClass:"opus"},[e.isEdit?e._e():a("Form-item",{attrs:{"label-width":85,label:"图片",required:""}},[a("m-upload-image",{attrs:{"obj-type":"share_image","default-images":t.defaultOpus,"image-type":"jpg,jpeg"},on:{"on-success":e.syncOpus},nativeOn:{click:function(t){e.markIndex(i)}},model:{value:t.images,callback:function(a){e.$set(t,"images",a)},expression:"formItem.images"}})],1),e._v(" "),e.isEdit||e.routePassUid?e._e():a("Form-item",{attrs:{"label-width":85,label:"发图者",required:""}},[a("MUserPicking",{attrs:{width:400},on:{"user-change":e.handleUserChange},model:{value:t.user,callback:function(a){e.$set(t,"user",a)},expression:"formItem.user"}})],1),e._v(" "),!e.isEdit&&e.routePassUid?a("Form-item",{attrs:{"label-width":85,label:"发图者",required:""}},[a("i-input",{staticStyle:{width:"400px"},attrs:{placeholder:"发图者",readonly:"",disabled:""},model:{value:e.routePassUsername,callback:function(t){e.routePassUsername=t},expression:"routePassUsername"}})],1):e._e(),e._v(" "),a("Form-item",{attrs:{"label-width":85,label:"美图标签"}},[a("Select",{staticStyle:{width:"400px"},attrs:{filterable:"",multiple:""},model:{value:t.opusTags,callback:function(a){e.$set(t,"opusTags",a)},expression:"formItem.opusTags"}},e._l(e.opusTags,function(t){return a("Option-group",{attrs:{label:t.name}},e._l(t.tags,function(t){return a("Option",{key:t.value,attrs:{value:t.label}},[e._v(e._s(t.label)+"\n                        ")])}))}))],1),e._v(" "),a("Form-item",{class:{hidden:!e.isEdit},attrs:{"label-width":85,label:"教程标签"}},[a("Select",{staticStyle:{width:"400px"},attrs:{filterable:"",multiple:""},model:{value:t.courseTags,callback:function(a){e.$set(t,"courseTags",a)},expression:"formItem.courseTags"}},e._l(e.courseTags,function(t){return a("Option-group",{attrs:{label:t.name}},e._l(t.tags,function(t){return a("Option",{key:t.value,attrs:{value:t.label}},[e._v(e._s(t.label)+"\n                        ")])}))}))],1),e._v(" "),a("Form-item",{attrs:{"label-width":85,label:"评分",required:""}},[a("Button-group",e._l(e.grades,function(s){return a("Button",{attrs:{type:s.grade==t.grade?"primary":"default"},on:{click:function(t){e.setGrade(s.grade,i)}}},[e._v(e._s(s.gradeName)+"\n                    ")])}))],1),e._v(" "),e.isEdit?e._e():a("Form-item",{attrs:{"label-width":85,label:"评分时间",required:""}},[a("Radio-group",{attrs:{id:"rateTimeRadioGroup"},on:{"on-change":e.updateDefaultShowTime},model:{value:t.gradeTimeType,callback:function(a){e.$set(t,"gradeTimeType",a)},expression:"formItem.gradeTimeType"}},[a("Radio",{attrs:{label:"default"}},[a("span",[e._v("默认时间")])]),e._v(" "),a("Radio",{attrs:{label:"custom"}},[a("span",[e._v("自定义时间")])])],1)],1),e._v(" "),e.isEdit||"default"!=t.gradeTimeType?e._e():a("Form-item",{attrs:{label:"时间选择","label-width":85}},[a("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",placeholder:"选择日期和时间",disabled:""},model:{value:t.defaultGradeTime,callback:function(a){e.$set(t,"defaultGradeTime",a)},expression:"formItem.defaultGradeTime"}})],1),e._v(" "),!e.isEdit&&"custom"==t.gradeTimeType||e.isEdit?a("Form-item",{attrs:{"label-width":85,label:e.isEdit?"评分时间":"时间选择",required:!!e.isEdit}},[a("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",placeholder:"选择日期和时间"},on:{"on-change":e.syncCustomGradeTime},model:{value:t.customGradeTime,callback:function(a){e.$set(t,"customGradeTime",a)},expression:"formItem.customGradeTime"}})],1):e._e(),e._v(" "),a("Form-item",{attrs:{"label-width":85,label:"标题"}},[a("i-input",{staticStyle:{width:"400px"},attrs:{maxlength:10,placeholder:"10字内"},model:{value:t.title,callback:function(a){e.$set(t,"title",a)},expression:"formItem.title"}})],1),e._v(" "),a("Form-item",{attrs:{"label-width":85,label:"描述"}},[a("i-input",{staticStyle:{width:"400px"},attrs:{maxlength:140,type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"140字内"},model:{value:t.description,callback:function(a){e.$set(t,"description",a)},expression:"formItem.description"}})],1),e._v(" "),e.isEdit?a("Form-item",{attrs:{"label-width":85}},[a("i-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("提交")])],1):e._e()],1)],1),e._v(" "),a("Col",{attrs:{span:"1"}},[e.isEdit||e.routePassUid?e._e():a("Button",{on:{click:function(t){e.unsetOpus(i)}}},[e._v("删除")])],1)],1)}),e._v(" "),e.isEdit||e.routePassUid?e._e():a("div",[a("Button",{attrs:{type:"ghost"},on:{click:e.pushOpus}},[e._v("+ 添加图片")])],1),e._v(" "),e.isEdit?e._e():a("div",[a("Button",{staticStyle:{"margin-top":"20px"},attrs:{type:"primary"},on:{click:e.submit}},[e._v("提交")])],1)],2)],1)},staticRenderFns:[]}},ltvX:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("M+im"),s=a.n(i);t.default={name:"Edit",props:{opusId:{type:Number,default:0},value:{type:[Number,String],default:0},loadDetail:{type:Boolean,default:!0}},components:{MOpusForm:s.a},data:function(){return{}},computed:{id:function(){return void 0!==this.$route.params.id?this.$route.params.id:this.opusId}},methods:{opusEditSuccessHandler:function(e){this.$emit("on-opus-edit-success",e)}}}},mGNJ:function(e,t,a){var i=a("iuF5");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("7992bcfc",i,!0)},nSUR:function(e,t,a){t=e.exports=a(0)(),t.push([e.i,".shade{left:0}.ivu-col{margin:0}#rateTimeRadioGroup .ivu-form-item,#rateTimeRadioGroup .ivu-radio{float:left}#rateTimeRadioGroup .ivu-form-item-label:before{content:''}#rateTimeRadioGroup .ivu-form-item-label{text-align:left}.hidden{display:none}.opus{margin-bottom:20px}.opus .ivu-card-body{background:#f9f9f9}.rightCloseButton{position:absolute;right:10px;top:10px}",""])},sNwv:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={create:{api:{path:"/boss/community/opus/opus/create"}},createByTopicImage:{api:{path:"/boss/community/opus/opus/create-by-topic-image"}},update:{api:{path:"/boss/community/opus/opus/update"}},find:{api:{path:"/boss/community/opus/opus/find",params:{fields:"{opus_id,grade_time,tags{name},course_tags{name},title,content,grade,cover{s(w:640){url,width,height,origin}}}",id:0}},responseHandle:function(e){var t=[];e.data.tags.map(function(e){t.push(e.name)}),e.data.tags=t;var a=[];return e.data.course_tags.map(function(e){a.push(e.name)}),e.data.courseTags=a,e.data.opus=[{url:e.data.cover.s.origin,width:e.data.cover.s.width,height:e.data.cover.s.height}],e.data.gradeTime=new Date(1e3*e.data.grade_time),e}},resource:{api:{path:"/boss/community/opus/opus/add-page-info",params:{fields:"{}",uid:0}},responseHandle:function(e){var t=[];if(e.data.form.tags.map(function(e){var a=[];e.son.map(function(e){var t={value:e.id,label:e.name};a.push(t)});var i={name:e.name,tags:a};t.push(i)}),void 0!==e.data.form.courseTags){var a=[],i=function(t){var i=e.data.form.courseTags[t],s={name:i.cate_name,tags:[]};for(var o in i.courseTagsOfGroupId){i.courseTagsOfGroupId[o].map(function(e){s.tags.push({label:e.name,value:e.name})})}a.push(s)};for(var s in e.data.form.courseTags)i(s);e.data.form.courseTags=a}return e.data.form.tags=t,e.data.form.lastModifyShowTime=new Date(1e3*parseInt(e.data.form.lastModifyShowTime)),e}},userResource:{api:{path:"/boss/user/specialaccount/account/find-authors-by-type",params:{type:""}}}};t.default={name:"MOpusForm",props:{id:{type:[String,Number],default:""},usage:{type:String,default:"edit"},url:{type:String,default:""},width:{type:Number,default:0},height:{type:Number,default:0},uid:{type:Number,default:0},loadDetail:{type:Boolean,default:!0}},watch:{id:function(e){this.reloadOpus()}},data:function(){return{opuses:[],grades:[{grade:5,gradeName:"精"},{grade:4,gradeName:"优"},{grade:3,gradeName:"良"},{grade:2,gradeName:"中"},{grade:1,gradeName:"差"}],opusTags:[],courseTags:[],lastModifyShowTime:new Date,lastModifyShowTimeAffectedUids:[],operationIndex:0,imagePathFromUrl:"",resourceLoaded:!1,routePassUsername:""}},computed:{isEdit:function(){return"edit"===this.usage},routePassUid:function(){return 0!==parseInt(this.uid)},creatingTopicImage:function(){return this.imagePathFromUrl===this.opuses[0].images[0].url}},methods:{setGrade:function(e,t){this.opuses[t].grade=e},syncOpus:function(e){this.opuses[this.operationIndex].images=e},getOpusTemplate:function(){return{id:0,images:[],defaultOpus:[],grade:5,opusTags:[],courseTags:[],gradeTimeType:"default",defaultGradeTime:null,customGradeTime:null,title:"",description:"",user:0}},pushOpus:function(){if(10===this.opuses.length)return this.$Notice.warning({title:"一次最多上传10张图片",desc:""}),!1;this.opuses.push(this.getOpusTemplate()),this.updateDefaultShowTime()},unsetOpus:function(e){this.opuses.splice(e,1),this.updateDefaultShowTime()},syncCustomGradeTime:function(e){this.formItem.customGradeTime=new Date(e)},updateDefaultShowTime:function(){var e=this,t=this.lastModifyShowTime;this.opuses.map(function(a,i){var s=e.lastModifyShowTimeAffectedUids.indexOf(parseInt(a.user))>=0;"default"===a.gradeTimeType?(a.defaultGradeTime=t,s&&(t=new Date(t.getTime()+18e5))):a.defaultGradeTime=null})},handleUserChange:function(){this.$nextTick(function(){this.updateDefaultShowTime()})},markIndex:function(e){this.operationIndex=e},back:function(){var e=this.creatingTopicImage?"/community/opus/opus/topic":"/community/opus/opus/list";location.hash=e},submit:function(){if(this.validateFormData()){var e=this.getRequestParams(),t=i.create;this.creatingTopicImage&&(t=i.createByTopicImage),"edit"===this.usage&&(t=i.update),this.submitRequest(e,t)}},validateFormData:function(){var e=this,t=!0,a=[];return this.opuses.map(function(i){if("add"===e.usage){if(0===i.images.length)return e.$Notice.warning({title:"图片不能为空",desc:""}),t=!1,!1;if(i.images.map(function(i){return""===i.url?(e.$Notice.warning({title:"图片不能为空",desc:""}),t=!1,!1):a.indexOf(i.url)>=0?(e.$Notice.warning({title:"不能选择同样的图片",desc:""}),t=!1,!1):void a.push(i.url)}),i.user<=0)return e.$Notice.warning({title:"用户不能为空",desc:""}),t=!1,!1;if(!("custom"!==i.gradeTimeType||i.customGradeTime&&i.customGradeTime.getTime))return e.$Notice.warning({title:"请选择自定义时间",desc:""}),t=!1,!1}if(!("edit"!==e.usage||i.customGradeTime&&i.customGradeTime.getTime))return e.$Notice.warning({title:"请选择自定义时间",desc:""}),t=!1,!1}),t},getRequestParams:function(){var e={opuses:[]},t=this;return this.opuses.map(function(a){var i={tags:a.opusTags,grade:a.grade,title:a.title,content:a.description};"add"===t.usage&&(i.uid=a.user,i.image=a.images[0],i.gradeTime="default"===a.gradeTimeType?parseInt(a.defaultGradeTime.getTime()/1e3):parseInt(a.customGradeTime.getTime()/1e3)),"edit"===t.usage&&(i.gradeTime=parseInt(a.customGradeTime.getTime()/1e3),i.courseTags=a.courseTags,i.id=a.id),e.opuses.push(i)}),e},submitRequest:function(e,t){bus.$emit("on-loading");var a=this;this.$Util.api.post(t,e,a).then(function(e){a.$Notice.success({title:"请求成功",desc:""}),"edit"===a.usage&&a.$emit("on-opus-edit-success",a.id),a.back()},function(e){bus.$emit("on-loading"),a.$Notice.warning({title:"请求失败",desc:""})})},loadResource:function(){if(this.resourceLoaded)return this.$nextTick(function(){this.loadOpus()}),!1;if(!this.loadDetail)return!1;bus.$emit("on-loading");var e=this;i.resource.api.params.uid=this.uid,this.$Util.api.get(i.resource,e).then(function(t){bus.$emit("on-loading"),this.lastModifyShowTime=t.data.form.lastModifyShowTime,this.lastModifyShowTimeAffectedUids=t.data.form.lastModifyShowTimeAffectedUids,this.opusTags=t.data.form.tags,this.routePassUsername=t.data.form.user.username,"add"===e.usage&&this.updateDefaultShowTime(),"edit"===e.usage&&(void 0!==t.data.form.courseTags&&(this.courseTags=t.data.form.courseTags),e.$nextTick(function(){e.loadOpus()})),e.resourceLoaded=!0},function(t){bus.$emit("on-loading"),e.$Notice.warning({title:"加载资源失败",desc:""})})},loadOpus:function(){if(!this.loadDetail)return!1;bus.$emit("on-loading");var e=this;this.$Util.api.get(i.find,e).then(function(e){bus.$emit("on-loading"),this.initOpus({id:e.data.opus_id,opus:e.data.opus,tags:e.data.tags,courseTags:e.data.courseTags,title:e.data.title,content:e.data.content,grade:e.data.grade,customGradeTime:e.data.gradeTime})},function(t){bus.$emit("on-loading"),e.$Notice.warning({title:"加载opus详情失败",desc:""})})},initIds:function(){if("edit"===this.usage){var e=this.id;if(!parseInt(e)&&0!=e)return alert("opusid格式有误"),!1;e=parseInt(e),i.find.api.params.id=e}},initOpus:function(e){var t=this.getOpusTemplate();void 0===e&&(e={}),void 0!==e.opus&&(t.images=e.opus,t.defaultOpus=e.opus),void 0!==e.customGradeTime&&(t.customGradeTime=e.customGradeTime),void 0!==e.title&&(t.title=e.title),void 0!==e.content&&(t.description=e.content),void 0!==e.grade&&(t.grade=e.grade),void 0!==e.tags&&(t.opusTags=e.tags),void 0!==e.courseTags&&(t.courseTags=e.courseTags),void 0!==e.id&&(t.id=e.id),this.opuses.push(t)},initOpusFromUrl:function(){this.opuses[0].images.push({url:this.url,width:this.width,height:this.height}),this.opuses[0].defaultOpus.push({url:this.url,width:this.width,height:this.height})},reloadOpus:function(){this.initIds(),this.opuses=[],this.$nextTick(function(){this.loadResource()})},doEdit:function(){this.initIds(),i.resource.api.path="/boss/community/opus/opus/edit-page-info",this.opuses=[],this.$nextTick(function(){this.loadResource()})}},created:function(){"add"===this.usage&&(this.initOpus(),0!=this.url&&(this.initOpusFromUrl(),this.imagePathFromUrl=this.url),0!=this.uid&&(this.opuses[0].user=this.uid),this.$nextTick(function(){this.loadResource()})),"edit"===this.usage&&this.doEdit()}}},v7ag:function(e,t,a){a("JwvJ"),a("mGNJ");var i=a("VU/8")(a("1SQ8"),a("HMeG"),"data-v-23ab40ed",null);e.exports=i.exports}});