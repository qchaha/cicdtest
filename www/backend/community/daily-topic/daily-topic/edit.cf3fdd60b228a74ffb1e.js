webpackJsonp([42],{Bn5b:function(t,e,i){i("f5Rq");var o=i("VU/8")(i("PjmO"),i("vydS"),"data-v-2620e241",null);t.exports=o.exports},MS8f:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("SRs0"),n={edit:function(t){return{api:{path:"/boss/community/topic/daily_topics/"+t,params:{base_fields:"topic_id,is_best,title,author.uid,author.user_name,edit_content,group_id,edit_covers[].s(180),is_hide,is_pgc,source,show_time,is_hot,recommend_time,is_top,edit_images[].s(180),content,edit_pattern"}}}},postEdit:function(t){return{api:{path:"/boss/community/topic/daily_topics/"+t}}},params:{api:{path:"/boss/community/topic/daily_topics/form_params"}},postAdd:{api:{path:"/boss/community/topic/daily_topics"}}};e.default={name:"TopicForm",props:{id:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{image_types:{cover:"topic_cover",image:"topic"},isEdit:!1,editModel:!0,editFrom:"",markImage:"",searchName:"",topic_id:"",is_recommend:!1,is_hide:!1,is_pgc:!1,is_top:!1,timing:!1,sourceChoice:"",recommend_time:"",show_time:"",content:"",ruleValidate:o.a,authors:[],cate_tree:[],source:[],submitData:{title:"",uid:"",group_id:"",content:"",cover:[],is_recommend:!1,recommend_time:"",is_hide:!1,is_pgc:!1,source:"",show_time:"",edit_pattern:"",images:[]},options:{disabledDate:function(t){return t&&t.valueOf()<Date.now()-864e5}},editContent:""}},methods:{setAnthors:function(){var t=this;this.$Util.api.get(n.params,this).then(function(e){t.authors=e.data.author,t.source=e.data.source,t.isEdit?t.getInfo():document.getElementById("singleEditor").onload=function(){return document.getElementById("singleEditor").contentWindow.editInit()}})},createSource:function(t){var e="";return this.source.forEach(function(i){i.choice=!1,Number(i.value)===t&&(i.choice=!0,e=i.name)}),e},createImage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(t){var e=t.map(function(t){return t.s});return e.forEach(function(t){return t.url=t.url.replace(/http\:\/\/cdn3.meijiabang.cn\//g,"")}),e}},getInfo:function(){var t=this;this.$Util.api.get(n.edit(this.$route.params.id),this).then(function(e){t.submitData=e.data,t.authors=e.data.author,t.topic_id=e.data.topic_id,t.content=e.data.edit_content,t.submitData.uid=Number(e.data.author.uid),t.submitData.cover=t.createImage(e.data.edit_covers),t.submitData.images=t.createImage(e.data.edit_images),t.show_time=new Date(1e3*e.data.show_time),t.sourceChoice=t.createSource(Number(e.data.source));var i=1e3*e.data.daily_info.show_start_time;t.show_time=new Date(i),e.data.edit_content&&(t.editContent=e.data.edit_content),1===Number(e.data.edit_pattern)||0===Number(e.data.edit_pattern)?(t.editModel=!0,document.getElementById("singleEditor").onload=function(){e.data.edit_content&&(document.getElementById("singleEditor").contentWindow.document.getElementById("content").value=e.data.edit_content),document.getElementById("singleEditor").contentWindow.editInit()},e.data.edit_content&&(document.getElementById("singleEditor").contentWindow.document.getElementById("content").value=e.data.edit_content),document.getElementById("singleEditor").contentWindow.editInit()):t.editModel=!1})},createImageData:function(t){this.submitData.images=t},createCoverData:function(t){this.submitData.cover=t},submit:function(){var t=this,e=this.source.findIndex(function(e){return e.name===t.sourceChoice});this.editModel?this.submitData.edit_pattern=1:this.submitData.edit_pattern=2,-1!==e&&(this.submitData.source=this.source[e].value),this.submitData.show_time=~~(new Date(this.show_time).getTime()/1e3),this.editModel?this.submitData.content=document.getElementById("singleEditor").contentWindow.document.getElementById("content").value:this.submitData.content=this.content;var i=this.isEdit?n.postEdit(this.$route.params.id):n.postAdd;this.$Util.api.post(i,this.submitData,this).then(function(e){0===e.error_code&&t.back()})},back:function(){var t=this.$route.query.ref;t?window.location.href=t:window.location.hash="/community/daily-topic/daily-topic/list"},findName:function(){var t=this;this.authors.forEach(function(e){-1!==e.user_name.indexOf(t.searchName)&&(t.submitData.uid=e.uid)})},initEdit:function(){var t=this;document.getElementById("singleEditor").onload=function(){t.editContent&&(document.getElementById("singleEditor").contentWindow.document.getElementById("content").value=t.editContent),document.getElementById("singleEditor").contentWindow.editInit()},this.editContent&&(document.getElementById("singleEditor").contentWindow.document.getElementById("content").value=this.editContent),document.getElementById("singleEditor").contentWindow.editInit()}},watch:{editModel:function(t,e){var i=this;!0===t&&!1===e&&this.$nextTick(function(){i.initEdit()})}},mounted:function(){var t=this;this.$nextTick(function(){"edit"==t.usage&&(t.isEdit=!0),t.setAnthors()})}}},NUAo:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{"padding-top":"20px"}},[i("div",{staticStyle:{"margin-bottom":"20px"}},[i("Button",{attrs:{type:"primary"},on:{click:t.back}},[t._v("返回")])],1),t._v(" "),i("Form",{ref:"formItem",attrs:{"label-width":110,rules:t.ruleValidate}},[i("Form-item",{attrs:{label:"编辑器模式"}},[i("i-switch",{model:{value:t.editModel,callback:function(e){t.editModel=e},expression:"editModel"}})],1),t._v(" "),"edit"===t.usage?i("Form-item",{attrs:{label:"帖子ID"}},[i("span",[t._v(t._s(t.topic_id))])]):t._e(),t._v(" "),i("Form-item",{attrs:{label:"话题内容",prop:"topic_content"}},[i("i-input",{staticStyle:{width:"200px"},attrs:{placeholder:"填写帖子标题"},model:{value:t.submitData.title,callback:function(e){t.$set(t.submitData,"title",e)},expression:"submitData.title"}})],1),t._v(" "),i("Form-item",{attrs:{label:"发布者",prop:"from"}},[i("span",[t._v(t._s(t.authors.user_name)+"["+t._s(t.authors.uid)+"]")])]),t._v(" "),t._e(),t._v(" "),i("Form-item",{directives:[{name:"show",rawName:"v-show",value:t.editModel,expression:"editModel"}],attrs:{label:"内容",prop:"content"}},[i("iframe",{attrs:{id:"singleEditor",src:"/backend/edit-index.html?id="+t.id,width:"1000",height:"600"}})]),t._v(" "),i("Form-item",{directives:[{name:"show",rawName:"v-show",value:!t.editModel,expression:"!editModel"}],attrs:{label:"内容",prop:"content"}},[i("i-input",{staticStyle:{width:"420px"},attrs:{type:"textarea",rows:4,placeholder:"输入帖子内容"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),t._v(" "),t.editModel?t._e():i("Form-item",{attrs:{label:"帖子图片"}},[i("m-upload-image",{attrs:{"obj-type":t.image_types.image,"default-images":t.submitData.images,multiple:!0,limit:9},on:{"on-success":t.createImageData}})],1),t._v(" "),i("Form-item",{attrs:{label:"封面图",prop:"cover"}},[i("m-upload-image",{attrs:{"obj-type":t.image_types.cover,"default-images":t.submitData.cover,multiple:!1,limit:1},on:{"on-success":t.createCoverData}})],1),t._v(" "),i("Form-item",{attrs:{label:"话题上线日期",prop:"push"}},[i("DatePicker",{staticStyle:{width:"150px"},attrs:{options:t.options,type:"datetime",format:"yyyy-MM-dd HH:mm",placeholder:"话题上线日期"},model:{value:t.show_time,callback:function(e){t.show_time=e},expression:"show_time"}})],1),t._v(" "),i("Form-item",{attrs:{label:"发布来源"}},[i("RadioGroup",{model:{value:t.sourceChoice,callback:function(e){t.sourceChoice=e},expression:"sourceChoice"}},t._l(t.source,function(e,o){return i("Radio",{key:o,staticClass:"edit-from-radio",attrs:{label:e.name},model:{value:e.choice,callback:function(i){t.$set(e,"choice",i)},expression:"item.choice"}})}))],1),t._v(" "),i("div",{staticStyle:{"margin-top":"30px"}},[i("i-button",{staticStyle:{width:"80px","margin-right":"20px"},attrs:{type:"primary"},on:{click:t.submit}},[t._v("\n                保存\n            ")]),t._v(" "),i("i-button",{staticStyle:{width:"80px"},on:{click:t.back}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]}},PjmO:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("rYsY"),n=i.n(o);e.default={name:"app",components:{MDailyTopicForm:n.a},data:function(){return{id:this.$route.params.id}}}},SRs0:function(t,e,i){"use strict";var o=i("s9g4");i.d(e,"a",function(){return o.a})},cwap:function(t,e,i){var o=i("hOTt");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);i("rjj0")("2dd9733c",o,!0)},f5Rq:function(t,e,i){var o=i("wnVI");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);i("rjj0")("cdcc0d80",o,!0)},hOTt:function(t,e,i){e=t.exports=i(0)(),e.push([t.i,"iframe[data-v-54622588]{border:none}.edit-from-radio[data-v-54622588]{display:block}",""])},rYsY:function(t,e,i){i("cwap");var o=i("VU/8")(i("MS8f"),i("NUAo"),"data-v-54622588",null);t.exports=o.exports},s9g4:function(t,e,i){"use strict";function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.d(e,"a",function(){return n});var n=o({title:[{required:!0,message:"请填写标题",trigger:"blur"}],from:[{required:!0,message:"请选择发布者",trigger:"blur"}],push:[{required:!0,message:"请选择所属板块",trigger:"blur"}],cover:[{required:!0,message:"请上传封面图",trigger:"blur"}],topic_content:[{required:!0,message:"请填写话题内容",trigger:"blur"}],content:[{required:!0,message:"请填写内容",trigger:"blur"}]},"from",[{required:!0,message:"请选择来源",trigger:"blur"}])},vydS:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page-edit",[i("m-daily-topic-form",{attrs:{usage:"edit",id:t.id}})],1)},staticRenderFns:[]}},wnVI:function(t,e,i){e=t.exports=i(0)(),e.push([t.i,"",""])}});