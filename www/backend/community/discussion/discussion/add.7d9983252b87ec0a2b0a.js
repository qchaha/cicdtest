webpackJsonp([164],{Ab3G:function(t,e,i){var a=i("VU/8")(i("VCav"),i("VNhe"),null,null);t.exports=a.exports},GDze:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a={create:{api:{path:"/boss/community/discussion/discussion/create"}},update:{api:{path:"/boss/community/discussion/discussion/update"}},find:{api:{path:"/boss/community/discussion/discussion/find",params:{fields:'{id,title,content,hot,create_time,start_time,end_time,uid,cover{s(w:40,h:40){url(protocol:"https"),width,height,origin}},author{uid,nickname,verified_type,verified_desc,cpma,avatar{s(w:40,h:40){url(protocol:"https"),width,height}}}}',discussionId:0}},responseHandle:function(t){var e=new Date;e.setTime(1e3*t.data.start_time),t.data.start_time=e;var i=new Date;return i.setTime(1e3*t.data.end_time),t.data.end_time=i,t}}};e.default={name:"MDiscussionForm",props:{id:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{formItem:{id:"",title:"",content:"",start_time:"",end_time:"",originalCover:"",cover:[],defaultImage:[],uid:""},submitEnable:!1,isActive:!1}},methods:{submit:function(){if(this.submitEnable=!0,bus.$emit("on-loading"),this.validateFormData()){var t=this.getRequestParams();this.submitRequest(t)}},validateFormData:function(){return""===this.formItem.start_time||""===this.formItem.end_time?(alert("请选择时间"),!1):!(this.formItem.start_time>=this.formItem.end_time)||(alert("开始时间必须小于结束时间"),!1)},getRequestParams:function(){return{discussionId:this.formItem.id,title:this.formItem.title,content:this.formItem.content,uid:this.formItem.uid,startTime:this.formItem.start_time.getTime()/1e3,endTime:this.formItem.end_time.getTime()/1e3,cover:0===this.formItem.cover.length?"":this.formItem.cover[0].url}},submitRequest:function(t){var e={};e="edit"===this.usage?a.update:a.create;var i=this;this.$Util.api.post(e,t,i).then(function(){location.hash="/community/discussion/discussion/list"},function(t){})},getCover:function(t){this.formItem.cover=t},loadFormData:function(t){a.find.api.params.discussionId=t;var e=this;this.$Util.api.get(a.find,this).then(function(t){if(bus.$emit("on-loading"),!t.data)return e.$Message.warning("话题不存在或数据有误"),!1;var i=t.data.cover.s.origin;e.formItem=t.data,e.formItem.defaultImage=[{url:i}],e.formItem.cover=[{url:i}],e.submitEnable=!1},function(t){})}},created:function(){var t=this;this.$nextTick(function(){if("edit"===t.usage){bus.$emit("on-loading");var e=this.id;if(this.formItem.id=e,!parseInt(this.formItem.id))return alert("话题id格式有误"),!1;this.loadFormData(e)}})}}},VCav:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("tMlH"),s=i.n(a);e.default={name:"add",components:{MDiscussionForm:s.a},data:function(){return{}}}},VNhe:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page-edit",[i("m-discussion-form",{attrs:{usage:"add"}})],1)},staticRenderFns:[]}},jw0g:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-form",{attrs:{"form-data":t.formItem,"submit-enable":t.submitEnable},on:{"on-submit":t.submit}},[i("Form-item",{attrs:{label:"话题标题"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"话题标题",maxlength:"50"},model:{value:t.formItem.title,callback:function(e){t.$set(t.formItem,"title",e)},expression:"formItem.title"}})],1),t._v(" "),i("Form-item",{attrs:{label:"话题内容"}},[i("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",autosize:{minRows:5,maxRows:10},placeholder:"话题内容"},model:{value:t.formItem.content,callback:function(e){t.$set(t.formItem,"content",e)},expression:"formItem.content"}})],1),t._v(" "),i("Form-item",{attrs:{label:"话题创建人uid"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"话题创建人uid"},model:{value:t.formItem.uid,callback:function(e){t.$set(t.formItem,"uid",e)},expression:"formItem.uid"}})],1),t._v(" "),i("Form-item",{attrs:{label:"话题开始时间"}},[i("Row",[i("i-col",{staticStyle:{width:"300px"}},[i("Date-picker",{attrs:{type:"datetime",placeholder:"选择日期"},model:{value:t.formItem.start_time,callback:function(e){t.$set(t.formItem,"start_time",e)},expression:"formItem.start_time"}})],1)],1)],1),t._v(" "),i("Form-item",{attrs:{label:"话题结束时间"}},[i("Row",[i("i-col",{staticStyle:{width:"300px"}},[i("Date-picker",{attrs:{type:"datetime",placeholder:"选择日期"},model:{value:t.formItem.end_time,callback:function(e){t.$set(t.formItem,"end_time",e)},expression:"formItem.end_time"}})],1)],1)],1),t._v(" "),i("Form-item",{attrs:{label:"话题封面"}},[i("m-upload-image",{attrs:{"default-images":t.formItem.defaultImage},on:{"on-success":t.getCover}})],1)],1)},staticRenderFns:[]}},tMlH:function(t,e,i){var a=i("VU/8")(i("GDze"),i("jw0g"),null,null);t.exports=a.exports}});