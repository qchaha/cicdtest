webpackJsonp([139],{AAbq:function(e,t,o){var i=o("VU/8")(o("MgR+"),o("stTm"),null,null);e.exports=i.exports},GtzU:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={create:{api:{path:"/boss/education/school/school/create"}},update:{api:{path:"/boss/education/school/school/update"}},find:{api:{path:"/boss/education/school/school/find",params:{fields:"{id,name,byname,type,tags(w:80,h:80){tag_id},introduce,icon{s(w:80,h:80){url,origin}},images{s(w:80,h:80){url,origin}},location{province_id,city_id,district_id,detail,summary},teachers{id},content,signed,back_phone,phone,phone_suffix,start_time,end_time,lesson_video_title,lesson_video{cover{s(w:80,h:80){url,origin}},items{url}}}",schoolId:0}},responseHandle:function(e){e.data.region=[e.data.location.province_id+"",e.data.location.city_id+"",e.data.location.district_id+""];var t=new Date;t.setTime(1e3*e.data.start_time),e.data.start_time=t;var o=new Date;return o.setTime(1e3*e.data.end_time),e.data.end_time=o,e}},resource:{api:{path:"/boss/education/school/school/add-page-info",params:{fields:"{teachers{id,name},tags(h:50){tag_id,url,height}}"}},responseHandle:function(e){var t=[];for(var o in e.data.form.region){var i=e.data.form.region[o],a={value:i.area_code,label:i.name,children:[]};for(var s in i.cities){var r=i.cities[s],n={value:r.area_code,label:r.name,children:[]};for(var m in r.areas){var l=r.areas[m],d={value:l.area_code,label:l.name};n.children.push(d)}a.children.push(n)}t.push(a)}return e.region=t,e.teachers=e.data.form.teachers,e.tags=e.data.form.tags,e}}};t.default={name:"MSchoolForm",props:{id:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{formItem:{id:0,name:"",byname:"",tags:[],address:"",addressBrief:"",backPhone:"",phone:"",phoneSuffix:"",introduce:"",signed:!1,researchful:!1,type:1,content:"",icon:[],defaultIcon:[],teachers:[],startTime:"",endTime:"",region:[],images:[],defaultImages:[],videoUrl:"",videoTitle:"",videoCover:[],defaultVideoCover:[]},teachers:[],tags:[],region:[]}},methods:{syncIcon:function(e){this.formItem.icon=e},syncImages:function(e){this.formItem.images=e},syncVideoCover:function(e){this.formItem.videoCover=e},syncStartTime:function(e){this.formItem.startTime=new Date(e)},syncEndTime:function(e){this.formItem.endTime=new Date(e)},back:function(){location.hash="/education/school/school/list"},submit:function(){if(this.validateFormData()){var e=this.getRequestParams();this.submitRequest(e)}},isVideoInfoLost:function(){var e=this.getVideoCover(),t=this.formItem.videoTitle,o=this.formItem.videoUrl,i=[""===e,""===t,""===o];return-1!==i.indexOf(!0)&&-1!==i.indexOf(!1)},validateFormData:function(){return""===this.formItem.startTime||""===this.formItem.endTime?(this.$Notice.warning({title:"请选择时间",desc:""}),!1):this.formItem.startTime>=this.formItem.endTime?(this.$Notice.warning({title:"开始时间必须小于结束时间",desc:""}),!1):0===this.formItem.images.length&&1===this.getSigned()?(this.$Message.warning("必须上传学校图片"),!1):""===this.getIcon()?(this.$Message.warning("必须上传学校logo"),!1):!this.isVideoInfoLost()||(this.$Message.warning("学校视频信息存在缺失"),!1)},getRequestParams:function(){var e={name:this.formItem.name,byname:this.formItem.byname,tags:this.formItem.tags,address:this.formItem.address,address_brief:this.formItem.addressBrief,back_phone:this.formItem.backPhone,phone:this.formItem.phone,phone_suffix:this.formItem.phoneSuffix,introduce:this.formItem.introduce,signed:this.getSigned(),type:this.getType(),content:this.formItem.content,icon:this.getIcon(),images:[],teachers:this.formItem.teachers,startTime:this.formItem.startTime.getTime()/1e3,endTime:this.formItem.endTime.getTime()/1e3,provinceId:this.formItem.region[0],cityId:this.formItem.region[1],districtId:this.formItem.region[2],video_cover:this.getVideoCover(),video_title:this.formItem.videoTitle,video_url:this.formItem.videoUrl};return this.formItem.images.map(function(t){e.images.push(t.url)}),"edit"===this.usage&&(e.id=this.formItem.id),e},getVideoCover:function(){return 0!==this.formItem.videoCover.length?this.formItem.videoCover[0].url:""},getIcon:function(){return 0===this.formItem.icon.length?"":this.formItem.icon[0].url},getSigned:function(){return this.formItem.signed?1:0},getType:function(){return this.formItem.researchful?2:this.formItem.type},submitRequest:function(e){bus.$emit("on-loading");var t=this,o=i.create;"edit"===this.usage&&(o=i.update),this.$Util.api.post(o,e,t).then(function(){t.$Message.success("请求成功"),t.back()},function(){bus.$emit("on-loading"),t.$Message.warning("请求失败")})},loadResource:function(){bus.$emit("on-loading");var e=this;this.$Util.api.get(i.resource,e).then(function(t){bus.$emit("on-loading"),e.teachers=t.teachers,e.tags=t.tags,e.region=t.region,"edit"===e.usage&&e.$nextTick(function(){e.loadSchool()})},function(t){bus.$emit("on-loading"),e.$Message.warning("加载资源失败")})},loadSchool:function(){bus.$emit("on-loading");var e=this;this.$Util.api.get(i.find,e).then(function(t){if(bus.$emit("on-loading"),e.formItem.name=t.data.name,e.formItem.byname=t.data.byname,e.formItem.address=t.data.location.detail,e.formItem.addressBrief=t.data.location.summary,e.formItem.backPhone=t.data.back_phone,e.formItem.phone=t.data.phone.replace(","+t.data.phone_suffix,""),e.formItem.phoneSuffix=t.data.phone_suffix,e.formItem.introduce=t.data.introduce,e.formItem.signed=t.data.signed,e.formItem.researchful=2===t.data.type,e.formItem.content=t.data.content,e.formItem.region=t.data.region,e.formItem.startTime=t.data.start_time,e.formItem.endTime=t.data.end_time,""!==t.data.icon.s.origin&&(e.formItem.defaultIcon=[{url:t.data.icon.s.origin}],e.formItem.icon=[{url:t.data.icon.s.origin}]),t.data.tags.map(function(t){e.formItem.tags.push(t.tag_id)}),t.data.teachers.map(function(t){e.formItem.teachers.push(t.id)}),t.data.images.map(function(t){e.formItem.defaultImages.push({url:t.s.origin}),e.formItem.images.push({url:t.s.origin})}),null!==t.data.lesson_video){if(null!==t.data.lesson_video.cover){var o={url:t.data.lesson_video.cover.s.origin};e.formItem.defaultVideoCover.push(o),e.formItem.videoCover.push(o)}null!==t.data.lesson_video.items&&(e.formItem.videoUrl=t.data.lesson_video.items[0].url)}e.formItem.videoTitle=null===t.data.lesson_video_title?"":t.data.lesson_video_title},function(t){bus.$emit("on-loading"),e.$Message.warning("加载学校详情失败")})},initIds:function(){if("edit"===this.usage){var e=this.id;if(!parseInt(e))return alert("学校id格式有误"),!1;e=parseInt(e),this.formItem.id=e,i.find.api.params.schoolId=e}}},created:function(){this.initIds(),"edit"===this.usage&&(i.resource.api.path="/boss/education/school/school/edit-page-info"),this.$nextTick(function(){this.loadResource()})}}},"MgR+":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o("aRQK"),a=o.n(i);t.default={name:"app",components:{MSchoolForm:a.a},data:function(){return{}}}},aRQK:function(e,t,o){var i=o("VU/8")(o("GtzU"),o("cO3w"),null,null);e.exports=i.exports},cO3w:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticStyle:{"padding-top":"20px"}},[o("Form",{attrs:{model:e.formItem,"label-width":60}},[o("Form-item",{attrs:{label:"是否签约"}},[o("i-switch",{attrs:{size:"large"},model:{value:e.formItem.signed,callback:function(t){e.$set(e.formItem,"signed",t)},expression:"formItem.signed"}},[o("span",{attrs:{slot:"open"},slot:"open"},[e._v("是")]),e._v(" "),o("span",{attrs:{slot:"close"},slot:"close"},[e._v("否")])])],1),e._v(" "),o("Form-item",{attrs:{label:"是否是美甲帮研习社"}},[o("i-switch",{attrs:{size:"large"},model:{value:e.formItem.researchful,callback:function(t){e.$set(e.formItem,"researchful",t)},expression:"formItem.researchful"}},[o("span",{attrs:{slot:"close"},slot:"close"},[e._v("否")]),e._v(" "),o("span",{attrs:{slot:"open"},slot:"open"},[e._v("是")])])],1),e._v(" "),o("Form-item",{attrs:{label:"学校名称"}},[o("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:30,placeholder:"学校名称(30字以内)"},model:{value:e.formItem.name,callback:function(t){e.$set(e.formItem,"name",t)},expression:"formItem.name"}})],1),e._v(" "),o("Form-item",{attrs:{label:"研习社别名"}},[o("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:30,placeholder:"研习社才填写"},model:{value:e.formItem.byname,callback:function(t){e.$set(e.formItem,"byname",t)},expression:"formItem.byname"}})],1),e._v(" "),o("Form-item",{attrs:{label:"学校logo"}},[o("m-upload-image",{attrs:{"default-images":e.formItem.defaultIcon},on:{"on-success":e.syncIcon}})],1),e._v(" "),o("Form-item",{attrs:{label:"学校标签"}},[o("Checkbox-group",{model:{value:e.formItem.tags,callback:function(t){e.$set(e.formItem,"tags",t)},expression:"formItem.tags"}},e._l(e.tags,function(e){return o("Checkbox",{key:e.tag_id,attrs:{label:e.tag_id}},[o("img",{style:{height:e.height+"px"},attrs:{src:e.url}})])}))],1),e._v(" "),o("Form-item",{attrs:{label:"展示开始时间"}},[o("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",placeholder:"选择日期和时间"},on:{"on-change":e.syncStartTime},model:{value:e.formItem.startTime,callback:function(t){e.$set(e.formItem,"startTime",t)},expression:"formItem.startTime"}})],1),e._v(" "),o("Form-item",{attrs:{label:"展示结束时间"}},[o("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",placeholder:"选择日期和时间"},on:{"on-change":e.syncEndTime},model:{value:e.formItem.endTime,callback:function(t){e.$set(e.formItem,"endTime",t)},expression:"formItem.endTime"}})],1),e._v(" "),o("Form-item",{attrs:{label:"学校地点"}},[o("Cascader",{attrs:{data:e.region,trigger:"hover"},model:{value:e.formItem.region,callback:function(t){e.$set(e.formItem,"region",t)},expression:"formItem.region"}})],1),e._v(" "),o("Form-item",{attrs:{label:"学校地址"}},[o("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:50,placeholder:"学校地址(50字以内)"},model:{value:e.formItem.address,callback:function(t){e.$set(e.formItem,"address",t)},expression:"formItem.address"}})],1),e._v(" "),o("Form-item",{attrs:{label:"学校地址索引"}},[o("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:50,placeholder:"学校地址索引(50字以内)"},model:{value:e.formItem.addressBrief,callback:function(t){e.$set(e.formItem,"addressBrief",t)},expression:"formItem.addressBrief"}})],1),e._v(" "),o("Form-item",{attrs:{label:"学校电话"}},[o("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:20,placeholder:"学校电话(20字以内)"},model:{value:e.formItem.backPhone,callback:function(t){e.$set(e.formItem,"backPhone",t)},expression:"formItem.backPhone"}})],1),e._v(" "),o("Form-item",{attrs:{label:"学校客服电话"}},[o("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:15,placeholder:"学校客服电话(15字以内)"},model:{value:e.formItem.phone,callback:function(t){e.$set(e.formItem,"phone",t)},expression:"formItem.phone"}})],1),e._v(" "),o("Form-item",{attrs:{label:"学校分机号"}},[o("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:10,placeholder:"学校分机号(10字以内)"},model:{value:e.formItem.phoneSuffix,callback:function(t){e.$set(e.formItem,"phoneSuffix",t)},expression:"formItem.phoneSuffix"}})],1),e._v(" "),o("Form-item",{attrs:{label:"学校品牌介绍"}},[o("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:30,type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请输入...(30字以内)"},model:{value:e.formItem.introduce,callback:function(t){e.$set(e.formItem,"introduce",t)},expression:"formItem.introduce"}})],1),e._v(" "),o("Form-item",{attrs:{label:"学校图片"}},[o("m-upload-image",{attrs:{multiple:"","default-images":e.formItem.defaultImages},on:{"on-success":e.syncImages}})],1),e._v(" "),o("Form-item",{attrs:{label:"学校办学特色与师资介绍"}},[o("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:300,type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请输入...(300字以内)"},model:{value:e.formItem.content,callback:function(t){e.$set(e.formItem,"content",t)},expression:"formItem.content"}})],1),e._v(" "),o("Form-item",{attrs:{label:"教师"}},[o("i-select",{staticStyle:{width:"260px"},attrs:{multiple:"",filterable:""},model:{value:e.formItem.teachers,callback:function(t){e.$set(e.formItem,"teachers",t)},expression:"formItem.teachers"}},e._l(e.teachers,function(t){return o("i-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name)+"\n                ")])}))],1),e._v(" "),o("Form-item",{attrs:{label:"视频封面图"}},[o("m-upload-image",{attrs:{"default-images":e.formItem.defaultVideoCover},on:{"on-success":e.syncVideoCover}})],1),e._v(" "),o("Form-item",{attrs:{label:"视频标题"}},[o("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:6,placeholder:"视频标题(6字以内)"},model:{value:e.formItem.videoTitle,callback:function(t){e.$set(e.formItem,"videoTitle",t)},expression:"formItem.videoTitle"}})],1),e._v(" "),o("Form-item",{attrs:{label:"视频URL"}},[o("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:255,placeholder:"视频URL(255字以内)"},model:{value:e.formItem.videoUrl,callback:function(t){e.$set(e.formItem,"videoUrl",t)},expression:"formItem.videoUrl"}})],1),e._v(" "),o("Form-item",[o("i-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("提交")]),e._v(" "),o("i-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:e.back}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]}},stTm:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("m-page-edit",[o("m-school-form",{attrs:{usage:"add"}})],1)},staticRenderFns:[]}}});