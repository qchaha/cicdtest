webpackJsonp([143],{EBqw:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("Xh0z"),s=i.n(o);e.default={name:"app",components:{MSchoolCommentForm:s.a},data:function(){return{id:this.$route.params.commentId,schoolId:this.$route.params.schoolId}}}},QFZ6:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page-edit",[i("m-school-comment-form",{attrs:{usage:"edit",id:t.id,schoolId:t.schoolId}})],1)},staticRenderFns:[]}},Xh0z:function(t,e,i){var o=i("VU/8")(i("kn9s"),i("aND7"),null,null);t.exports=o.exports},aND7:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{"padding-top":"20px"}},[i("Form",{attrs:{model:t.formItem,"label-width":60}},[i("Form-item",{attrs:{label:"用户id"}},[i("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:10,placeholder:"用户id"},model:{value:t.formItem.uid,callback:function(e){t.$set(t.formItem,"uid",e)},expression:"formItem.uid"}})],1),t._v(" "),i("Form-item",{attrs:{label:"评价内容"}},[i("i-input",{staticStyle:{width:"300px"},attrs:{placeholder:"评价内容"},model:{value:t.formItem.content,callback:function(e){t.$set(t.formItem,"content",e)},expression:"formItem.content"}})],1),t._v(" "),i("Form-item",{attrs:{label:"评价图片"}},[i("m-upload-image",{attrs:{multiple:"","default-images":t.formItem.defaultImages},on:{"on-success":t.syncImages}})],1),t._v(" "),i("Form-item",[i("i-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("提交")]),t._v(" "),i("i-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:t.back}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]}},cGAi:function(t,e,i){var o=i("VU/8")(i("EBqw"),i("QFZ6"),null,null);t.exports=o.exports},kn9s:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={create:{api:{path:"/boss/education/school/school-comment/create"}},update:{api:{path:"/boss/education/school/school-comment/update"}},find:{api:{path:"/boss/education/school/school-comment/find",params:{fields:'{id,school_id,uid,content,user{user_name},images{s(w:80,h:80){url(protocol:"https"),origin,width,height}}}}',id:0}}}};e.default={name:"MSchoolCommentForm",props:{id:{type:String,default:""},schoolId:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{formItem:{id:"",uid:"",schoolId:"",content:"",images:[],defaultImages:[]}}},methods:{syncImages:function(t){this.formItem.images=t},back:function(){location.hash="/education/school/comment/list/"+this.schoolId},submit:function(){if(this.validateFormData()){var t=this.getRequestParams();this.submitRequest(t)}},validateFormData:function(){return!0},getRequestParams:function(){var t={uid:this.formItem.uid,content:this.formItem.content,school_id:this.formItem.schoolId,images:[]};return"edit"===this.usage&&(t.id=this.formItem.id),this.formItem.images.map(function(e){""!==e.url&&t.images.push(e.url)}),t},submitRequest:function(t){bus.$emit("on-loading");var e=this,i=o.create;"edit"===this.usage&&(i=o.update),this.$Util.api.post(i,t,e).then(function(t){e.$Message.success("请求成功"),e.back()},function(t){bus.$emit("on-loading"),e.$Message.warning("请求失败")})},loadComment:function(){bus.$emit("on-loading");var t=this;this.$Util.api.get(o.find,t).then(function(e){bus.$emit("on-loading"),t.formItem.uid=e.data.uid,t.formItem.content=e.data.content,t.formItem.schoolId=e.data.school_id,e.data.images.map(function(e){t.formItem.defaultImages.push({url:e.s.origin}),t.formItem.images.push({url:e.s.origin})})},function(){bus.$emit("on-loading"),t.$Message.warning("加载评论详情失败")})},initIds:function(){var t=this.schoolId;if(!parseInt(t))return alert("学校id格式有误"),!1;t=parseInt(t),this.formItem.schoolId=t;var e=this.id;if(!parseInt(e)&&"edit"===this.usage)return alert("评论id格式有误"),!1;e=parseInt(e),this.formItem.id=e,o.find.api.params.id=e}},created:function(){this.initIds(),"edit"===this.usage&&this.$nextTick(function(){this.loadComment()})}}}});