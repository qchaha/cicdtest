webpackJsonp([142],{"7EYu":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={create:{api:{path:"/boss/education/school/lesson/create"}},update:{api:{path:"/boss/education/school/lesson/update"}},find:{api:{path:"/boss/education/school/lesson/find",params:{fields:"{id, title, student_min, student_max, tuition, period, instructor_ids,content_images{s(w:80,h:80){url,origin,origin_width,origin_height}}, images{s(w:80,h:80){url,origin}},teachers{id},tag(w:80,h:80){tag_id}, lesson_time, lesson_start_time, target, objective, content_text, route, start_time, end_time, tags, days, school{type}}",lessonId:0}},responseHandle:function(t){var e=new Date;e.setTime(1e3*t.data.start_time),t.data.start_time=e;var i=new Date;i.setTime(1e3*t.data.end_time),t.data.end_time=i;var s=new Date;return s.setTime(1e3*t.data.lesson_start_time),t.data.lesson_start_time=s,t}},resource:{api:{path:"/boss/education/school/lesson/add-page-info",params:{fields:"{teachers{id,name},ranks(h:50){tag_id,url,height},school{type}}",schoolId:0}}}};e.default={name:"MLessonForm",props:{id:{type:String,default:""},schoolId:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{formItem:{id:0,schoolId:0,days:0,title:"",startTime:"",endTime:"",rank:"",lessonImages:"",studentMin:"",studentMax:"",target:"",tuition:"",period:"",lessonTime:"",lessonStartTime:"",objective:"",contents:[],defaultContents:[],contentText:"",images:[],defaultImages:[],teachers:[],instructors:[],route:"",tags:""},contentImageWidthHeightData:{},teachers:[],instructors:[],ranks:[],appRouteModelShow:!1,schoolType:1}},computed:{isYanxishe:function(){return 2===parseInt(this.schoolType)}},methods:{getRoute:function(t){this.formItem.route=t},syncImages:function(t){this.formItem.images=t},syncContentImages:function(t){var e=[],i=this,s=[];t.map(function(t){var a=t.url;s.push(a);var o=0,n=0;void 0!==t.width?o=t.width:void 0!==i.contentImageWidthHeightData[a]&&(o=i.contentImageWidthHeightData[a].width),void 0!==t.height?n=t.height:void 0!==i.contentImageWidthHeightData[a]&&(n=i.contentImageWidthHeightData[a].height),e.push({url:a,width:o,height:n})});for(var a in this.contentImageWidthHeightData)s.indexOf(a)<0&&this.$delete(this.contentImageWidthHeightData,a);this.formItem.contents=e},syncStartTime:function(t){this.formItem.startTime=new Date(t)},syncEndTime:function(t){this.formItem.endTime=new Date(t)},syncLessonStartTime:function(t){this.formItem.lessonStartTime=new Date(t)},back:function(){location.hash="/education/school/lesson/list/"+this.schoolId},submit:function(){if(this.validateFormData()){var t=this.getRequestParams();this.submitRequest(t)}},validateFormData:function(){return parseInt(this.formItem.tuition)>99999.99||parseInt(this.formItem.tuition)<0?(this.$Notice.warning({title:"学费不能超过99999.99元,且大于0",desc:""}),!1):""===this.formItem.startTime||""===this.formItem.endTime?(this.$Notice.warning({title:"请选择时间"}),!1):""===this.formItem.lessonStartTime?(this.$Notice.warning({title:"请选择上课时间(运营)"}),!1):this.formItem.startTime>=this.formItem.endTime?(this.$Notice.warning({title:"开始时间必须小于结束时间"}),!1):0===this.formItem.images.length?(this.$Notice.warning({title:"必须上传课程图片",desc:""}),!1):0===this.formItem.contentText.length&&0===this.formItem.contents.length?(this.$Notice.warning({title:"教学内容和图片需要有其中之一",desc:""}),!1):2===this.schoolType&&0===this.formItem.days.length?(this.$Notice.warning({title:"研习社必须填课程天数",desc:""}),!1):2!==this.schoolType||0!==this.formItem.instructors.length||(this.$Notice.warning({title:"研习社授课老师不能为空",desc:""}),!1)},getRequestParams:function(){var t={title:this.formItem.title,startTime:this.formItem.startTime.getTime()/1e3,endTime:this.formItem.endTime.getTime()/1e3,rank:this.formItem.rank,studentMin:this.formItem.studentMin,studentMax:this.formItem.studentMax,target:this.formItem.target,tuition:this.formItem.tuition,period:this.formItem.period,lessonTime:this.formItem.lessonTime,lessonStartTime:this.formItem.lessonStartTime.getTime()/1e3,objective:this.formItem.objective,contentText:this.formItem.contentText,teachers:this.formItem.teachers,instructors:this.formItem.instructors,route:this.formItem.route,images:[],contents:[],tags:this.formItem.tags,days:this.formItem.days};return"edit"===this.usage?t.id=this.formItem.id:"add"===this.usage&&(t.schoolId=this.formItem.schoolId),this.formItem.images.map(function(e){""!==e.url&&t.images.push(e.url)}),this.formItem.contents.map(function(e){""!==e.url&&t.contents.push(e)}),t},submitRequest:function(t){bus.$emit("on-loading");var e=this,i=s.create;"edit"===this.usage&&(i=s.update),this.$Util.api.post(i,t,e).then(function(){e.$Message.success("请求成功"),e.back()},function(){bus.$emit("on-loading"),e.$Message.warning("请求失败")})},loadResource:function(){bus.$emit("on-loading");var t=this;this.$Util.api.get(s.resource,t).then(function(e){bus.$emit("on-loading"),t.teachers=e.data.form.teachers,t.instructors=t.teachers,t.ranks=e.data.form.ranks,t.schoolType=e.data.form.type,"edit"===t.usage&&t.$nextTick(function(){t.loadLesson()})},function(e){bus.$emit("on-loading"),t.$Message.warning("加载资源失败")})},loadLesson:function(){bus.$emit("on-loading");var t=this;this.$Util.api.get(s.find,t).then(function(e){bus.$emit("on-loading"),t.formItem.title=e.data.title,t.formItem.studentMin=e.data.student_min,t.formItem.studentMax=e.data.student_max,t.formItem.tuition=e.data.tuition,t.formItem.period=e.data.period,t.formItem.lessonTime=e.data.lesson_time,t.formItem.startTime=e.data.start_time,t.formItem.endTime=e.data.end_time,t.formItem.lessonStartTime=e.data.lesson_start_time,t.formItem.target=e.data.target,t.formItem.objective=e.data.objective,t.formItem.contentText=e.data.content_text,t.formItem.route=e.data.route,t.formItem.tags=e.data.tags,t.formItem.rank=e.data.tag.tag_id,e.data.teachers.map(function(e){t.formItem.teachers.push(e.id)}),null==e.data.instructor_ids&&(e.data.instructor_ids="");var i=e.data.instructor_ids.split(",");i=i.map(function(t){return+t}),i.map(function(e){0!==e&&t.formItem.instructors.push(e)}),e.data.images.map(function(e){t.formItem.defaultImages.push({url:e.s.origin}),t.formItem.images.push({url:e.s.origin})}),e.data.content_images.map(function(e){var i=e.s.origin,s=e.s.origin_width,a=e.s.origin_height;t.formItem.defaultContents.push({url:i,width:s,height:a}),t.formItem.contents.push({url:i,width:s,height:a}),t.contentImageWidthHeightData[i]={width:s,height:a}}),t.schoolType=e.data.school.type,t.formItem.days=e.data.days},function(e){bus.$emit("on-loading"),t.$Message.warning("加载课程详情失败")})},initIds:function(){var t=this.schoolId;if(!parseInt(t))return alert("学校id格式有误"),!1;t=parseInt(t),this.formItem.schoolId=t;var e=this.id;if(!parseInt(e)&&"edit"===this.usage)return alert("课程id格式有误"),!1;e=parseInt(e),this.formItem.id=e,s.find.api.params.lessonId=e,s.resource.api.params.schoolId=t}},created:function(){"edit"===this.usage&&(s.resource.api.path="/boss/education/school/lesson/edit-page-info"),this.initIds(),this.$nextTick(function(){this.loadResource()})}}},OEjM:function(t,e,i){var s=i("VU/8")(i("m+4i"),i("aXA/"),null,null);t.exports=s.exports},PqAQ:function(t,e,i){var s=i("VU/8")(i("7EYu"),i("bLzn"),null,null);t.exports=s.exports},"aXA/":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page-edit",[i("m-lesson-form",{attrs:{usage:"add",schoolId:t.schoolId}})],1)},staticRenderFns:[]}},bLzn:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{"padding-top":"20px"}},[i("Form",{attrs:{model:t.formItem,"label-width":60}},[i("Form-item",{attrs:{label:"课程名称"}},[i("i-input",{attrs:{maxlength:30,placeholder:"请输入...(30个字以内)"},model:{value:t.formItem.title,callback:function(e){t.$set(t.formItem,"title",e)},expression:"formItem.title"}})],1),t._v(" "),t.isYanxishe?i("Form-item",{attrs:{label:"课程天数",required:""}},[i("i-input",{attrs:{maxlength:30,placeholder:"输入数字"},model:{value:t.formItem.days,callback:function(e){t.$set(t.formItem,"days",e)},expression:"formItem.days"}})],1):t._e(),t._v(" "),i("Form-item",{attrs:{label:"显示开始时间"}},[i("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",placeholder:"请选择时间..."},on:{"on-change":t.syncStartTime},model:{value:t.formItem.startTime,callback:function(e){t.$set(t.formItem,"startTime",e)},expression:"formItem.startTime"}})],1),t._v(" "),i("Form-item",{attrs:{label:"显示结束时间"}},[i("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",placeholder:"请选择时间..."},on:{"on-change":t.syncEndTime},model:{value:t.formItem.endTime,callback:function(e){t.$set(t.formItem,"endTime",e)},expression:"formItem.endTime"}})],1),t._v(" "),i("Form-item",{attrs:{label:"等级"}},[i("Radio-group",{model:{value:t.formItem.rank,callback:function(e){t.$set(t.formItem,"rank",e)},expression:"formItem.rank"}},t._l(t.ranks,function(t){return i("Radio",{key:t.id,attrs:{label:t.tag_id}},[i("img",{style:{height:t.height+"px"},attrs:{src:t.url}})])}))],1),t._v(" "),i("Form-item",{attrs:{label:"课程学费"}},[i("i-input",{attrs:{maxlength:8,placeholder:"请输入...(99999.99元以内)"},model:{value:t.formItem.tuition,callback:function(e){t.$set(t.formItem,"tuition",e)},expression:"formItem.tuition"}})],1),t._v(" "),i("Form-item",{attrs:{label:"课程配图"}},[i("m-upload-image",{attrs:{multiple:"","default-images":t.formItem.defaultImages},on:{"on-success":t.syncImages}})],1),t._v(" "),i("Form-item",{attrs:{label:"同时上课人数最小值"}},[i("i-input",{attrs:{maxlength:6,placeholder:"请输入...(6个字以内)"},model:{value:t.formItem.studentMin,callback:function(e){t.$set(t.formItem,"studentMin",e)},expression:"formItem.studentMin"}})],1),t._v(" "),i("Form-item",{attrs:{label:"同时上课人数最大值"}},[i("i-input",{attrs:{maxlength:6,placeholder:"请输入...(6个字以内)"},model:{value:t.formItem.studentMax,callback:function(e){t.$set(t.formItem,"studentMax",e)},expression:"formItem.studentMax"}})],1),t._v(" "),i("Form-item",{attrs:{label:"课程适应人群"}},[i("i-input",{attrs:{maxlength:50,placeholder:"请输入...(50个字以内)"},model:{value:t.formItem.target,callback:function(e){t.$set(t.formItem,"target",e)},expression:"formItem.target"}})],1),t._v(" "),i("Form-item",{attrs:{label:"课程持续时长（天）"}},[i("i-input",{attrs:{maxlength:30,placeholder:"请输入...(30个字以内)"},model:{value:t.formItem.period,callback:function(e){t.$set(t.formItem,"period",e)},expression:"formItem.period"}})],1),t._v(" "),i("Form-item",{attrs:{label:"上课时间（前端展示）"}},[i("i-input",{attrs:{maxlength:30,placeholder:"请输入...(30个字以内)"},model:{value:t.formItem.lessonTime,callback:function(e){t.$set(t.formItem,"lessonTime",e)},expression:"formItem.lessonTime"}})],1),t._v(" "),i("Form-item",{attrs:{label:"上课时间（运营）"}},[i("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",placeholder:"请选择时间..."},on:{"on-change":t.syncLessonStartTime},model:{value:t.formItem.lessonStartTime,callback:function(e){t.$set(t.formItem,"lessonStartTime",e)},expression:"formItem.lessonStartTime"}})],1),t._v(" "),i("Form-item",{attrs:{label:"课程目标"}},[i("i-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请输入..."},model:{value:t.formItem.objective,callback:function(e){t.$set(t.formItem,"objective",e)},expression:"formItem.objective"}})],1),t._v(" "),i("Form-item",{attrs:{label:"课程教学图片"}},[i("m-upload-image",{attrs:{multiple:"","default-images":t.formItem.defaultContents},on:{"on-success":t.syncContentImages}})],1),t._v(" "),i("Form-item",{attrs:{label:"课程教学内容"}},[i("i-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请输入..."},model:{value:t.formItem.contentText,callback:function(e){t.$set(t.formItem,"contentText",e)},expression:"formItem.contentText"}})],1),t._v(" "),i("Form-item",{attrs:{label:"教师"}},[i("i-select",{staticStyle:{width:"260px"},attrs:{multiple:"",filterable:""},model:{value:t.formItem.teachers,callback:function(e){t.$set(t.formItem,"teachers",e)},expression:"formItem.teachers"}},t._l(t.teachers,function(e){return i("i-option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name)+"\n                ")])}))],1),t._v(" "),i("Form-item",{attrs:{label:"授课老师",required:""}},[i("i-select",{staticStyle:{width:"260px"},attrs:{multiple:"",filterable:""},model:{value:t.formItem.instructors,callback:function(e){t.$set(t.formItem,"instructors",e)},expression:"formItem.instructors"}},t._l(t.instructors,function(e){return i("i-option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name)+"\n                ")])}))],1),t._v(" "),i("Form-item",{attrs:{label:"标签选择",prop:"tags"}},[i("m-education-tags",{attrs:{width:"700"},model:{value:t.formItem.tags,callback:function(e){t.$set(t.formItem,"tags",e)},expression:"formItem.tags"}})],1),t._v(" "),i("Form-item",{attrs:{label:"跳转路由"}},[i("m-app-route",{attrs:{placeholder:"输入路由","default-route":t.formItem.route},on:{"on-ok":t.getRoute}})],1),t._v(" "),i("Form-item",[i("i-button",{attrs:{type:"primary"},nativeOn:{click:function(e){return t.submit(e)}}},[t._v("提交")]),t._v(" "),i("i-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},nativeOn:{click:function(e){return t.back(e)}}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]}},"m+4i":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("PqAQ"),a=i.n(s);e.default={name:"app",components:{MLessonForm:a.a},data:function(){return{schoolId:this.$route.params.schoolId}}}}});