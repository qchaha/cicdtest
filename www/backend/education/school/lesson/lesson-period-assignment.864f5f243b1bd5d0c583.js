webpackJsonp([179],{HN4h:function(e,t,n){var i=n("y2vm");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n("rjj0")("df5bf1f2",i,!0)},Mksj:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=null,o={findPeriod:{api:{path:"/boss/education/school/lesson-period/find",params:{fields:"{id,title,name,lesson{id,title,school{id,name,location{province,city,address}}}}",id:0}}},findAssignments:{api:{path:"/boss/education/school/lesson-period-assignment/find-list",params:{fields:"{id,user{nickname},uid,content,create_time,reviews{voice_path,voice_duration,content,rating},images{s(w:800){url}}}",periodId:0,offset:0,limit:9999999999}}},findAssignmentStatistics:{api:{path:"/boss/education/school/lesson-period-assignment/statistics",params:{periodId:0}}}};t.default={name:"app",props:{},data:function(){return{location:"",school:"",schoolId:0,lesson:"",lessonId:0,period:"",periodId:this.$route.params.periodId,imageModalUrl:"",imageModalShow:!1,reviewsToPreview:[],previewReviewRating:0,previewReviewsModalShow:!1,handedAssignmentStudentCount:0,assignmentCount:0,reviewedAssignmentCount:0,average:0,ratingPercentage:[],assignments:[],percentageColumn:[{key:"rating",title:"分数",width:70},{key:"count",title:"人数",width:70},{key:"percentage",title:"比例",render:function(e,t){return e("span",t.row.percentage+"%")},width:110}],homeworkColumn:[{key:"uid",title:"UID"},{key:"name",title:"昵称",render:function(e,t){return e("span",t.row.user?t.row.user.nickname:"")}},{key:"content",title:"评论"},{key:"create_time",title:"提交时间",render:function(e,t){return e("span",vm.$Util.dateFormat(t.row.create_time,"yyyy-MM-dd hh:mm"))}},{key:"has_review",title:"是否已评价",render:function(e,t){return e("span",null!==t.row.reviews&&t.row.reviews.length>0?"是":"否")}},{key:"action",title:"操作",render:function(e,t){var n=null!==t.row.reviews&&t.row.reviews.length>0,o=e("i-button",{props:{type:"text"},style:{color:"#39f"},on:{click:function(){i.previewImage(t.row.images)}}},"查看图片"),s=e("i-button",{props:{type:"text"},style:{color:"#39f"},on:{click:function(){i.previewReviews(t.row.reviews)}}},"查看讲师评价"),a=[];return a.push(o),n&&a.push(s),e("div",a)}}]}},methods:{back:function(){location.hash="/education/school/lesson/yanxishe-lesson-daily-info-list/"+this.lessonId},reload:function(){window.location.reload()},loadLessonPeriod:function(){bus.$emit("on-loading"),this.$Util.api.get(o.findPeriod,i).then(function(e){bus.$emit("on-loading"),i.lesson=e.data.lesson.title,i.lessonId=e.data.lesson.id;var t="";t+=e.data.lesson.school.location.province,t+=""+e.data.lesson.school.location.city,t+=""+e.data.lesson.school.location.address,i.location=t,i.period=e.data.name,i.school=e.data.lesson.school.name,i.schoolId=e.data.lesson.school.id,i.loadAssignments()},function(){bus.$emit("on-loading"),i.$Message.warning("加载课时详情失败")})},loadAssignments:function(){bus.$emit("on-loading"),this.$Util.api.get(o.findAssignments,i).then(function(e){bus.$emit("on-loading"),null!==e.data&&(i.assignments=e.data,i.loadAssignmentStatistics())},function(){bus.$emit("on-loading"),i.$Message.warning("加载作业列表失败")})},loadAssignmentStatistics:function(){bus.$emit("on-loading"),this.$Util.api.get(o.findAssignmentStatistics,i).then(function(e){bus.$emit("on-loading"),null!==e.data&&(i.assignmentCount=e.data.assignmentCount,i.average=e.data.average,i.handedAssignmentStudentCount=e.data.handedAssignmentStudentCount,i.reviewedAssignmentCount=e.data.reviewedAssignmentCount,i.ratingPercentage=e.data.ratingPercentage)},function(){bus.$emit("on-loading"),i.$Message.warning("加载作业统计信息失败")})},previewImage:function(e){this.imageModalUrl=e[0].s.url,this.imageModalShow=!0},previewReviews:function(e){this.previewReviewRating=0;var t=[];e.map(function(e){""!==e.content&&t.push({type:"text",content:e.content}),""!==e.voice_path&&t.push({type:"audio",content:e.voice_path,duration:e.voice_duration}),0!==parseInt(e.rating)&&(i.previewReviewRating=parseInt(e.rating))}),this.reviewsToPreview=t,this.previewReviewsModalShow=!0},calculateReviewRating:function(e){var t={1:{count:0},2:{count:0},3:{count:0},4:{count:0},5:{count:0}},n=e.length,i=[];e.map(function(e){e.reviews.map(function(e){0!==parseInt(e.rating)&&t[parseInt(e.rating)].count++})});var o=0;for(var s in t){var a=(t[s].count/n*100).toFixed(2);o+=t[s].count*s,i.push({rating:s,count:t[s].count,percentage:a})}this.ratingPercentage=i,this.reviewedAssignmentCount=n,this.average=(o/n).toFixed(2)},openAudio:function(e){window.open(e)},exportExcel:function(){window.open("/boss/education/school/lesson-period-assignment/export-statistics?periodId="+this.periodId)},initIds:function(){var e=this.periodId;if(!parseInt(e))return alert("课时id格式有误"),!1;e=parseInt(e),o.findPeriod.api.params.id=e,o.findAssignments.api.params.periodId=e,o.findAssignmentStatistics.api.params.periodId=e}},created:function(){i=this,this.initIds(),this.$nextTick(function(){this.loadLessonPeriod()})}}},SnmW:function(e,t,n){n("HN4h");var i=n("VU/8")(n("Mksj"),n("z8Op"),"data-v-0c133290",null);e.exports=i.exports},y2vm:function(e,t,n){t=e.exports=n(0)(),t.push([e.i,".flower[data-v-0c133290]{float:left;font-size:20px;top:5px;position:relative}",""])},z8Op:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("MPage",[n("i-button",{attrs:{type:"primary"},on:{click:e.back}},[e._v("返回\n    ")]),e._v(" "),n("Card",[e._v("\n        "+e._s(e.location)+"  "+e._s(e.school)+"/"+e._s(e.lesson)+"/"+e._s(e.period)+"  作业详情\n        "),n("div",[n("i-button",{staticStyle:{color:"#39f"},attrs:{type:"text"},on:{click:e.exportExcel}},[e._v("导出\n            ")])],1),e._v(" "),n("p",[e._v(e._s(e.handedAssignmentStudentCount)+"人提交作业，共提交作业"+e._s(e.assignmentCount)+"份。")]),e._v(" "),n("p",[e._v("讲师评价作业"+e._s(e.reviewedAssignmentCount)+"份。")]),e._v(" "),n("br"),e._v(" "),n("p",[e._v("平均分  "+e._s(e.average))]),e._v(" "),n("Table",{attrs:{data:e.ratingPercentage,columns:e.percentageColumn,width:"250"}}),e._v(" "),n("h4",{staticStyle:{"margin-top":"20px"}},[e._v("作业详情")]),e._v(" "),n("Table",{attrs:{data:e.assignments,columns:e.homeworkColumn}})],1),e._v(" "),n("Modal",{attrs:{width:"600"},model:{value:e.imageModalShow,callback:function(t){e.imageModalShow=t},expression:"imageModalShow"}},[n("div",{staticStyle:{"text-align":"center",width:"600px"}},[n("img",{staticStyle:{"max-width":"600px","max-height":"600px"},attrs:{src:e.imageModalUrl}})])]),e._v(" "),n("Modal",{attrs:{width:"600"},model:{value:e.previewReviewsModalShow,callback:function(t){e.previewReviewsModalShow=t},expression:"previewReviewsModalShow"}},[n("div",[n("Form",{attrs:{model:e.formItem,"label-width":60}},[n("Form-item",{attrs:{label:"评分:"}},[e._l(e.previewReviewRating,function(e){return n("Icon",{staticClass:"flower",staticStyle:{color:"red"},attrs:{type:"ios-flower"}})}),e._v(" "),e._l(5-e.previewReviewRating,function(e){return n("Icon",{staticClass:"flower",attrs:{type:"ios-flower"}})})],2),e._v(" "),n("Form-item",{attrs:{label:"评语:"}},e._l(e.reviewsToPreview,function(t){return n("div",["audio"===t.type?n("Tag",{nativeOn:{click:function(n){e.openAudio(t.content)}}},[n("Icon",{attrs:{type:"play"}}),e._v("\n                            "+e._s(t.duration)+"''\n                        ")],1):e._e(),e._v(" "),"text"===t.type?n("span",[e._v(e._s(t.content))]):e._e()],1)}))],1)],1)])],1)},staticRenderFns:[]}}});