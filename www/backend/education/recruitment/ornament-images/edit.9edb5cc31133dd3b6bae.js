webpackJsonp([150],{"36gA":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a={create:{api:{path:"/boss/education/recruitment/ornament-images/create"}},update:{api:{path:"/boss/education/recruitment/ornament-images/update"}},remove:{api:{path:"/boss/education/recruitment/ornament-images/delete",params:{id:0}}},find:{api:{path:"/boss/education/recruitment/ornament-images/find",params:{fields:"{users,start_time,end_time,title,identity,image{s(w:80){url,origin}},id}",id:0}}},resource:{api:{path:"/boss/education/recruitment/ornament-images/add-page-info",params:{fields:"{title,users,identity,start_time,end_time,image}"}},responseHandle:function(t){return t}}};e.default={name:"MOrnamentImageForm",props:{id:{type:String,name:""},usage:{type:String,name:"edit"}},data:function(){return{formItem:{title:"",activity_time:[],start_time:"",end_time:"",identities:["招聘者","求职者"],identity:[],image:[],id:"",users:""},ha:0}},methods:{checkAllGroupChange:function(t){},getActivityTime:function(t){var e=new Date(t[0]),i=new Date(t[1]);this.formItem.start_time=e.getTime()/1e3-28800,this.formItem.end_time=i.getTime()/1e3-28800},getImage:function(t){this.formItem.image=t},back:function(){location.hash="/education/recruitment/ornament-images/list"},remove:function(){if("edit"===this.usage){var t=this.id;t=parseInt(t),this.formItem.id=t,a.remove.api.params.id=t,confirm("确认删除?")&&vm.$Util.api.delete(a.remove).then(this.back())}},submit:function(){if(this.validateFormData()){var t=this.getRequestParams();this.submitRequest(t)}},validateFormData:function(){var t=0;if("招聘者"==this.formItem.identities[0]&&1===this.formItem.identities.length?t=1:"求职者"==this.formItem.identities[0]&&1===this.formItem.identities.length?t=2:2===this.formItem.identities.length&&(t=3),this.formItem.identity=t,0===this.formItem.end_time.length||0===this.formItem.start_time.length)return this.$Message.warning("要选择活动时间..."),!1;var e=new Date;return e.setTime(1e3*this.formItem.end_time),e.setHours(23),e.setMinutes(59),e.setSeconds(59),e.setMilliseconds(0),this.formItem.end_time=e.getTime()/1e3,this.formItem.start_time>this.formItem.end_time?(this.$Message.warning("开始时间必须小于结束时间..."),!1):0===this.formItem.title.length?(this.$Message.warning("活动名称不能为空..."),!1):0===this.formItem.users.length?(this.$Message.warning("用户ID不能为空"),!1):0===t?(this.$Message.warning("要选择用户身份呀!"),!1):0!==this.formItem.image.length||(this.$Message.warning("必须上传装饰图"),!1)},getRequestParams:function(){var t={title:this.formItem.title,users:this.formItem.users,identity:this.formItem.identity,start_time:this.formItem.start_time,end_time:this.formItem.end_time,image:this.formItem.image};return"edit"===this.usage&&(t.id=this.formItem.id),t},submitRequest:function(t){bus.$emit("on-loading");var e=this,i=a.create;"edit"===this.usage&&(i=a.update),this.$Util.api.post(i,t,e).then(function(){e.$Message.success("请求成功"),e.back()},function(t){bus.$emit("on-loading"),e.$Message.warning("请求失败")})},loadResource:function(){var t=this;bus.$emit("on-loading"),this.$Util.api.get(a.resource,t).then(function(e){bus.$emit("on-loading"),"edit"===t.usage&&t.$nextTick(function(){t.loadOrnamentImage()}),t.submitEnable=!1},function(e){t.$Message.warning("加载资源失败")})},loadOrnamentImage:function(){var t=this;bus.$emit("on-loading"),this.$Util.api.get(a.find,t).then(function(e){if(bus.$emit("on-loading"),!e.data)return t.$Message.warning("装饰图不存在或数据有误"),!1;t.formItem.title=e.data.title,t.formItem.users=e.data.users;var i=new Date;i=e.data.start_time?i.setTime(1e3*e.data.start_time):"";var a=new Date;a=e.data.end_time?a.setTime(1e3*e.data.end_time):"",t.formItem.activity_time=[i,a],t.formItem.start_time=e.data.start_time,t.formItem.end_time=e.data.end_time,1==e.data.identity?t.formItem.identities=["招聘者"]:2==e.data.identity?t.formItem.identities=["求职者"]:3==e.data.identity&&(t.formItem.identities=["招聘者","求职者"]),t.formItem.defaultImage=[{url:e.data.image.s.origin}],t.formItem.image=[{url:e.data.image.s.origin}],t.submitEnable=!1},function(e){bus.$emit("on-loading"),t.$Message.warning("加载活动装饰图详情失败")})},initIds:function(){if("edit"===this.usage){var t=this.id;if(!parseInt(t))return alert("活动装饰图格式有误"),!1;t=parseInt(t),this.formItem.id=t,a.find.api.params.id=t}}},created:function(){this.initIds(),"edit"===this.usage&&(a.resource.api.path="/boss/education/recruitment/ornament-images/edit-page-info"),this.$nextTick(function(){this.loadResource()})}}},B2kg:function(t,e,i){var a=i("VU/8")(i("36gA"),i("X4z2"),null,null);t.exports=a.exports},G9im:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("B2kg"),n=i.n(a);e.default={name:"app",components:{MOrnamentImageForm:n.a},data:function(){return{id:this.$route.params.id}}}},X4z2:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{"padding-top":"20px"}},[i("Form",{attrs:{model:t.formItem,"label-width":80}},[i("m-card",[i("h3",{staticStyle:{"margin-bottom":"10px"}},[t._v("设置活动")]),t._v(" "),i("Form-item",{attrs:{label:"活动标题"}},[i("Input",{staticStyle:{width:"300px"},attrs:{maxlength:30,placeholder:"请输入30字以内活动标题"},model:{value:t.formItem.title,callback:function(e){t.$set(t.formItem,"title",e)},expression:"formItem.title"}})],1),t._v(" "),i("Form-item",{attrs:{label:"用户id"}},[i("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"用户id用英文，隔开"},model:{value:t.formItem.users,callback:function(e){t.$set(t.formItem,"users",e)},expression:"formItem.users"}})],1),t._v(" "),i("Form-item",{attrs:{label:"用户身份"}},[i("CheckboxGroup",{on:{"on-change":t.checkAllGroupChange},model:{value:t.formItem.identities,callback:function(e){t.$set(t.formItem,"identities",e)},expression:"formItem.identities"}},[i("checkbox",{attrs:{label:"招聘者"}}),t._v(" "),i("checkbox",{attrs:{label:"求职者"}})],1)],1),t._v(" "),i("Form-item",{attrs:{label:"活动时间"}},[i("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"daterange",placeholder:"请选择活动时间",options:t.options,value:t.formItem.activity_time},on:{"on-change":t.getActivityTime}})],1),t._v(" "),i("Form-item",{attrs:{label:"装饰图"}},[i("m-upload-image",{attrs:{"default-images":t.formItem.defaultImage},on:{"on-success":t.getImage}})],1),t._v(" "),i("Affix",{attrs:{"offset-bottom":0}},[i("Form-item",[i("i-button",{attrs:{type:"primary"},nativeOn:{click:function(e){return t.submit(e)}}},[t._v("提交")])],1)],1)],1)],1)],1)},staticRenderFns:[]}},"sjp+":function(t,e,i){var a=i("VU/8")(i("G9im"),i("yNVv"),null,null);t.exports=a.exports},yNVv:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page-edit",[i("m-ornament-image-form",{attrs:{usage:"edit",id:t.id}})],1)},staticRenderFns:[]}}});