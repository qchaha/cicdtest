webpackJsonp([162],{"+vfs":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("/j6o"),o=a.n(i);e.default={name:"app",components:{MTagForm:o.a},data:function(){return{category:this.$route.params.category}}}},"/j6o":function(t,e,a){var i=a("VU/8")(a("qi20"),a("DlM9"),null,null);t.exports=i.exports},DlM9:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"padding-top":"20px"}},[a("Form",{attrs:{model:t.formData,"label-width":60}},[a("Form-item",{attrs:{label:"专题名称",required:""}},[a("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:16,placeholder:"专题名称"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),t._v(" "),a("Form-item",{attrs:{label:"专题描述",required:""}},[a("i-input",{staticStyle:{width:"300px"},attrs:{maxlength:255,placeholder:"专题描述"},model:{value:t.formData.desc,callback:function(e){t.$set(t.formData,"desc",e)},expression:"formData.desc"}})],1),t._v(" "),a("Form-item",{attrs:{label:"封面图",required:""}},[a("m-upload-image",{attrs:{objType:"course_tag",objId:t.formData.id},model:{value:t.formData.images,callback:function(e){t.$set(t.formData,"images",e)},expression:"formData.images"}})],1),t._v(" "),a("Form-item",{attrs:{label:"包含教程",required:""}},[a("i-input",{staticStyle:{width:"700px"},attrs:{type:"textarea",placeholder:"输入教程id,用英文逗号隔开"},model:{value:t.formData.courseIds,callback:function(e){t.$set(t.formData,"courseIds",e)},expression:"formData.courseIds"}})],1),t._v(" "),"videoCourse"!==t.category&&"courseProject"!==t.category?a("div",[a("Form-item",{attrs:{label:""}},[a("Checkbox",{attrs:{disabled:!t.canAddToVideoCourse},model:{value:t.formData.inVideoCourse,callback:function(e){t.$set(t.formData,"inVideoCourse",e)},expression:"formData.inVideoCourse"}},[t._v("加入视频教程列表 \n                "),t.canAddToVideoCourse?t._e():a("span",{staticStyle:{color:"red"}},[t._v("(视频教程标签已达上限)")])])],1),t._v(" "),a("Form-item",{attrs:{label:""}},[a("Checkbox",{model:{value:t.formData.inCourseProject,callback:function(e){t.$set(t.formData,"inCourseProject",e)},expression:"formData.inCourseProject"}},[t._v("加入教程专题列表")])],1)],1):t._e(),t._v(" "),a("Form-item",[a("i-button",{attrs:{type:"primary"},nativeOn:{click:function(e){return t.submit(e)}}},[t._v(t._s(t.submitButtonText))])],1)],1)],1)},staticRenderFns:[]}},NjLl:function(t,e,a){var i=a("VU/8")(a("+vfs"),a("wXPv"),null,null);t.exports=i.exports},qi20:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={create:{api:{path:"/boss/education/course/tag/create"}},update:{api:{path:"/boss/education/course/tag/update"}},find:{api:{path:"/boss/education/course/tag/find",params:{fields:"{id, name, desc, cover{s(w:400){url,origin,origin_width,origin_height}},all_courses{id},in_course_project,in_video_course}",id:0}}},resource:{api:{path:"/boss/education/course/tag/add-page-info",params:{id:0}}}};e.default={name:"MTagForm",props:{id:{type:String,default:""},usage:{type:String,default:""},category:{type:String,default:""}},data:function(){return{formData:{id:0,name:"",desc:"",images:[],courseIds:"",inCourseProject:"courseProject"===this.category,inVideoCourse:"videoCourse"===this.category},canAddToVideoCourse:!1}},computed:{submitButtonText:function(){return"edit"===this.usage?"修改":"添加"}},methods:{back:function(){var t="";"courseProject"===this.category&&(t="-course-project"),"videoCourse"===this.category&&(t="-video-course"),"all"===this.category&&(t=""),location.hash="/education/course/tag/list"+t},submit:function(){if(this.validateFormData()){var t=this.getRequestParams();this.submitRequest(t)}},validateFormData:function(){return""===this.formData.name?(this.$Notice.warning({title:"标签名不能为空"}),!1):""===this.formData.desc?(this.$Notice.warning({title:"标签描述不能为空"}),!1):0!==this.formData.images.length||(this.$Notice.warning({title:"标签图片不能为空",desc:""}),!1)},getRequestParams:function(){var t={name:this.formData.name,desc:this.formData.desc,inCourseProject:this.formData.inCourseProject?1:0,inVideoCourse:this.formData.inVideoCourse?1:0,courseIds:this.formData.courseIds,imagePath:this.formData.images[0].url,imageWidth:this.formData.images[0].width,imageHeight:this.formData.images[0].height};return"edit"===this.usage&&(t.id=this.formData.id),t},submitRequest:function(t){bus.$emit("on-loading");var e=this,a=i.create;"edit"===this.usage&&(a=i.update),this.$Util.api.post(a,t,e).then(function(){e.$Message.success("请求成功"),e.back()},function(){bus.$emit("on-loading"),e.$Message.warning("请求失败")})},loadTag:function(){var t=this;this.$Util.api.get(i.find,t).then(function(e){t.formData.name=e.data.name,t.formData.desc=e.data.desc,void 0!==e.data.cover.s&&(t.formData.images=[{url:e.data.cover.s.origin,width:e.data.cover.s.origin_width,height:e.data.cover.s.origin_height}]);var a=[];e.data.all_courses.map(function(t){a.push(t.id)}),t.formData.courseIds=a.join(","),t.formData.inCourseProject=e.data.in_course_project,t.formData.inVideoCourse=e.data.in_video_course,bus.$emit("on-loading")},function(e){bus.$emit("on-loading"),t.$Message.warning("加载课程详情失败")})},loadFormInfo:function(){bus.$emit("on-loading");var t=this;this.$Util.api.get(i.resource,t).then(function(e){t.canAddToVideoCourse=e.data.form.canAddToVideoCourse,"edit"===t.usage?t.$nextTick(function(){t.loadTag()}):bus.$emit("on-loading")},function(e){bus.$emit("on-loading"),t.$Message.warning("加载资源失败")})},initIds:function(){var t=this.id;if(!parseInt(t))return alert("标签id格式有误"),!1;t=parseInt(t),this.formData.id=t,i.find.api.params.id=t,i.resource.api.params.id=t}},created:function(){"edit"===this.usage&&(i.resource.api.path="/boss/education/course/tag/edit-page-info",this.initIds()),this.$nextTick(function(){this.loadFormInfo()})}}},wXPv:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("m-page-edit",[a("m-tag-form",{attrs:{usage:"add",category:t.category}})],1)},staticRenderFns:[]}}});