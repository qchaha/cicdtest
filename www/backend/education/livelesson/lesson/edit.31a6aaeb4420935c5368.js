webpackJsonp([23],{"/Mgz":function(t,e,i){e=t.exports=i(0)(),e.push([t.i,".demo-upload-list{display:inline-block;width:60px;height:60px;text-align:center;line-height:60px;border:1px solid transparent;border-radius:4px;overflow:hidden;background:#fff;position:relative;box-shadow:0 1px 1px rgba(0,0,0,.2);margin-right:4px}.demo-upload-list img{width:100%;height:100%}.demo-upload-list-cover{display:none;position:absolute;top:0;bottom:0;left:0;right:0;background:rgba(0,0,0,.6)}.demo-upload-list:hover .demo-upload-list-cover{display:block}.demo-upload-list-cover i{color:#fff;font-size:20px;cursor:pointer;margin:0 2px}",""])},"0+fJ":function(t,e,i){var o=i("0KtB");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);i("rjj0")("2804553a",o,!0)},"0KtB":function(t,e,i){e=t.exports=i(0)(),e.push([t.i,".route[data-v-54bf4c36]{color:#5cadff;cursor:pointer}",""])},"5gDg":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"lesson-popup"},[i("m-popup",{attrs:{modal:t.modal,title:t.title,width:"600"},on:{"on-ok":t.onOk,"on-modal-change":function(e){t.modal=!1}}},[i("Form",{ref:"formItem",attrs:{model:t.formItem,"label-width":60,rules:t.ruleValidate}},[i("Form-item",{attrs:{label:"小节名称",prop:"title"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"输入课程名称"},model:{value:t.formItem.title,callback:function(e){t.$set(t.formItem,"title",e)},expression:"formItem.title"}})],1),t._v(" "),0==t.type?i("div",[i("Form-item",{attrs:{label:"课程图"}},[i("m-upload-image",{attrs:{"default-images":t.defaultImages},on:{"on-success":t.syncImages}})],1),t._v(" "),i("Form-item",{attrs:{label:"显示大小",prop:"size"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"输入显示大小，文本，例如 100kb"},model:{value:t.formItem.size,callback:function(e){t.$set(t.formItem,"size",e)},expression:"formItem.size"}})],1)],1):1==t.type?i("div",[i("Form-item",{attrs:{label:"视频封面图"}},[i("m-upload-image",{attrs:{"default-images":t.defaultCoverImages},on:{"on-success":t.syncCoverImages}})],1),t._v(" "),i("Form-item",{attrs:{label:"视频URL",prop:"video_path"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"输入视频URL"},model:{value:t.formItem.video_path,callback:function(e){t.$set(t.formItem,"video_path",e)},expression:"formItem.video_path"}})],1),t._v(" "),i("Form-item",{attrs:{label:"时长",prop:"duration"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"输入视频时长，文本，例如 90分钟"},model:{value:t.formItem.duration,callback:function(e){t.$set(t.formItem,"duration",e)},expression:"formItem.duration"}})],1)],1):2==t.type||3==t.type||4==t.type?i("div",[i("Form-item",{attrs:{label:"直播开始时间",prop:"start_time"}},[i("Row",[i("i-col",{staticStyle:{width:"300px"}},[i("Date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm",placeholder:"选择直播开始时间",disabled:t.dateDisabled},model:{value:t.formItem.start_time,callback:function(e){t.$set(t.formItem,"start_time",e)},expression:"formItem.start_time"}})],1)],1)],1),t._v(" "),i("Form-item",{attrs:{label:"直播结束时间",prop:"end_time"}},[i("Row",[i("i-col",{staticStyle:{width:"300px"}},[i("Date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm",placeholder:"选择直播结束时间",disabled:t.dateDisabled},model:{value:t.formItem.end_time,callback:function(e){t.$set(t.formItem,"end_time",e)},expression:"formItem.end_time"}})],1)],1)],1),t._v(" "),i("Form-item",{attrs:{label:"直播老师",prop:"teacher_id"}},[i("Select",{staticStyle:{width:"300px"},model:{value:t.formItem.teacher_id,callback:function(e){t.$set(t.formItem,"teacher_id",e)},expression:"formItem.teacher_id"}},t._l(t.teacherList,function(e){return i("Option",{key:e,attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),i("Form-item",{attrs:{label:"备选老师",prop:"second_teacher_id"}},[i("Select",{staticStyle:{width:"300px"},model:{value:t.formItem.second_teacher_id,callback:function(e){t.$set(t.formItem,"second_teacher_id",e)},expression:"formItem.second_teacher_id"}},t._l(t.teacherList,function(e){return i("Option",{key:e,attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1)],1):i("div",[t._v("\n                无此类型\n\n            ")]),t._v(" "),i("Form-item",{attrs:{label:"第几节课",prop:"num"}},[i("Select",{staticStyle:{width:"300px"},model:{value:t.formItem.num,callback:function(e){t.$set(t.formItem,"num",e)},expression:"formItem.num"}},t._l(t.courseArray,function(e){return i("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}))],1)],1)],1),t._v(" "),"add"==t.usage?i("div",[i("i-button",{staticStyle:{"margin-bottom":"5px"},attrs:{type:"ghost"},nativeOn:{click:function(e){return t.popupShow(e)}}},[t._v(t._s(t.buttonText))])],1):i("div",[i("span",{staticClass:"lesson-edit",on:{click:t.popupShow}},[t._v("编辑")])])],1)},staticRenderFns:[]}},"7VMq":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t._l(t.courseInformationList,function(e,o){return i("Form-item",{attrs:{label:"第"+(o+1)+"节课"}},["直播"==e.name?i("div",[i("div",[i("span",[t._v(t._s(e.name))]),t._v(" "),i("span",[t._v(t._s(e.title))]),t._v(" "),3==e.type||4==e.type?i("span",[i("span",{staticClass:"route",on:{click:function(i){t.sendTeacherRoute(e)}}},[t._v("发送主播路由")]),t._v(" "),i("span",{staticClass:"route",on:{click:function(i){t.sendSecondTeacherRoute(e)}}},[t._v("发送备选主播路由")])]):t._e()]),t._v(" "),i("div",[i("span",[t._v("时间")]),t._v(" "),i("span",[t._v(t._s(e.startTime))]),t._v("\n                -\n                "),i("span",[t._v(t._s(e.endTime))]),t._v(" "),i("m-lesson-popup",{attrs:{"course-num":t.courseNum,type:e.type,"default-course":e.defaultCourse,"teacher-list":t.teachers,usage:"edit",index:o},on:{"on-ok":t.onOk}}),t._v(" "),i("span",{staticStyle:{cursor:"pointer",color:"#f30"},on:{click:function(e){t.removeCourse(o)}}},[t._v("删除")])],1)]):i("div",[i("span",[t._v(t._s(e.name))]),t._v(" "),i("span",[t._v(t._s(e.title))]),t._v(" "),i("m-lesson-popup",{attrs:{"course-num":t.courseNum,type:e.type,"default-course":e.defaultCourse,"teacher-list":t.teachers,usage:"edit",index:o},on:{"on-ok":t.onOk}}),t._v(" "),i("span",{staticStyle:{cursor:"pointer",color:"#f30"},on:{click:function(e){t.removeCourse(o)}}},[t._v("删除")])],1)])}),t._v(" "),i("Form-item",{attrs:{label:"添加课程",prop:"catalog"}},[i("m-lesson-popup",{attrs:{"course-num":t.courseNum,type:0},on:{"on-ok":t.onOk}}),t._v(" "),i("m-lesson-popup",{attrs:{"course-num":t.courseNum,type:1},on:{"on-ok":t.onOk}}),t._v(" "),i("m-lesson-popup",{attrs:{"course-num":t.courseNum,type:2,"teacher-list":t.teachers},on:{"on-ok":t.onOk}})],1)],2)},staticRenderFns:[]}},BLNm:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"MLessonPopup",props:{courseNum:{type:Number,default:0},type:{type:Number,default:0},index:{type:Number,default:-1},usage:{type:String,default:"add"},teacherList:{type:Array,default:function(){return[]}},defaultCourse:{type:Object,default:function(){return{}}}},watch:{courseNum:function(t){this.courseNumber=t},defaultImages:function(t){}},data:function(){return{modal:!1,courseNumber:this.courseNum,formItem:{title:"",num:0,size:"",path:[{url:""}],video_path:"",duration:"",teacher_id:"",second_teacher_id:"",room_id:"",create_status:0,notify_status:0,quit_time:0,coverImage:[{url:""}],start_time:0,end_time:0},ruleValidate:{title:[{required:!0,message:"名称不能为空",trigger:"blur"}],size:[{type:"string",required:!0,message:"显示大小不能为空",trigger:"blur"}],video_path:[{type:"string",required:!0,message:"视频URL不能为空",trigger:"blur"}],duration:[{required:!0,message:"视频时长不能为空",trigger:"blur"}],num:[{type:"number",required:!0,message:"第几节课不能为空",trigger:"blur"}],teacher_id:[{type:"number",required:!0,message:"直播老师不能为空",trigger:"blur"}],second_teacher_id:[{type:"number",required:!0,message:"备选老师不能为空",trigger:"blur"}],start_time:[{type:"date",required:!0,message:"直播开始时间不能为空",trigger:"blur"}],end_time:[{type:"date",required:!0,message:"直播结束时间不能为空",trigger:"blur"}]},defaultImages:[{url:""}],defaultCoverImages:[{url:""}],dateDisabled:!1}},computed:{courseArray:function(){for(var t=[],e=0;e<this.courseNumber;e++)t.push(e+1);return t},title:function(){switch(this.type){case 0:return"图片";case 1:return"视频";case 2:case 3:case 4:return"直播";default:return"无此类型"}},buttonText:function(){switch(this.type){case 0:return"添加图片教程";case 1:return"添加视频教程";case 2:return"添加直播教程";default:return"无此类型"}}},methods:{onOk:function(){var t=this,e=this;this.$refs.formItem.validate(function(i){if(i)if(0==t.type&&""==t.formItem.path[0].url||1==t.type&&""==t.formItem.coverImage[0].url)t.$Message.error("必须上传图片!"),setTimeout(function(){e.modal=!0});else if(2==t.type&&t.formItem.end_time<t.formItem.start_time)t.$Message.error("开始时间必须小于结束时间"),setTimeout(function(){e.modal=!0});else{var o=t.getFormData();t.$emit("on-ok",o)}else setTimeout(function(){e.modal=!0}),t.$Message.error("表单验证失败!")})},getFormData:function(){var t={};switch(t.title=this.formItem.title,t.index=this.index,t.num=this.formItem.num,t.usage=this.usage,this.type){case 0:t.type=0,t.path=this.formItem.path[0].url,t.subtitle=this.formItem.size;break;case 1:t.type=1,t.video_path=this.formItem.video_path,t.cover_path=this.formItem.coverImage[0].url,t.subtitle=this.formItem.duration;break;case 2:case 3:case 4:t.type=2,t.start_time="number"==typeof this.formItem.start_time?this.formItem.start_time/1e3:Date.parse(this.formItem.start_time)/1e3,t.end_time="number"==typeof this.formItem.end_time?this.formItem.end_time/1e3:Date.parse(this.formItem.end_time)/1e3,t.teacher_id=this.formItem.teacher_id,t.second_teacher_id=this.formItem.second_teacher_id,t.room_id=this.formItem.room_id,t.create_status=this.formItem.create_status,t.notify_status=this.formItem.notify_status,t.quit_time=this.formItem.quit_time}return t},syncImages:function(t){this.formItem.path=t},syncCoverImages:function(t){this.formItem.coverImage=t},popupShow:function(){if(this.defaultCourse.room_id&&(this.dateDisabled=!0),this.modal=!0,this.courseNumber=this.courseNum,"edit"==this.usage)switch(this.formItem.title=this.defaultCourse.title,this.formItem.num=this.defaultCourse.num,this.defaultCourse.type){case 0:this.defaultImages[0].url=this.defaultCourse.path,this.formItem.path[0].url=this.defaultCourse.path,this.formItem.size=this.defaultCourse.subtitle;break;case 1:this.formItem.video_path=this.defaultCourse.video_path,this.defaultCoverImages[0].url=this.defaultCourse.cover_path,this.formItem.coverImage[0].url=this.defaultCourse.cover_path,this.formItem.duration=this.defaultCourse.subtitle;break;case 2:case 3:case 4:this.formItem.start_time=new Date(1e3*this.defaultCourse.start_time),this.formItem.end_time=new Date(1e3*this.defaultCourse.end_time),this.formItem.teacher_id=this.defaultCourse.teacher_id,this.formItem.second_teacher_id=this.defaultCourse.second_teacher_id,this.formItem.room_id=this.defaultCourse.room_id,this.formItem.create_status=this.defaultCourse.create_status,this.formItem.notify_status=this.defaultCourse.notify_status,this.formItem.quit_time=this.defaultCourse.quit_time}else this.courseNumber++,this.formItem={title:"",num:0,defaultImages:[{url:""}],defaultCoverImages:[{url:""}],size:"",path:[{url:""}],video_path:"",duration:"",teacher_id:"",second_teacher_id:"",room_id:"",create_status:0,notify_status:0,quit_time:0,coverImage:[{url:""}]},this.defaultImages=[{url:""}],this.defaultCoverImages=[{url:""}]}}}},EYYU:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page-edit",[i("m-lesson-form",{attrs:{usage:"edit",id:t.id}})],1)},staticRenderFns:[]}},FYnx:function(t,e,i){var o=i("XSEK");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);i("rjj0")("80948c82",o,!0)},FsWk:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("Udgh"),s=i.n(o);e.default={name:"app",components:{MLessonForm:s.a},data:function(){return{id:this.$route.params.id}}}},G0Ll:function(t,e,i){i("0+fJ");var o=i("VU/8")(i("ob+R"),i("7VMq"),"data-v-54bf4c36",null);t.exports=o.exports},Gwb7:function(t,e,i){var o=i("VU/8")(i("FsWk"),i("EYYU"),null,null);t.exports=o.exports},OpSM:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{"padding-top":"20px"}},[i("Form",{ref:"formItem",attrs:{model:t.formItem,"label-width":60,rules:t.ruleValidate}},[i("Form-item",{attrs:{label:"线上课程名称",prop:"title"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"输入课程名称"},model:{value:t.formItem.title,callback:function(e){t.$set(t.formItem,"title",e)},expression:"formItem.title"}})],1),t._v(" "),i("m-lesson-course-edit",{attrs:{teachers:t.formItem.teachers,"default-course":t.defaultCourse,"lesson-name":t.formItem.title},on:{"on-remove":t.handleRemove,"on-ok":t.handleAddOrUpdate}}),t._v(" "),i("Form-item",{attrs:{label:"展示开始时间"}},[i("Row",[i("i-col",{staticStyle:{width:"300px"}},[i("Date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm",placeholder:"选择展示开始时间"},model:{value:t.formItem.show_start_time,callback:function(e){t.$set(t.formItem,"show_start_time",e)},expression:"formItem.show_start_time"}})],1)],1)],1),t._v(" "),i("Form-item",{attrs:{label:"展示结束时间"}},[i("Row",[i("i-col",{staticStyle:{width:"300px"}},[i("Date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm",placeholder:"选择展示结束时间"},model:{value:t.formItem.show_end_time,callback:function(e){t.$set(t.formItem,"show_end_time",e)},expression:"formItem.show_end_time"}})],1)],1)],1),t._v(" "),i("Form-item",{attrs:{label:"钻石价格",prop:"diamond_coin_price"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"输入价格数字，单位：钻石，整数"},model:{value:t.formItem.diamond_coin_price,callback:function(e){t.$set(t.formItem,"diamond_coin_price",e)},expression:"formItem.diamond_coin_price"}})],1),t._v(" "),i("Form-item",{attrs:{label:"人民币价格",prop:"sale_price"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"输入价格数字，单位：元，整数"},model:{value:t.formItem.sale_price,callback:function(e){t.$set(t.formItem,"sale_price",e)},expression:"formItem.sale_price"}})],1),t._v(" "),i("Form-item",{attrs:{label:"人数上限",prop:"limited_count"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"输入人数上限数字"},model:{value:t.formItem.limited_count,callback:function(e){t.$set(t.formItem,"limited_count",e)},expression:"formItem.limited_count"}})],1),t._v(" "),i("Form-item",{attrs:{label:"适合人群",prop:"target"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"输入适合人群，分号分隔"},model:{value:t.formItem.target,callback:function(e){t.$set(t.formItem,"target",e)},expression:"formItem.target"}})],1),t._v(" "),i("Form-item",{attrs:{required:"",label:"封面图片"}},[i("m-upload-image",{attrs:{"default-images":t.formItem.cover},on:{"on-success":t.syncCover}})],1),t._v(" "),i("Form-item",{attrs:{label:"课堂内容图片"}},[i("m-upload-image",{attrs:{multiple:"","default-images":t.formItem.contents},on:{"on-success":t.syncContentImages}})],1),t._v(" "),i("Form-item",{attrs:{label:"课堂内容文本",prop:"content_text"}},[i("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",autosize:{minRows:5,maxRows:10},placeholder:"输入课堂内容文本"},model:{value:t.formItem.content_text,callback:function(e){t.$set(t.formItem,"content_text",e)},expression:"formItem.content_text"}})],1),t._v(" "),i("Form-item",{attrs:{label:"课程老师",prop:"teacher_id"}},[i("i-select",{staticStyle:{width:"260px"},model:{value:t.formItem.teacher_id,callback:function(e){t.$set(t.formItem,"teacher_id",e)},expression:"formItem.teacher_id"}},t._l(t.formItem.teachers,function(e){return i("i-option",{attrs:{value:e.id}},[t._v("\n                    "+t._s(e.name)+"\n\n                ")])}))],1),t._v(" "),i("Form-item",{attrs:{label:"标签选择",prop:"tags"}},[i("m-education-tags",{attrs:{width:"700"},model:{value:t.formItem.tags,callback:function(e){t.$set(t.formItem,"tags",e)},expression:"formItem.tags"}})],1),t._v(" "),i("Form-item",{attrs:{label:"课堂管理员1"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"输入管理员ID"},model:{value:t.formItem.first_admin,callback:function(e){t.$set(t.formItem,"first_admin",e)},expression:"formItem.first_admin"}})],1),t._v(" "),i("Form-item",{attrs:{label:"课堂管理员2"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"输入管理员ID"},model:{value:t.formItem.second_admin,callback:function(e){t.$set(t.formItem,"second_admin",e)},expression:"formItem.second_admin"}})],1),t._v(" "),i("Form-item",{attrs:{label:"课堂管理员3"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"输入管理员ID"},model:{value:t.formItem.third_admin,callback:function(e){t.$set(t.formItem,"third_admin",e)},expression:"formItem.third_admin"}})],1),t._v(" "),i("Form-item",{attrs:{label:"教学款式"}},[i("m-upload-image",{attrs:{multiple:"","default-images":t.formItem.images},on:{"on-success":t.syncImages}})],1),t._v(" "),i("Form-item",{attrs:{label:"关联学校"}},[i("i-select",{staticStyle:{width:"260px"},attrs:{clearable:""},model:{value:t.formItem.school_id,callback:function(e){t.$set(t.formItem,"school_id",e)},expression:"formItem.school_id"}},t._l(t.formItem.schools,function(e){return i("i-option",{attrs:{value:e.id}},[t._v("\n                    "+t._s(e.name)+"\n\n                ")])}))],1),t._v(" "),i("Form-item",{attrs:{label:"课程咨询"}},[i("m-app-route",{attrs:{placeholder:"输入路由","default-route":t.formItem.consult_app_route},on:{"on-ok":t.handleRoute}})],1),t._v(" "),i("Form-item",{attrs:{label:"显示报名须知"}},[i("i-switch",{on:{"on-change":t.change},model:{value:t.formItem.show_notice,callback:function(e){t.$set(t.formItem,"show_notice",e)},expression:"formItem.show_notice"}})],1),t._v(" "),i("Form-item",{attrs:{label:"课堂结束时间"}},[i("Row",[i("i-col",{staticStyle:{width:"300px"}},[i("Date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm",placeholder:"课堂结束时间"},model:{value:t.formItem.end_time,callback:function(e){t.$set(t.formItem,"end_time",e)},expression:"formItem.end_time"}})],1)],1)],1),t._v(" "),i("Form-item",{attrs:{label:"课堂作业"}},[i("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",autosize:{minRows:5,maxRows:10},placeholder:"请输入课堂作业内容200字"},model:{value:t.formItem.assignment_description,callback:function(e){t.$set(t.formItem,"assignment_description",e)},expression:"formItem.assignment_description"}})],1),t._v(" "),i("Form-item",[i("i-button",{attrs:{type:"primary",disabled:t.submitEnable},on:{click:function(e){t.handleSubmit("formItem")}}},[t._v("提交")]),t._v(" "),i("i-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:t.back}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]}},Udgh:function(t,e,i){i("kjXY");var o=i("VU/8")(i("lpci"),i("OpSM"),null,null);t.exports=o.exports},XSEK:function(t,e,i){e=t.exports=i(0)(),e.push([t.i,".lesson-popup[data-v-11e7dad5]{display:inline-block}.lesson-edit[data-v-11e7dad5]{cursor:pointer;color:#39f}",""])},kjXY:function(t,e,i){var o=i("/Mgz");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);i("rjj0")("2294fd92",o,!0)},lpci:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("G0Ll"),s=i.n(o),r=i("ezil"),a=i.n(r),m={create:{api:{path:"/boss/education/livelesson/lesson/create"}},update:{api:{path:"/boss/education/livelesson/lesson/update"}},findSchoolsAndTeachers:{api:{path:"/boss/education/livelesson/lesson/find-schools-and-teachers"}},find:{api:{path:"/boss/education/livelesson/lesson/find",params:{fields:'{id,title,attendance_count,limited_count,diamond_coin_price,sale_price,target,content_text,show_start_time,show_end_time,teacher{id,name},teachers{id,name},school{id,name},schools{id,name},end_time,consult_app_route,content_images{s(w:80,h:80){url(protocol:"https"),origin,width,height}},cover{s(w:80,h:80){url,origin}},preview_images{s(w:80,h:80){url(protocol:"https"),origin,width,height}},hide_notice,assignment_description,catalog,admin_uids,tags}',id:0}},responseHandle:function(t){var e=new Date;e.setTime(1e3*t.data.show_start_time),t.data.show_start_time=e;var i=new Date;i.setTime(1e3*t.data.show_end_time),t.data.show_end_time=i;var o=new Date;return o.setTime(1e3*t.data.end_time),t.data.end_time=o,t}}};e.default={name:"MLessonForm",props:{id:{type:String,default:""},usage:{type:String,default:"edit"}},components:{MEducationTags:a.a,MLessonCourseEdit:s.a},data:function(){return{formItem:{id:"",title:"",attendance_count:"",limited_count:"",diamond_coin_price:"",target:"",content_text:"",teacher_id:0,teachers:[],school_id:0,schools:[],show_notice:!1,show_start_time:"",show_end_time:"",end_time:"",images:[],contents:[],catalog:[],consult_app_route:"",first_admin:"",second_admin:"",third_admin:"",assignment_description:"",tags:"",cover:""},uploadType:{content:{usage:"liveLesson/content"},preview:{usage:"liveLesson/preview"}},submitEnable:!0,isActive:!1,visible:!1,displayContentUrl:"",displayPreviewUrl:"",ruleValidate:{title:[{required:!0,message:"名称不能为空",trigger:"blur"}],diamond_coin_price:[{type:"string",required:!0,message:"价格不能为空",trigger:"blur"}],sale_price:[{type:"string",required:!0,message:"价格不能为空",trigger:"blur"}],limited_count:[{type:"string",required:!0,message:"人数上限不能为空",trigger:"blur"}],target:[{required:!0,message:"适合人群不能为空",trigger:"blur"}],content_text:[{required:!0,message:"课堂内容文本不能为空",trigger:"blur"}],teacher_id:[{type:"number",required:!0,message:"直播老师不能为空",trigger:"blur"}],catalog:[]},defaultCourse:[]}},methods:{back:function(){location.hash="/education/livelesson/lesson/list"},syncImages:function(t){this.formItem.images=t},syncContentImages:function(t){this.formItem.contents=t},syncCover:function(t){this.formItem.cover=t},handleAddOrUpdate:function(t){this.formItem.catalog=t},handleRemove:function(t){this.formItem.catalog=t},handleRoute:function(t){this.formItem.consult_app_route=t},handleSubmit:function(t){var e=this;this.$refs[t].validate(function(t){if(t){if(!e.validateFormData())return;var i=e.getRequestParams();e.$Message.success("提交成功!"),e.submitRequest(i)}else e.$Message.error("表单验证失败!")})},validateFormData:function(){return""===this.formItem.show_start_time||""===this.formItem.show_end_time?(this.$Notice.warning({title:"时间不能为空",desc:""}),!1):this.formItem.show_start_time>=this.formItem.show_end_time?(this.$Notice.warning({title:"开始时间必须小于结束时间",desc:""}),!1):""===this.formItem.teacher_id?(this.$Notice.warning({title:"必须选老师",desc:""}),!1):""===this.formItem.consult_app_route?(this.$Notice.warning({title:"咨询路由不能为空",desc:""}),!1):0===this.formItem.catalog.length?(this.$Notice.warning({title:"课程至少有一个小节",desc:""}),!1):0!==this.formItem.cover.length||(this.$Notice.warning({title:"必须上传封面图片",desc:""}),!1)},getRequestParams:function(){var t={id:this.formItem.id,title:this.formItem.title,attendance_count:this.formItem.attendance_count,limited_count:this.formItem.limited_count,diamond_coin_price:this.formItem.diamond_coin_price,sale_price:this.formItem.sale_price,target:this.formItem.target,content_text:this.formItem.content_text,content_images:[],preview_images:[],teacher_id:this.formItem.teacher_id,school_id:this.formItem.school_id,catalog:this.formItem.catalog,show_start_time:this.formItem.show_start_time.getTime()/1e3,show_end_time:this.formItem.show_end_time.getTime()/1e3,end_time:this.formItem.end_time.getTime()/1e3,consult_app_route:this.formItem.consult_app_route,assignment_description:this.formItem.assignment_description,admin_uids:"",tags:this.formItem.tags,cover:this.formItem.cover};!0===this.formItem.show_notice?t.hide_notice=0:t.hide_notice=1,this.formItem.cover.map(function(e){""!==e.url&&(t.cover=e.url)}),this.formItem.images.map(function(e){""!==e.url&&t.preview_images.push(e.url)});for(var e in this.formItem.contents){var i=this.formItem.contents[e];if(""!==i.url){var o={width:i.width,height:i.height,url:i.url};t.content_images.push(o)}}return""===this.formItem.school_id&&(t.school_id=0),isNaN(this.formItem.first_admin)||(t.admin_uids=this.formItem.first_admin+","),isNaN(this.formItem.second_admin)||(t.admin_uids+=this.formItem.second_admin+","),isNaN(this.formItem.third_admin)||(t.admin_uids+=this.formItem.third_admin),t},submitRequest:function(t){this.submitEnable=!0,bus.$emit("on-loading");var e={};e="edit"===this.usage?m.update:m.create;var i=this;this.$Util.api.post(e,t,i).then(function(){i.back()},function(){})},change:function(t){this.formItem.show_notice=t},loadEditFormData:function(t){m.find.api.params.id=t;var e=this;this.$Util.api.get(m.find,this).then(function(t){if(bus.$emit("on-loading"),!t.data)return e.$Message.warning("直播课不存在或数据有误"),!1;if(e.submitEnable=!1,e.formItem=t.data,e.formItem.images=[],e.formItem.contents=[],e.formItem.diamond_coin_price=t.data.diamond_coin_price+"",e.formItem.sale_price=t.data.sale_price+"",e.formItem.limited_count=t.data.limited_count+"",e.formItem.teacher_id=t.data.teacher.id,null!=t.data.school&&(e.formItem.school_id=t.data.school.id),1==t.data.hide_notice?e.formItem.show_notice=!1:e.formItem.show_notice=!0,t.data.preview_images.map(function(t){e.formItem.images.push({url:t.s.origin})}),t.data.content_images.map(function(t){e.formItem.contents.push({url:t.s.origin})}),e.defaultCourse=t.data.catalog,""!=t.data.admin_uids){var i=t.data.admin_uids.split(",");e.formItem.first_admin=i[0],i.hasOwnProperty(1)?e.formItem.second_admin=i[1]:e.formItem.second_admin="",i.hasOwnProperty(2)?e.formItem.third_admin=i[2]:e.formItem.third_admin=""}e.formItem.cover=[{url:t.data.cover.s.origin}]},function(t){})},loadAddFormData:function(){var t=this;this.$Util.api.get(m.findSchoolsAndTeachers,this).then(function(e){if(bus.$emit("on-loading"),!e.data)return t.$Message.warning("直播课不存在或数据有误"),!1;t.formItem.teachers=e.data.teachers,t.formItem.schools=e.data.schools,t.submitEnable=!1},function(t){})}},created:function(){var t=this;this.$nextTick(function(){if("edit"===t.usage||"relive"===t.usage){bus.$emit("on-loading");var e=t.id;if(t.formItem.id=e,!parseInt(t.formItem.id))return alert("直播课id格式有误"),!1;this.loadEditFormData(e)}else"add"===t.usage&&(bus.$emit("on-loading"),this.loadAddFormData())})}}},"ob+R":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("u8Sv"),s=i.n(o);e.default={name:"MLessonCourseEdit",props:{teachers:{type:Array,default:function(){return[]}},defaultCourse:{type:Array,default:function(){return[]}},lessonName:{type:String,default:""}},components:{MLessonPopup:s.a},watch:{defaultCourse:{handler:function(t){this.courseNum=t.length;var e=this;t.map(function(t,i){var o={};switch(o.title=t.title,o.type=t.type,t.type){case 0:o.name="图片",o.size=t.subtitle;break;case 1:o.name="视频",o.duration=t.subtitle;break;case 2:case 3:case 4:o.name="直播",o.teacher_uid=t.teacher_uid,o.second_teacher_uid=t.second_teacher_uid,o.room_id=t.room_id,o.notify_status=t.notify_status,o.create_status=t.create_status,o.quit_time=t.quit_time;break;default:o.name="无"}o.startTime=t.start_time?e.$Util.dateFormat(t.start_time,"yyyy-MM-dd hh:mm:ss"):"",o.endTime=t.end_time?e.$Util.dateFormat(t.end_time,"yyyy-MM-dd hh:mm:ss"):"",o.defaultCourse=t,o.defaultCourse.index=i,o.defaultCourse.num=i+1,e.courseInformationList[i]=o})},deep:!0}},data:function(){return{courseNum:0,teacherList:[],course:[],courseInformationList:[]}},methods:{onOk:function(t){var e={};switch(t.type){case 0:e.name="图片";break;case 1:e.name="视频";break;case 2:e.name="直播";break;default:e.name="无"}e.title=t.title,e.type=t.type,e.startTime=t.start_time?this.$Util.dateFormat(t.start_time,"yyyy-MM-dd hh:mm:ss"):"",e.endTime=t.end_time?this.$Util.dateFormat(t.end_time,"yyyy-MM-dd hh:mm:ss"):"",e.defaultCourse=t,"edit"==t.usage?(this.courseInformationList.splice(t.index,1),this.courseInformationList.splice(t.num-1,0,e)):this.courseInformationList.splice(t.num-1,0,e),this.courseNum=this.courseInformationList.length;var i=this.getCourseList();this.$emit("on-ok",i)},sendTeacherRoute:function(t){var e="/admin.php?m=Admin&c=SystemNotice&a=addSingle",i="老师好,您执教的课程"+this.lessonName+"-"+t.title+"将于"+t.startTime+"开始上课,请准时前往直播间授课,链接>>",o="meijiabang://live_lesson/rooms/"+t.room_id+"?is_host=1",s=e+"&uid="+t.teacher_uid+"&content="+i+"&app_route="+o;location.href="//"+window.location.host+s},sendSecondTeacherRoute:function(t){var e="/admin.php?m=Admin&c=SystemNotice&a=addSingle",i="请点击链接前往"+this.lessonName+"-"+t.title+"的直播间参加直播,谢谢哦～",o="meijiabang://live_lesson/rooms/"+t.room_id+"?is_host=1",s=e+"&uid="+t.second_teacher_uid+"&content="+i+"&app_route="+o;location.href="//"+window.location.host+s},removeCourse:function(t){this.courseInformationList.splice(t,1),this.courseNum--;var e=this.getCourseList();this.$emit("on-remove",e)},getCourseList:function(){this.courseInformationList.map(function(t,e){t.defaultCourse.num=e+1});var t=[];return this.courseInformationList.map(function(e,i){t[i]=e.defaultCourse}),t}}}},u8Sv:function(t,e,i){i("FYnx");var o=i("VU/8")(i("BLNm"),i("5gDg"),"data-v-11e7dad5",null);t.exports=o.exports}});