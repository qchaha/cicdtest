webpackJsonp([57],{"7dtI":function(e,t,i){i("toZW");var r=i("VU/8")(i("Mu9W"),i("gYUF"),null,null);e.exports=r.exports},Mu9W:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i("h45B"),a=i.n(r),s={create:{api:{path:"/boss/mall/information/information/create"}},update:{api:{path:"/boss/mall/information/information/update"}},find:{api:{path:"/boss/mall/information/information/find",params:{fields:"{id,title,app_route,desc,start_time,end_time,cover(w:80,h:80){url,origin},receivers{receive_type,uid,user_tag}}",id:0}},responseHandle:function(e,t){var i=new Date;i.setTime(1e3*e.data.start_time),e.data.start_time=i;var r=new Date;return r.setTime(1e3*e.data.end_time),e.data.end_time=r,e}},getUserTags:{api:{path:"/admin.php?m=Admin&c=User&a=getUserTags",params:{}}}};t.default={components:{MCard:a.a},name:"MInformationForm",props:{id:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{formItem:{id:"",title:"",cover:[],start_time:"",end_time:"",app_route:"",desc:""},receiverItem:{receive_type:1,uids:"",user_tag:[],user_tag_op:"UNION"},submitEnable:!1,textareaRows:5,sendTimeType:"sendNow",modal:!1,userTags:[],loadingUserTag:!1,ruleValidate:{title:[{required:!0,message:"标题不能为空",trigger:"blur"}],start_time:[{required:!0,type:"date",message:"发送时间不能为空",trigger:"blur"}],end_time:[{required:!0,type:"date",message:"结束时间不能为空",trigger:"blur"}],desc:[{required:!0,message:"说明不能为空",trigger:"blur"}]}}},methods:{reset:function(){"add"===this.usage||this.usage},back:function(){location.hash="/mall/information/information/list"},syncCoverImages:function(e){this.formItem.cover=e},getRoute:function(e){this.formItem.app_route=e},handleSubmit:function(e){var t=this;"sendNow"==this.sendTimeType&&(this.formItem.start_time=new Date),this.$refs[e].validate(function(e){if(e){if(!t.validateFormData())return;var i=t.getRequestParams();t.$Message.success("提交成功!"),t.submitRequest(i)}else t.$Message.error("表单验证失败!")})},handleReceiveTypeChanged:function(e){},handleSendTimeTypeChanged:function(e){this.formItem.start_time="sendNow"==e?new Date:null},getUserTagsForSelect:function(e){""!=e?(s.getUserTags.api.params.tag_name=e,s.getUserTags.api.params.tags="",this.loadingUserTag=!0,this.$Util.api.get(s.getUserTags,this).then(function(e){if(this.loadingUserTag=!1,!e.data)return this.$Message.warning("数据不存在或数据有误"),!1;e.data.length>100?this.$Message.warning("数据太多不能加载，请用更精确关键词搜索"):this.userTags=e.data},function(e){})):this.userTags=[]},getRequestParams:function(){return{id:this.formItem.id,title:this.formItem.title,cover:this.formItem.cover[0].url,start_time:Math.round(this.formItem.start_time.getTime()/1e3),end_time:Math.round(this.formItem.end_time.getTime()/1e3),app_route:this.formItem.app_route,desc:this.formItem.desc,receiver:{receive_type:this.receiverItem.receive_type,uids:this.receiverItem.uids,user_tag:this.receiverItem.user_tag_op+"|"+this.receiverItem.user_tag.join(",")}}},submitRequest:function(e){this.submitEnable=!0,bus.$emit("on-loading");var t={};t="edit"===this.usage?s.update:s.create;var i=this;this.$Util.api.post(t,e,i).then(function(){i.back()},function(){})},loadEditFormData:function(e){s.find.api.params.id=e;var t=this;bus.$emit("on-loading"),this.$Util.api.get(s.find,this).then(function(e){if(bus.$emit("on-loading"),!e.data)return t.$Message.warning("数据不存在或数据有误"),!1;t.assignEditData(e.data)},function(e){})},assignEditData:function(e){var t=this;t.sendTimeType="sendFixedTime",t.submitEnable=!1,t.formItem=e,t.formItem.cover=[{url:e.cover.origin}];var i=e.receivers,r=i[0].receive_type;if(t.receiverItem.receive_type=r,2==r)for(var a=i.length,o=0;o<a;o++)t.receiverItem.uids+=i[o].uid+(o<a-1?",":"");else if(3==r){var n=i[0].user_tag.split("|");t.receiverItem.user_tag_op=n[0],s.getUserTags.api.params.tags=n[1],this.loadingUserTag=!0,this.$Util.api.get(s.getUserTags,this).then(function(e){if(this.loadingUserTag=!1,!e.data)return this.$Message.warning("数据不存在或数据有误"),!1;this.userTags=e.data;var i=n[1].split(",");for(var r in i)t.receiverItem.user_tag.push(i[r])})}},validateFormData:function(){return"sendNow"==this.sendTimeType&&(this.formItem.start_time=new Date),this.formItem.start_time>=this.formItem.end_time?(this.$Notice.warning({title:"发送时间必须小于结束时间",desc:""}),!1):0===this.formItem.cover.length?(this.$Notice.warning({title:"封面图片不能为空",desc:""}),!1):""==this.formItem.app_route?(this.$Notice.warning({title:"跳转路由不能为空",desc:""}),!1):2==this.receiverItem.receive_type&&""==this.receiverItem.uids?(this.$Notice.warning({title:"指定UID不能为空",desc:""}),!1):2==this.receiverItem.receive_type&&this.receiverItem.uids.split(",").length>100?(this.$Notice.warning({title:"指定UID不能超过100",desc:""}),!1):3!=this.receiverItem.receive_type||""!=this.receiverItem.user_tag||(this.$Notice.warning({title:"用户标签不能为空",desc:""}),!1)}},created:function(){var e=this;this.$nextTick(function(){if("edit"===e.usage){var t=e.id;if(e.formItem.id=t,!parseInt(e.formItem.id))return alert("id格式有误"),!1;this.loadEditFormData(t)}else e.usage})}}},Vhqp:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("m-page",[i("m-information-form",{attrs:{usage:"add"},on:{loading:e.changeLoadingState}})],1)},staticRenderFns:[]}},You7:function(e,t,i){var r=i("VU/8")(i("u8Hn"),i("Vhqp"),null,null);e.exports=r.exports},btPO:function(e,t,i){t=e.exports=i(0)(),t.push([e.i,".demo-upload-list{display:inline-block;width:60px;height:60px;text-align:center;line-height:60px;border:1px solid transparent;border-radius:4px;overflow:hidden;background:#fff;position:relative;box-shadow:0 1px 1px rgba(0,0,0,.2);margin-right:4px}.demo-upload-list img{width:100%;height:100%}.demo-upload-list-cover{display:none;position:absolute;top:0;bottom:0;left:0;right:0;background:rgba(0,0,0,.6)}.demo-upload-list:hover .demo-upload-list-cover{display:block}.demo-upload-list-cover i{color:#fff;font-size:20px;cursor:pointer;margin:0 2px}",""])},gYUF:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{},[i("Form",{ref:"formItem",attrs:{model:e.formItem,"label-width":100,rules:e.ruleValidate}},[i("m-card",[i("h4",[e._v("基本信息")]),e._v(" "),""!=e.formItem.id?i("div",{staticStyle:{width:"100px","text-align":"right","padding-right":"12px"}},[e._v("ID:"+e._s(e.formItem.id))]):e._e(),e._v(" "),i("Form-item",{attrs:{label:"标题",prop:"title"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"建议不超过15个字"},model:{value:e.formItem.title,callback:function(t){e.$set(e.formItem,"title",t)},expression:"formItem.title"}})],1),e._v(" "),i("Form-item",{attrs:{label:"说明",prop:"desc"}},[i("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",rows:e.textareaRows,placeholder:"建议不超过60个字"},model:{value:e.formItem.desc,callback:function(t){e.$set(e.formItem,"desc",t)},expression:"formItem.desc"}})],1),e._v(" "),i("Form-item",{attrs:{label:"跳转路由",prop:"app_route"}},[i("m-app-route",{attrs:{placeholder:"输入路由","default-route":e.formItem.app_route},on:{"on-ok":e.getRoute}})],1),e._v(" "),i("Form-item",{attrs:{label:"图片"}},[i("m-upload-image",{attrs:{"default-images":e.formItem.cover},on:{"on-success":e.syncCoverImages}})],1)],1),e._v(" "),i("m-card",[i("h4",[e._v("时间设置")]),e._v(" "),i("Form-item",{attrs:{label:"发送时间",prop:"start_time"}},[i("Radio-group",{on:{"on-change":e.handleSendTimeTypeChanged},model:{value:e.sendTimeType,callback:function(t){e.sendTimeType=t},expression:"sendTimeType"}},[i("Radio",{attrs:{label:"sendNow"}},[e._v("\n                        立即发送\n                    ")]),e._v(" "),i("Radio",{attrs:{label:"sendFixedTime"}},[e._v("\n                        定时发送\n                    ")])],1),e._v(" "),"sendFixedTime"==e.sendTimeType?i("Row",[i("i-col",{staticStyle:{width:"300px"}},[i("Date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:"于选定时间发送"},model:{value:e.formItem.start_time,callback:function(t){e.$set(e.formItem,"start_time",t)},expression:"formItem.start_time"}})],1)],1):e._e()],1),e._v(" "),i("Form-item",{attrs:{label:"结束时间",prop:"end_time"}},[i("Row",[i("i-col",{staticStyle:{width:"300px"}},[i("Date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:"结束时间"},model:{value:e.formItem.end_time,callback:function(t){e.$set(e.formItem,"end_time",t)},expression:"formItem.end_time"}})],1)],1)],1)],1),e._v(" "),i("m-card",[i("h4",[e._v("接收人群")]),e._v(" "),i("Form-item",{attrs:{label:"接收人群"}},[i("Radio-group",{on:{"on-change":e.handleReceiveTypeChanged},model:{value:e.receiverItem.receive_type,callback:function(t){e.$set(e.receiverItem,"receive_type",t)},expression:"receiverItem.receive_type"}},[i("Radio",{attrs:{label:"1"}},[e._v("\n                        全量用户\n                    ")]),e._v(" "),i("Radio",{attrs:{label:"2"}},[e._v("\n                        指定UID(不超过100个)\n                    ")]),e._v(" "),i("Radio",{attrs:{label:"3"}},[e._v("\n                        标签用户\n                    ")])],1),e._v(" "),2==e.receiverItem.receive_type?i("Row",[i("i-col",{staticStyle:{width:"300px"}},[i("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",rows:e.textareaRows,placeholder:"不超过100个，英文逗号隔开"},model:{value:e.receiverItem.uids,callback:function(t){e.$set(e.receiverItem,"uids",t)},expression:"receiverItem.uids"}})],1)],1):e._e(),e._v(" "),i("Row",{directives:[{name:"show",rawName:"v-show",value:3==e.receiverItem.receive_type,expression:"receiverItem.receive_type==3"}]},[i("Select",{staticStyle:{width:"80px"},model:{value:e.receiverItem.user_tag_op,callback:function(t){e.$set(e.receiverItem,"user_tag_op",t)},expression:"receiverItem.user_tag_op"}},[i("Option",{attrs:{value:"UNION"}},[e._v("并集")]),e._v(" "),i("Option",{attrs:{value:"INTERSECTION"}},[e._v("交集")]),e._v(" "),i("Option",{attrs:{value:"EXCEPT"}},[e._v("差集")]),e._v(" "),i("Option",{attrs:{value:"NOT"}},[e._v("非")])],1),e._v(" "),i("Select",{staticStyle:{width:"300px"},attrs:{multiple:"",filterable:"",remote:"","remote-method":e.getUserTagsForSelect,loading:e.loadingUserTag},model:{value:e.receiverItem.user_tag,callback:function(t){e.$set(e.receiverItem,"user_tag",t)},expression:"receiverItem.user_tag"}},e._l(e.userTags,function(t){return i("Option",{key:t,attrs:{value:t.tag}},[e._v(e._s(t.name))])}))],1)],1)],1),e._v(" "),i("Form-item",[i("i-button",{attrs:{type:"primary",disabled:e.submitEnable},on:{click:function(t){e.handleSubmit("formItem")}}},[e._v("提交")]),e._v(" "),i("i-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:e.back}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]}},toZW:function(e,t,i){var r=i("btPO");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);i("rjj0")("22ca6f2a",r,!0)},u8Hn:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i("7dtI"),a=i.n(r),s=i("Edfu"),o=i.n(s);t.default={name:"app",components:{MPage:o.a,MInformationForm:a.a},data:function(){return{loadingState:!1}},methods:{changeLoadingState:function(){this.loadingState=!this.loadingState}}}}});