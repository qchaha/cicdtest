webpackJsonp([131],{AqxN:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("m-page-edit",[a("m-category-list-form",{attrs:{usage:"add"}})],1)},staticRenderFns:[]}},HYQ3:function(t,e,a){var i=a("VU/8")(a("anbo"),a("bBn3"),null,null);t.exports=i.exports},RaWW:function(t,e,a){var i=a("VU/8")(a("fjSP"),a("AqxN"),null,null);t.exports=i.exports},anbo:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={create:{api:{path:"/boss/mall/advertising/category-list/create",params:{id:0}}},update:{api:{path:"/boss/mall/advertising/category-list/update",params:{id:0}}},listPageInfoApi:{path:"/boss/mall/advertising/category-list/list-page-info",params:{}},resource:{api:{path:"/boss/mall/advertising/home/tag-group-info"}},find:{api:{path:"/boss/mall/advertising/category-list/find",params:{id:0,fields:"{id,name,audience,start_time,end_time,state}"}},responseHandle:function(t,e){switch(0!==t.data.start_time&&(t.data.start_time=1e3*t.data.start_time),0!==t.data.end_time&&(t.data.end_time=1e3*t.data.end_time),t.data.state){case 0:t.data.status="已作废";break;case 1:t.data.status="已发布";break;case 2:t.data.status="已下线";break;case 3:t.data.status="待发布"}return""===t.data.audience_name&&(t.data.audience_name="no_tag"),t}}};e.default={name:"MCategoryListForm",props:{id:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{searchTypeSource:{},formItem:{id:"",status:"",name:"",audience:"",start_time:"",end_time:""},ruleValidate:{name:[{required:!0,message:"页面名称不能为空",trigger:"blur"}],audience:[{required:!0,message:"展示人群不能为空",trigger:"blur"}]}}},methods:{back:function(){location.hash="/mall/advertising/category-list/list"},submit:function(t){if(this.validateFormData()){var e=this.getRequestParams(),a=i.create;"edit"===this.usage&&(a=i.update),this.submitRequest(e,a,t)}},validateFormData:function(){var t=this;return this.$refs.myForm.validate(function(e){if(!e)return t.$Message.error("表单验证失败!"),!1}),""===this.formItem.start_time?(this.$Message.error("开始时间不能为空!"),!1):""===this.formItem.end_time?(this.$Message.error("结束时间不能为空!"),!1):!(new Date(this.formItem.start_time).getTime()>=new Date(this.formItem.end_time).getTime())||(this.$Message.error("开始时间不能比结束时间大!"),!1)},getRequestParams:function(){var t={};return"edit"===this.usage&&(t.id=this.id),t.module="mall",t.page="category",t.position="list",t.name=this.formItem.name,t.audience="no_tag"===this.formItem.audience?"":this.formItem.audience,t.start_time=new Date(this.formItem.start_time).getTime()/1e3,t.end_time=new Date(this.formItem.end_time).getTime()/1e3,t},submitRequest:function(t,e,a){bus.$emit("on-loading");var i=this;this.$Util.api.post(e,t,i).then(function(t){0===t.error_code?(i.$Notice.success({title:"请求成功",desc:""}),location.hash="information"===a?"/mall/advertising/category-list/category-information/list/"+t.data:"/mall/advertising/category-list/list"):(bus.$emit("on-loading"),i.alertErrorTips(t.message?t.message:"提交失败",300))},function(t){bus.$emit("on-loading"),i.$Notice.warning({title:"请求失败",desc:""})})},loadEditFormData:function(){i.find.api.params.id=this.id;var t=this;bus.$emit("on-loading"),this.$Util.api.get(i.find,this).then(function(e){if(bus.$emit("on-loading"),!e.data)return t.$Message.warning("数据不存在"),!1;t.formItem=e.data},function(t){})},loadResource:function(){var t=this;this.$Util.api.get(i.resource,t).then(function(e){e.data.unshift({audience:"no_tag",title:"不限"}),t.searchTypeSource=e.data},function(e){t.$Message.warning("加载资源失败")})}},created:function(){"add"==this.usage&&(i.create.api.params.promotion_id=this.id),"edit"===this.usage&&(this.formItem.id=this.id,i.find.api.params.id=this.id),this.$nextTick(function(){this.loadResource(),"edit"===this.usage&&this.loadEditFormData()})}}},bBn3:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Form",{ref:"myForm",attrs:{model:t.formItem,"label-width":120,rules:t.ruleValidate}},[a("h3",[t._v("分类列表编辑")]),t._v(" "),""!=t.formItem.id?a("div",{staticStyle:{width:"100px","text-align":"left","padding-left":"50px"}},[t._v("ID:"+t._s(t.formItem.id))]):t._e(),t._v(" "),""!=t.formItem.status?a("div",{staticStyle:{width:"200px","text-align":"left","padding-left":"50px"}},[t._v("\n        页面状态:"+t._s(t.formItem.status)+"\n    ")]):t._e(),t._v(" "),a("Form-item",{attrs:{label:"页面名称",prop:"name"}},[a("Input",{staticStyle:{width:"200px"},attrs:{placeholder:""},model:{value:t.formItem.name,callback:function(e){t.$set(t.formItem,"name",e)},expression:"formItem.name"}})],1),t._v(" "),a("Form-item",{attrs:{label:"展示对象",prop:"audience"}},[a("i-select",{staticStyle:{width:"150px"},model:{value:t.formItem.audience,callback:function(e){t.$set(t.formItem,"audience",e)},expression:"formItem.audience"}},t._l(t.searchTypeSource,function(e){return a("i-option",{attrs:{value:e.audience}},[t._v(t._s(e.title))])}))],1),t._v(" "),a("Form-item",{attrs:{label:"开始时间",prop:"start_time"}},[a("Date-picker",{staticClass:"fixed-width-input",staticStyle:{width:"200px"},attrs:{type:"datetime",placeholder:"选择开始时间"},model:{value:t.formItem.start_time,callback:function(e){t.$set(t.formItem,"start_time",e)},expression:"formItem.start_time"}})],1),t._v(" "),a("Form-item",{attrs:{label:"结束时间",prop:"end_time"}},[a("Date-picker",{staticClass:"fixed-width-input",staticStyle:{width:"200px"},attrs:{type:"datetime",placeholder:"选择结束时间"},model:{value:t.formItem.end_time,callback:function(e){t.$set(t.formItem,"end_time",e)},expression:"formItem.end_time"}})],1),t._v(" "),a("Form-item",[a("i-button",{attrs:{type:"primary"},on:{click:function(e){t.submit("list")}}},[t._v("提交")]),t._v(" "),a("i-button",{attrs:{type:"primary"},on:{click:function(e){t.submit("information")}}},[t._v("提交并创建一级分类")]),t._v(" "),a("i-button",{attrs:{type:"primary"},on:{click:t.back}},[t._v("返回")])],1)],1)},staticRenderFns:[]}},fjSP:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("HYQ3"),s=a.n(i);e.default={name:"app",components:{MCategoryListForm:s.a},data:function(){return{}}}}});