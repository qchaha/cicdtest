webpackJsonp([130],{"+gju":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page-edit",[i("m-category-information-level1-form",{attrs:{usage:"add",id:t.id}})],1)},staticRenderFns:[]}},"5n9F":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page",[i("Form",{ref:"myForm",attrs:{model:t.formItem,"label-width":120}},[i("Card",[i("span",{staticStyle:{"margin-right":"20px"}},[t._v("\n            页面名称："+t._s(t.listItem.name)+"\n        ")]),t._v(" "),i("span",{staticStyle:{"margin-right":"20px"}},[t._v("\n            展示对象："+t._s(t.listItem.audience_name)+"\n        ")]),t._v(" "),i("span",[t._v("\n            展示时段："+t._s(t.listItem.start_time)+" ~ "+t._s(t.listItem.end_time)+"\n        ")])]),t._v(" "),i("Card",[i("table",{staticClass:"ivu-table",staticStyle:{width:"1000px","margin-left":"50px"},attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[i("tr",[i("th",[i("div",{staticClass:"ivu-table-cell"},[t._v("一级分类名称")])]),t._v(" "),i("th",[i("div",{staticClass:"ivu-table-cell"},[t._v("一级分类排序")])]),t._v(" "),i("th",[i("div",{staticClass:"ivu-table-cell"},[t._v("操作")])])]),t._v(" "),t._l(t.formItem.categories,function(e,r){return i("tr",[i("td",[i("div",{staticClass:"ivu-table-cell"},[i("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"最多4个中文（8字符)"},on:{"on-blur":function(e){t.checkName(r)}},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"categoryItem.name"}})],1)]),t._v(" "),i("td",[i("div",{staticClass:"ivu-table-cell"},[i("Input",{staticStyle:{width:"100px"},attrs:{placeholder:""},on:{"on-blur":function(e){t.checkSort(r)}},model:{value:e.sort,callback:function(i){t.$set(e,"sort",i)},expression:"categoryItem.sort"}})],1)]),t._v(" "),i("td",[i("Button",{attrs:{type:"error",size:"small"},on:{click:function(e){t.removeCategory(r)}}},[t._v("删除")])],1)])})],2),t._v(" "),i("div",{staticStyle:{margin:"10px auto 10px 50px"}},[i("Button",{attrs:{type:"primary",icon:"ios-plus",size:"small"},on:{click:function(e){t.addCategory()}}},[t._v("添加分类\n\n\n                ")])],1)]),t._v(" "),i("Form-item",[i("i-button",{attrs:{type:"primary"},on:{click:function(e){t.submit("list")}}},[t._v("提交")]),t._v(" "),i("i-button",{attrs:{type:"primary"},on:{click:function(e){t.submit("addCategoryOfLevel2")}}},[t._v("提交并创建二级分类")]),t._v(" "),i("i-button",{attrs:{type:"primary"},on:{click:t.back}},[t._v("返回")])],1)],1)],1)},staticRenderFns:[]}},G1xQ:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i("loKL"),a=i.n(r);e.default={name:"app",components:{MCategoryInformationLevel1Form:a.a},data:function(){return{id:this.$route.params.advertising_id}}}},gjoC:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={create:{api:{path:"/boss/mall/advertising/category-information/1/create"}},update:{api:{path:"/boss/mall/advertising/category-information/1/update"}},find:{api:{path:"/boss/mall/advertising/category-list/find",params:{id:0,fields:"{id,name,audience_name,start_time,end_time}"}},responseHandle:function(t,e){return""===t.data.audience_name&&(t.data.audience_name="不限"),t.data.start_time=e.$Util.dateFormat(t.data.start_time,"yyyy-MM-dd hh:mm:ss"),t.data.end_time=e.$Util.dateFormat(t.data.end_time,"yyyy-MM-dd hh:mm:ss"),t}},findInformation:{api:{path:"/boss/mall/advertising/category-information/find",params:{advertising_id:0,parent_id:0,level:1,fields:"{id,name,ordering}"}},responseHandle:function(t,e){return""===t.data.audience_name&&(t.data.audience_name="不限"),t.data.start_time=e.$Util.dateFormat(t.data.start_time,"yyyy-MM-dd hh:mm:ss"),t.data.end_time=e.$Util.dateFormat(t.data.end_time,"yyyy-MM-dd hh:mm:ss"),t}}};e.default={name:"MCategoryInformationLevel1Form",props:{id:{type:String,default:""},parent_id:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{searchTypeSource:{},listItem:{name:"",audience_name:"",start_time:"",end_time:""},formItem:{categories:[{id:"",name:"",sort:"",ordering:""}]},removeId:[]}},methods:{back:function(){location.hash="/mall/advertising/category-list/category-information/list/"+this.id},submit:function(t){if(this.validateFormData()){var e=this.getRequestParams(),i=r.create;"edit"===this.usage&&(i=r.update),this.submitRequest(e,i,t)}},validateFormData:function(){for(var t=0;t<this.formItem.categories.length;t++){if(""===this.formItem.categories[t].name)return this.$Message.error("分类名称不能为空!"),!1;if(""===this.formItem.categories[t].sort)return this.$Message.error("排序不能为空!"),!1;if(this.formItem.categories[t].name.replace(/[\u0391-\uFFE5]/g,"aa").length>8)return this.$Message.error("分类名称不能长于8个字符!"),!1}return!0},getRequestParams:function(){var t={};return t.id=this.id,t.parent_id=this.parent_id,t.categories=this.formItem.categories,t.remove_ids=this.removeId,t},submitRequest:function(t,e,i){bus.$emit("on-loading");var r=this;this.$Util.api.post(e,t,r).then(function(t){0===t.error_code?(r.$Notice.success({title:"请求成功",desc:""}),"addCategoryOfLevel2"===i?r.formItem.categories.length>1?location.hash="/mall/advertising/category-list/category-information/add/2/"+this.id+"/0":1==r.formItem.categories.length&&(location.hash="/mall/advertising/category-list/category-information/add/2/"+this.id+"/"+t.data):location.hash="/mall/advertising/category-list/category-information/list/"+this.id):(bus.$emit("on-loading"),r.alertErrorTips(t.message?t.message:"提交失败",300))},function(t){bus.$emit("on-loading"),r.$Notice.warning({title:"请求失败",desc:""})})},addCategory:function(){var t={id:"",name:"",sort:""};this.formItem.categories.push(t)},removeCategory:function(t){this.formItem.categories.length>1&&(""!==this.formItem.categories[t].id&&this.removeId.push(this.formItem.categories[t].id),this.formItem.categories.splice(t,1))},checkName:function(t){for(var e=0;e<this.formItem.categories.length;e++)if(t!==e&&this.formItem.categories[e].name===this.formItem.categories[t].name)return this.$Message.error("名称不能重复!"),this.formItem.categories[t].name="",!1},checkSort:function(t){if(!/^\d+$/.test(this.formItem.categories[t].sort)&&""!==this.formItem.categories[t].sort)return this.$Message.error("排序需要为正整数!"),this.formItem.categories[t].sort="",this.formItem.categories[t].ordering="",!1;if(this.formItem.categories[t].sort<=0)return this.$Message.error("排序需要为正整数!"),this.formItem.categories[t].sort="",this.formItem.categories[t].ordering="",!1;for(var e=0;e<this.formItem.categories.length;e++)t!==e&&this.formItem.categories[e].sort==this.formItem.categories[t].sort&&(""==this.formItem.categories[t].ordering?this.resetSort(this.formItem.categories[t].sort,0,t):this.resetSort(this.formItem.categories[t].sort,this.formItem.categories[t].ordering,t),this.formItem.categories[t].ordering=this.formItem.categories[t].sort)},resetSort:function(t,e,i,r){var a={};if(0===e)for(var s=0;s<this.formItem.categories.length;s++)i!==s&&this.formItem.categories[s].sort>=t&&(a=this.formItem.categories[s],a.sort=parseInt(this.formItem.categories[s].sort)+1,a.ordering=parseInt(this.formItem.categories[s].ordering)+1,this.formItem.categories.splice(s,1,a));else if(t>e)for(var s=0;s<this.formItem.categories.length;s++)i!==s&&e<this.formItem.categories[s].sort&&this.formItem.categories[s].sort<=t&&(a=this.formItem.categories[s],a.sort=parseInt(this.formItem.categories[s].sort)-1,a.ordering=parseInt(this.formItem.categories[s].sort)-1,this.formItem.categories.splice(s,1,a));else for(var s=0;s<this.formItem.categories.length;s++)i!==s&&t<=this.formItem.categories[s].sort&&this.formItem.categories[s].sort<e&&(a=this.formItem.categories[s],a.sort=parseInt(this.formItem.categories[s].sort)+1,a.ordering=parseInt(this.formItem.categories[s].ordering)+1,this.formItem.categories.splice(s,1,a))},resetCategories:function(){this.formItem.categories.sort(function(t,e){return""==t.sort?1:""==e.sort?-1:parseInt(t.sort)-parseInt(e.sort)})},loadEditFormData:function(){r.findInformation.api.params.advertising_id=this.id,r.findInformation.api.params.parent_id=this.parent_id;var t=this;bus.$emit("on-loading"),this.$Util.api.get(r.findInformation,this).then(function(e){if(bus.$emit("on-loading"),!e.data)return t.$Message.warning("数据不存在"),!1;t.formItem.categories=e.data;for(var i=0;i<t.formItem.categories.length;i++)t.formItem.categories[i].sort=t.formItem.categories[i].ordering;setTimeout(function(){t.resetCategories()},1e3)},function(t){})},loadResource:function(){r.find.api.params.id=this.id;var t=this;this.$Util.api.get(r.find,this).then(function(e){if(!e.data)return t.$Message.warning("数据不存在"),!1;t.listItem=e.data},function(t){})}},created:function(){this.$nextTick(function(){this.loadResource(),"edit"===this.usage&&this.loadEditFormData()})}}},loKL:function(t,e,i){var r=i("VU/8")(i("gjoC"),i("5n9F"),null,null);t.exports=r.exports},y6qu:function(t,e,i){var r=i("VU/8")(i("G1xQ"),i("+gju"),null,null);t.exports=r.exports}});