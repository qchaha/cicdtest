webpackJsonp([127],{"60Qc":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={create:{api:{path:"/boss/mall/advertising/category-information/2/create"}},update:{api:{path:"/boss/mall/advertising/category-information/2/update"}},find:{api:{path:"/boss/mall/advertising/category-list/find",params:{id:0,fields:"{id,name,audience_name,start_time,end_time}"}},responseHandle:function(t,e){return""===t.data.audience_name&&(t.data.audience_name="不限"),t.data.start_time=e.$Util.dateFormat(t.data.start_time,"yyyy-MM-dd hh:mm:ss"),t.data.end_time=e.$Util.dateFormat(t.data.end_time,"yyyy-MM-dd hh:mm:ss"),t}},findInformation:{api:{path:"/boss/mall/advertising/category-information/find",params:{id:0,advertising_id:0,parent_id:0,level:2,fields:"{id,name,parent_id,ordering}"}},responseHandle:function(t,e){return""===t.data.audience_name&&(t.data.audience_name="不限"),t.data.start_time=e.$Util.dateFormat(t.data.start_time,"yyyy-MM-dd hh:mm:ss"),t.data.end_time=e.$Util.dateFormat(t.data.end_time,"yyyy-MM-dd hh:mm:ss"),t}}};e.default={name:"MCategoryInformationLevel1Form",props:{id:{type:String,default:""},parent_id:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{searchTypeSource:{},listItem:{name:"",audience_name:"",start_time:"",end_time:""},formItem:{categories:[{id:"",name:"",sort:"",ordering:"",parent_id:parseInt(this.parent_id)}]},removeId:[],informationItem:{id:"",name:"",sort:""},categoriesOfLevel1:[{id:"",name:"",sort:""}]}},methods:{back:function(){location.hash="/mall/advertising/category-list/category-information/list/"+this.id},submit:function(t){if(this.validateFormData()){var e=this.getRequestParams(),i=r.create;"edit"===this.usage&&(i=r.update),this.submitRequest(e,i,t)}},validateFormData:function(){for(var t=0;t<this.formItem.categories.length;t++){if(""===this.formItem.categories[t].name)return this.$Message.error("分类名称不能为空!"),!1;if(""===this.formItem.categories[t].sort)return this.$Message.error("排序不能为空!"),!1;if(this.formItem.categories[t].name.replace(/[\u0391-\uFFE5]/g,"aa").length>20)return this.$Message.error("分类名称不能长于20个字符!"),!1}return!0},getRequestParams:function(){var t={};return t.id=this.id,t.parent_id=0,t.categories=this.formItem.categories,t.remove_ids=this.removeId,t},submitRequest:function(t,e,i){bus.$emit("on-loading");var r=this;this.$Util.api.post(e,t,r).then(function(t){0===t.error_code?(r.$Notice.success({title:"请求成功",desc:""}),"addCategoryOfLevel3"===i?r.formItem.categories.length>1?location.hash="/mall/advertising/category-list/category-information/add/3/"+this.id+"/0":1==r.formItem.categories.length&&(location.hash="/mall/advertising/category-list/category-information/add/3/"+this.id+"/"+t.data):location.hash="/mall/advertising/category-list/category-information/list/"+this.id):(bus.$emit("on-loading"),r.alertErrorTips(t.message?t.message:"提交失败",300))},function(t){bus.$emit("on-loading"),r.$Notice.warning({title:"请求失败",desc:""})})},addCategory:function(){var t={id:"",name:"",sort:"",parent_id:parseInt(this.parent_id)};this.formItem.categories.push(t)},removeCategory:function(t){this.formItem.categories.length>1&&(""!==this.formItem.categories[t].id&&this.removeId.push(this.formItem.categories[t].id),this.formItem.categories.splice(t,1))},checkName:function(t){for(var e=0;e<this.formItem.categories.length;e++)if(t!==e&&this.formItem.categories[e].name===this.formItem.categories[t].name)return this.$Message.error("名称不能重复!"),this.formItem.categories[t].name="",!1},checkSort:function(t,e){if(!/^\d+$/.test(this.formItem.categories[t].sort)&&""!==this.formItem.categories[t].sort)return this.$Message.error("排序需要为正整数!"),this.formItem.categories[t].sort="",this.formItem.categories[t].ordering="",!1;if(this.formItem.categories[t].sort<=0)return this.$Message.error("排序需要为正整数!"),this.formItem.categories[t].sort="",this.formItem.categories[t].ordering="",!1;for(var i=0;i<this.formItem.categories.length;i++)t!==i&&this.formItem.categories[i].sort==this.formItem.categories[t].sort&&this.formItem.categories[i].parent_id==this.formItem.categories[t].parent_id&&(""==this.formItem.categories[t].ordering?this.resetSort(this.formItem.categories[t].sort,0,t,this.formItem.categories[t].parent_id):this.resetSort(this.formItem.categories[t].sort,this.formItem.categories[t].ordering,t,this.formItem.categories[t].parent_id),this.formItem.categories[t].ordering=this.formItem.categories[t].sort)},resetSort:function(t,e,i,r){var a={};if(0===e)for(var s=0;s<this.formItem.categories.length;s++)i!==s&&this.formItem.categories[s].sort>=t&&this.formItem.categories[s].parent_id==r&&(a=this.formItem.categories[s],a.sort=parseInt(this.formItem.categories[s].sort)+1,a.ordering=parseInt(this.formItem.categories[s].ordering)+1,this.formItem.categories.splice(s,1,a));else if(t>e)for(var s=0;s<this.formItem.categories.length;s++)i!==s&&e<this.formItem.categories[s].sort&&this.formItem.categories[s].sort<=t&&this.formItem.categories[s].parent_id==r&&(a=this.formItem.categories[s],a.sort=parseInt(this.formItem.categories[s].sort)-1,a.ordering=parseInt(this.formItem.categories[s].sort)-1,this.formItem.categories.splice(s,1,a));else for(var s=0;s<this.formItem.categories.length;s++)i!==s&&t<=this.formItem.categories[s].sort&&this.formItem.categories[s].sort<e&&this.formItem.categories[s].parent_id==r&&(a=this.formItem.categories[s],a.sort=parseInt(this.formItem.categories[s].sort)+1,a.ordering=parseInt(this.formItem.categories[s].ordering)+1,this.formItem.categories.splice(s,1,a))},resetCategories:function(){this.formItem.categories.sort(function(t,e){return""==t.sort?1:""==e.sort?-1:t.parent_id>e.parent_id?1:t.parent_id<e.parent_id?-1:parseInt(t.sort)-parseInt(e.sort)})},loadEditFormData:function(){r.findInformation.api.params.advertising_id=this.id,r.findInformation.api.params.parent_id=this.parent_id,r.findInformation.api.params.id="",r.findInformation.api.params.level=2;var t=this;bus.$emit("on-loading"),this.$Util.api.get(r.findInformation,this).then(function(e){if(bus.$emit("on-loading"),!e.data)return t.$Message.warning("数据不存在"),!1;if(0===e.error_code){t.formItem.categories=e.data;for(var i=0;i<t.formItem.categories.length;i++)t.formItem.categories[i].sort=t.formItem.categories[i].ordering,t.formItem.categories[i].parent_id=parseInt(t.formItem.categories[i].parent_id);setTimeout(function(){t.resetCategories()},1e3)}},function(t){})},loadResource:function(){r.find.api.params.id=this.id;var t=this;this.$Util.api.get(r.find,this).then(function(e){if(!e.data)return t.$Message.warning("数据不存在"),!1;t.listItem=e.data},function(t){})},loadInformation:function(){r.findInformation.api.params.id=this.parent_id,r.findInformation.api.params.advertising_id="",r.findInformation.api.params.parent_id="",r.findInformation.api.params.level=1;var t=this;this.$Util.api.get(r.findInformation,this).then(function(e){if(!e.data)return t.$Message.warning("数据不存在"),!1;t.informationItem=e.data[0]},function(t){})},loadCategoriesOfLevel1:function(){r.findInformation.api.params.advertising_id=this.id,r.findInformation.api.params.parent_id="",r.findInformation.api.params.id="",r.findInformation.api.params.level=1;var t=this;this.$Util.api.get(r.findInformation,this).then(function(e){if(!e.data)return t.$Message.warning("数据不存在"),!1;t.categoriesOfLevel1=e.data;for(var i=0;i<t.categoriesOfLevel1.length;i++)t.categoriesOfLevel1[i].id=parseInt(t.categoriesOfLevel1[i].id);t.categoriesOfLevel1.push({id:0,name:"请选择"})},function(t){})}},created:function(){this.$nextTick(function(){this.loadResource(),this.loadCategoriesOfLevel1(),0!=this.parent_id&&this.loadInformation(),"edit"===this.usage&&this.loadEditFormData()})}}},Mx60:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page",[i("Form",{ref:"myForm",attrs:{model:t.formItem,"label-width":120}},[i("Card",[i("div",[i("span",{staticStyle:{"margin-right":"20px"}},[t._v("\n                    页面名称："+t._s(t.listItem.name)+"\n                ")]),t._v(" "),i("span",{staticStyle:{"margin-right":"20px"}},[t._v("\n                    展示对象："+t._s(t.listItem.audience_name)+"\n                ")]),t._v(" "),i("span",[t._v("\n                    展示时段："+t._s(t.listItem.start_time)+" ~ "+t._s(t.listItem.end_time)+"\n                ")])]),t._v(" "),i("div",[i("span",[t._v("\n                    一级分类："+t._s(t.informationItem.name)+"\n                ")]),t._v(" "),i("span",[t._v("\n                    一级分类排序："+t._s(t.informationItem.ordering)+"\n                ")])])]),t._v(" "),i("Card",[i("table",{staticClass:"ivu-table",staticStyle:{width:"1000px","margin-left":"50px"},attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[i("tr",[i("th",[i("div",{staticClass:"ivu-table-cell"},[t._v("二级分类名称")])]),t._v(" "),i("th",[i("div",{staticClass:"ivu-table-cell"},[t._v("二级分类排序")])]),t._v(" "),i("th",[i("div",{staticClass:"ivu-table-cell"},[t._v("所属一级分类")])]),t._v(" "),i("th",[i("div",{staticClass:"ivu-table-cell"},[t._v("操作")])])]),t._v(" "),t._l(t.formItem.categories,function(e,r){return i("tr",[i("td",[i("div",{staticClass:"ivu-table-cell"},[i("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"最多10个中文（20字符)"},on:{"on-blur":function(e){t.checkName(r)}},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"categoryItem.name"}})],1)]),t._v(" "),i("td",[i("div",{staticClass:"ivu-table-cell"},[i("Input",{staticStyle:{width:"100px"},attrs:{placeholder:"",disabled:0==e.parent_id},on:{"on-blur":function(e){t.checkSort(r,!0)}},model:{value:e.sort,callback:function(i){t.$set(e,"sort",i)},expression:"categoryItem.sort"}}),t._v(" "),0==e.parent_id?i("div",[t._v("请先选择分组")]):t._e()],1)]),t._v(" "),i("td",[i("div",{staticClass:"ivu-table-cell"},[i("i-select",{staticStyle:{width:"260px"},attrs:{filterable:"",disabled:0!=t.parent_id},on:{"on-change":function(e){t.checkSort(r,!1)}},model:{value:e.parent_id,callback:function(i){t.$set(e,"parent_id",i)},expression:"categoryItem.parent_id"}},t._l(t.categoriesOfLevel1,function(e){return i("i-option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name)+"\n\n                                ")])}))],1)]),t._v(" "),i("td",[i("Button",{attrs:{type:"error",size:"small"},on:{click:function(e){t.removeCategory(r)}}},[t._v("删除")])],1)])})],2),t._v(" "),i("div",{staticStyle:{margin:"10px auto 10px 50px"}},[i("Button",{attrs:{type:"primary",icon:"ios-plus",size:"small"},on:{click:function(e){t.addCategory()}}},[t._v("添加分类\n\n                ")])],1)]),t._v(" "),i("Form-item",[i("i-button",{attrs:{type:"primary"},on:{click:function(e){t.submit("list")}}},[t._v("提交")]),t._v(" "),i("i-button",{attrs:{type:"primary"},on:{click:function(e){t.submit("addCategoryOfLevel3")}}},[t._v("\n                提交并创建三级分类\n\n            ")]),t._v(" "),i("i-button",{attrs:{type:"primary"},on:{click:t.back}},[t._v("返回")])],1)],1)],1)},staticRenderFns:[]}},OfN7:function(t,e,i){var r=i("VU/8")(i("60Qc"),i("Mx60"),null,null);t.exports=r.exports},PnLZ:function(t,e,i){var r=i("VU/8")(i("fp7c"),i("Vu55"),null,null);t.exports=r.exports},Vu55:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page-edit",[i("m-category-information-level2-form",{attrs:{usage:"edit",id:t.id,parent_id:t.parent_id}})],1)},staticRenderFns:[]}},fp7c:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i("OfN7"),a=i.n(r);e.default={name:"app",components:{MCategoryInformationLevel2Form:a.a},data:function(){return{id:this.$route.params.advertising_id,parent_id:this.$route.params.parent_id}}}}});