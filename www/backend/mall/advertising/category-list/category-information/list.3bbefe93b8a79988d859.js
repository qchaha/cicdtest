webpackJsonp([228],{Lahe:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("aG4E"),o=a.n(i),n={resource:{api:{path:"/boss/mall/advertising/home/tag-group-info"}},find:{api:{path:"/boss/mall/advertising/category-list/find",params:{id:0,fields:"{id,name,audience_name,start_time,end_time}"}},responseHandle:function(e,t){return""===e.data.audience_name&&(e.data.audience_name="不限"),e.data.start_time=t.$Util.dateFormat(e.data.start_time,"yyyy-MM-dd hh:mm:ss"),e.data.end_time=t.$Util.dateFormat(e.data.end_time,"yyyy-MM-dd hh:mm:ss"),e}}};t.default={components:{MActionBar:o.a},name:"MCategoryList",data:function(){return{addModal:!1,editModal:!1,createModal:!1,copyModal:!1,deleteModal:!1,editLevel1:!1,editLevel2:!1,editLevel3:!1,createLevel2:!1,createLevel3:!1,copyLevel1:!1,copyLevel2:!1,copyLevel3:!1,deleteLevel1:!1,deleteLevel2:!1,deleteLevel3:!1,editParentIdOfLevel1:0,editParentIdOfLevel2:0,copyIdOfLevel1:0,copyIdOfLevel2:0,copyIdOfLevel3:0,deleteIdOfLevel1:0,deleteIdOfLevel2:0,deleteIdOfLevel3:0,searchTypeSource:{},addRoute:"/mall/advertising/category-list/add",listApi:{path:"/boss/mall/advertising/category-information/find-list",params:{fields:"{id1,name1,ordering1,id2,name2,ordering2,id3,name3,ordering3,image{origin,url}}",advertising_id:this.$route.params.id,state:[1]}},listPageInfoApi:{path:"/boss/mall/advertising/category-information/list-page-info",params:{advertising_id:this.$route.params.id,state:[1]}},listItem:{name:"",audience_name:"",start_time:"",end_time:""},searchCondition:{categoryOfLevel1:"",categoryOfLevel2:"",categoryOfLevel3:"",state:[1]},columns:[{title:"id",key:"id1,id2,id3",align:"center",sortable:!0,render:function(e,t){return null!==t.row.id3?e("span",t.row.id3):null!==t.row.id2?e("span",t.row.id2):e("span",t.row.id1)}},{title:"一级分类",key:"name1",align:"center"},{title:"一级分类排序",key:"ordering1",sortable:!0,align:"center"},{title:"二级分类",key:"name2",align:"center"},{title:"二级分类排序",key:"ordering2",sortable:!0,align:"center"},{title:"三级分类",key:"name3",align:"center"},{title:"三级分类排序",key:"ordering3",sortable:!0,align:"center"},{title:"三级分类图片",key:"image",align:"center",render:function(e,t){return e("img",{style:{width:"50px",padding:"10px 0 10px 0"},attrs:{src:t.row.image.url}})}},{title:"状态",key:"status",align:"center",render:function(e,t){return t.row.name3&&t.row.name2?e("span","正常"):e("span","数据异常")}},{title:"操作",key:"action",width:"200px",align:"center",render:function(e,t){var a=[];return[{name:"编辑",handle:function(){bus.$emit("show-edit-modal",t.row)}},{name:"新建",handle:function(){bus.$emit("show-create-modal",t.row)}},{name:"复制",handle:function(){bus.$emit("show-copy-modal",t.row)}},{name:"删除",handle:function(){bus.$emit("show-delete-modal",t.row)}}].map(function(t){"删除"===t.name?a.push(e("i-button",{props:{type:"text",size:"small"},on:{click:function(){t.handle()}}},[e("span",{style:{color:"#FF0000"}},t.name)])):a.push(e("i-button",{props:{type:"text",size:"small"},on:{click:function(){t.handle()}}},[e("span",{style:{color:"#39f"}},t.name)]))}),e("div",a)}}],responseHandle:function(e){return e},searchConditionHandle:function(e){return e.start_time&&"number"!=typeof e.start_time&&(e.start_time=Date.parse(e.start_time)),e.end_time&&"number"!=typeof e.end_time&&(e.end_time=Date.parse(e.end_time)),e}}},methods:{loadResource:function(){n.find.api.params.id=this.$route.params.id;var e=this;this.$Util.api.get(n.find,this).then(function(t){if(!t.data)return e.$Message.warning("数据不存在"),!1;e.listItem=t.data},function(e){})},loadTagResource:function(){var e=this;this.$Util.api.get(n.resource,e).then(function(t){t.data.unshift({audience:"no_tag",title:"不限"}),e.searchTypeSource=t.data},function(t){e.$Message.warning("加载资源失败")})},addCategory:function(e){0===e?this.addModal=!0:1===e?location.hash="/mall/advertising/category-list/category-information/add/1/"+this.$route.params.id:2===e?location.hash="/mall/advertising/category-list/category-information/add/2/"+this.$route.params.id+"/0":3===e&&(location.hash="/mall/advertising/category-list/category-information/add/3/"+this.$route.params.id+"/0")},editCategory:function(e){1===e?location.hash="/mall/advertising/category-list/category-information/edit/1/"+this.$route.params.id+"/0":2===e?location.hash="/mall/advertising/category-list/category-information/edit/2/"+this.$route.params.id+"/0":3===e&&(location.hash="/mall/advertising/category-list/category-information/edit/3/"+this.$route.params.id+"/0")},addSonCategory:function(e){2===e?location.hash="/mall/advertising/category-list/category-information/add/2/"+this.$route.params.id+"/"+this.editParentIdOfLevel1:3===e&&(location.hash="/mall/advertising/category-list/category-information/add/3/"+this.$route.params.id+"/"+this.editParentIdOfLevel2)},copyCategory:function(e,t){var a=this;if(confirm("确定要复制配置吗?")){var i={api:{path:"/boss/mall/advertising/category-information/copy",params:{advertising_id:this.$route.params.id,id1:"",id2:"",id3:""}}};if(3===e&&"all"===t)i.api.params.id1=a.copyIdOfLevel1,i.api.params.id2=a.copyIdOfLevel2,i.api.params.id3=a.copyIdOfLevel3,i.api.params.copy_level=[1,2,3];else if(2===e&&"all"===t)i.api.params.id1=a.copyIdOfLevel1,i.api.params.id2=a.copyIdOfLevel2,i.api.params.copy_level=[1,2];else if(1===e&&"current"===t)i.api.params.id1=a.copyIdOfLevel1,i.api.params.copy_level=[1];else if(3===e&&"part"===t)i.api.params.id2=a.copyIdOfLevel2,i.api.params.id3=a.copyIdOfLevel3,i.api.params.copy_level=[2,3];else if(2===e&&"current"===t)i.api.params.id2=a.copyIdOfLevel2,i.api.params.copy_level=[2];else{if(3!==e||"current"!==t)return void alert("复制失败，请联系开发人员");i.api.params.id3=a.copyIdOfLevel3,i.api.params.copy_level=[3]}bus.$emit("on-loading"),vm.$Util.api.post(i,i.api.params,vm).then(function(e){e.data?(alert("复制成功"),setTimeout(function(){location.reload()},1500)):(bus.$emit("on-loading"),alert("复制失败，请联系开发人员"))},function(e){bus.$emit("on-loading"),alert("复制失败，请联系开发人员")})}},deleteCategory:function(e){var t=this;if(confirm("确定要删除吗?")){var a={api:{path:"/boss/mall/advertising/category-information/delete",params:{advertising_id:this.$route.params.id,id1:"",id2:"",id3:""}}};if(1===e)a.api.params.id1=t.deleteIdOfLevel1;else if(2===e)a.api.params.id2=t.deleteIdOfLevel2;else{if(3!==e)return void alert("删除失败，请联系开发人员");a.api.params.id3=t.deleteIdOfLevel3}bus.$emit("on-loading"),vm.$Util.api.delete(a,vm).then(function(e){e.data?(alert("删除成功"),setTimeout(function(){location.reload()},1500)):(bus.$emit("on-loading"),alert("删除失败，请联系开发人员"))},function(e){bus.$emit("on-loading"),alert("删除失败，请联系开发人员")})}},showEditCategoryModal:function(e){this.editModal=!0,null!==e.id3&&void 0!==e.id3?(this.editLevel3=!0,this.editParentIdOfLevel2=e.id2):(this.editLevel3=!1,this.editParentIdOfLevel2=0),null!==e.id2&&void 0!==e.id2?(this.editLevel2=!0,this.editParentIdOfLevel1=e.id1):(this.editLevel2=!1,this.editParentIdOfLevel1=0),null!==e.id1&&void 0!==e.id1?this.editLevel1=!0:this.editLevel1=!1},showCreateCategoryModal:function(e){this.createModal=!0,null!==e.id2&&void 0!==e.id2?(this.createLevel3=!0,this.editParentIdOfLevel2=e.id2):(this.createLevel3=!1,this.editParentIdOfLevel2=0),null!==e.id1&&void 0!==e.id1?(this.createLevel2=!0,this.editParentIdOfLevel1=e.id1):(this.createLevel2=!1,this.editParentIdOfLevel1=0)},showCopyCategoryModal:function(e){this.copyModal=!0,null!==e.id3&&void 0!==e.id3?(this.copyLevel3=!0,this.copyIdOfLevel3=e.id3):(this.copyLevel3=!1,this.copyIdOfLevel3=0),null!==e.id2&&void 0!==e.id2?(this.copyLevel2=!0,this.copyIdOfLevel2=e.id2):(this.copyLevel2=!1,this.copyIdOfLevel2=0),null!==e.id1&&void 0!==e.id1?(this.copyLevel1=!0,this.copyIdOfLevel1=e.id1):(this.copyLevel1=!1,this.copyIdOfLevel1=0)},showDeleteCategoryModal:function(e){this.deleteModal=!0,null!==e.id3&&void 0!==e.id3?(this.deleteLevel3=!0,this.deleteIdOfLevel3=e.id3):(this.deleteLevel3=!1,this.deleteIdOfLevel3=0),null!==e.id2&&void 0!==e.id2?(this.deleteLevel2=!0,this.deleteIdOfLevel2=e.id2):(this.deleteLevel2=!1,this.deleteIdOfLevel2=0),null!==e.id1&&void 0!==e.id1?(this.deleteLevel1=!0,this.deleteIdOfLevel1=e.id1):(this.deleteLevel1=!1,this.deleteIdOfLevel1=0)}},created:function(){this.$nextTick(function(){var e=this;this.loadTagResource(),this.loadResource(),bus.$on("show-edit-modal",function(t){e.showEditCategoryModal(t)}),bus.$on("show-create-modal",function(t){e.showCreateCategoryModal(t)}),bus.$on("show-copy-modal",function(t){e.showCopyCategoryModal(t)}),bus.$on("show-delete-modal",function(t){e.showDeleteCategoryModal(t)})})}}},jF4Y:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("m-page-list",{attrs:{path:e.listApi.path,params:e.listApi.params,columns:e.columns,"response-handle":e.responseHandle,"page-info-path":e.listPageInfoApi.path,"page-info-params":e.listPageInfoApi.params}},[a("m-action-bar",[a("Button",{attrs:{type:"primary"},on:{click:function(t){e.addCategory(0)}}},[e._v("新建")])],1),e._v(" "),a("m-action-bar",{attrs:{slot:"search"},slot:"search"},[a("Card",[a("span",{staticStyle:{"margin-right":"20px"}},[e._v("\n                页面名称："+e._s(e.listItem.name)+"\n            ")]),e._v(" "),a("span",{staticStyle:{"margin-right":"20px"}},[e._v("\n                展示对象："+e._s(e.listItem.audience_name)+"\n            ")]),e._v(" "),a("span",[e._v("\n                展示时段："+e._s(e.listItem.start_time)+" ~ "+e._s(e.listItem.end_time)+"\n            ")])]),e._v(" "),a("m-action-search-bar",{attrs:{"search-condition":e.searchCondition}},[a("m-form-item",{attrs:{label:"一级分类"}},[a("Input",{staticStyle:{width:"150px","margin-right":"10px"},model:{value:e.searchCondition.categoryOfLevel1,callback:function(t){e.$set(e.searchCondition,"categoryOfLevel1",t)},expression:"searchCondition.categoryOfLevel1"}})],1),e._v(" "),a("m-form-item",{attrs:{label:"二级分类"}},[a("Input",{staticStyle:{width:"150px","margin-right":"10px"},model:{value:e.searchCondition.categoryOfLevel2,callback:function(t){e.$set(e.searchCondition,"categoryOfLevel2",t)},expression:"searchCondition.categoryOfLevel2"}})],1),e._v(" "),a("m-form-item",{attrs:{label:"三级分类"}},[a("Input",{staticStyle:{width:"150px","margin-right":"10px"},model:{value:e.searchCondition.categoryOfLevel3,callback:function(t){e.$set(e.searchCondition,"categoryOfLevel3",t)},expression:"searchCondition.categoryOfLevel3"}})],1),e._v(" "),a("m-form-item",{attrs:{label:"状态"}},[a("i-select",{staticStyle:{width:"200px"},attrs:{multiple:""},model:{value:e.searchCondition.state,callback:function(t){e.$set(e.searchCondition,"state",t)},expression:"searchCondition.state"}},[a("i-option",{attrs:{value:0}},[e._v("数据不全")]),e._v(" "),a("i-option",{attrs:{value:1}},[e._v("正常")])],1)],1)],1)],1),e._v(" "),a("m-action-bar",[a("Modal",{attrs:{title:"请选择要新建的类型"},model:{value:e.addModal,callback:function(t){e.addModal=t},expression:"addModal"}},[a("Button",{attrs:{type:"primary"},on:{click:function(t){e.addCategory(1)}}},[e._v("一级分类")]),e._v(" "),a("Button",{attrs:{type:"primary"},on:{click:function(t){e.addCategory(2)}}},[e._v("二级分类")]),e._v(" "),a("Button",{attrs:{type:"primary"},on:{click:function(t){e.addCategory(3)}}},[e._v("三级分类")])],1),e._v(" "),a("Modal",{attrs:{title:"请选择要编辑的类型"},model:{value:e.editModal,callback:function(t){e.editModal=t},expression:"editModal"}},[e.editLevel1?a("Button",{attrs:{type:"primary"},on:{click:function(t){e.editCategory(1)}}},[e._v("该页面的所有一级分类")]):e._e(),e._v(" "),e.editLevel2?a("Button",{attrs:{type:"primary"},on:{click:function(t){e.editCategory(2)}}},[e._v("该页面的所有二级分类")]):e._e(),e._v(" "),e.editLevel3?a("Button",{attrs:{type:"primary"},on:{click:function(t){e.editCategory(3)}}},[e._v("该页面的所有三级分类")]):e._e()],1),e._v(" "),a("Modal",{attrs:{title:"请选择要新建的类型"},model:{value:e.createModal,callback:function(t){e.createModal=t},expression:"createModal"}},[e.createLevel2?a("Button",{attrs:{type:"primary"},on:{click:function(t){e.addSonCategory(2)}}},[e._v("该一级分类的二级分类")]):e._e(),e._v(" "),e.createLevel3?a("Button",{attrs:{type:"primary"},on:{click:function(t){e.addSonCategory(3)}}},[e._v("该二级分类的三级分类")]):e._e()],1),e._v(" "),a("Modal",{attrs:{title:"请选择要复制的类型"},model:{value:e.copyModal,callback:function(t){e.copyModal=t},expression:"copyModal"}},[e.copyLevel3?a("Button",{attrs:{type:"primary"},on:{click:function(t){e.copyCategory(3,"all")}}},[e._v("当前一级分类及其所有二级、三级分类")]):e._e(),e._v(" "),e.copyLevel2?a("Button",{attrs:{type:"primary"},on:{click:function(t){e.copyCategory(2,"all")}}},[e._v("当前一级分类及其所有二级")]):e._e(),e._v(" "),e.copyLevel1?a("Button",{attrs:{type:"primary"},on:{click:function(t){e.copyCategory(1,"current")}}},[e._v("当前一级分类")]):e._e(),e._v(" "),e.copyLevel3?a("Button",{attrs:{type:"primary"},on:{click:function(t){e.copyCategory(3,"part")}}},[e._v("当前二级分类及其所有三级分类")]):e._e(),e._v(" "),e.copyLevel2?a("Button",{attrs:{type:"primary"},on:{click:function(t){e.copyCategory(2,"current")}}},[e._v("当前二级分类")]):e._e(),e._v(" "),e.copyLevel3?a("Button",{attrs:{type:"primary"},on:{click:function(t){e.copyCategory(3,"current")}}},[e._v("当前三级分类")]):e._e()],1),e._v(" "),a("Modal",{attrs:{title:"请选择要删除的类型"},model:{value:e.deleteModal,callback:function(t){e.deleteModal=t},expression:"deleteModal"}},[e.deleteLevel1?a("Button",{attrs:{type:"primary"},on:{click:function(t){e.deleteCategory(1)}}},[e._v("当前一级分类及其所有二级、三级分类")]):e._e(),e._v(" "),e.deleteLevel2?a("Button",{attrs:{type:"primary"},on:{click:function(t){e.deleteCategory(2)}}},[e._v("当前二级分类及其所有三级分类")]):e._e(),e._v(" "),e.deleteLevel3?a("Button",{attrs:{type:"primary"},on:{click:function(t){e.deleteCategory(3)}}},[e._v("当前三级分类")]):e._e()],1)],1)],1)},staticRenderFns:[]}},pq5W:function(e,t,a){var i=a("VU/8")(a("Lahe"),a("jF4Y"),null,null);e.exports=i.exports}});