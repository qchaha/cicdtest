webpackJsonp([30],{"4bGS":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("oMr3"),r=a.n(n),s=a("pr6G"),i=a.n(s);t.default={name:"List",components:{MSearch:r.a,MTable:i.a},data:function(){return{listApi:{api:{path:"/boss/mall/advertising/often-buy/list",params:{offset:0,limit:24,name:null,position:null,audience:null,state:[1,3],time:null,start_time:null,end_time:null,fields:"{id,module,page,position,name,start_time,end_time,state,audience,audience_name}"}}},pageApi:{api:{path:"/boss/mall/advertising/often-buy/page"}},loadTotal:3,loadedNum:0,audienceOptions:[],data:[],page:{total:0,pageSize:24,currentPage:1}}},created:function(){var e=this;this.$nextTick(function(){bus.$emit("on-loading"),e.loadList(),e.loadPage(),e.loadAudienceOptions(),bus.$on("alert-error-tips",function(t,a){return e.alertErrorTips(t,a)}),bus.$on("on-search",function(){return e.doSearch()}),bus.$on("change-page",function(t){return e.changePage(t)})})},watch:{loadedNum:function(){this.loadedNum>=this.loadTotal&&(bus.$emit("on-loading"),this.loadedNum=0)}},methods:{loadList:function(){var e=this;this.$Util.api.get(this.listApi,this).then(function(t){e.loadedNum+=1,e.data=t.data},function(t){e.loadedNum+=1,e.alertErrorTips(t.message?t.message:"发生了未知的错误",300)})},loadPage:function(){this.page.total=0,this.page.currentPage=1,this.pageApi.api.params=this.listApi.api.params;var e=this;this.$Util.api.get(this.pageApi,this).then(function(t){e.loadedNum+=1,e.page.total=t.data.total},function(t){e.loadedNum+=1,e.alertErrorTips(t.message?t.message:"发生了未知的错误",300)})},loadAudienceOptions:function(){var e=this;this.$Util.api.get({api:{path:"/boss/mall/advertising/home/tag-group-info",params:{fields:"{audience,title}"}}},this).then(function(t){e.loadedNum+=1,t.data.unshift({audience:"no_tag",title:"不限"}),e.audienceOptions=t.data},function(t){e.loadedNum+=1,e.alertErrorTips(t.message?t.message:"发生了未知的错误",300)})},doSearch:function(){this.data=[],this.loadTotal=2,bus.$emit("on-loading"),this.listApi.api.params.offset=0,this.loadList(),this.loadPage()},changePage:function(e){this.page.currentPage=e,this.listApi.api.params.offset=(e-1)*this.listApi.api.params.limit,this.loadTotal=1,bus.$emit("on-loading"),this.loadList()},alertErrorTips:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250;this.$Modal.error({width:t,content:e})}},beforeDestroy:function(){bus.$off("alert-error-tips"),bus.$off("on-search"),bus.$off("change-page")}}},"9FJr":function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Card",[a("Form",{attrs:{model:e.searchParams}},[a("Row",[a("Col",{attrs:{span:"9"}},[a("FormItem",{attrs:{label:"标题","label-width":40}},[a("Input",{attrs:{placeholder:"多个关键词之间用中/英文逗号隔开"},on:{"on-enter":e.onSearch},model:{value:e.searchParams.name,callback:function(t){e.$set(e.searchParams,"name",t)},expression:"searchParams.name"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"4"}},[a("FormItem",{attrs:{label:"类型","label-width":60}},[a("Select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.searchParams.position,callback:function(t){e.$set(e.searchParams,"position",t)},expression:"searchParams.position"}},e._l(e.positionOptions,function(t){return a("Option",{attrs:{value:t.value}},[e._v(e._s(t.label))])}))],1)],1),e._v(" "),a("Col",{attrs:{span:"8"}},[a("FormItem",{attrs:{label:"展示对象","label-width":80}},[a("Select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.searchParams.audience,callback:function(t){e.$set(e.searchParams,"audience",t)},expression:"searchParams.audience"}},e._l(e.audienceOptions,function(t){return a("Option",{attrs:{value:t.audience}},[e._v(e._s(t.title))])}))],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"6"}},[a("FormItem",{attrs:{label:"状态","label-width":40}},[a("Select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:e.searchParams.state,callback:function(t){e.$set(e.searchParams,"state",t)},expression:"searchParams.state"}},e._l(e.stateOptions,function(t){return a("Option",{attrs:{value:t.value}},[e._v(e._s(t.label))])}))],1)],1),e._v(" "),a("Col",{attrs:{span:"10"}},[a("FormItem",{attrs:{label:"开始结束时间范围","label-width":130}},[a("DatePicker",{attrs:{type:"datetimerange",options:e.datetimeOptions,placeholder:"选择日期和时间"},model:{value:e.searchParams.time,callback:function(t){e.$set(e.searchParams,"time",t)},expression:"searchParams.time"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"2"}},[a("Button",{attrs:{type:"primary",long:""},on:{click:e.onSearch}},[e._v("搜索")])],1),e._v(" "),a("Col",{attrs:{span:"2",push:"19"}},[a("Button",{attrs:{type:"primary",long:""},on:{click:e.toCreate}},[e._v("新建")])],1)],1)],1)],1)},staticRenderFns:[]}},"D+9n":function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Card",[a("Table",{attrs:{border:"",columns:e.columns,data:e.data}}),e._v(" "),a("div",{staticClass:"page-bar"},[a("Page",{attrs:{current:e.page.currentPage,"page-size":e.page.pageSize,total:e.page.total,size:"small"},on:{"on-change":e.changePage}})],1)],1)},staticRenderFns:[]}},GUus:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("m-page",[a("m-search",{attrs:{audienceOptions:e.audienceOptions,searchParams:e.listApi.api.params},on:{"update:searchParams":function(t){e.$set(e.listApi.api,"params",t)}}}),e._v(" "),a("m-table",{attrs:{data:e.data,page:e.page}}),e._v(" "),a("Back-top",{attrs:{bottom:100,right:30}},[a("div",{staticClass:"top"},[e._v("返回顶端")])])],1)},staticRenderFns:[]}},Tk8J:function(e,t,a){t=e.exports=a(0)(),t.push([e.i,".ivu-card[data-v-b961854a]{margin-bottom:15px}.top[data-v-b961854a]{padding:10px;background:rgba(0,153,229,.7);color:#fff;text-align:center;border-radius:2px}",""])},chsx:function(e,t,a){a("eOBR");var n=a("VU/8")(a("4bGS"),a("GUus"),"data-v-b961854a",null);e.exports=n.exports},eOBR:function(e,t,a){var n=a("Tk8J");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("rjj0")("61b1a4dc",n,!0)},gGyW:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"MTable",props:{data:{type:Array,default:function(){return[]}},page:{type:Object,default:function(){return{total:0,pageSize:24,currentPage:1}}}},data:function(){var e=this;return{trashApi:{api:{path:"/boss/mall/advertising/often-buy/trash"}},restoreApi:{api:{path:"/boss/mall/advertising/often-buy/restore"}},columns:[{title:"ID",key:"id",align:"center",sortable:!0,width:80},{title:"标题",key:"name",align:"center"},{title:"类型",key:"position",align:"center",width:80,render:function(e,t){var a="";switch(t.row.position){case"goods":a="商品";break;case"brand":a="品牌";break;case"service":a="服务"}return e("span",{},a)}},{title:"展示对象",key:"audience_name",align:"center",width:200,render:function(e,t){return""===t.row.audience_name?e("span",{},"不限"):e("span",{},t.row.audience_name)}},{title:"开始时间",key:"start_time",align:"center",sortable:!0,width:120,render:function(t,a){var n=parseInt(a.row.start_time);return t("div",{},[t("p",{},e.$Util.dateFormat(n,"yyyy-MM-dd")),t("p",{},e.$Util.dateFormat(n,"hh:mm:ss"))])}},{title:"结束时间",key:"end_time",align:"center",sortable:!0,width:120,render:function(t,a){var n=parseInt(a.row.end_time);return t("div",{},[t("p",{},e.$Util.dateFormat(n,"yyyy-MM-dd")),t("p",{},e.$Util.dateFormat(n,"hh:mm:ss"))])}},{title:"状态",key:"state",align:"center",width:100,render:function(e,t){switch(t.row.state){case 0:return e("Tag",{attrs:{color:"red"}},"已作废");case 1:return e("Tag",{attrs:{color:"green"}},"已发布");case 2:return e("Tag",{attrs:{color:"gray"}},"已下线");case 3:return e("Tag",{attrs:{color:"yellow"}},"待发布")}}},{title:"操作",key:"action",align:"center",width:120,render:function(t,a){var n=[t("Button",{attrs:{type:"text",size:"small"},style:{color:"#3366FF"},on:{click:function(){location.hash="/mall/advertising/often-buy/edit/"+a.row.id}}},"编辑")];return 0!==a.row.state?n.push(t("Button",{attrs:{type:"text",size:"small"},style:{color:"#FF0000"},on:{click:function(){var t=e;e.$Modal.confirm({width:300,loading:!0,content:"确认废弃ID【"+a.row.id+"】的常购广告位么？",onOk:function(){e.$Util.api.post(e.trashApi,{id:a.row.id},e).then(function(e){0===e.error_code?(a.row.state=0,t.$Modal.remove(),setTimeout(function(){t.$Modal.success({width:300,content:"已成功作废，不会发布上线"})},300)):(t.$Modal.remove(),setTimeout(function(){bus.$emit("alert-error-tips",e.error_description?e.error_description:"发生了未知的错误",300)},300))},function(e){t.$Modal.remove(),setTimeout(function(){bus.$emit("alert-error-tips",e.message?e.message:"发生了未知的错误",300)},300)})}})}}},"废弃")):n.push(t("Button",{attrs:{type:"text",size:"small"},style:{color:"#00cc66"},on:{click:function(){bus.$emit("on-loading"),e.$Util.api.post(e.restoreApi,{id:a.row.id},e).then(function(e){if(bus.$emit("on-loading"),0===e.error_code){var t=parseInt((new Date).getTime()/1e3);a.row.start_time>t?a.row.state=3:a.row.end_time<t?a.row.state=2:a.row.state=1}else bus.$emit("alert-error-tips",e.error_description?e.error_description:"发生了未知的错误",300)},function(e){bus.$emit("on-loading"),bus.$emit("alert-error-tips",e.message?e.message:"发生了未知的错误",300)})}}},"恢复")),t("div",{},n)}}]}},methods:{changePage:function(e){bus.$emit("change-page",e)}}}},gyEL:function(e,t,a){var n=a("utb5");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("rjj0")("6aa2876e",n,!0)},ikxR:function(e,t,a){t=e.exports=a(0)(),t.push([e.i,".page-bar[data-v-087dca3a]{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;margin:15px auto 0}",""])},oMr3:function(e,t,a){a("gyEL");var n=a("VU/8")(a("xzf+"),a("9FJr"),"data-v-392eebec",null);e.exports=n.exports},pr6G:function(e,t,a){a("sczZ");var n=a("VU/8")(a("gGyW"),a("D+9n"),"data-v-087dca3a",null);e.exports=n.exports},sczZ:function(e,t,a){var n=a("ikxR");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("rjj0")("7b20e3a8",n,!0)},utb5:function(e,t,a){t=e.exports=a(0)(),t.push([e.i,".ivu-form>.ivu-row[data-v-392eebec]:not(:last-child){margin-bottom:10px}",""])},"xzf+":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"MSearch",props:{searchParams:{type:Object,default:function(){return{name:null,position:null,audience:null,state:[1,3],time:null}}},audienceOptions:{type:Array,default:function(){return[]}}},data:function(){return{positionOptions:[{label:"商品",value:"goods"},{label:"品牌",value:"brand"},{label:"服务",value:"service"}],stateOptions:[{label:"已废弃",value:0},{label:"已发布",value:1},{label:"已下线",value:2},{label:"待发布",value:3}],datetimeOptions:{shortcuts:[{text:"今天",value:function(){var e=new Date,t=new Date;return e.setDate(e.getDate()+1),e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),[t,e]}},{text:"最近一周",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-6048e5),[t,e]}},{text:"最近一个月",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-2592e6),[t,e]}},{text:"最近三个月",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-7776e6),[t,e]}}]}}},watch:{"searchParams.time":function(e){e[0]instanceof Date?this.searchParams.start_time=parseInt(e[0].getTime()/1e3):this.searchParams.start_time=null,e[1]instanceof Date?this.searchParams.end_time=parseInt(e[1].getTime()/1e3):this.searchParams.end_time=null}},methods:{toCreate:function(){location.hash="/mall/advertising/often-buy/add"},onSearch:function(){bus.$emit("on-search")}}}}});