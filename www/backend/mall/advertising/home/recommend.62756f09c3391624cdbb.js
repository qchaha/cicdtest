webpackJsonp([36],{"1Cb9":function(t,e,a){var i=a("ECkP");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("52768bf4",i,!0)},"4lGw":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("m-page",[a("m-recommend-settings")],1)},staticRenderFns:[]}},"6HYG":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"MIconSettings",props:{itemSettingsCardClass:{default:"item-settings-card"},position:{default:0},disabled:{default:!1},recommendItem:{type:Object,default:function(){return{name:"",image:"",route:"",ratio_of_image:0,start_validate_all_fields:!1,validate_pass:!1}}}},data:function(){return{formRef:"recommend-item",validateRules:{name:[{required:!0,message:"标题不能为空",trigger:"blur"}],image:[{required:!0,message:"图片不能为空",trigger:"blur"}],route:[{required:!0,message:"路由不能为空"}],ratio_of_image:[{validator:function(t,e,a){if(e>0){var i=1e3*parseFloat(e).toFixed(3);Math.abs(i-744)>10?a(new Error("上传图片比例+限制比例（0.744（长375px，宽504px），+/-误差不超过0.01）")):a()}else a()}}]}}},methods:{handleSelectRoute:function(t){this.recommendItem.route=t},handleUploadSuccessImage:function(t){this.recommendItem.image=t.length>0?t[0].url:"";var e=t.length>0?(t[0].width/t[0].height).toFixed(4):0;this.recommendItem.ratio_of_image=isNaN(e)?0:e},removeItem:function(t){t>=0&&bus.$emit("remove-icon",t)}},created:function(){var t=this,e=this;this.$nextTick(function(){bus.$on("start-validate",function(){t.$refs[e.formRef]&&t.$refs[e.formRef].validate(function(e){t.recommendItem.validate_pass=!!e,t.recommendItem.start_validate_all_fields=!1})})})}}},"8eXN":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("XD6P"),n=a.n(i);e.default={name:"app",components:{MRecommendSettings:n.a},data:function(){return{}},methods:{submit:function(){}},created:function(){var t=this;this.$nextTick(function(){bus.$on("submit",function(){return t.submit()})})}}},CfOr:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",[a("section",{attrs:{slot:"extra"},slot:"extra"},[a("Button",{staticClass:"addIcon",attrs:{slot:"extra",disabled:t.add_icon_disabled},on:{click:t.addIcon},slot:"extra"},[t._v("添加广告位\n        ")]),t._v(" "),a("Button",{attrs:{slot:"extra",type:"primary"},on:{click:t.validateForm},slot:"extra"},[t._v("提交\n        ")])],1),t._v(" "),a("br"),t._v(" "),a("br"),t._v(" "),a("section",t._l(t.groupChunks,function(e,i){return a("Row",t._l(e,function(e,n){return a("Col",{attrs:{span:"8",offset:n?1:0}},[a("m-recommend-item-settings",{attrs:{position:2*i+n,disabled:t.delete_icon_disabled,recommendItem:e},on:{"update:recommendItem":function(t){e=t}}})],1)}))}))])},staticRenderFns:[]}},ECkP:function(t,e,a){e=t.exports=a(0)(),e.push([t.i,".img-ratio-tips[data-v-db616bb4],.input-tips[data-v-db616bb4]{font-size:12px;color:#9ea7b4}.item-settings-card[data-v-db616bb4]{max-width:400px;background-color:#f2f2f2}.A5-first[data-v-db616bb4]{max-width:400px;background-color:#cff}.ivu-form-item[data-v-db616bb4]:not(:last-child){margin-bottom:24px}.fixed-width-input[data-v-db616bb4]{display:inline-block;width:200px}.input-tips[data-v-db616bb4]{margin-left:10px}",""])},HCnN:function(t,e,a){a("1Cb9");var i=a("VU/8")(a("6HYG"),a("qHwd"),"data-v-db616bb4",null);t.exports=i.exports},Kxo9:function(t,e,a){var i=a("TvdN");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("5d272c1b",i,!0)},TvdN:function(t,e,a){e=t.exports=a(0)(),e.push([t.i,".ivu-row[data-v-efd883ac]:not(:last-child){margin-bottom:20px}",""])},XD6P:function(t,e,a){a("Kxo9");var i=a("VU/8")(a("oetl"),a("CfOr"),"data-v-efd883ac",null);t.exports=i.exports},krzf:function(t,e,a){var i=a("VU/8")(a("8eXN"),a("4lGw"),null,null);t.exports=i.exports},oetl:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("HCnN"),n=a.n(i),o={find:{api:{path:"/boss/mall/advertising/home/recommend",params:{fields:"{name,image{url,origin},route}"}}},update:{api:{path:"/boss/mall/advertising/home/recommend"}}},s={name:"",image:"",route:"",ratio_of_image:0,start_validate_all_fields:!1,validate_pass:!1};e.default={name:"MA3Settings",components:{MRecommendItemSettings:n.a},data:function(){return{groups:[JSON.parse(JSON.stringify(s)),JSON.parse(JSON.stringify(s))],add_icon_disabled:!1,delete_icon_disabled:!1}},computed:{groupChunks:function(){var t=[];return this.groups.forEach(function(e,a){a%2==0&&t.push([]),t[t.length-1].push(e)}),t}},methods:{addIcon:function(){var t=JSON.parse(JSON.stringify(s));this.groups.splice(this.groups.length,0,t)},removeIcon:function(t){t>=0&&this.groups.splice(t,1)},validateForm:function(){bus.$emit("on-loading"),this.beforeValidate(),setTimeout(this.onValidate(),1e3)},submit:function(){var t=this.getRequestParams();this.submitRequest(t)},beforeValidate:function(){bus.$emit("start-validate")},onValidate:function(){var t=0;if(this.groups.forEach(function(e,a){e.validate_pass||t++}),t>0)return bus.$emit("on-loading"),this.$Message.warning("有"+t+"个表单项填写违规，请修正"),!1;bus.$emit("validate-success")},validateFormData:function(){this.groups.forEach(function(t,e){t.start_validate_all_fields=!0})},getRequestParams:function(){var t={};return t.groups=JSON.parse(JSON.stringify(this.groups)),t},submitRequest:function(t){var e=this;this.$Util.api.post(o.update,t,e).then(function(){location.reload()},function(t){bus.$emit("on-loading")})},initialData:function(){var t=this;bus.$emit("on-loading"),this.$Util.api.get(o.find,this).then(function(e){bus.$emit("on-loading"),e.data.length>0?(t.groups=[],e.data.forEach(function(e,a){var i=JSON.parse(JSON.stringify(s));i.name=e.name,i.route=e.route,i.image=e.image.origin,t.groups.push(i)})):t.addCoin()},function(e){t.alertErrorTips(e.message?e.message:"发生了未知的错误",300)})}},created:function(){var t=this;this.$nextTick(function(){t.initialData(),bus.$on("remove-icon",function(e){return t.removeIcon(e)}),bus.$on("validate-success",function(){return t.submit()})})}}},qHwd:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{class:t.itemSettingsCardClass},[a("p",{attrs:{slot:"title"},slot:"title"}),t._v(" "),a("section",{attrs:{slot:"extra"},slot:"extra"},[a("Button",{staticClass:"info-ghost-btn",attrs:{type:"ghost",disabled:t.disabled},on:{click:function(e){t.removeItem(t.position)}}},[t._v("\n            删除\n        ")])],1),t._v(" "),a("Form",{ref:t.formRef,attrs:{model:t.recommendItem,rules:t.validateRules,"label-width":50}},[a("Form-item",{attrs:{label:"标题",prop:"name"}},[a("Input",{staticClass:"fixed-width-input",attrs:{placeholder:"请输入标题"},model:{value:t.recommendItem.name,callback:function(e){t.$set(t.recommendItem,"name",e)},expression:"recommendItem.name"}}),t._v(" "),a("span",{staticClass:"input-tips"},[t._v("弱环境下展示")])],1),t._v(" "),a("Form-item",{attrs:{label:"图片"}},[a("Form-item",{attrs:{prop:"image"}},[a("m-upload-image",{attrs:{"default-images":[{url:t.recommendItem.image}]},on:{"on-success":t.handleUploadSuccessImage}})],1),t._v(" "),a("Form-item",{attrs:{prop:"ratio_of_image"}},[t.recommendItem.ratio_of_image?a("span",{staticClass:"img-ratio-tips"},[t._v("长宽比"+t._s(t.recommendItem.ratio_of_image))]):t._e()])],1),t._v(" "),a("Form-item",{attrs:{label:"路由",prop:"route"}},[a("m-app-route",{attrs:{placeholder:"输入路由","default-route":t.recommendItem.route},on:{"on-ok":t.handleSelectRoute}})],1)],1)],1)},staticRenderFns:[]}}});