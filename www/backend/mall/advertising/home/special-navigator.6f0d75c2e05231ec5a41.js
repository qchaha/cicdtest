webpackJsonp([35],{"15BC":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("eh7C"),s=a.n(i),o={find:{api:{path:"/boss/mall/advertising/home/special-navigator/find",params:{fields:"{id,name,position,extra_rule,groups{id,ratio,type,start_time,end_time,state,color,route,orders,items{id,name,description,route,image{origin},ratio,orders,goods_id,color}}}"}}},update:{api:{path:"/boss/mall/advertising/home/special-navigator/update"}}},r={name:"",description:"",image:"",route:"",ratio:0,validate_pass:!0};e.default={name:"MSpecialNavigatorSettings",components:{MSpecialNavigatorItemSettings:s.a},data:function(){return{groups:[JSON.parse(JSON.stringify(r))],delete_icon_disabled:!1}},computed:{groupChunks:function(){var t=[];return this.groups.forEach(function(e,a){a%2==0&&t.push([]),t[t.length-1].push(e)}),t}},methods:{addIcon:function(){var t=JSON.parse(JSON.stringify(r));this.groups.splice(this.groups.length,0,t)},removeIcon:function(t){t>=0&&this.groups.splice(t,1)},validateForm:function(){bus.$emit("on-loading"),this.beforeValidate(),setTimeout(this.onValidate(),1e3)},submit:function(){var t=this.getRequestParams();this.submitRequest(t)},beforeValidate:function(){bus.$emit("start-validate")},onValidate:function(){var t=0;if(this.groups.forEach(function(e,a){e.validate_pass||t++}),t>0)return bus.$emit("on-loading"),this.$Message.warning("有"+t+"个表单项填写违规，请修正"),!1;bus.$emit("validate-success")},getRequestParams:function(){var t={};return t.groups=JSON.parse(JSON.stringify(this.groups)),t},submitRequest:function(t){var e=this;this.$Util.api.post(o.update,t,e).then(function(){location.reload()},function(t){bus.$emit("on-loading")})},initialData:function(){var t=this;bus.$emit("on-loading"),t.$Util.api.get(o.find,this).then(function(e){bus.$emit("on-loading"),e.data.groups[0].items.length>0?(t.groups=[],e.data.groups[0].items.forEach(function(e,a){var i=JSON.parse(JSON.stringify(r));i.name=e.name,i.description=e.description,i.ratio=e.ratio,i.route=e.route,i.image=e.image.origin,t.groups.push(i)})):t.addCoin()},function(e){t.alertErrorTips(e.message?e.message:"发生了未知的错误",300)})}},created:function(){var t=this;this.$nextTick(function(){t.initialData(),bus.$on("remove-icon",function(e){return t.removeIcon(e)}),bus.$on("validate-success",function(){return t.submit()})})},beforeDestroy:function(){bus.$off("remove-icon"),bus.$off("validate-success")}}},IqjO:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("wf+X"),s=a.n(i);e.default={name:"app",components:{MSpecialNavigatorSettings:s.a},data:function(){return{}}}},"N/Zv":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",[a("section",{attrs:{slot:"extra"},slot:"extra"},[a("Button",{staticClass:"addIcon",attrs:{slot:"extra"},on:{click:t.addIcon},slot:"extra"},[t._v("添加广告位\n        ")]),t._v(" "),a("Button",{attrs:{slot:"extra",type:"primary"},on:{click:t.validateForm},slot:"extra"},[t._v("提交\n        ")])],1),t._v(" "),a("br"),t._v(" "),a("br"),t._v(" "),a("section",t._l(t.groupChunks,function(e,i){return a("Row",t._l(e,function(e,s){return a("Col",{attrs:{span:"8",offset:s?1:0}},[a("m-special-navigator-item-settings",{attrs:{position:2*i+s,disabled:t.delete_icon_disabled,specialNavigatorItem:e},on:{"update:specialNavigatorItem":function(t){e=t}}})],1)}))}))])},staticRenderFns:[]}},PTbl:function(t,e,a){var i=a("WsOH");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("8dbec67e",i,!0)},WsOH:function(t,e,a){e=t.exports=a(0)(),e.push([t.i,".ivu-row[data-v-16122bfa]:not(:last-child){margin-bottom:20px}",""])},Xr4H:function(t,e,a){var i=a("jo8C");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("6cfb066f",i,!0)},cjPr:function(t,e,a){var i=a("VU/8")(a("IqjO"),a("qsct"),null,null);t.exports=i.exports},dmX0:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"MIconSettings",props:{itemSettingsCardClass:{default:"item-settings-card"},position:{default:0},disabled:{default:!1},specialNavigatorItem:{type:Object,default:function(){return{name:"",description:"",image:"",route:"",ratio:0,validate_pass:!1}}}},data:function(){return{formRef:"special-navigator-item",validateRules:{name:[{required:!0,message:"标题不能为空",trigger:"blur"}],image:[{required:!0,message:"图片不能为空",trigger:"blur"}],route:[{required:!0,message:"路由不能为空"}]}}},methods:{handleSelectRoute:function(t){this.specialNavigatorItem.route=t},handleUploadSuccessImage:function(t){this.specialNavigatorItem.image=t.length>0?t[0].url:"";var e=t.length>0?(t[0].width/t[0].height).toFixed(4):0;this.specialNavigatorItem.ratio=isNaN(e)?0:e},removeItem:function(t){t>=0&&bus.$emit("remove-icon",t)}},created:function(){var t=this;this.$nextTick(function(){bus.$on("start-validate",function(){t.$refs[t.formRef]&&t.$refs[t.formRef].validate(function(e){t.specialNavigatorItem.validate_pass=!!e})})})},beforeDestroy:function(){bus.$off("start-validate")}}},eh7C:function(t,e,a){a("Xr4H");var i=a("VU/8")(a("dmX0"),a("vKHH"),"data-v-e40ac426",null);t.exports=i.exports},jo8C:function(t,e,a){e=t.exports=a(0)(),e.push([t.i,".img-ratio-tips[data-v-e40ac426],.input-tips[data-v-e40ac426]{font-size:12px;color:#9ea7b4}.item-settings-card[data-v-e40ac426]{max-width:400px;background-color:#f2f2f2}.A5-first[data-v-e40ac426]{max-width:400px;background-color:#cff}.ivu-form-item[data-v-e40ac426]:not(:last-child){margin-bottom:24px}.fixed-width-input[data-v-e40ac426]{display:inline-block;width:200px}.input-tips[data-v-e40ac426]{margin-left:10px}",""])},qsct:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("m-page",[a("m-special-navigator-settings")],1)},staticRenderFns:[]}},vKHH:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{class:t.itemSettingsCardClass},[a("p",{attrs:{slot:"title"},slot:"title"}),t._v(" "),a("section",{attrs:{slot:"extra"},slot:"extra"},[a("Button",{staticClass:"info-ghost-btn",attrs:{type:"ghost",disabled:t.disabled},on:{click:function(e){t.removeItem(t.position)}}},[t._v("\n            删除\n        ")])],1),t._v(" "),a("Form",{ref:t.formRef,attrs:{model:t.specialNavigatorItem,rules:t.validateRules,"label-width":50}},[a("Form-item",{attrs:{label:"标题",prop:"name"}},[a("Input",{staticClass:"fixed-width-input",attrs:{placeholder:"请输入标题"},model:{value:t.specialNavigatorItem.name,callback:function(e){t.$set(t.specialNavigatorItem,"name",e)},expression:"specialNavigatorItem.name"}}),t._v(" "),a("span",{staticClass:"input-tips"},[t._v("弱环境下展示")])],1),t._v(" "),a("Form-item",{attrs:{label:"描述"}},[a("Input",{staticClass:"fixed-width-input",attrs:{placeholder:"请输入描述"},model:{value:t.specialNavigatorItem.description,callback:function(e){t.$set(t.specialNavigatorItem,"description",e)},expression:"specialNavigatorItem.description"}}),t._v(" "),a("span",{staticClass:"input-tips"},[t._v("弱环境下展示")])],1),t._v(" "),a("Form-item",{attrs:{label:"图片"}},[a("Form-item",{attrs:{prop:"image"}},[a("m-upload-image",{attrs:{"default-images":[{url:t.specialNavigatorItem.image}]},on:{"on-success":t.handleUploadSuccessImage}})],1),t._v(" "),a("Form-item",[t.specialNavigatorItem.ratio?a("span",{staticClass:"img-ratio-tips"},[t._v("长宽比"+t._s(t.specialNavigatorItem.ratio))]):t._e()])],1),t._v(" "),a("Form-item",{attrs:{label:"路由",prop:"route"}},[a("m-app-route",{attrs:{placeholder:"输入路由","default-route":t.specialNavigatorItem.route},on:{"on-ok":t.handleSelectRoute}})],1)],1)],1)},staticRenderFns:[]}},"wf+X":function(t,e,a){a("PTbl");var i=a("VU/8")(a("15BC"),a("N/Zv"),"data-v-16122bfa",null);t.exports=i.exports}});