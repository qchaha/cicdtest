webpackJsonp([31],{"+ELx":function(t,e,i){var a=i("rC88");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i("rjj0")("4684cefa",a,!0)},"//kS":function(t,e,i){i("+ELx");var a=i("VU/8")(i("cGEz"),i("78/C"),"data-v-27ff2abc",null);t.exports=a.exports},"3nhj":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Form",{ref:t.formRef,attrs:{model:t.item,rules:t.validateRules,"label-width":60}},[i("Card",{staticClass:"item-card"},[i("section",{attrs:{slot:"title"},slot:"title"},[i("strong",[t._v("头部横幅广告")]),t._v(" "),i("i-switch",{attrs:{"true-value":1,"false-value":0},model:{value:t.item.switch,callback:function(e){t.$set(t.item,"switch",e)},expression:"item.switch"}})],1),t._v(" "),t.item.switch?i("div",[i("Form-item",{staticClass:"tightness-form-item",attrs:{label:"ID"}},[i("span",[t._v(t._s(t.item.id))])]),t._v(" "),i("Form-item",{attrs:{label:"标题",prop:"name"}},[i("Input",{staticClass:"fixed-width-input",model:{value:t.item.name,callback:function(e){t.$set(t.item,"name",e)},expression:"item.name"}}),t._v(" "),i("span",{staticClass:"input-tips"},[t._v("弱网环境下展示")])],1),t._v(" "),i("Form-item",{attrs:{label:"描述",prop:"description"}},[i("Input",{staticClass:"fixed-width-input",model:{value:t.item.description,callback:function(e){t.$set(t.item,"description",e)},expression:"item.description"}}),t._v(" "),i("span",{staticClass:"input-tips"},[t._v("弱网环境下展示")])],1),t._v(" "),i("Form-item",{attrs:{label:"路由",prop:"route"}},[i("m-app-route",{attrs:{"default-route":t.item.route,disabled:t.editDisabled},on:{"on-ok":t.handleSelectRoute}})],1),t._v(" "),i("Form-item",{attrs:{label:"图片",prop:"image"}},[i("m-upload-image",{attrs:{"default-images":[{url:t.item.image}],disabled:t.editDisabled},on:{"on-success":t.handleUploadSuccess}}),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:t.item.ratio,expression:"item.ratio"}],staticClass:"img-ratio-tips"},[t._v("长宽比"+t._s(t.item.ratio))])],1)],1):t._e()])],1)},staticRenderFns:[]}},"78/C":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Card",[i("p",{attrs:{slot:"title"},slot:"title"},[t._v("Tab"+t._s(t.position+2))]),t._v(" "),i("section",{attrs:{slot:"extra"},slot:"extra"},[i("Button",{directives:[{name:"show",rawName:"v-show",value:t.canAddTabGroup,expression:"canAddTabGroup"}],attrs:{type:"success"},on:{click:function(e){t.addGroup(t.position)}}},[t._v("\n            添加Tab\n        ")]),t._v(" "),i("Button",{directives:[{name:"show",rawName:"v-show",value:t.canRemoveTabGroup,expression:"canRemoveTabGroup"}],attrs:{type:"error"},on:{click:t.removeGroup}},[t._v("\n            删除\n        ")]),t._v(" "),i("Button",{directives:[{name:"show",rawName:"v-show",value:t.position>0,expression:"position > 0"}],attrs:{type:"info"},on:{click:function(e){t.moveGroup(t.position,t.position-1)}}},[t._v("\n            上移\n        ")]),t._v(" "),i("Button",{directives:[{name:"show",rawName:"v-show",value:t.position<t.groups.length-1,expression:"position < (groups.length - 1)"}],attrs:{type:"info"},on:{click:function(e){t.moveGroup(t.position,t.position+1)}}},[t._v("\n            下移\n        ")])],1),t._v(" "),i("section",[i("Form",{ref:t.formRef,attrs:{model:t.group,rules:t.validateRules,"label-width":110}},[i("Form-item",{staticStyle:{"margin-bottom":"24px"},attrs:{label:"Tab名称",prop:"name","label-width":"80"}},[i("Input",{staticClass:"fixed-width-input",model:{value:t.group.name,callback:function(e){t.$set(t.group,"name",e)},expression:"group.name"}}),t._v(" "),i("span",{staticClass:"input-tips"},[t._v("最多5个中文（10个字符）")])],1),t._v(" "),i("Row",[i("i-col",{attrs:{span:"9"}},[i("header-item",{attrs:{item:t.group.items[0],group:t.group},on:{"update:item":function(e){t.$set(t.group.items,0,e)},"update:group":function(e){t.group=e}}})],1),t._v(" "),i("i-col",{attrs:{span:"9",offset:"2"}},[i("Card",{staticClass:"item-card"},[i("p",{attrs:{slot:"title"},slot:"title"},[t._v("商品列表")]),t._v(" "),i("Form-item",{attrs:{label:"填写方式",prop:"type"}},[i("RadioGroup",{model:{value:t.group.type,callback:function(e){t.$set(t.group,"type",e)},expression:"group.type"}},[i("Radio",{attrs:{label:"brand_id"}},[t._v("指定品牌/品类")]),t._v(" "),i("Radio",{attrs:{label:"goods_id"}},[t._v("指定GoodsID")])],1)],1),t._v(" "),"brand_id"===t.group.type?i("div",[i("Form-item",{staticClass:"tightness-form-item"},[i("span",[t._v("搜索结果路由参数（品牌、品类，至少填一种参数)")])]),t._v(" "),i("Form-item",{attrs:{label:"品类",prop:"category"}},[i("Select",{staticClass:"fixed-width-input",attrs:{placeholder:"搜索品类名",filterable:"",clearable:""},on:{"on-change":t.changeBrandOrCategory},model:{value:t.group.category,callback:function(e){t.$set(t.group,"category",e)},expression:"group.category"}},t._l(t.categoryOptions,function(e){return i("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),i("Form-item",{attrs:{label:"品牌",prop:"brand"}},[i("Select",{staticClass:"fixed-width-input",attrs:{placeholder:"搜索品牌名",filterable:"",clearable:""},on:{"on-change":t.changeBrandOrCategory},model:{value:t.group.brand,callback:function(e){t.$set(t.group,"brand",e)},expression:"group.brand"}},t._l(t.brandOptions,function(e){return i("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1)],1):i("Form-item",{key:"goods-input",attrs:{label:"置顶Goods_ID",prop:"extra"}},[i("Input",{attrs:{type:"textarea",rows:10,placeholder:"英文逗号隔开"},model:{value:t.group.extra,callback:function(e){t.$set(t.group,"extra",e)},expression:"group.extra"}})],1)],1)],1)],1)],1)],1)])},staticRenderFns:[]}},Fvdt:function(t,e,i){var a=i("u4lv");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i("rjj0")("e9a5f42a",a,!0)},Ge1b:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"HeaderItem",props:{group:{type:Object,default:function(){return{}}},item:{type:Object,default:function(){return{}}}},data:function(){return{formRef:"headerItemForm",validateRules:{name:[{type:"string",required:!0,message:"不能为空",trigger:"blur"}],description:[{type:"string",max:100,message:"不能多于100个字符",trigger:"blur"}],route:[{type:"string",max:1e3,message:"不能多于1000个字符",trigger:"change"}],image:[{type:"string",required:!0,message:"不能为空",trigger:"change"}]}}},computed:{switch:function(){return this.item.switch}},methods:{handleSelectRoute:function(t){this.item.route=t},handleUploadSuccess:function(t){this.item.ratio=(t[0].width/t[0].height).toFixed(4),this.item.image=t[0].url,this.group.ratio=(750/t[0].height).toFixed(4)}},watch:{switch:function(){this.item.switch?bus.$emit("need-validate"):bus.$emit("decrease-validate-num")}},created:function(){var t=this;this.item.image&&null!==this.item.image.origin&&void 0!==this.item.image.origin&&(this.item.image=this.item.image.origin),bus.$on("validate-form",function(){t.$refs[t.formRef]&&t.$refs[t.formRef].validate(function(t){t?bus.$emit("validate-pass"):bus.$emit("alert-error-tips","有必填项尚未填写或填写错误，请完善")})})}}},VvqN:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("//kS"),o=i.n(a);e.default={name:"HomeAdTab",components:{TabGroup:o.a},data:function(){return{hasTabGroup:!0,homeAdvertising:{},tabGroups:[],homeAdvertisingApi:{api:{path:"/boss/mall/advertising/home/"+this.$route.params.id,params:{fields:"{id,module,page,position,name,start_time,end_time,state,audience,audience_name,version_no,background,groups{id,name,type,state,ratio,color,route,orders,start_time,end_time,extra,items{id,name,description,route,image{origin},ratio,orders,goods_id,color,state,extra,type,switch,background{origin}}}}"}}},brandListApi:{api:{path:"/boss/mall/catalog/basic-brand/list",params:{status:1,offset:0,limit:9999,fields:"{id,name}"}}},categoryListApi:{api:{path:"/boss/mall/catalog/basic-category/list",params:{status:[1],level:3,offset:0,limit:9999,fields:"{id,name}"}}},categoryOptions:[],brandOptions:[],loadTotal:3,loadedNum:0,validateTotal:0,validatePassNum:0,submitApi:{api:{path:"/boss/mall/advertising/home/update"}},canSubmit:!0}},computed:{startTime:function(){return this.homeAdvertising.start_time?this.$Util.dateFormat(this.homeAdvertising.start_time,"yyyy-MM-dd hh:mm:ss"):""},endTime:function(){return this.homeAdvertising.end_time?this.$Util.dateFormat(this.homeAdvertising.end_time,"yyyy-MM-dd hh:mm:ss"):""},canAddTabGroup:function(){return this.tabGroups.length<9}},methods:{alertErrorTips:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;this.$Modal.error({width:e,content:t})},loadHomeAdvertising:function(){var t=this;this.$Util.api.get(this.homeAdvertisingApi,this).then(function(e){if(t.loadedNum+=1,"home"===e.data.page&&"home"===e.data.position){for(var i=e.data,a=[],o=0;o<i.groups.length;o++)if("mall_home_tab"===i.groups[o].type){var r=i.groups[o].route,s=r.match(/brand_id=(\d+)/),n=r.match(/category_id=(\d+)/);s&&s[1]||n&&n[1]?(i.groups[o].brand=s&&s[1]?parseInt(s[1]):null,i.groups[o].category=n&&n[1]?parseInt(n[1]):null,i.groups[o].type="brand_id"):i.groups[o].type="goods_id",t.tabGroups.push(i.groups[o])}else a.push(i.groups[o]);if(i.groups=a,t.homeAdvertising=i,t.tabGroups.length<1)for(var u=0;u<5;u++)t.tabGroups.push({type:"brand_id",name:"",route:"",extra:"",items:[{switch:!1,name:"",description:"",route:"",image:""}]})}else t.alertErrorTips("非法数据")},function(e){t.loadedNum+=1,t.alertErrorTips(e.message?e.message:"发生了未知的错误")})},loadCategoryOptions:function(){var t=this;this.$Util.api.get(this.categoryListApi,this).then(function(e){t.loadedNum+=1,0===e.error_code&&(t.categoryOptions=e.data)},function(e){t.loadedNum+=1})},loadBrandOptions:function(){var t=this;this.$Util.api.get(this.brandListApi,this).then(function(e){t.loadedNum+=1,0===e.error_code&&(t.brandOptions=e.data)},function(e){t.loadedNum+=1})},addGroup:function(t){this.tabGroups.splice(t,0,{type:"brand_id",name:"",route:"",extra:"",items:[{switch:!1,name:"",description:"",route:"",image:""}]})},removeGroup:function(t){var e=this;this.$Modal.confirm({width:250,content:"确认删除？",onOk:function(){e.tabGroups.splice(t,1)}})},moveGroup:function(t,e){if(e>=0&&e<this.tabGroups.length){var i=this.tabGroups[t];this.tabGroups.splice(t,1,this.tabGroups[e]),this.tabGroups.splice(e,1,i)}},submit:function(){this.validatePassNum=0,this.hasTabGroup?bus.$emit("validate-form"):this.doSubmit()},doSubmit:function(){for(var t=this,e=this.homeAdvertising.groups,i=0;i<e.length;i++)if(0===e[i].start_time&&(e[i].start_time=null),0===e[i].end_time&&(e[i].end_time=null),-1!==["line","home_banner","M_S3","order_count","home_category_nav","home_flash_sales","home_special_nav","home_coupon"].indexOf(e[i].type)&&delete e[i].items,e[i].items)for(var a=e[i].items,o=0;o<a.length;o++)!a[o].image||null===a[o].image.origin&&void 0===a[o].image.origin?e[i].items[o].image="":e[i].items[o].image=a[o].image.origin,!a[o].background||null===a[o].background.origin&&void 0===a[o].background.origin?e[i].items[o].background="":e[i].items[o].background=a[o].background.origin,0===a[o].goods_id&&(e[i].items[o].goods_id=null);else e[i].items=[];this.hasTabGroup&&this.tabGroups.forEach(function(e){t.homeAdvertising.groups.push({type:"mall_home_tab",name:e.name,route:"brand_id"===e.type&&e.route?e.route:"",extra:"goods_id"===e.type&&e.extra?e.extra:"",ratio:e.ratio?e.ratio:1,items:[{switch:e.items[0].switch?1:0,name:e.items[0].name?e.items[0].name:"",description:e.items[0].description?e.items[0].description:"",route:e.items[0].route?e.items[0].route:"",image:e.items[0].image?e.items[0].image:"",ratio:e.items[0].ratio?e.items[0].ratio:1}]})}),bus.$emit("on-loading"),this.$Util.api.post(this.submitApi,this.homeAdvertising,this).then(function(e){bus.$emit("on-loading"),0===e.error_code?t.$Modal.success({width:250,content:"提交成功",onOk:function(){location.reload()}}):t.alertErrorTips(e.error_description?e.error_description:"提交失败")},function(e){bus.$emit("on-loading"),t.alertErrorTips(e.message?e.message:"提交失败")})}},watch:{loadedNum:function(){this.loadedNum>=this.loadTotal&&(bus.$emit("on-loading"),this.loadedNum=0)}},created:function(){var t=this;this.$nextTick(function(){bus.$emit("on-loading")}),this.loadHomeAdvertising(),this.loadCategoryOptions(),this.loadBrandOptions(),bus.$on("alert-error-tips",function(e,i){return t.alertErrorTips(e,i)}),bus.$on("add-group",function(e){return t.addGroup(e)}),bus.$on("remove-group",function(e){return t.removeGroup(e)}),bus.$on("move-group",function(e,i){return t.moveGroup(e,i)}),bus.$on("need-validate",function(){t.validateTotal+=1}),bus.$on("validate-pass",function(){t.validatePassNum+=1,t.validatePassNum>=t.validateTotal&&t.canSubmit&&(t.canSubmit=!1,t.doSubmit(),setTimeout(function(){t.canSubmit=!0},1e3))}),bus.$on("decrease-validate-num",function(){t.validateTotal-=1})},beforeDestroy:function(){bus.$off("add-group"),bus.$off("remove-group"),bus.$off("move-group"),bus.$off("validate-form"),bus.$off("need-validate"),bus.$off("validate-pass"),bus.$off("decrease-validate-num")}}},cGEz:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("q0/2"),o=i.n(a);e.default={name:"TabGroup",components:{HeaderItem:o.a},props:{position:{type:Number,default:0},groups:{type:Array,default:function(){return[]}},group:{type:Object,default:function(){return{}}},canAddTabGroup:{type:Boolean},categoryOptions:{type:Array,default:function(){return[]}},brandOptions:{type:Array,default:function(){return[]}}},data:function(){var t=this,e=function(e,i,a){if(!(void 0!==t.group.brand&&null!==t.group.brand&&""!==t.group.brand||void 0!==t.group.category&&null!==t.group.category&&""!==t.group.category))return a(new Error("品牌/品类必须任填其一"));a()};return{formRef:"TabGroupForm",validateRules:{name:[{type:"string",required:!0,message:"不能为空",trigger:"blur"},{validator:function(t,e,i){if(e.replace(/[\u0391-\uFFE5]/g,"aa").length>10)return i(new Error("限制10个字符，中文算2字符，英文数字算1字符"));i()},trigger:"blur"}],type:[{required:!0,message:""}],extra:[{type:"string",required:!0,message:"不能为空",trigger:"blur"},{type:"string",max:5e4,message:"不能多于50000个字符",trigger:"blur"}],category:[{validator:e,trigger:"blur"}],brand:[{validator:e,trigger:"blur"}]}}},computed:{canRemoveTabGroup:function(){return this.groups.length>5}},methods:{addGroup:function(){bus.$emit("add-group",this.position+1)},removeGroup:function(){bus.$emit("remove-group",this.position)},moveGroup:function(t,e){bus.$emit("move-group",t,e)},changeBrandOrCategory:function(){this.group.brand&&this.group.category?this.group.route="meijiabang://goods_list?attrs.category_id="+this.group.category+"&attrs.brand_id="+this.group.brand:this.group.brand&&!this.group.category?this.group.route="meijiabang://goods_list?attrs.brand_id="+this.group.brand:!this.group.brand&&this.group.category&&(this.group.route="meijiabang://goods_list?attrs.category_id="+this.group.category)}},created:function(){var t=this;bus.$emit("need-validate"),bus.$on("validate-form",function(){t.$refs[t.formRef]&&t.$refs[t.formRef].validate(function(t){t?bus.$emit("validate-pass"):bus.$emit("alert-error-tips","有必填项尚未填写或填写错误，请完善")})})},beforeDestroy:function(){bus.$emit("decrease-validate-num")}}},"f/9V":function(t,e,i){var a=i("vrCn");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i("rjj0")("630f5050",a,!0)},hnDl:function(t,e,i){i("f/9V");var a=i("VU/8")(i("VvqN"),i("x2xV"),"data-v-7915d272",null);t.exports=a.exports},"q0/2":function(t,e,i){i("Fvdt");var a=i("VU/8")(i("Ge1b"),i("3nhj"),"data-v-31668036",null);t.exports=a.exports},rC88:function(t,e,i){e=t.exports=i(0)(),e.push([t.i,".ivu-form-item[data-v-27ff2abc]:not(:last-child):not(:first-child){margin-bottom:24px}.fixed-width-input[data-v-27ff2abc]{display:inline-block;max-width:300px}.input-tips[data-v-27ff2abc]{margin-left:10px;font-size:12px;color:#9ea7b4}.item-card[data-v-27ff2abc]{background-color:#f2f2f2}.tightness-form-item[data-v-27ff2abc]{margin-top:0!important;margin-bottom:5px!important}",""])},u4lv:function(t,e,i){e=t.exports=i(0)(),e.push([t.i,".img-ratio-tips[data-v-31668036],.input-tips[data-v-31668036]{font-size:12px;color:#9ea7b4}.ivu-form-item[data-v-31668036]:not(:last-child):not(:first-child){margin-bottom:24px}.fixed-width-input[data-v-31668036]{display:inline-block;max-width:300px}.input-tips[data-v-31668036]{margin-left:10px}.item-card[data-v-31668036]{background-color:#f2f2f2}",""])},vrCn:function(t,e,i){e=t.exports=i(0)(),e.push([t.i,".ivu-card[data-v-7915d272]{margin-bottom:15px}.top[data-v-7915d272]{padding:10px;background:rgba(0,153,229,.7);color:#fff;text-align:center;border-radius:2px}",""])},x2xV:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page",[i("Card",[i("Row",[i("i-col",{attrs:{span:"2"}},[i("strong",[t._v("ID： "+t._s(t.homeAdvertising.id))])]),t._v(" "),i("i-col",{attrs:{span:"4"}},[i("strong",[t._v("页面标题： "+t._s(t.homeAdvertising.name))])]),t._v(" "),i("i-col",{attrs:{span:"4"}},[i("strong",[t._v("展示人群： "+t._s(t.homeAdvertising.audience_name))])]),t._v(" "),i("i-col",{attrs:{span:"8"}},[i("strong",[t._v("展示时段： "+t._s(t.startTime)+" ~ "+t._s(t.endTime))])])],1),t._v(" "),i("Row",[i("i-col",[t._v(" ")])],1),t._v(" "),i("Row",{attrs:{type:"flex",justify:"space-between"}},[i("i-col",{attrs:{span:"4"}},[i("strong",[t._v("顶部Tab栏")]),t._v(" "),i("i-switch",{model:{value:t.hasTabGroup,callback:function(e){t.hasTabGroup=e},expression:"hasTabGroup"}})],1),t._v(" "),i("i-col",{attrs:{span:"2"}},[i("Button",{attrs:{type:"primary",long:""},on:{click:t.submit}},[t._v("提交")])],1)],1)],1),t._v(" "),i("Card",{directives:[{name:"show",rawName:"v-show",value:t.hasTabGroup,expression:"hasTabGroup"}]},[i("Row",{attrs:{type:"flex",justify:"space-between"}},[i("i-col",{attrs:{span:"4"}},[i("strong",[t._v("Tab1 精选")])]),t._v(" "),i("i-col",{attrs:{span:"2"}},[i("Button",{directives:[{name:"show",rawName:"v-show",value:t.canAddTabGroup,expression:"canAddTabGroup"}],attrs:{type:"success",long:""},on:{click:function(e){t.addGroup(0)}}},[t._v("\n                    添加Tab\n                ")])],1)],1)],1),t._v(" "),t._l(t.tabGroups,function(e,a){return i("div",{directives:[{name:"show",rawName:"v-show",value:t.hasTabGroup,expression:"hasTabGroup"}],key:a},[i("tab-group",{attrs:{position:a,group:e,groups:t.tabGroups,canAddTabGroup:t.canAddTabGroup,categoryOptions:t.categoryOptions,brandOptions:t.brandOptions},on:{"update:group":function(t){e=t},"update:groups":function(e){t.tabGroups=e}}})],1)}),t._v(" "),i("Back-top",{attrs:{height:100,bottom:100}},[i("div",{staticClass:"top"},[t._v("返回顶端")])])],2)},staticRenderFns:[]}}});