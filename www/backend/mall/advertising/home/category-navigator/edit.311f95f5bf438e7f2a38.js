webpackJsonp([33],{"08nI":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("fbGG"),r=a.n(i),n=a("dsgi"),o=a.n(n),s={create:{api:{path:"/boss/mall/advertising/home/category-navigator/create"}},update:{api:{path:"/boss/mall/advertising/home/category-navigator/update"}},find:{api:{path:"/boss/mall/advertising/home/category-navigator/find",params:{fields:"{id,name,position,audience,groups{id,type,state,color,route,orders,ratio,background{origin},items{id,name,description,route,image{origin},ratio,orders,goods_id,color}}}",id:0}},responseHandle:function(t){for(var e in t.data.groups)for(var a in t.data.groups[e].items)t.data.groups[e].items[a].image=t.data.groups[e].items[a].image.origin;return t}}};e.default={name:"MCategoryNavigatorForm",components:{MCategoryNavigatorSettings:r.a,MCategoryNavigatorGroupSettings:o.a},props:{id:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{showLessNavigatorGroupsBtn:!1,can_submit:!0,base_info:{id:"",name:"",audience:""},group:{background:"",ratio:1},items:[{},{},{},{},{}]}},computed:{itemChunks:function(){var t=[];return this.items.forEach(function(e,a){a%2==0&&t.push([]),t[t.length-1].push(e)}),t}},methods:{showMoreGroups:function(){this.showLessNavigatorGroupsBtn=!0;for(var t=0;t<5;t++)this.items.push({})},showLessGroups:function(){this.showLessNavigatorGroupsBtn=!1,this.items.splice(5,5)},preventSubmit:function(){this.can_submit=!1},submit:function(){if(this.can_submit){bus.$emit("on-loading");var t=this.getRequestParams();this.validateSubmit(t),this.submitRequest(t)}},validateSubmit:function(t){},getRequestParams:function(){var t={};t.id=this.base_info.id,t.name=this.base_info.name,t.audience="no_tag"===this.base_info.audience?"":this.base_info.audience;var e={type:"navigation",background:this.group.background,ratio:this.group.ratio,items:JSON.parse(JSON.stringify(this.items))};return t.groups=[],t.groups.push(e),t.module="mall",t.page="home",t.position="category_nav",t.start_time=0,t.end_time=1577836800,t},submitRequest:function(t){var e={};e="edit"===this.usage?s.update:s.create;var a=this;this.$Util.api.post(e,t,a).then(function(t){bus.$emit("on-loading"),this.$Message.success("提交成功!"),location.hash="/mall/advertising/home/category-navigator/list"},function(t){return bus.$emit("on-loading"),this.$Message.warning(t.error_description),!1})},loadEditFormData:function(t){s.find.api.params.id=t;var e=this;this.$Util.api.get(s.find,this).then(function(t){if(!t.data)return e.$Message.warning("不存在或数据有误"),!1;e.base_info.id=t.data.id,e.base_info.name=t.data.name,e.base_info.audience=""===t.data.audience?"no_tag":t.data.audience,e.group.background=t.data.groups[0].background&&t.data.groups[0].background.origin?t.data.groups[0].background.origin:"",e.group.ratio=t.data.groups[0].ratio,e.items=t.data.groups[0].items,10===e.items.length?e.showLessNavigatorGroupsBtn=!0:e.showLessNavigatorGroupsBtn=!1,bus.$emit("on-loading")},function(t){bus.$emit("on-loading"),e.back()})}},created:function(){var t=this,e=this;this.$nextTick(function(){if(bus.$on("prevent-submit",function(){return e.preventSubmit()}),bus.$on("category-navigator-submit",function(){return e.submit()}),"edit"===e.usage){bus.$emit("on-loading");var a=e.id;if(e.base_info.id=a,!parseInt(e.base_info.id))return alert("id格式有误"),!1;t.loadEditFormData(a)}})},beforeDestroy:function(){bus.$off("category-navigator-submit")}}},"3QmN":function(t,e,a){e=t.exports=a(0)(),e.push([t.i,".icon-settings-card[data-v-dc3b5fa0]{max-width:400px;background-color:#f2f2f2}.A5-first[data-v-dc3b5fa0]{max-width:400px;background-color:#cff}.ivu-form-item[data-v-dc3b5fa0]:not(:last-child){margin-bottom:24px}.fixed-width-input[data-v-dc3b5fa0]{display:inline-block;width:200px}.input-tips[data-v-dc3b5fa0]{margin-left:10px;font-size:12px;color:#9ea7b4}",""])},"5G9L":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("m-page",[a("Card",[a("m-category-navigator-settings",{attrs:{usage:t.usage,base_info:t.base_info,id:t.id,group:t.group},on:{"update:group":function(e){t.group=e}}})],1),t._v(" "),a("Card",[t.showLessNavigatorGroupsBtn?a("Button",{attrs:{type:"primary"},on:{click:t.showLessGroups}},[t._v("设置5个商品组")]):t._e(),t._v(" "),t.showLessNavigatorGroupsBtn?t._e():a("Button",{attrs:{type:"primary"},on:{click:t.showMoreGroups}},[t._v("设置10个商品组")]),t._v(" "),a("section",t._l(t.itemChunks,function(e,i){return a("Row",t._l(e,function(t,e){return a("Col",{attrs:{span:"8",offset:e?1:0}},[a("m-category-navigator-group-settings",{attrs:{item:t},on:{"update:item":function(e){t=e}}})],1)}))}))],1)],1)},staticRenderFns:[]}},AmEh:function(t,e,a){var i=a("VU/8")(a("rQHa"),a("GuWs"),null,null);t.exports=i.exports},DhtQ:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={resource:{api:{path:"/boss/mall/advertising/home/tag-group-info"}}};e.default={name:"MIndexBaseSettings",props:{id:{type:String,default:""},usage:{type:String,default:"edit"},base_info:{id:"",name:"",audience:""},group:{type:Object,default:function(){return{background:"",ratio:1}}}},data:function(){return{ref:"baseForm",searchTypeSource:{},validateRules:{name:[{required:!0,message:"策略标题不能为空",trigger:"blur"}],audience:[{required:!0,message:"展示人群不能为空",trigger:"blur"}]}}},methods:{loadResource:function(){var t=this;this.$Util.api.get(i.resource,t).then(function(e){"edit"!==t.usage&&bus.$emit("on-loading"),e.data.unshift({audience:"no_tag",title:"不限"}),t.searchTypeSource=e.data},function(e){"edit"!==t.usage&&bus.$emit("on-loading"),t.$Message.warning("加载资源失败")})},submit:function(){var t=this;this.$refs[this.ref].validate(function(e){e||(bus.$emit("prevent-submit"),t.$Message.error("表单验证失败!"))}),bus.$emit("validate"),setTimeout(function(){bus.$emit("category-navigator-submit")},500)},handleUploadSuccess:function(t){this.group.background=t[0].url,this.group.ratio=(t[0].width/t[0].height).toFixed(4)}},created:function(){this.$nextTick(function(){"edit"!==this.usage&&bus.$emit("on-loading"),this.loadResource()})},beforeDestroy:function(){bus.$off("validate")}}},Fand:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"MIconSettings",props:{iconSettingsCardClass:{default:"icon-settings-card"},item:{type:Object,default:function(){return{name:"",route:"",image:{url:null}}}}},data:function(){return{ref:"itemForm",validateRules:{name:[{required:!0,message:"名字不能为空",trigger:"blur"}],route:[{required:!0,message:"路由不能为空",trigger:"blur"}],image:[{required:!0,message:"图片不能为空",trigger:"blur"}]}}},methods:{handleSelectRoute:function(t){this.item.route=t},handleUploadSuccessImage:function(t){this.item.image=t[0].url}},created:function(){var t=this;this.$nextTick(function(){bus.$on("validate",function(){t.$refs[t.ref].validate(function(e){e||(bus.$emit("prevent-submit"),t.$Message.error("表单验证失败!"))})})})},beforeDestroy:function(){bus.$off("validate")}}},GuWs:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("m-page",[a("m-category-navigator-form",{attrs:{usage:"edit",id:t.id}})],1)},staticRenderFns:[]}},"K+C9":function(t,e,a){var i=a("3QmN");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("416d6bf3",i,!0)},VYVP:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{class:t.iconSettingsCardClass},[a("Form",{ref:t.ref,attrs:{model:t.item,rules:t.validateRules,"label-width":50}},[a("Form-item",{attrs:{label:"标题",prop:"name"}},[a("Input",{staticClass:"fixed-width-input",attrs:{placeholder:"请输入标题"},model:{value:t.item.name,callback:function(e){t.$set(t.item,"name",e)},expression:"item.name"}})],1),t._v(" "),a("Form-item",{attrs:{label:"路由",prop:"route"}},[a("m-app-route",{attrs:{placeholder:"输入路由","default-route":t.item.route},on:{"on-ok":t.handleSelectRoute}})],1),t._v(" "),a("Form-item",{attrs:{label:"图片",prop:"image"}},[a("m-upload-image",{attrs:{"default-images":[{url:t.item.image}]},on:{"on-success":t.handleUploadSuccessImage}})],1)],1)],1)},staticRenderFns:[]}},Xfap:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{attrs:{bordered:!1}},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("基本信息")]),t._v(" "),a("Button",{attrs:{slot:"extra",type:"primary"},on:{click:t.submit},slot:"extra"},[t._v("提交")]),t._v(" "),a("section",[a("Form",{ref:t.ref,attrs:{model:t.base_info,rules:t.validateRules,"label-width":80}},[a("Form-item",{attrs:{label:"ID"}},[a("span",[t._v(t._s(t.base_info.id))])]),t._v(" "),a("Form-item",{attrs:{label:"策略标题",prop:"name"}},[a("Input",{attrs:{placeholder:"请输入策略标题"},model:{value:t.base_info.name,callback:function(e){t.$set(t.base_info,"name",e)},expression:"base_info.name"}})],1),t._v(" "),a("Form-item",{attrs:{label:"展示人群",prop:"audience"}},[a("Select",{attrs:{placeholder:"请选择"},model:{value:t.base_info.audience,callback:function(e){t.$set(t.base_info,"audience",e)},expression:"base_info.audience"}},t._l(t.searchTypeSource,function(e,i){return a("Option",{attrs:{value:e.audience}},[t._v(t._s(e.title))])}))],1),t._v(" "),a("Form-item",{attrs:{label:"背景图",prop:"background"}},[a("m-upload-image",{attrs:{"default-images":[{url:t.group.background}]},on:{"on-success":t.handleUploadSuccess}}),t._v(" "),t.group.ratio?a("span",{staticClass:"img-ratio-tips"},[t._v("长宽比"+t._s(t.group.ratio))]):t._e()],1)],1)],1)],1)},staticRenderFns:[]}},dsgi:function(t,e,a){a("K+C9");var i=a("VU/8")(a("Fand"),a("VYVP"),"data-v-dc3b5fa0",null);t.exports=i.exports},fbGG:function(t,e,a){var i=a("VU/8")(a("DhtQ"),a("Xfap"),null,null);t.exports=i.exports},ksWg:function(t,e,a){var i=a("VU/8")(a("08nI"),a("5G9L"),null,null);t.exports=i.exports},rQHa:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("ksWg"),r=a.n(i);e.default={name:"app",components:{MCategoryNavigatorForm:r.a},data:function(){return{id:this.$route.params.id}}}}});