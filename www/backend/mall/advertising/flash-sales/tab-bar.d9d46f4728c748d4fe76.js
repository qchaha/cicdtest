webpackJsonp([37],{"6jtb":function(t,e,a){var i=a("cBay");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("46d669fc",i,!0)},EBbQ:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("HJaM"),o=a.n(i),n={find:{api:{path:"/boss/mall/advertising/flash-sales/tab-bar-info",params:{fields:"{name,image{url,origin},extra,route}"}}},update:{api:{path:"/boss/mall/advertising/flash-sales/update-tab-bar"}}},s={name:"",image_before_click:"",image_after_click:"",route:"",ratio_of_image_before_click:0,ratio_of_image_after_click:0,start_validate_all_fields:!1,validate_pass:!1};e.default={name:"MA3Settings",components:{MIconSettings:o.a},data:function(){return{groups:[JSON.parse(JSON.stringify(s)),JSON.parse(JSON.stringify(s))]}},computed:{groupChunks:function(){var t=[];return this.groups.forEach(function(e,a){a%2==0&&t.push([]),t[t.length-1].push(e)}),t},add_icon_disabled:function(){return this.groups.length>=5},delete_icon_disabled:function(){return this.groups.length<=2}},methods:{addIcon:function(){if(this.groups.length<5){var t=JSON.parse(JSON.stringify(s));this.groups.splice(this.groups.length,0,t)}else this.$Message.warning("不能添加多于5个icon")},removeIcon:function(t){t>=0&&this.groups.length>=3?this.groups.splice(t,1):this.$Message.warning("不能删除少于2个icon")},validateForm:function(){bus.$emit("on-loading"),this.beforeValidate(),setTimeout(this.onValidate(),1e3)},submit:function(){var t=this.getRequestParams();this.submitRequest(t)},beforeValidate:function(){bus.$emit("start-validate")},onValidate:function(){var t=0;if(this.groups.forEach(function(e,a){e.validate_pass||t++}),t>0)return bus.$emit("on-loading"),this.$Message.warning("有"+t+"个表单项填写违规，请修正"),!1;bus.$emit("validate-success")},validateFormData:function(){this.groups.forEach(function(t,e){t.start_validate_all_fields=!0})},getRequestParams:function(){var t={};return t.groups=JSON.parse(JSON.stringify(this.groups)),t},submitRequest:function(t){var e=this;this.$Util.api.post(n.update,t,e).then(function(){location.reload()},function(t){bus.$emit("on-loading")})},initialData:function(){var t=this;bus.$emit("on-loading"),this.$Util.api.get(n.find,this).then(function(e){bus.$emit("on-loading"),e.data.length>0?(t.groups=[],e.data.forEach(function(e,a){var i=JSON.parse(JSON.stringify(s));i.name=e.name,i.route=e.route,i.image_before_click=e.image.origin,i.image_after_click=e.extra,t.groups.push(i)})):t.addCoin()},function(e){t.alertErrorTips(e.message?e.message:"发生了未知的错误",300)})}},created:function(){var t=this;this.$nextTick(function(){t.initialData(),bus.$on("remove-icon",function(e){return t.removeIcon(e)}),bus.$on("validate-success",function(){return t.submit()})})}}},FusK:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"MIconSettings",props:{iconSettingsCardClass:{type:String,default:"icon-settings-card"},position:{type:Number,default:0},disabled:{type:Boolean,default:!1},icon:{type:Object,default:function(){return{name:"",image_before_click:"",image_after_click:"",route:"",ratio_of_image_before_click:0,ratio_of_image_after_click:0,start_validate_all_fields:!1,validate_pass:!1}}}},data:function(){var t=function(t,e,a){if(e>0){var i=1e3*parseFloat(e).toFixed(3);Math.abs(i-1e3)>0?a(new Error("长宽比不等于1")):a()}else a()};return{formRef:"icon",validateRules:{name:[{required:!0,message:"标题不能为空",trigger:"blur"},{type:"string",max:4,message:"标题不能多于4个字符",trigger:"blur"}],image_before_click:[{required:!0,message:"点击前的图片不能为空",trigger:"blur"}],image_after_click:[{required:!0,message:"点击后的图片不能为空",trigger:"blur"}],ratio_of_image_before_click:[{validator:t}],ratio_of_image_after_click:[{validator:t}],route:[{required:!0,message:"路由不能为空"}]}}},methods:{handleSelectRoute:function(t){this.icon.route=t},handleUploadSuccessImagesBeforeClick:function(t){this.icon.image_before_click=t.length>0?t[0].url:"";var e=t.length>0?(t[0].width/t[0].height).toFixed(4):0;this.icon.ratio_of_image_before_click=isNaN(e)?0:e},handleUploadSuccessImagesAfterClick:function(t){this.icon.image_after_click=t.length>0?t[0].url:"";var e=t.length>0?(t[0].width/t[0].height).toFixed(4):0;this.icon.ratio_of_image_after_click=isNaN(e)?0:e},removeItem:function(t){t>=0&&bus.$emit("remove-icon",t)}},created:function(){var t=this,e=this;this.$nextTick(function(){bus.$on("start-validate",function(){t.$refs[e.formRef]&&t.$refs[e.formRef].validate(function(e){t.icon.validate_pass=!!e,t.icon.start_validate_all_fields=!1})})})}}},GMGJ:function(t,e,a){var i=a("VU/8")(a("Ms7U"),a("pOqz"),null,null);t.exports=i.exports},HJaM:function(t,e,a){a("6jtb");var i=a("VU/8")(a("FusK"),a("R2Bf"),"data-v-2c2a9aea",null);t.exports=i.exports},IScW:function(t,e,a){a("lgyg");var i=a("VU/8")(a("EBbQ"),a("gBjc"),"data-v-98a8e41e",null);t.exports=i.exports},Ms7U:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("IScW"),o=a.n(i);e.default={name:"app",components:{MTabBarSettings:o.a},data:function(){return{}},methods:{submit:function(){}},created:function(){var t=this;this.$nextTick(function(){bus.$on("submit",function(){return t.submit()})})}}},Nosy:function(t,e,a){e=t.exports=a(0)(),e.push([t.i,".ivu-row[data-v-98a8e41e]:not(:last-child){margin-bottom:20px}",""])},R2Bf:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{class:t.iconSettingsCardClass},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("Icon"+t._s(t.position+1))]),t._v(" "),a("section",{attrs:{slot:"extra"},slot:"extra"},[a("Button",{staticClass:"info-ghost-btn",attrs:{type:"ghost",disabled:t.disabled},on:{click:function(e){t.removeItem(t.position)}}},[t._v("\n            删除\n        ")])],1),t._v(" "),a("Form",{ref:t.formRef,attrs:{model:t.icon,rules:t.validateRules,"label-width":50}},[a("Form-item",{attrs:{label:"标题",prop:"name"}},[a("Input",{staticClass:"fixed-width-input",attrs:{placeholder:"请输入标题"},model:{value:t.icon.name,callback:function(e){t.$set(t.icon,"name",e)},expression:"icon.name"}}),t._v(" "),a("span",{staticClass:"input-tips"},[t._v("不超过4个字")])],1),t._v(" "),a("Form-item",{attrs:{label:"点击前的图片"}},[a("Form-item",{attrs:{prop:"image_before_click"}},[a("m-upload-image",{attrs:{"default-images":[{url:t.icon.image_before_click}]},on:{"on-success":t.handleUploadSuccessImagesBeforeClick}})],1),t._v(" "),a("Form-item",{attrs:{prop:"ratio_of_image_before_click"}},[t.icon.ratio_of_image_before_click?a("span",{staticClass:"img-ratio-tips"},[t._v("长宽比"+t._s(t.icon.ratio_of_image_before_click))]):t._e()])],1),t._v(" "),a("Form-item",{attrs:{label:"点击后的图片"}},[a("Form-item",{attrs:{prop:"image_after_click"}},[a("m-upload-image",{attrs:{"default-images":[{url:t.icon.image_after_click}]},on:{"on-success":t.handleUploadSuccessImagesAfterClick}})],1),t._v(" "),a("Form-item",{attrs:{prop:"ratio_of_image_after_click"}},[t.icon.ratio_of_image_after_click?a("span",{staticClass:"img-ratio-tips"},[t._v("长宽比"+t._s(t.icon.ratio_of_image_after_click))]):t._e()])],1),t._v(" "),a("Form-item",{attrs:{label:"路由",prop:"route"}},[a("m-app-route",{attrs:{placeholder:"输入路由","default-route":t.icon.route},on:{"on-ok":t.handleSelectRoute}})],1)],1)],1)},staticRenderFns:[]}},cBay:function(t,e,a){e=t.exports=a(0)(),e.push([t.i,".img-ratio-tips[data-v-2c2a9aea],.input-tips[data-v-2c2a9aea]{font-size:12px;color:#9ea7b4}.icon-settings-card[data-v-2c2a9aea]{max-width:400px;background-color:#f2f2f2}.A5-first[data-v-2c2a9aea]{max-width:400px;background-color:#cff}.ivu-form-item[data-v-2c2a9aea]:not(:last-child){margin-bottom:24px}.fixed-width-input[data-v-2c2a9aea]{display:inline-block;width:200px}.input-tips[data-v-2c2a9aea]{margin-left:10px}",""])},gBjc:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",[a("section",{attrs:{slot:"extra"},slot:"extra"},[a("Button",{staticClass:"addIcon",attrs:{slot:"extra",type:"primary",disabled:t.add_icon_disabled},on:{click:t.addIcon},slot:"extra"},[t._v("添加Icon\n        ")]),t._v(" "),a("Button",{attrs:{slot:"extra",type:"primary"},on:{click:t.validateForm},slot:"extra"},[t._v("提交\n        ")])],1),t._v(" "),a("br"),t._v(" "),a("br"),t._v(" "),a("section",t._l(t.groupChunks,function(e,i){return a("Row",t._l(e,function(e,o){return a("Col",{attrs:{span:"8",offset:o?1:0}},[a("m-icon-settings",{attrs:{position:2*i+o,disabled:t.delete_icon_disabled,icon:e},on:{"update:icon":function(t){e=t}}})],1)}))}))])},staticRenderFns:[]}},lgyg:function(t,e,a){var i=a("Nosy");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("481828fe",i,!0)},pOqz:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("m-page",[a("m-tab-bar-settings")],1)},staticRenderFns:[]}}});