webpackJsonp([223],{Jpbk:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i("Edfu"),a=i.n(r),o={find:{api:{path:"/boss/mall/advertising/order-list/notice",params:{fields:"{start_time,end_time,groups{items}}"}},responseHandle:function(t,e){var i=new Date;i.setTime(1e3*t.data.start_time),t.data.start_time=i;var r=new Date;return r.setTime(1e3*t.data.end_time),t.data.end_time=r,t}},update:{api:{path:"/boss/mall/advertising/order-list/update-notice"}}};e.default={components:{MPage:a.a},name:"MOrderListNotice",data:function(){return{formItem:{start_time:0,end_time:0,description:"",route:""},ruleValidate:{start_time:[{required:!0,message:"开始时间不能为空",trigger:"blur",type:"date"}],end_time:[{required:!0,message:"结束时间不能为空",trigger:"blur",type:"date"}],description:[{required:!0,message:"通告文本不能为空",trigger:"blur"}]}}},methods:{handleSelectRoute:function(t){this.formItem.route=t},handleSubmit:function(t){var e=this;this.$refs[t].validate(function(t){if(t){if(!e.validateFormData())return;var i=e.getRequestParams();e.submitRequest(i)}else e.$Message.error("表单验证失败!")})},validateFormData:function(){return this.formItem.description.length>100?(this.$Notice.warning({title:"通告文本不可超过100字符",desc:""}),!1):!(this.formItem.start_time>=this.formItem.end_time)||(this.$Notice.warning({title:"开始时间必须小于结束时间",desc:""}),!1)},getRequestParams:function(){var t={};return t.start_time=this.formItem.start_time.getTime()/1e3,t.end_time=this.formItem.end_time.getTime()/1e3,t.description=this.formItem.description,t.route=this.formItem.route,t},submitRequest:function(t){bus.$emit("on-loading");var e=this;this.$Util.api.post(o.update,t,e).then(function(){bus.$emit("on-loading"),location.reload()},function(t){return bus.$emit("on-loading"),this.$Message.warning(t.error_description),!1})},initialData:function(){bus.$emit("on-loading");var t=this;this.$Util.api.get(o.find,t).then(function(e){bus.$emit("on-loading"),e&&(t.formItem.start_time=void 0===e.data.start_time?"":e.data.start_time,t.formItem.end_time=void 0===e.data.end_time?"":e.data.end_time,t.formItem.description=void 0===e.data.groups[0].items[0].name?"":e.data.groups[0].items[0].name,t.formItem.route=void 0===e.data.groups[0].items[0].route?"":e.data.groups[0].items[0].route)},function(e){bus.$emit("on-loading"),t.$Message.warning("加载资源失败")})}},created:function(){var t=this;this.$nextTick(function(){t.initialData()})}}},nFLq:function(t,e,i){var r=i("VU/8")(i("Jpbk"),i("seC3"),null,null);t.exports=r.exports},seC3:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page",[i("div",{staticStyle:{"padding-top":"20px"}},[i("Form",{ref:"formItem",attrs:{model:t.formItem,"label-width":100,rules:t.ruleValidate}},[i("Form-item",{attrs:{label:"开始时间",prop:"start_time"}},[i("Row",[i("i-col",{staticStyle:{width:"300px"}},[i("Date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:"开始时间"},model:{value:t.formItem.start_time,callback:function(e){t.$set(t.formItem,"start_time",e)},expression:"formItem.start_time"}})],1)],1)],1),t._v(" "),i("Form-item",{attrs:{label:"结束时间",prop:"end_time"}},[i("Row",[i("i-col",{staticStyle:{width:"300px"}},[i("Date-picker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:"结束时间"},model:{value:t.formItem.end_time,callback:function(e){t.$set(t.formItem,"end_time",e)},expression:"formItem.end_time"}})],1)],1)],1),t._v(" "),i("Form-item",{attrs:{label:"通告文本",prop:"description"}},[i("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",autosize:{minRows:3,maxRows:10}},model:{value:t.formItem.description,callback:function(e){t.$set(t.formItem,"description",e)},expression:"formItem.description"}}),t._v("\n                不可有特殊字符，不得超过100个字符\n            ")],1),t._v(" "),i("Form-item",{attrs:{label:"跳转路由"}},[i("m-app-route",{attrs:{placeholder:"输入路由","default-route":t.formItem.route},on:{"on-ok":t.handleSelectRoute}})],1),t._v(" "),i("Form-item",[i("i-button",{attrs:{type:"primary"},on:{click:function(e){t.handleSubmit("formItem")}}},[t._v("提交")]),t._v(" "),i("i-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:t.back}},[t._v("取消")])],1)],1)],1)])},staticRenderFns:[]}}});