webpackJsonp([133],{"2SfI":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("9mvH"),a=i.n(s);e.default={name:"app",components:{MHuabeiRuleForm:a.a},data:function(){return{loadingState:!1}},methods:{changeLoadingState:function(){this.loadingState=!this.loadingState}}}},"9mvH":function(t,e,i){var s=i("VU/8")(i("qDbE"),i("arFt"),null,null);t.exports=s.exports},H4Z6:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page-edit",[i("m-huabei-rule-form",{attrs:{usage:"add"},on:{loading:t.changeLoadingState}})],1)},staticRenderFns:[]}},arFt:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("i-button",{attrs:{type:"primary"},on:{click:t.back}},[t._v("返回")]),t._v(" "),i("Card",[i("h3",[t._v("花呗规则")])]),t._v(" "),i("Card",[i("Form",{ref:"myForm",attrs:{model:t.formItem,"label-width":120}},[i("Form-item",{attrs:{label:"开始时间"}},[i("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",placeholder:"",disabled:t.editDisabled},on:{"on-change":t.syncStartTime},model:{value:t.formItem.start_time,callback:function(e){t.$set(t.formItem,"start_time",e)},expression:"formItem.start_time"}})],1),t._v(" "),i("Form-item",{attrs:{label:"结束时间"}},[i("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",placeholder:"",disabled:t.editDisabled},on:{"on-change":t.syncEndTime},model:{value:t.formItem.end_time,callback:function(e){t.$set(t.formItem,"end_time",e)},expression:"formItem.end_time"}})],1),t._v(" "),i("Form-item",{attrs:{label:"花呗最低消费金额"}},[i("Input",{staticStyle:{width:"150px"},attrs:{placeholder:"",disabled:t.editDisabled},model:{value:t.formItem.min_amount,callback:function(e){t.$set(t.formItem,"min_amount",e)},expression:"formItem.min_amount"}}),t._v(" 元\n\n            ")],1),t._v(" "),i("Form-item",{attrs:{label:"分期免息"}},[i("i-switch",{attrs:{disabled:t.editDisabled},model:{value:t.formItem.is_installment,callback:function(e){t.$set(t.formItem,"is_installment",e)},expression:"formItem.is_installment"}})],1),t._v(" "),i("Form-item",{attrs:{label:""}},[t.formItem.is_installment?i("div",[i("Row",{attrs:{justify:"start"}},[i("i-col",{attrs:{span:"4"}},[i("div",[t._v("3期免息")])]),t._v(" "),i("i-col",{attrs:{span:"4"}},[i("i-switch",{attrs:{size:"small",disabled:t.editDisabled},model:{value:t.formItem.is_installment_for_three,callback:function(e){t.$set(t.formItem,"is_installment_for_three",e)},expression:"formItem.is_installment_for_three"}})],1),t._v(" "),i("i-col",{attrs:{span:"4"}},[i("div",[t._v("最低消费金额")])]),t._v(" "),i("i-col",{attrs:{span:"4"}},[i("Input",{staticStyle:{width:"100px"},attrs:{placeholder:"",disabled:!t.formItem.is_installment_for_three||t.editDisabled},model:{value:t.formItem.installment_for_three,callback:function(e){t.$set(t.formItem,"installment_for_three",e)},expression:"formItem.installment_for_three"}})],1),t._v(" "),i("i-col",{attrs:{span:"4"}},[i("div",[t._v("元")])])],1),t._v(" "),i("Row",{attrs:{justify:"start"}},[i("i-col",{attrs:{span:"4"}},[i("div",[t._v("6期免息")])]),t._v(" "),i("i-col",{attrs:{span:"4"}},[i("i-switch",{attrs:{size:"small",disabled:t.editDisabled},model:{value:t.formItem.is_installment_for_six,callback:function(e){t.$set(t.formItem,"is_installment_for_six",e)},expression:"formItem.is_installment_for_six"}})],1),t._v(" "),i("i-col",{attrs:{span:"4"}},[i("div",[t._v("最低消费金额")])]),t._v(" "),i("i-col",{attrs:{span:"4"}},[i("Input",{staticStyle:{width:"100px"},attrs:{placeholder:"",disabled:!t.formItem.is_installment_for_six||t.editDisabled},model:{value:t.formItem.installment_for_six,callback:function(e){t.$set(t.formItem,"installment_for_six",e)},expression:"formItem.installment_for_six"}})],1),t._v(" "),i("i-col",{attrs:{span:"4"}},[i("div",[t._v("元")])])],1),t._v(" "),i("Row",{attrs:{justify:"start"}},[i("i-col",{attrs:{span:"4"}},[i("div",[t._v("12期免息")])]),t._v(" "),i("i-col",{attrs:{span:"4"}},[i("i-switch",{attrs:{size:"small",disabled:t.editDisabled},model:{value:t.formItem.is_installment_for_twelve,callback:function(e){t.$set(t.formItem,"is_installment_for_twelve",e)},expression:"formItem.is_installment_for_twelve"}})],1),t._v(" "),i("i-col",{attrs:{span:"4"}},[i("div",[t._v("最低消费金额")])]),t._v(" "),i("i-col",{attrs:{span:"4"}},[i("Input",{staticStyle:{width:"100px"},attrs:{placeholder:"",disabled:!t.formItem.is_installment_for_twelve||t.editDisabled},model:{value:t.formItem.installment_for_twelve,callback:function(e){t.$set(t.formItem,"installment_for_twelve",e)},expression:"formItem.installment_for_twelve"}})],1),t._v(" "),i("i-col",{attrs:{span:"4"}},[i("div",[t._v("元")])])],1)],1):t._e()]),t._v(" "),i("Form-item",[i("i-button",{attrs:{type:"primary",disabled:t.editDisabled},on:{click:t.submit}},[t._v("提交")]),t._v(" "),i("i-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost",disabled:t.editDisabled},on:{click:function(e){t.back()}}},[t._v("取消\n                ")])],1)],1)],1)],1)},staticRenderFns:[]}},eABi:function(t,e,i){var s=i("VU/8")(i("2SfI"),i("H4Z6"),null,null);t.exports=s.exports},qDbE:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={create:{api:{path:"/boss/mall/admin/huabei/rule/create"}},update:{api:{path:"/boss/mall/admin/huabei/rule/update"}},find:{api:{path:"/boss/mall/admin/huabei/rule/find",params:{id:0,fields:"{id,start_time,end_time,min_amount,is_installment,installment}"}},responseHandle:function(t){var e=new Date;e.setTime(1e3*t.data.start_time),t.data.start_time=e;var i=new Date;if(i.setTime(1e3*t.data.end_time),t.data.end_time=i,t.data.installment){var s=JSON.parse(t.data.installment);for(var a in s)3==a?(t.data.is_installment_for_three=!0,t.data.installment_for_three=s[a]):6==a?(t.data.is_installment_for_six=!0,t.data.installment_for_six=s[a]):12==a&&(t.data.is_installment_for_twelve=!0,t.data.installment_for_twelve=s[a])}return t}}};e.default={name:"MHuabeiRuleForm",props:{id:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{formItem:{id:"",start_time:"",end_time:"",min_amount:"",is_installment:!1,is_installment_for_three:!1,is_installment_for_six:!1,is_installment_for_twelve:!1,installment_for_three:"",installment_for_six:"",installment_for_twelve:""},editDisabled:!1}},methods:{back:function(){location.hash="/mall/admin/huabei/list?type=rule"},reset:function(){this.$refs.myForm.resetFields()},syncStartTime:function(t){this.formItem.start_time=t?new Date(t).getTime():""},syncEndTime:function(t){this.formItem.end_time=t?new Date(t).getTime():""},submit:function(){if(this.validateFormData()){var t=this.getRequestParams(),e=s.create;"edit"===this.usage&&(e=s.update),this.submitRequest(t,e)}},validateFormData:function(){var t=!0;return t&&(""===this.formItem.start_time&&(this.$Message.error("开始时间不能为空!"),t=!1),""===this.formItem.end_time&&(this.$Message.error("结束时间不能为空!"),t=!1),""===this.formItem.min_amount&&(this.$Message.error("最低消费不能为空!"),t=!1),this.formItem.start_time>this.formItem.end_time&&(this.$Message.error("开始时间不能大于结束时间!"),t=!1),this.formItem.is_installment&&((this.formItem.is_installment_for_three||""===this.formItem.installment_for_three)&&(""!==this.formItem.installment_for_three&&parseFloat(this.formItem.installment_for_three)<parseFloat(this.formItem.min_amount)?(this.$Message.error("3期免息最低消费金额不能低于最低消费!"),t=!1):this.formItem.is_installment_for_three&&""===this.formItem.installment_for_three&&(this.$Message.error("3期免息最低消费金额不能为空!"),t=!1)),(this.formItem.is_installment_for_six||""===this.formItem.installment_for_six)&&(""!==this.formItem.installment_for_six&&parseFloat(this.formItem.installment_for_six)<parseFloat(this.formItem.min_amount)?(this.$Message.error("6期免息最低消费金额不能低于最低消费!"),t=!1):this.formItem.is_installment_for_six&&""===this.formItem.installment_for_six&&(this.$Message.error("6期免息最低消费金额不能为空!"),t=!1)),(this.formItem.is_installment_for_twelve||""===this.formItem.installment_for_twelve)&&(""!==this.formItem.installment_for_twelve&&parseFloat(this.formItem.installment_for_twelve)<parseFloat(this.formItem.min_amount)?(this.$Message.error("12期免息最低消费金额不能低于最低消费!"),t=!1):this.formItem.is_installment_for_twelve&&""===this.formItem.installment_for_twelve&&(this.$Message.error("12期免息最低消费金额不能为空!"),t=!1)))),t},getRequestParams:function(){var t={};if(t.id=this.formItem.id,t.min_amount=this.formItem.min_amount,t.is_installment=!1===this.formItem.is_installment?0:1,t.start_time=Math.round(this.formItem.start_time/1e3),t.end_time=Math.round(this.formItem.end_time/1e3),""!==this.formItem.installment_for_three||""!==this.formItem.installment_for_six||""!==this.formItem.installment_for_twelve){var e="{ ";""!==this.formItem.installment_for_three&&this.formItem.is_installment_for_three&&(e+='"3": '+this.formItem.installment_for_three+","),""!==this.formItem.installment_for_six&&this.formItem.is_installment_for_six&&(e+='"6": '+this.formItem.installment_for_six+","),""!==this.formItem.installment_for_twelve&&this.formItem.is_installment_for_twelve&&(e+='"12": '+this.formItem.installment_for_twelve+","),e=e.substring(0,e.length-1),e+=" }",t.installment=JSON.parse(e)}return t},submitRequest:function(t,e){bus.$emit("on-loading");var i=this;this.$Util.api.post(e,t,i).then(function(t){i.$Notice.success({title:"请求成功",desc:""}),i.back()},function(t){bus.$emit("on-loading"),i.$Notice.warning({title:"请求失败",desc:t.message})})},loadEditFormData:function(){bus.$emit("on-loading");var t=this;this.$Util.api.get(s.find,t).then(function(e){bus.$emit("on-loading"),t.formItem=e.data},function(e){bus.$emit("on-loading"),t.$Notice.warning({title:"加载详情失败",desc:""})})},initIds:function(){if("edit"===this.usage){var t=this.id;if(!parseInt(t))return alert("id格式有误"),!1;t=parseInt(t),this.formItem.id=t,s.find.api.params.id=t}}},created:function(){this.initIds(),this.$nextTick(function(){"edit"===this.usage&&(this.loadEditFormData(),this.editDisabled=!0)})}}}});