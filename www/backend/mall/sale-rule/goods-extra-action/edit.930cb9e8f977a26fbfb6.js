webpackJsonp([25],{"2ncK":function(t,o,e){var i=e("e3cV");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);e("rjj0")("7cde2207",i,!0)},"3roj":function(t,o,e){o=t.exports=e(0)(),o.push([t.i,".ivu-card[data-v-bbd52fb2]{margin-bottom:15px}.btn-ghost-error[data-v-bbd52fb2]{color:#ed3f14;border-color:#ed3f14}.btn-text-error[data-v-bbd52fb2]{margin-left:10px;color:#ed3f14;border:none;background-color:#fff}.btn-ghost-info[data-v-bbd52fb2]{color:#2d8cf0;border-color:#2d8cf0}.ivu-form-item[data-v-bbd52fb2]{margin-bottom:24px}.select-fixed-width[data-v-bbd52fb2]{width:120px}.input-fixed-width[data-v-bbd52fb2]{max-width:500px}.input-display-inline[data-v-bbd52fb2]{display:inline-table}.input-tips[data-v-bbd52fb2]{margin-left:10px;color:#aaa}",""])},"9hDU":function(t,o){t.exports={render:function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("m-page",[e("m-goods-info",{attrs:{goods:t.goods}}),t._v(" "),e("m-action-settings",{attrs:{goods:t.goods,actionGroups:t.actionGroups},on:{"update:actionGroups":function(o){t.actionGroups=o}}})],1)},staticRenderFns:[]}},AOIV:function(t,o,e){"use strict";Object.defineProperty(o,"__esModule",{value:!0});e("pb2F");o.default={name:"MActionSettings",props:{actionGroups:{type:Array,default:function(){return[]}}},data:function(){return{actionOptions:[{label:"看教程",value:1},{label:"返券",value:3},{label:"看电子书",value:4},{label:"看教程套餐",value:5},{label:"加权限",value:6},{label:"发短信",value:7},{label:"发小秘书",value:8},{label:"看线上课",value:10},{label:"线下课",value:11}],formRef:"actionForm",validateRules:{condition:[{required:!0,message:"触发条件不能为空",trigger:"blur"}],action:[{validator:function(t,o,e){e()},trigger:"blur"}]}}},created:function(){var t=this;this.$nextTick(function(){bus.$on("add-action-settings",function(){t.addActionGroup()}),bus.$on("on-submit",function(){t.$refs[t.formRef]&&t.$refs[t.formRef].forEach(function(t){t.validate(function(t){t||(bus.$emit("prevent-submit"),bus.$emit("alert-error-tips","有必填项尚未填写，请完善"))})})})})},methods:{addActionGroup:function(){this.actionGroups.push({condition:"all",removable:!0,spec_ids:"",actionItems:[{action:null,relation_id:null,msg_content:"",app_route:"",removable:!1}]})},removeActionGroups:function(t){var o=this;this.$Modal.confirm({width:250,content:"确认删除？",onOk:function(){o.actionGroups.splice(t,1)}})},addAction:function(t){this.actionGroups[t].actionItems.push({action:null,relation_id:null,msg_content:"",app_route:"",removable:!0})},removeAction:function(t,o){var e=this;this.$Modal.confirm({width:250,content:"确认删除？",onOk:function(){e.actionGroups[t].actionItems.splice(o,1)}})},getPlaceholder:function(t){switch(t){case 1:return"请填写教程ID";case 3:return"请填写券ID";case 4:return"请填写电子书ID";case 5:return"请填写教程套餐ID";case 6:return"请填写权限ID";case 7:return"请填写短信内容";case 8:return"请填写小秘书文案";case 10:return"请填写线上课ID";case 11:return"请填写线下课ID";default:return""}},getInputTips:function(t){switch(t){case 1:case 3:case 4:case 5:case 6:case 10:case 11:return"只可填写一个ID";default:return""}}}}},ATOO:function(t,o,e){var i=e("TV3a");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);e("rjj0")("21c13c5b",i,!0)},Mrzm:function(t,o,e){var i=e("3roj");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);e("rjj0")("6f059008",i,!0)},OFAw:function(t,o,e){e("Mrzm");var i=e("VU/8")(e("AOIV"),e("ZG0U"),"data-v-bbd52fb2",null);t.exports=i.exports},OJkL:function(t,o,e){e("ATOO");var i=e("VU/8")(e("wbWk"),e("kncD"),"data-v-028a2b08",null);t.exports=i.exports},TV3a:function(t,o,e){o=t.exports=e(0)(),o.push([t.i,".info-card[data-v-028a2b08]{margin-bottom:15px}.detail-item[data-v-028a2b08]:not(:last-child){margin-bottom:10px}#app-route-val[data-v-028a2b08]{position:fixed;top:-9999px;left:-9999px}.detail-info[data-v-028a2b08]{color:#666}.btn-ghost-info[data-v-028a2b08]{color:#2d8cf0;border-color:#2d8cf0}",""])},ZG0U:function(t,o){t.exports={render:function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("section",t._l(t.actionGroups,function(o,i){return e("Card",[e("p",{attrs:{slot:"title"},slot:"title"},[t._v("购买后行为"+t._s(i+1))]),t._v(" "),e("span",{attrs:{slot:"extra"},slot:"extra"},[o.removable?e("Button",{staticClass:"btn-ghost-error",attrs:{type:"ghost"},on:{click:function(o){t.removeActionGroups(i)}}},[t._v("\n                删除\n            ")]):t._e(),t._v(" "),e("Button",{staticClass:"btn-ghost-info",attrs:{type:"ghost"},on:{click:function(o){t.addAction(i)}}},[t._v("新增行为")])],1),t._v(" "),e("Form",{ref:t.formRef,refInFor:!0,attrs:{rules:t.validateRules,model:t.actionGroups[i],"label-width":80}},[e("Form-item",{attrs:{label:"触发条件",prop:"condition"}},[e("Radio-group",{staticStyle:{"margin-left":"10px"},model:{value:t.actionGroups[i].condition,callback:function(o){t.$set(t.actionGroups[i],"condition",o)},expression:"actionGroups[groupIndex].condition"}},[e("Radio",{attrs:{label:"all"}},[t._v("该Goods_ID的任意Spec_ID")]),t._v(" "),e("Radio",{attrs:{label:"specify"}},[t._v("该Goods_ID的指定Spec_ID")])],1)],1),t._v(" "),"specify"===o.condition?e("Form-item",{attrs:{prop:"spec_ids"}},[e("Row",[e("Col",{attrs:{span:"9"}},[e("Input",{attrs:{placeholder:"请填写Spec_ID"},model:{value:t.actionGroups[i].spec_ids,callback:function(o){t.$set(t.actionGroups[i],"spec_ids",o)},expression:"actionGroups[groupIndex].spec_ids"}})],1),t._v(" "),e("Col",{attrs:{span:"10"}},[e("span",{staticClass:"input-tips"},[t._v("\n                            多个Spec_ID之间英文逗号隔开。购买其中任一种即可获得指定权益\n                        ")])])],1)],1):t._e(),t._v(" "),t._l(o.actionItems,function(s,n){return e("Form-item",{attrs:{label:"额外行为"+(n+1),prop:"action"}},[e("Row",[e("Col",{attrs:{span:"9"}},[7!==parseInt(t.actionGroups[i].actionItems[n].action)&&8!==parseInt(t.actionGroups[i].actionItems[n].action)?e("Input",{staticClass:"input-fixed-width input-display-inline",attrs:{placeholder:t.getPlaceholder(t.actionGroups[i].actionItems[n].action)},model:{value:t.actionGroups[i].actionItems[n].relation_id,callback:function(o){t.$set(t.actionGroups[i].actionItems[n],"relation_id",o)},expression:"actionGroups[groupIndex].actionItems[itemIndex].relation_id"}},[e("Select",{staticClass:"select-fixed-width",attrs:{slot:"prepend",placeholder:"请选择行为类型"},slot:"prepend",model:{value:t.actionGroups[i].actionItems[n].action,callback:function(o){t.$set(t.actionGroups[i].actionItems[n],"action",o)},expression:"actionGroups[groupIndex].actionItems[itemIndex].action"}},t._l(t.actionOptions,function(o){return e("Option",{key:o.value,attrs:{value:o.value}},[t._v(t._s(o.label)+"\n                                ")])}))],1):t._e(),t._v(" "),7===parseInt(t.actionGroups[i].actionItems[n].action)||8===parseInt(t.actionGroups[i].actionItems[n].action)?e("Input",{staticClass:"input-fixed-width input-display-inline",attrs:{placeholder:t.getPlaceholder(t.actionGroups[i].actionItems[n].action)},model:{value:t.actionGroups[i].actionItems[n].msg_content,callback:function(o){t.$set(t.actionGroups[i].actionItems[n],"msg_content",o)},expression:"actionGroups[groupIndex].actionItems[itemIndex].msg_content"}},[e("Select",{staticClass:"select-fixed-width",attrs:{slot:"prepend",placeholder:"请选择行为类型"},slot:"prepend",model:{value:t.actionGroups[i].actionItems[n].action,callback:function(o){t.$set(t.actionGroups[i].actionItems[n],"action",o)},expression:"actionGroups[groupIndex].actionItems[itemIndex].action"}},t._l(t.actionOptions,function(o){return e("Option",{key:o.value,attrs:{value:o.value}},[t._v(t._s(o.label)+"\n                                ")])}))],1):t._e()],1),t._v(" "),e("Col",{attrs:{span:"3"}},[t.getInputTips(t.actionGroups[i].actionItems[n].action)?e("span",{staticClass:"input-tips"},[t._v("\n                            "+t._s(t.getInputTips(t.actionGroups[i].actionItems[n].action))+"\n                        ")]):t._e(),t._v(" "),o.actionItems.length>1?e("button",{staticClass:"btn-text-error",attrs:{type:"text"},on:{click:function(o){t.removeAction(i,n)}}},[t._v("\n                            删除\n                        ")]):t._e()])],1),t._v(" "),8==t.actionGroups[i].actionItems[n].action?e("Row",[e("Col",{staticStyle:{"margin-left":"131px"},attrs:{span:"12"}},[e("m-app-route",{attrs:{placeholder:"请选择小秘书跳转路由","default-route":t.actionGroups[i].actionItems[n].app_route},on:{"on-ok":function(o){return t.actionGroups[i].actionItems[n].app_route=o}}})],1)],1):t._e()],1)})],2)],1)}))},staticRenderFns:[]}},e3cV:function(t,o,e){o=t.exports=e(0)(),o.push([t.i,"",""])},kncD:function(t,o){t.exports={render:function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("Card",{staticClass:"info-card"},[e("p",{attrs:{slot:"title"},slot:"title"},[t._v("商品信息")]),t._v(" "),e("span",{attrs:{slot:"extra"},slot:"extra"},[e("Button",{staticClass:"btn-ghost-info",attrs:{type:"ghost"},on:{click:t.addActionSettings}},[t._v("新增购买后行为")]),t._v(" "),e("Button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("提交")])],1),t._v(" "),e("p",{staticClass:"detail-item"},[t._v("Goods_ID："),e("Tooltip",{attrs:{content:"点击查看商品详情",placement:"right"}},[e("a",{attrs:{href:t.toGoodsDetail,target:"_blank"}},[t._v(t._s(t.goodsId))])])],1),t._v(" "),e("p",{staticClass:"detail-item"},[t._v("状态："),e("span",{staticClass:"detail-info"},[t._v(t._s(t.statusText))])]),t._v(" "),e("p",{staticClass:"detail-item"},[t._v("创建时间："),e("span",{staticClass:"detail-info"},[t._v(t._s(t.createTime))])]),t._v(" "),e("p",{staticClass:"detail-item"},[t._v("首次上架时间："),e("span",{staticClass:"detail-info"},[t._v(t._s(t.firstOnSaleTime))])]),t._v(" "),e("p",{staticClass:"detail-item"},[t._v("App路由："),e("span",{staticClass:"detail-info"},[t._v(t._s(t.appRoute))]),t._v(" "),e("input",{attrs:{type:"text",id:"app-route-val"},domProps:{value:t.appRoute}}),t._v(" "),e("Tooltip",{attrs:{content:"点击复制",placement:"right"}},[e("Button",{staticStyle:{color:"#2d8cf0"},attrs:{type:"text"},on:{click:t.copyAppRoute}},[t._v("复制")])],1)],1)])},staticRenderFns:[]}},"r/bq":function(t,o,e){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=e("OJkL"),s=e.n(i),n=e("OFAw"),a=e.n(n);o.default={name:"app",components:{MGoodsInfo:s.a,MActionSettings:a.a},data:function(){return{goodsDetailApi:{api:{path:"/boss/mall/catalog/goods/find?id="+this.$route.query.goods_id,params:{fields:"{goods_id,shelf_status,create_time,start_time,delete_time,spec{spec_id}}"}}},actionsApi:{api:{path:"/boss/mall/sale-rule/goods-extra-action/detail?goods_id="+this.$route.query.goods_id,params:{fields:"{id,action,spec_id,group_id,relation_id,msg_content,app_route}"}}},loadedNum:0,loadTotal:2,goods:{},actionGroups:[],submitApi:{api:{path:"/boss/mall/sale-rule/goods-extra-action/update"}},canSubmit:!0}},created:function(){var t=this;this.$nextTick(function(){t.$route.query.goods_id?bus.$emit("on-loading"):t.alertErrorTips("非法操作：缺少必要参数")}),bus.$on("alert-error-tips",function(t,o){return self.alertErrorTips(t,o)}),this.loadGoodsDetail(),this.loadActionGroups(),bus.$on("prevent-submit",function(){t.canSubmit=!1}),bus.$on("reset-submit",function(){t.canSubmit=!0}),bus.$on("do-submit",function(){t.canSubmit&&t.doSubmit()})},watch:{loadedNum:function(){this.loadedNum>=this.loadTotal&&bus.$emit("on-loading")}},methods:{alertErrorTips:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250;this.$Modal.error({width:o,content:t})},loadGoodsDetail:function(){var t=this;this.$Util.api.get(this.goodsDetailApi).then(function(o){t.loadedNum+=1,0===o.error_code?t.goods=o.data:20101===o.error_code?t.goods={}:t.alertErrorTips(o.error_description?o.error_description:"发生未知的错误",300)},function(o){t.loadedNum+=1,t.alertErrorTips(o.message?o.message:"发生未知的错误",300)})},loadActionGroups:function(){var t=this;this.$Util.api.get(this.actionsApi).then(function(o){if(t.loadedNum+=1,0===o.error_code){for(var e=[],i=function(t){var i=o.data[t];if(0===i.group_id)e.push({condition:0===i.spec_id?"all":"specify",removable:!0,spec_ids:0===i.spec_id?"":i.spec_id,actionItems:[i]});else{var s=e.findIndex(function(t){return t.group_id===i.group_id});if(-1===s)e.push({condition:0===i.spec_id?"all":"specify",removable:!0,group_id:i.group_id,spec_ids:0===i.spec_id?"":i.spec_id+"",actionItems:[i]});else if(0===i.spec_id)e[s].actionItems.push(i);else{var n=e[s].actionItems.findIndex(function(t){return t.action===i.action&&t.relation_id===i.relation_id});if(-1===n)e[s].actionItems.push(i);else{var a=e[s].spec_ids.split(","),r=a.findIndex(function(t){return t==i.spec_id});-1===r&&a.push(i.spec_id),e[s].spec_ids=a.join(",")}}}},s=0;s<o.data.length;s++)i(s);t.actionGroups=e}},function(o){t.loadedNum+=1,t.alertErrorTips(o.message?o.message:"发生未知的错误",300)})},doSubmit:function(){for(var t=[],o=JSON.parse(JSON.stringify(this.actionGroups)),e=0;e<o.length;e++){var i=o[e];if(!i.actionItems instanceof Array||i.actionItems.length<1||!i.actionItems[0].action||!i.actionItems[0].relation_id&&!i.actionItems[0].msg_content&&!i.actionItems[0].app_route)return void this.alertErrorTips("【购买后行为"+(e+1)+"】至少需要一个额外行为，请添加。",300);for(var s=0;s<i.actionItems.length;s++){var n=i.actionItems[s];if(!n.action)return void this.alertErrorTips("【购买后行为"+(e+1)+"】的【额外行为"+(s+1)+"】项尚未填写完整，请完善",300);if(7===n.action&&!n.msg_content)return void this.alertErrorTips("【购买后行为"+(e+1)+"】的【额外行为"+(s+1)+"】项尚未填写完整，请完善",300);if(!(8!==n.action||n.msg_content&&n.app_route))return void this.alertErrorTips("【购买后行为"+(e+1)+"】的【额外行为"+(s+1)+"】项尚未填写完整，请完善",300);if(7!==n.action&&8!==n.action&&!i.actionItems[0].relation_id)return void this.alertErrorTips("【购买后行为"+(e+1)+"】的【额外行为"+(s+1)+"】项尚未填写完整，请完善",300);if("all"===i.condition)t.push({group_id:e+1,action:n.action,spec_id:0,relation_id:n.relation_id?n.relation_id:0,msg_content:n.msg_content?n.msg_content:"",app_route:n.app_route?n.app_route:"",goods_id:this.goods.goods_id});else{var a=i.spec_ids+"";a=a.split(",");for(var r=0;r<a.length;r++)t.push({group_id:e+1,action:n.action,spec_id:a[r],relation_id:n.relation_id?n.relation_id:0,msg_content:n.msg_content?n.msg_content:"",app_route:n.app_route?n.app_route:"",goods_id:this.goods.goods_id})}}}this.handlePost({goods_id:this.goods.goods_id,extra_actions:t})},handlePost:function(t){var o=this;bus.$emit("on-loading"),this.$Util.api.post(this.submitApi,t).then(function(t){bus.$emit("on-loading"),0===t.error_code?(o.$Modal.success({width:250,content:"提交成功",onOk:function(){location.reload()}}),setTimeout(function(){o.$Modal.remove(),location.reload()},5e3)):o.alertErrorTips(t.error_descrition?t.error_descrition:"发生了不可预知的错误",300)},function(t){bus.$emit("on-loading"),405===t.code?o.alertErrorTips(t.message,"表单验证失败"):o.alertErrorTips(t.message?t.message:"发生了不可预知的错误")})}},beforeDestroy:function(){bus.$off("alert-error-tips"),bus.$off("prevent-submit"),bus.$off("reset-submit"),bus.$off("on-submit"),bus.$off("do-submit")}}},"r/yb":function(t,o,e){e("2ncK");var i=e("VU/8")(e("r/bq"),e("9hDU"),"data-v-09bcfc20",null);t.exports=i.exports},wbWk:function(t,o,e){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default={name:"MGoodsInfo",props:{goods:{type:Object,default:function(){return{}}}},data:function(){return{appRoutePrefix:"meijiabang://goods_details?goods_id="}},computed:{goodsId:function(){return this.goods&&this.goods.goods_id?this.goods.goods_id:""},statusText:function(){return this.goods&&this.goods.delete_time?"废弃":this.goods&&this.goods.shelf_status?"上架":this.goods&&!this.goods.shelf_status?"下架":""},createTime:function(){return this.goods&&void 0!==this.goods.create_time?this.$Util.dateFormat(this.goods.create_time,"yyyy-MM-dd hh:mm:ss"):""},firstOnSaleTime:function(){return this.goods&&void 0!==this.goods.start_time?this.$Util.dateFormat(this.goods.start_time,"yyyy-MM-dd hh:mm:ss"):""},appRoute:function(){return this.goods&&this.goods.goods_id?this.appRoutePrefix+this.goods.goods_id:""},toGoodsDetail:function(){return"#/mall/catalog/goods/edit/"+this.goods.goods_id}},methods:{copyAppRoute:function(){if(this.goods&&this.goods.goods_id){var t=document.getElementById("app-route-val");t.focus(),t.setSelectionRange(0,t.value.length);try{document.execCommand("copy"),this.$Modal.success({content:"已复制到剪贴板:<br>"+t.value});var o=this;setTimeout(function(){o.$Modal.remove()},5e3)}catch(t){bus.$emit("该浏览器不支持此复制功能，请升级到最新的chrome",300)}}else bus.$emit("非法操作：缺少必要参数Goods_ID，无法组装App路由",300)},addActionSettings:function(){bus.$emit("add-action-settings")},onSubmit:function(){bus.$emit("reset-submit"),bus.$emit("on-submit"),setTimeout(function(){bus.$emit("do-submit")},500)}}}}});