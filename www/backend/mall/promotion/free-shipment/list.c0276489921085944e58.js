webpackJsonp([46],{"7Ixz":function(t,i,o){var n=o("X/BJ");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);o("rjj0")("0bb03395",n,!0)},JfMr:function(t,i,o){o("7Ixz");var n=o("VU/8")(o("OKCv"),o("h8Wg"),null,null);t.exports=n.exports},NZ6e:function(t,i,o){var n=o("z3la");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);o("rjj0")("0e3768df",n,!0)},OKCv:function(t,i,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=o("oIdx"),e=o.n(n),s={update:{api:{path:"/boss/mall/promotion/free-shipment/update",params:{promotion_id:0}},exceptionHandle:function(t,i){alert(i.replace(/\\r/g,"\r"))}},find:{api:{path:"/boss/mall/promotion/free-shipment/find",params:{promotion_id:0,fields:"{id,name,desc,type,start_time,end_time,update_time,goods_ids,user_condition{type,condition,condition_start_time,condition_end_time}}"}},responseHandle:function(t,i){return t}}};i.default={components:{MPromotionUserCondition:e.a},name:"MPromotionFreeShipment",data:function(){return{promotion:{id:0,name:"",title:"",desc:"",start_time:"",end_time:""},formItem:{goods_ids:"",user_condition:{type:1}},usage:"edit",canSubmit:!0,requestParamsOfUserCondition:{type:1}}},methods:{back:function(){location.hash="/mall/promotion/promotion/list"},refreshUserCondition:function(t){this.requestParamsOfUserCondition=t},submit:function(){bus.$emit("reset-submit"),bus.$emit("on-submit"),setTimeout(function(){bus.$emit("do-submit")},300)},getRequestParams:function(){var t={};return t=this.formItem,t.user_condition=this.requestParamsOfUserCondition,t.promotion_id=s.update.api.params.promotion_id,t},submitRequest:function(){var t=this,i=t.getRequestParams(),o=s.update;bus.$emit("on-loading"),this.$Util.api.post(o,i,t).then(function(i){bus.$emit("on-loading"),t.$Notice.success({title:"请求成功",desc:""}),location.hash="/mall/promotion/"+s.update.api.params.promotion_id+"/free-shipment/list/"},function(i){bus.$emit("on-loading"),t.$Notice.warning({title:"请求失败",desc:""})})},loadEditFormData:function(){var t=this;bus.$emit("on-loading"),this.$Util.api.get(s.find,this).then(function(i){if(bus.$emit("on-loading"),!i.data)return t.$Message.warning("数据不存在"),!1;t.promotion=i.data,this.$set(t.formItem,"goods_ids",t.promotion.goods_ids.join(",")),null!==i.data.user_condition&&this.$set(t.formItem,"user_condition",i.data.user_condition)},function(t){})},alertErrorTips:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250;this.$Modal.error({width:i,content:t})}},created:function(){s.update.api.params.promotion_id=this.$route.params.id,s.find.api.params.promotion_id=this.$route.params.id,this.$nextTick(function(){var t=this;t.loadEditFormData(),bus.$on("alert-error-tips",function(i,o){return t.alertErrorTips(i,o)}),bus.$on("prevent-submit",function(){t.canSubmit=!1}),bus.$on("reset-submit",function(){t.canSubmit=!0}),bus.$on("do-submit",function(){t.canSubmit&&t.submitRequest()})})},beforeDestroy:function(){bus.$off("alert-error-tips"),bus.$off("prevent-submit"),bus.$off("reset-submit"),bus.$off("on-submit"),bus.$off("do-submit")}}},QDqa:function(t,i){t.exports={render:function(){var t=this,i=t.$createElement,o=t._self._c||i;return o("m-page",[o("Card",{staticStyle:{"margin-bottom":"10px"}},[o("FormItem",[o("Row",[o("Col",[t._v("\n                活动允许参与人群\n                ")]),t._v(" "),o("Col",[o("RadioGroup",{model:{value:t.user_condition.type,callback:function(i){t.$set(t.user_condition,"type",i)},expression:"user_condition.type"}},[o("Radio",{attrs:{label:"1"}},[t._v("不限")]),t._v(" "),o("Radio",{attrs:{label:"2"}},[t._v("指定用户标签组")]),t._v(" "),o("Radio",{attrs:{label:"3"}},[t._v("指定UID")])],1)],1)],1)],1),t._v(" "),"2"==t.user_condition.type?o("FormItem",[o("Row",[o("Col",[t._v("\n                指定用户标签组:\n                ")]),t._v(" "),o("Col",[o("CheckboxGroup",{model:{value:t.user_condition.tag,callback:function(i){t.$set(t.user_condition,"tag",i)},expression:"user_condition.tag"}},t._l(t.userTags,function(i){return o("Checkbox",{key:i.tag,attrs:{label:i.tag}},[t._v(t._s(i.name))])}))],1)],1)],1):t._e(),t._v(" "),"3"==t.user_condition.type?o("FormItem",[o("Row",[o("Col",[t._v("\n                指定UID:\n                ")]),t._v(" "),o("Col",[o("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:""},model:{value:t.user_condition.uids,callback:function(i){t.$set(t.user_condition,"uids",i)},expression:"user_condition.uids"}})],1)],1)],1):t._e(),t._v(" "),"4"==t.user_condition.type?o("FormItem",[o("Row",[o("Col",[t._v("\n                在指定时间周期内:\n                ")])],1),t._v(" "),o("Row",[o("Col",{attrs:{span:"10",label:"开始时间"}},[o("Date-picker",{attrs:{type:"datetime",placeholder:"选择开始时间",format:"yyyy-MM-dd HH:mm:ss"},model:{value:t.user_condition.condition_start_time,callback:function(i){t.$set(t.user_condition,"condition_start_time",i)},expression:"user_condition.condition_start_time"}})],1),t._v(" "),o("Col",{attrs:{span:"10",label:"结束时间"}},[o("Date-picker",{attrs:{type:"datetime",placeholder:"选择结束时间",format:"yyyy-MM-dd HH:mm:ss"},model:{value:t.user_condition.condition_end_time,callback:function(i){t.$set(t.user_condition,"condition_end_time",i)},expression:"user_condition.condition_end_time"}})],1)],1),t._v(" "),o("Row",[o("Col",[t._v("\n                购买过至少1款指定Goods_ID:(多个Goods_ID用英文逗号隔开)\n                ")]),t._v(" "),o("Col",[o("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"多个GoodsID英文逗号隔开"},model:{value:t.user_condition.has_purchased_goods_id,callback:function(i){t.$set(t.user_condition,"has_purchased_goods_id",i)},expression:"user_condition.has_purchased_goods_id"}})],1)],1)],1):t._e()],1)],1)},staticRenderFns:[]}},"X/BJ":function(t,i,o){i=t.exports=o(0)(),i.push([t.i,"p{margin:5px}",""])},h8Wg:function(t,i){t.exports={render:function(){var t=this,i=t.$createElement,o=t._self._c||i;return o("m-page",[o("Form",{ref:"myForm",attrs:{model:t.formItem}},[o("Card",{staticStyle:{"margin-bottom":"10px"}},[o("p",{attrs:{slot:"title"},slot:"title"},[t._v("活动名称:"+t._s(t.promotion.name))]),t._v(" "),o("p",[t._v("活动Id:"+t._s(t.promotion.id))]),t._v(" "),o("p",[t._v("活动描述:"+t._s(t.promotion.desc))])]),t._v(" "),o("m-promotion-user-condition",{attrs:{user_condition:t.formItem.user_condition},on:{condition_change:t.refreshUserCondition}}),t._v(" "),o("Card",{staticStyle:{"margin-bottom":"10px"}},[o("div",{staticStyle:{margin:"5px"}},[t._v("条件商品(多个Goods_ID用英文逗号隔开，不超过1000个)")]),t._v(" "),o("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:10},placeholder:"多个商品id用英文逗号隔开"},model:{value:t.formItem.goods_ids,callback:function(i){t.$set(t.formItem,"goods_ids",i)},expression:"formItem.goods_ids"}})],1),t._v(" "),o("Form-item",{staticStyle:{margin:"10px"}},[o("i-button",{attrs:{type:"primary"},on:{click:function(i){t.submit()}}},[t._v("提交")]),t._v(" "),o("i-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:function(i){t.back()}}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]}},oIdx:function(t,i,o){o("NZ6e");var n=o("VU/8")(o("s1ay"),o("QDqa"),null,null);t.exports=n.exports},s1ay:function(t,i,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default={name:"MPromotionUserCondition",props:{user_condition:{type:Object,default:function(){return{type:"1",tag:[],uids:"",condition_start_time:"",condition_end_time:"",has_purchased_goods_id:""}}}},data:function(){return{userTags:[],hasInitialed:0,findTags:{api:{path:"/boss/mall/promotion/user-condition/tag"},responseHandle:function(t,i){return t}}}},watch:{user_condition:{handler:function(t,i){if(!this.hasInitialed)if(2==t.type){var o=this.user_condition.condition?this.user_condition.condition.split(","):[];this.$set(this.user_condition,"tag",o)}else 3==t.type?this.$set(this.user_condition,"uids",this.user_condition.condition):4==t.type&&(this.user_condition.condition_start_time&&"number"==typeof this.user_condition.condition_start_time&&(this.user_condition.condition_start_time=1e3*parseInt(this.user_condition.condition_start_time)),this.user_condition.condition_end_time&&"number"==typeof this.user_condition.condition_end_time&&(this.user_condition.condition_end_time=1e3*parseInt(this.user_condition.condition_end_time)),this.user_condition.condition_start_time&&"number"!=typeof this.user_condition.condition_start_time&&(this.user_condition.condition_start_time=Date.parse(this.user_condition.condition_start_time)),this.user_condition.condition_end_time&&"number"!=typeof this.user_condition.condition_end_time&&(this.user_condition.condition_end_time=Date.parse(this.user_condition.condition_end_time)),this.$set(this.user_condition,"has_purchased_goods_id",this.user_condition.condition));this.hasInitialed=!0;var n=Object.assign({},this.user_condition);"4"==this.user_condition.type&&(n.condition_start_time=n.condition_start_time.toString(),n.condition_end_time=n.condition_end_time.toString()),this.$emit("condition_change",n)},deep:!0}},methods:{validateFormData:function(){if(""==this.user_condition.type)return this.$Message.error("允许参与人群不能为空"),!1;if("2"==this.user_condition.type&&(!this.user_condition.tag||this.user_condition.tag.length<=0))return this.$Message.error("指定用户标签组不能为空"),!1;if("3"==this.user_condition.type&&(!this.user_condition.uids||""==this.user_condition.uids))return this.$Message.error("指定UID不能为空"),!1;if("4"==this.user_condition.type){if(""===this.user_condition.has_purchased_goods_id)return this.$Message.error("购买过至少1款指定Goods_ID不能为空"),!1;if(""==this.user_condition.condition_start_time)return this.$Message.error("在指定时间周期内的开始时间不能为空"),!1;if(""==this.user_condition.condition_end_time)return this.$Message.error("在指定时间周期内的结束时间不能为空"),!1}return!0},loadData:function(){var t=this;this.$Util.api.get(t.findTags,this).then(function(i){if(!i.data)return t.$Message.warning("数据不存在"),!1;t.userTags=i.data},function(t){})}},created:function(){this.$nextTick(function(){var t=this;bus.$on("on-submit",function(){t.validateFormData()||bus.$emit("prevent-submit")}),t.loadData()})}}},z3la:function(t,i,o){i=t.exports=o(0)(),i.push([t.i,"p{margin:5px}",""])}});