webpackJsonp([54],{Dzp0:function(t,i){t.exports={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("m-page",[e("Form",{ref:"myForm",attrs:{model:t.formItem}},[e("Card",{staticStyle:{"margin-bottom":"10px"}},[e("p",{attrs:{slot:"title"},slot:"title"},[t._v("活动名称:"+t._s(t.promotion.name))]),t._v(" "),e("p",[t._v("活动Id:"+t._s(t.promotion.id))]),t._v(" "),e("p",[t._v("活动描述:"+t._s(t.promotion.desc))])]),t._v(" "),e("m-promotion-user-condition",{attrs:{user_condition:t.promotion.user_condition},on:{condition_change:t.refreshUserCondition}}),t._v(" "),e("Card",{staticStyle:{"margin-bottom":"10px"}},[e("div",{staticStyle:{margin:"5px"}},[t._v("条件商品(多个Goods_ID用英文逗号隔开)")]),t._v(" "),e("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:10},placeholder:"多个商品id用英文逗号隔开"},model:{value:t.formItem.condition,callback:function(i){t.$set(t.formItem,"condition",i)},expression:"formItem.condition"}})],1),t._v(" "),e("Card",[e("div",{staticStyle:{margin:"5px"}},[t._v("阶梯设置\n                "),e("Button",{attrs:{type:"primary",icon:"ios-plus",size:"small"},on:{click:function(i){t.addPremium(null)}}},[t._v("添加阶梯")])],1),t._v(" "),t._l(t.formItem.premium,function(i,o){return e("div",{staticStyle:{border:"1px solid #ddd","margin-bottom":"8px"}},[e("Row",{staticStyle:{margin:"5px"},attrs:{type:"flex",justify:"start"}},[e("Col",{attrs:{span:"4"}},[e("Input",{staticStyle:{width:"180px"},on:{"on-change":function(i){t.handleAmountMinChange(o)}},model:{value:i.amount_min,callback:function(e){t.$set(i,"amount_min",e)},expression:"premiumItem.amount_min"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("购买金额最小值")])])],1),t._v(" "),e("Col",{attrs:{span:"4"}},[e("Input",{staticStyle:{width:"180px"},attrs:{readonly:""},model:{value:i.amount_max,callback:function(e){t.$set(i,"amount_max",e)},expression:"premiumItem.amount_max"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("购买金额最大值")])])],1),t._v(" "),e("Col",{attrs:{span:"4"}},[e("Input",{staticStyle:{width:"150px"},model:{value:i.premium_price,callback:function(e){t.$set(i,"premium_price",e)},expression:"premiumItem.premium_price"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("加购金额")])])],1),t._v(" "),e("Col",{attrs:{span:"4"}},[e("Input",{staticStyle:{width:"150px"},on:{"on-change":function(i){t.handleBuyLimitChange(o)}},model:{value:i.buy_limit,callback:function(e){t.$set(i,"buy_limit",e)},expression:"premiumItem.buy_limit"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("换购个数")])])],1),t._v(" "),e("Col",{attrs:{span:"4"}},[e("Button",{attrs:{type:"error"},on:{click:function(i){t.removePremium(o)}}},[t._v("删除")])],1)],1),t._v(" "),e("div",{staticStyle:{margin:"10px auto 10px 50px"}},[t._v("换购商品\n                    "),e("Button",{attrs:{type:"primary",icon:"ios-plus",size:"small"},on:{click:function(i){t.addOptional(null,o)}}},[t._v("\n                        添加换购商品\n                    ")])],1),t._v(" "),e("table",{staticClass:"ivu-table",staticStyle:{width:"720px","margin-left":"50px"},attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[e("tr",[e("th",[e("div",{staticClass:"ivu-table-cell"},[t._v("商品规格id")])]),t._v(" "),e("th",[e("div",{staticClass:"ivu-table-cell"},[t._v("商品数量")])]),t._v(" "),e("th",[e("div",{staticClass:"ivu-table-cell"},[t._v("操作")])])]),t._v(" "),t._l(t.formItem.premium[o].goods,function(i,n){return e("tr",[e("td",[e("div",{staticClass:"ivu-table-cell"},[e("Input",{staticStyle:{width:"100px"},attrs:{placeholder:"商品规格id"},model:{value:i.goods_spec_id,callback:function(e){t.$set(i,"goods_spec_id",e)},expression:"optionalItem.goods_spec_id"}})],1)]),t._v(" "),e("td",[e("div",{staticClass:"ivu-table-cell"},[e("Input-number",{staticStyle:{width:"100px"},attrs:{min:1,placeholder:""},on:{"on-change":function(i){t.handleOptionalQuantityChange(o,n)}},model:{value:i.quantity,callback:function(e){t.$set(i,"quantity",e)},expression:"optionalItem.quantity"}})],1)]),t._v(" "),e("td",[e("div",{staticClass:"ivu-table-cell"},[e("Button",{attrs:{type:"error",size:"small"},on:{click:function(i){t.removeOptional(o,n)}}},[t._v("删除\n                                ")])],1)])])})],2)],1)})],2),t._v(" "),e("Form-item",{staticStyle:{margin:"10px"}},[e("i-button",{attrs:{type:"primary",disabled:t.submitDisabled},on:{click:t.submit}},[t._v("提交")]),t._v(" "),e("i-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:function(i){t.back()}}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]}},KzCL:function(t,i,e){var o=e("VU/8")(e("wmyO"),e("Dzp0"),null,null);t.exports=o.exports},NZ6e:function(t,i,e){var o=e("z3la");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);e("rjj0")("0e3768df",o,!0)},QDqa:function(t,i){t.exports={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("m-page",[e("Card",{staticStyle:{"margin-bottom":"10px"}},[e("FormItem",[e("Row",[e("Col",[t._v("\n                活动允许参与人群\n                ")]),t._v(" "),e("Col",[e("RadioGroup",{model:{value:t.user_condition.type,callback:function(i){t.$set(t.user_condition,"type",i)},expression:"user_condition.type"}},[e("Radio",{attrs:{label:"1"}},[t._v("不限")]),t._v(" "),e("Radio",{attrs:{label:"2"}},[t._v("指定用户标签组")]),t._v(" "),e("Radio",{attrs:{label:"3"}},[t._v("指定UID")])],1)],1)],1)],1),t._v(" "),"2"==t.user_condition.type?e("FormItem",[e("Row",[e("Col",[t._v("\n                指定用户标签组:\n                ")]),t._v(" "),e("Col",[e("CheckboxGroup",{model:{value:t.user_condition.tag,callback:function(i){t.$set(t.user_condition,"tag",i)},expression:"user_condition.tag"}},t._l(t.userTags,function(i){return e("Checkbox",{key:i.tag,attrs:{label:i.tag}},[t._v(t._s(i.name))])}))],1)],1)],1):t._e(),t._v(" "),"3"==t.user_condition.type?e("FormItem",[e("Row",[e("Col",[t._v("\n                指定UID:\n                ")]),t._v(" "),e("Col",[e("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:""},model:{value:t.user_condition.uids,callback:function(i){t.$set(t.user_condition,"uids",i)},expression:"user_condition.uids"}})],1)],1)],1):t._e(),t._v(" "),"4"==t.user_condition.type?e("FormItem",[e("Row",[e("Col",[t._v("\n                在指定时间周期内:\n                ")])],1),t._v(" "),e("Row",[e("Col",{attrs:{span:"10",label:"开始时间"}},[e("Date-picker",{attrs:{type:"datetime",placeholder:"选择开始时间",format:"yyyy-MM-dd HH:mm:ss"},model:{value:t.user_condition.condition_start_time,callback:function(i){t.$set(t.user_condition,"condition_start_time",i)},expression:"user_condition.condition_start_time"}})],1),t._v(" "),e("Col",{attrs:{span:"10",label:"结束时间"}},[e("Date-picker",{attrs:{type:"datetime",placeholder:"选择结束时间",format:"yyyy-MM-dd HH:mm:ss"},model:{value:t.user_condition.condition_end_time,callback:function(i){t.$set(t.user_condition,"condition_end_time",i)},expression:"user_condition.condition_end_time"}})],1)],1),t._v(" "),e("Row",[e("Col",[t._v("\n                购买过至少1款指定Goods_ID:(多个Goods_ID用英文逗号隔开)\n                ")]),t._v(" "),e("Col",[e("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"多个GoodsID英文逗号隔开"},model:{value:t.user_condition.has_purchased_goods_id,callback:function(i){t.$set(t.user_condition,"has_purchased_goods_id",i)},expression:"user_condition.has_purchased_goods_id"}})],1)],1)],1):t._e()],1)],1)},staticRenderFns:[]}},oIdx:function(t,i,e){e("NZ6e");var o=e("VU/8")(e("s1ay"),e("QDqa"),null,null);t.exports=o.exports},s1ay:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default={name:"MPromotionUserCondition",props:{user_condition:{type:Object,default:function(){return{type:"1",tag:[],uids:"",condition_start_time:"",condition_end_time:"",has_purchased_goods_id:""}}}},data:function(){return{userTags:[],hasInitialed:0,findTags:{api:{path:"/boss/mall/promotion/user-condition/tag"},responseHandle:function(t,i){return t}}}},watch:{user_condition:{handler:function(t,i){if(!this.hasInitialed)if(2==t.type){var e=this.user_condition.condition?this.user_condition.condition.split(","):[];this.$set(this.user_condition,"tag",e)}else 3==t.type?this.$set(this.user_condition,"uids",this.user_condition.condition):4==t.type&&(this.user_condition.condition_start_time&&"number"==typeof this.user_condition.condition_start_time&&(this.user_condition.condition_start_time=1e3*parseInt(this.user_condition.condition_start_time)),this.user_condition.condition_end_time&&"number"==typeof this.user_condition.condition_end_time&&(this.user_condition.condition_end_time=1e3*parseInt(this.user_condition.condition_end_time)),this.user_condition.condition_start_time&&"number"!=typeof this.user_condition.condition_start_time&&(this.user_condition.condition_start_time=Date.parse(this.user_condition.condition_start_time)),this.user_condition.condition_end_time&&"number"!=typeof this.user_condition.condition_end_time&&(this.user_condition.condition_end_time=Date.parse(this.user_condition.condition_end_time)),this.$set(this.user_condition,"has_purchased_goods_id",this.user_condition.condition));this.hasInitialed=!0;var o=Object.assign({},this.user_condition);"4"==this.user_condition.type&&(o.condition_start_time=o.condition_start_time.toString(),o.condition_end_time=o.condition_end_time.toString()),this.$emit("condition_change",o)},deep:!0}},methods:{validateFormData:function(){if(""==this.user_condition.type)return this.$Message.error("允许参与人群不能为空"),!1;if("2"==this.user_condition.type&&(!this.user_condition.tag||this.user_condition.tag.length<=0))return this.$Message.error("指定用户标签组不能为空"),!1;if("3"==this.user_condition.type&&(!this.user_condition.uids||""==this.user_condition.uids))return this.$Message.error("指定UID不能为空"),!1;if("4"==this.user_condition.type){if(""===this.user_condition.has_purchased_goods_id)return this.$Message.error("购买过至少1款指定Goods_ID不能为空"),!1;if(""==this.user_condition.condition_start_time)return this.$Message.error("在指定时间周期内的开始时间不能为空"),!1;if(""==this.user_condition.condition_end_time)return this.$Message.error("在指定时间周期内的结束时间不能为空"),!1}return!0},loadData:function(){var t=this;this.$Util.api.get(t.findTags,this).then(function(i){if(!i.data)return t.$Message.warning("数据不存在"),!1;t.userTags=i.data},function(t){})}},created:function(){this.$nextTick(function(){var t=this;bus.$on("on-submit",function(){t.validateFormData()||bus.$emit("prevent-submit")}),t.loadData()})}}},wmyO:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=e("oIdx"),n=e.n(o),s={create:{api:{path:"/boss/mall/promotion/premium/create",params:{promotion_id:0}},exceptionHandle:function(t,i){alert(i.replace(/\\r/g,"\r"))}},update:{api:{path:"/boss/mall/promotion/premium/update",params:{promotion_id:0}},exceptionHandle:function(t,i){alert(i.replace(/\\r/g,"\r"))}},find:{api:{path:"/boss/mall/promotion/premium/find",params:{promotion_id:0,fields:"{id,name,title,desc,type,start_time,end_time,update_time,user_condition{type,condition,condition_start_time,condition_end_time},condition{id,goods_id,goods_spec_id,update_time},premium{id,amount_min,amount_max,premium_price,buy_limit,update_time,goods{id,goods_id,goods_spec_id,quantity,update_time}}}"}},responseHandle:function(t,i){return t}}};i.default={components:{MPromotionUserCondition:n.a},name:"MPromotionpremium",data:function(){return{promotion:{name:"",title:"",desc:"",start_time:"",end_time:"",user_condition:{type:1}},formItem:{promotion_id:"",condition:"",premium:[{id:0,amount_min:"",amount_max:0,premium_price:"",buy_limit:1,goods:[{id:0,goods_spec_id:"",quantity:1}]}]},usage:"edit",submitDisabled:!0,canSubmit:!0,requestParamsOfUserCondition:{type:1}}},methods:{back:function(){location.hash="/mall/promotion/promotion/list"},refreshUserCondition:function(t){this.requestParamsOfUserCondition=t},handleAmountMinChange:function(t){this.formItem.premium[t].amount_max>0&&parseFloat(this.formItem.premium[t].amount_min)>=parseFloat(this.formItem.premium[t].amount_max)?this.$Message.error("购买金额最小值必须小于购买金额最大值"):t>0&&(parseFloat(this.formItem.premium[t].amount_min)<=parseFloat(this.formItem.premium[t-1].amount_min)?this.$Message.error("必须大于上一阶梯购买金额最小值"):this.formItem.premium[t-1].amount_max=this.formItem.premium[t].amount_min)},handleBuyLimitChange:function(t){for(var i=this.formItem.premium[t].buy_limit,e=0;e<this.formItem.premium.length;e++)this.formItem.premium[e].buy_limit=i},handleOptionalQuantityChange:function(t,i){this.formItem.premium[t].goods[i].quantity>=10&&this.$Message.info("单笔订单可换购件数大于10件了！！！")},addPremium:function(t){null==t&&(t={id:0,amount_min:"",amount_max:0,premium_price:"",buy_limit:1,goods:[{id:0,goods_spec_id:"",quantity:1}]});for(var i in this.formItem.premium)if(this.formItem.premium[i].buy_limit>0){t.buy_limit=this.formItem.premium[i].buy_limit;break}this.formItem.premium.push(t)},removePremium:function(t){this.formItem.premium.length>1&&(this.formItem.premium.length==t+1?this.formItem.premium[t-1].amount_max=0:t>0&&this.formItem.premium.length>2&&(this.formItem.premium[t-1].amount_max=this.formItem.premium[t+1].amount_min),this.formItem.premium.splice(t,1))},addOptional:function(t,i){null==t&&(t={id:0,goods_spec_id:"",quantity:1}),this.formItem.premium[i].goods.push(t)},removeOptional:function(t,i){this.formItem.premium[t].goods.length>1&&this.formItem.premium[t].goods.splice(i,1)},submit:function(){bus.$emit("reset-submit"),bus.$emit("on-submit"),setTimeout(function(){bus.$emit("do-submit")},1e3)},validateFormData:function(){if(""==this.formItem.condition)return this.$Message.error("条件商品不能为空"),!1;var t=this.formItem.condition.split(","),i={};for(var e in t){var o=t[e];if(isNaN(o))return this.$Message.error("条件商品ID必须为数字，多个ID用逗号分割,Id="+o),!1;if(i[o])return this.$Message.error("条件商品ID重复,Goods_Id="+o),!1;i[o]=!0}if(t.length>1e3)return this.$Message.error("条件商品不能超过1000个!"),!1;if(this.formItem.premium.length<1)return this.$Message.error("至少填写1个阶梯设置!"),!1;for(var e=0;e<this.formItem.premium.length;e++){var n=this.formItem.premium[e];if(""==n.amount_min||isNaN(n.amount_min))return this.$Message.error("购买金额最小值不能为空，必须为数字"),!1;if(0!=n.amount_max&&(""==n.amount_max||isNaN(n.amount_max)))return this.$Message.error("购买金额最大值不能为空，必须为数字"),!1;if(n.amount_min=parseFloat(n.amount_min),n.amount_max=parseFloat(n.amount_max),this.formItem.premium.length!=e+1&&n.amount_min>=n.amount_max)return this.$Message.error("购买金额最小值必须小于最大值,"+n.amount_min+"<"+n.amount_max),!1;if(""==n.premium_price||isNaN(n.premium_price))return this.$Message.error("加购金额不能为空，必须为数字"),!1;if(""==n.buy_limit||isNaN(n.buy_limit))return this.$Message.error("换购个数不能为空，必须为数字"),!1;var s={};for(var r in n.goods){if(""==n.goods[r].goods_spec_id||isNaN(n.goods[r].goods_spec_id))return this.$Message.error("换购商品规格ID不能为空，必须为数字"),!1;if(""==n.goods[r].quantity||isNaN(n.goods[r].quantity))return this.$Message.error("商品数量不能为空，必须为数字"),!1;if(s[n.goods[r].goods_spec_id])return this.$Message.error("换购商品规格ID重复，ID="+n.goods[r].goods_spec_id),!1;s[n.goods[r].goods_spec_id]=!0}}for(var a=0;a<this.formItem.premium.length;a++)for(var e=a+1;e<this.formItem.premium.length;e++)if(!(this.formItem.premium[a].amount_min>=this.formItem.premium[e].amount_max||this.formItem.premium[a].amount_max<=this.formItem.premium[e].amount_min)){var m="["+this.formItem.premium[a].amount_min+","+this.formItem.premium[a].amount_max+"]";return m+="，["+this.formItem.premium[e].amount_min+","+this.formItem.premium[e].amount_max+"]",this.$Message.error("阶梯区间不能重合"+m),!1}return!0},getRequestParams:function(){var t={};return t=this.formItem,t.user_condition=this.requestParamsOfUserCondition,t},submitRequest:function(){bus.$emit("on-loading");var t=this;if(!t.validateFormData())return bus.$emit("on-loading"),bus.$emit("prevent-submit"),!1;var i=t.getRequestParams(),e=s.create;"edit"===t.usage&&(e=s.update),this.$Util.api.post(e,i,t).then(function(i){t.$Notice.success({title:"请求成功",desc:""}),t.back()},function(i){bus.$emit("on-loading"),t.$Notice.warning({title:"请求失败",desc:""})})},loadEditFormData:function(){var t=this;bus.$emit("on-loading"),this.$Util.api.get(s.find,this).then(function(i){if(bus.$emit("on-loading"),!i.data)return t.$Message.warning("数据不存在"),!1;if(this.submitDisabled=!1,t.promotion.id=i.data.id,t.promotion.name=i.data.name,t.promotion.desc=i.data.desc,null!==i.data.user_condition&&this.$set(t.promotion,"user_condition",i.data.user_condition),0==i.data.condition.length&&0==i.data.premium.length)t.usage="add";else{var e=[];for(var o in i.data.condition)e.push(i.data.condition[o].goods_id);t.formItem.condition=e.join(","),t.formItem.premium=i.data.premium}},function(t){})}},created:function(){s.create.api.params.promotion_id=this.$route.params.id,s.find.api.params.promotion_id=this.$route.params.id,this.formItem.promotion_id=this.$route.params.id,this.$nextTick(function(){var t=this;t.loadEditFormData(),bus.$on("prevent-submit",function(){t.canSubmit=!1}),bus.$on("reset-submit",function(){t.canSubmit=!0}),bus.$on("do-submit",function(){t.canSubmit&&t.submitRequest()})})},beforeDestroy:function(){bus.$off("prevent-submit"),bus.$off("reset-submit"),bus.$off("on-submit"),bus.$off("do-submit")}}},z3la:function(t,i,e){i=t.exports=e(0)(),i.push([t.i,"p{margin:5px}",""])}});