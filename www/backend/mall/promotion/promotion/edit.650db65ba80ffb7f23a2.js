webpackJsonp([103],{"+3Ln":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{"padding-top":"20px"}},[i("Form",{ref:"myForm",attrs:{model:t.formItem,"label-width":120,rules:t.ruleValidate}},[""!=t.formItem.id?i("div",{staticStyle:{width:"100px","text-align":"right","padding-right":"20px"}},[t._v("ID:"+t._s(t.formItem.id))]):t._e(),t._v(" "),i("Form-item",{attrs:{label:"促销活动名称",prop:"name"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"促销活动名称"},model:{value:t.formItem.name,callback:function(e){t.$set(t.formItem,"name",e)},expression:"formItem.name"}})],1),t._v(" "),i("Form-item",{attrs:{label:"促销活动描述",prop:"desc"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"促销活动描述"},model:{value:t.formItem.desc,callback:function(e){t.$set(t.formItem,"desc",e)},expression:"formItem.desc"}})],1),t._v(" "),i("Form-item",{attrs:{label:"促销活动类型",prop:"type"}},[i("Select",{staticStyle:{width:"200px"},attrs:{disabled:t.promotionTypeDisabled,placeholder:"请选择促销活动类型"},model:{value:t.formItem.type,callback:function(e){t.$set(t.formItem,"type",e)},expression:"formItem.type"}},t._l(t.promotionTypes,function(e){return i("Option",{key:e,attrs:{value:e.value}},[t._v(t._s(e.text))])}))],1),t._v(" "),i("Form-item",{attrs:{label:"开始时间",prop:"start_time"}},[i("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:"选择开始时间"},model:{value:t.formItem.start_time,callback:function(e){t.$set(t.formItem,"start_time",e)},expression:"formItem.start_time"}})],1),t._v(" "),i("Form-item",{attrs:{label:"结束时间",prop:"end_time"}},[i("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",disabled:t.endTimeDisabled,placeholder:"选择结束时间"},model:{value:t.formItem.end_time,callback:function(e){t.$set(t.formItem,"end_time",e)},expression:"formItem.end_time"}})],1),t._v(" "),i("Form-item",{attrs:{label:"活动页面APP_ROUTE",prop:"app_route"}},[i("div",[i("m-app-route",{attrs:{"default-route":t.formItem.app_route},on:{"on-ok":t.handleRoute}}),t._v("（不填使用默认生成链接）\n            ")],1)]),t._v(" "),5!=t.formItem.type&&6!=t.formItem.type&&9!=t.formItem.type?i("Form-item",{attrs:{label:"预告开始时间",prop:"show_time"}},[i("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:"预告开始时间"},model:{value:t.formItem.show_time,callback:function(e){t.$set(t.formItem,"show_time",e)},expression:"formItem.show_time"}}),t._v("\n            （不填表示不展示预告）\n        ")],1):t._e(),t._v(" "),5!=t.formItem.type&&6!=t.formItem.type&&9!=t.formItem.type?i("Form-item",{attrs:{label:"预告营销文案",prop:"show_desc"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"预告营销文案"},model:{value:t.formItem.show_desc,callback:function(e){t.$set(t.formItem,"show_desc",e)},expression:"formItem.show_desc"}})],1):t._e(),t._v(" "),i("Form-item",{attrs:{label:"活动顶图"}},[i("m-upload-image",{attrs:{"default-images":t.formItem.top_image,format:"path"},on:{"on-success":t.setTopImage}})],1),t._v(" "),i("Form-item",{attrs:{label:"是否叠加使用优惠券"}},[i("Radio-group",{model:{value:t.formItem.is_coupon_available,callback:function(e){t.$set(t.formItem,"is_coupon_available",e)},expression:"formItem.is_coupon_available"}},[i("Radio",{attrs:{label:"0"}},[t._v("否")]),t._v(" "),i("Radio",{attrs:{label:"1"}},[t._v("是")])],1)],1),t._v(" "),i("Form-item",{attrs:{label:"允许用户参加活动的次数",prop:"user_join_limit"}},[i("Input-number",{attrs:{min:0,placeholder:"允许用户参加活动的次数"},model:{value:t.formItem.user_join_limit,callback:function(e){t.$set(t.formItem,"user_join_limit",e)},expression:"formItem.user_join_limit"}}),t._v("\n            （不填或者为0时，表示不限制用户参加次数）\n        ")],1),t._v(" "),i("Form-item",[i("i-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("提交")]),t._v(" "),i("i-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:t.back}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]}},DQsW:function(t,e,i){var o=i("VU/8")(i("QSCN"),i("SLez"),null,null);t.exports=o.exports},QBJX:function(t,e,i){var o=i("VU/8")(i("bG7q"),i("+3Ln"),null,null);t.exports=o.exports},QSCN:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("QBJX"),a=i.n(o);e.default={name:"app",components:{MPromotionForm:a.a},data:function(){return{id:this.$route.params.id,loadingState:!1}},methods:{changeLoadingState:function(){this.loadingState=!this.loadingState}}}},SLez:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page-edit",{attrs:{"is-loading":t.loadingState}},[i("m-promotion-form",{attrs:{usage:"edit",id:t.id},on:{loading:t.changeLoadingState}})],1)},staticRenderFns:[]}},bG7q:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={create:{api:{path:"/boss/mall/promotion/promotion/create"}},update:{api:{path:"/boss/mall/promotion/promotion/update"}},find:{api:{path:"/boss/mall/promotion/promotion/find",params:{id:0,fields:"{id,name,desc,type,start_time,end_time,show_time,show_desc,app_route,user_join_limit,status,top_image(w:80,h:80){url,origin},promotion_mark(w:80,h:80){url,origin},is_coupon_available,is_coupon_available,buy_limit_type}"}},responseHandle:function(t,e){var i=new Date;i.setTime(1e3*t.data.start_time),t.data.start_time=i;var o=new Date;if(o.setTime(1e3*t.data.end_time),t.data.end_time=o,t.data.show_time>0){var a=new Date;a.setTime(1e3*t.data.show_time),t.data.show_time=a}return t}},resource:{api:{path:"/boss/mall/promotion/promotion/add-page-info",params:{fields:"{}"}},responseHandle:function(t){return t}}};e.default={name:"MPromotionForm",props:{id:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{formItem:{id:0,name:"",desc:"",type:"",start_time:"",end_time:"",app_route:"",user_join_limit:0,status:1,top_image:[],promotion_mark:[],is_coupon_available:1,show_time:"",show_desc:"",buy_limit_type:0},promotionTypes:[{value:5,text:"组合购"},{value:6,text:"加价购"},{value:8,text:"全场满赠"},{value:9,text:"包邮"}],modal:!1,promotionTypeDisabled:!1,endTimeDisabled:!1,ruleValidate:{name:[{required:!0,message:"促销活动名称不能为空",trigger:"blur"}],desc:[{required:!0,message:"促销活动描述不能为空",trigger:"blur"}],type:[{required:!0,type:"number",message:"促销活动类型不能为空",trigger:"blur"}],start_time:[{required:!0,type:"date",message:"开始时间不能为空",trigger:"blur"}],end_time:[{required:!0,type:"date",message:"结束时间不能为空",trigger:"blur"}],user_join_limit:[{required:!0,type:"number",message:"允许用户参加活动的次数不能为空",trigger:"blur"}]}}},methods:{back:function(){location.hash="/mall/promotion/promotion/list"},reset:function(){this.$refs.myForm.resetFields()},submit:function(){if(this.validateFormData()){var t=this.getRequestParams(),e=o.create;"edit"===this.usage&&(e=o.update),this.submitRequest(t,e)}},validateFormData:function(){var t=this,e=!0;return this.$refs.myForm.validate(function(i){i||(t.$Message.error("表单验证失败!"),e=!1)}),e&&this.formItem.start_time.getTime()>this.formItem.end_time.getTime()&&(this.$Message.error("开始时间不能大于结束时间!"),e=!1),e},getRequestParams:function(){var t={};return t.id=this.formItem.id,t.name=this.formItem.name,t.desc=this.formItem.desc,t.type=this.formItem.type,t.app_route=this.formItem.app_route,t.user_join_limit=this.formItem.user_join_limit,t.status=this.formItem.status,t.is_coupon_available=this.formItem.is_coupon_available,t.show_desc=this.formItem.show_desc,t.buy_limit_type=this.formItem.buy_limit_type,t.start_time=Math.round(this.formItem.start_time.getTime()/1e3),t.end_time=Math.round(this.formItem.end_time.getTime()/1e3),""!=this.formItem.show_time&&(t.show_time=Math.round(this.formItem.show_time.getTime()/1e3)),this.formItem.top_image.length>0&&(t.top_image=this.formItem.top_image[0].url),t},handleRoute:function(t){this.formItem.app_route=t},setTopImage:function(t){this.formItem.top_image=t},setPromotionMarkImage:function(t){this.formItem.promotion_mark=t},submitRequest:function(t,e){bus.$emit("on-loading");var i=this;this.$Util.api.post(e,t,i).then(function(t){i.$Notice.success({title:"请求成功",desc:""}),i.back()},function(t){bus.$emit("on-loading"),i.$Notice.warning({title:"请求失败",desc:""})})},loadResource:function(){},loadEditFormData:function(){bus.$emit("on-loading");var t=this;this.$Util.api.get(o.find,t).then(function(e){bus.$emit("on-loading"),t.formItem=e.data,t.formItem.top_image=[{url:e.data.top_image.origin}],t.promotionTypeDisabled=!0,5==e.data.type&&e.data.end_time<new Date&&(t.endTimeDisabled=!0)},function(e){bus.$emit("on-loading"),t.$Notice.warning({title:"加载详情失败",desc:""})})},initIds:function(){if("edit"===this.usage){var t=this.id;if(!parseInt(t))return alert("id格式有误"),!1;t=parseInt(t),this.formItem.id=t,o.find.api.params.id=t}}},created:function(){this.initIds(),this.$nextTick(function(){"edit"===this.usage&&(this.promotionTypeDisabled=!1,this.loadEditFormData(),o.resource.api.path="/boss/mall/promotion/promotion/edit-page-info")})}}}});