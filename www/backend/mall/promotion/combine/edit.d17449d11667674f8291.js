webpackJsonp([105],{"5Jch":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page-edit",{attrs:{"is-loading":t.loadingState}},[i("m-combine-form",{attrs:{usage:"edit",id:t.id},on:{loading:t.changeLoadingState}})],1)},staticRenderFns:[]}},"K/58":function(t,e,i){var a=i("VU/8")(i("oWuf"),i("TXID"),null,null);t.exports=a.exports},TXID:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-page",[i("Form",{ref:"myForm",attrs:{model:t.formItem,"label-width":120,rules:t.ruleValidate}},[""!=t.formItem.id?i("div",{staticStyle:{width:"100px","text-align":"right","padding-right":"20px"}},[t._v("ID:"+t._s(t.formItem.id))]):t._e(),t._v(" "),i("Form-item",{attrs:{label:"组标题",prop:"title"}},[i("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"组标题，最多15个字符"},model:{value:t.formItem.title,callback:function(e){t.$set(t.formItem,"title",e)},expression:"formItem.title"}})],1),t._v(" "),i("Form-item",{attrs:{label:"可单独退货",prop:"can_return_separately"}},[i("Radio-group",{model:{value:t.formItem.can_return_separately,callback:function(e){t.$set(t.formItem,"can_return_separately",e)},expression:"formItem.can_return_separately"}},[i("Radio",{attrs:{label:"1"}},[t._v("是")]),t._v(" "),i("Radio",{attrs:{label:"0"}},[t._v("否")])],1)],1),t._v(" "),i("Form-item",[i("Card",[i("div",{staticStyle:{margin:"5px"}},[t._v("商品设置\n            "),i("Button",{attrs:{type:"primary",icon:"ios-plus",size:"small"},on:{click:function(e){t.addGoods()}}},[t._v("添加")])],1),t._v(" "),i("table",{staticClass:"ivu-table",staticStyle:{width:"720px"},attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[i("tr",[i("th",[i("div",{staticClass:"ivu-table-cell"},[t._v("商品规格id")])]),t._v(" "),i("th",[i("div",{staticClass:"ivu-table-cell"},[t._v("组合商品价格")])]),t._v(" "),i("th",[i("div",{staticClass:"ivu-table-cell"},[t._v("组合数量")])]),t._v(" "),i("th",[i("div",{staticClass:"ivu-table-cell"},[t._v("操作")])])]),t._v(" "),t._l(t.formItem.combine_items,function(e,a){return i("tr",[i("td",[i("div",{staticClass:"ivu-table-cell"},[i("Input",{staticStyle:{width:"100px"},attrs:{placeholder:"商品规格id"},model:{value:e.goods_spec_id,callback:function(i){t.$set(e,"goods_spec_id",i)},expression:"item.goods_spec_id"}})],1)]),t._v(" "),i("td",[i("div",{staticClass:"ivu-table-cell"},[i("Input",{staticStyle:{width:"100px"},attrs:{placeholder:"组合商品价格"},model:{value:e.goods_price,callback:function(i){t.$set(e,"goods_price",i)},expression:"item.goods_price"}})],1)]),t._v(" "),i("td",[i("div",{staticClass:"ivu-table-cell"},[i("Input-number",{staticStyle:{width:"100px"},attrs:{min:1,placeholder:"组合数量"},model:{value:e.quantity,callback:function(i){t.$set(e,"quantity",i)},expression:"item.quantity"}})],1)]),t._v(" "),i("td",[i("div",{staticClass:"ivu-table-cell"},[i("Button",{attrs:{type:"error"},on:{click:function(e){t.removeGoods(a)}}},[t._v("删除")])],1)])])})],2)])],1),t._v(" "),i("Form-item",[i("i-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("提交")]),t._v(" "),i("i-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:function(e){t.back()}}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]}},mYUr:function(t,e,i){var a=i("VU/8")(i("yuox"),i("5Jch"),null,null);t.exports=a.exports},oWuf:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("Edfu"),o=i.n(a),s={create:{api:{path:"/boss/mall/promotion/combine/create",params:{promotion_id:0},exceptionHandle:function(t,e){alert(e.replace("\\r","\r"))}}},update:{api:{path:"/boss/mall/promotion/combine/update",params:{promotion_id:0}},exceptionHandle:function(t,e){alert(e.replace("\\r","\r"))}},find:{api:{path:"/boss/mall/promotion/combine/find",params:{id:0,fields:"{id,promotion_id,can_return_separately,title,create_time,update_time,combine_items{id,goods_id,goods_spec_id,goods_price,quantity,create_time,update_time},promotion{id,name,title,desc,type,start_time,end_time,update_time}}"}},responseHandle:function(t,e){return t.data.can_return_separately=t.data.can_return_separately?1:0,t}}};e.default={components:{MPage:o.a},name:"MCombineForm",props:{id:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{promotion:{name:"",title:"",desc:"",start_time:"",end_time:""},formItem:{id:"",title:"",promotion_id:"",can_return_separately:0,combine_items:[{id:0,goods_id:"",goods_spec_id:"",goods_price:"",quantity:1}]},ruleValidate:{title:[{required:!0,message:"组名称不能为空",trigger:"blur"}]}}},methods:{back:function(){var t="add"==this.usage?this.id:this.formItem.promotion_id;location.hash="/mall/promotion/"+t+"/combine/list"},addGoods:function(t){null==t&&(t={id:0,goods_id:"",goods_spec_id:"",goods_price:"",quantity:1}),this.formItem.combine_items.push(t)},removeGoods:function(t){this.formItem.combine_items.length>1&&this.formItem.combine_items.splice(t,1)},submit:function(){if(this.validateFormData()){var t=this.getRequestParams(),e=s.create;"edit"===this.usage&&(e=s.update),this.submitRequest(t,e)}},validateFormData:function(){var t=this,e=!0;if(this.$refs.myForm.validate(function(i){i||(t.$Message.error("表单验证失败!"),e=!1)}),!e)return!1;if(this.formItem.combine_items.length<2)return this.$Message.error("至少填写2件商品!"),!1;var i={};for(var a in this.formItem.combine_items){var o=this.formItem.combine_items[a].goods_spec_id;if(""==o||isNaN(o))return this.$Message.error("商品规格id不能为空，必须为数字"),!1;if(""==this.formItem.combine_items[a].goods_price||isNaN(this.formItem.combine_items[a].goods_price))return this.$Message.error("组合商品价格不能为空，必须为数字"),!1;if(""==this.formItem.combine_items[a].quantity||isNaN(this.formItem.combine_items[a].quantity))return this.$Message.error("组合数量不能为空，必须为数字"),!1;if(i[o])return this.$Message.error("组合商品规格id不能重复,id="+o),!1;i[o]=!0}return!0},getRequestParams:function(){var t={};return"add"==this.usage?t.promotion_id=this.id:(t.id=this.id,t.promotion_id=this.formItem.promotion_id),t.title=this.formItem.title,t.can_return_separately=this.formItem.can_return_separately,t.goods=this.formItem.combine_items,t},submitRequest:function(t,e){bus.$emit("on-loading");var i=this;this.$Util.api.post(e,t,i).then(function(t){i.$Notice.success({title:"请求成功",desc:""}),i.back()},function(t){bus.$emit("on-loading"),i.$Notice.warning({title:"请求失败",desc:""})})},loadEditFormData:function(){s.find.api.params.id=this.id;var t=this;bus.$emit("on-loading"),this.$Util.api.get(s.find,this).then(function(e){if(bus.$emit("on-loading"),!e.data)return t.$Message.warning("数据不存在"),!1;t.promotion.id=e.data.id,t.promotion.name=e.data.name,t.promotion.desc=e.data.desc,t.formItem=e.data},function(t){})}},created:function(){"add"==this.usage&&(s.create.api.params.promotion_id=this.id),"edit"===this.usage&&(this.formItem.id=this.id,s.find.api.params.id=this.id),this.$nextTick(function(){"edit"===this.usage&&this.loadEditFormData()})}}},yuox:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("K/58"),o=i.n(a);e.default={name:"app",components:{MCombineForm:o.a},data:function(){return{id:this.$route.params.id,loadingState:!1}},methods:{changeLoadingState:function(){this.loadingState=!this.loadingState}}}}});