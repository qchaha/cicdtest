webpackJsonp([175],{"+qFI":function(t,e,a){a("jiZw");var i=a("VU/8")(a("72Gk"),a("tWOw"),"data-v-89e2396c",null);t.exports=i.exports},"72Gk":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"Edit",data:function(){var t=this,e=function(e,a,i){t.existsId?i(new Error("与已有品牌重名")):i()},a=function(t,e,a){e.replace(/[\u0391-\uFFE5]/g,"aa").length>24?a(new Error("最多12个中文（24字符）")):a()},i=function(e,a,i){t.brand.show&&""==a?i(new Error("路由不能为空")):i()};return{brand:{name:"",image:"",selling_point:"",sort:0,ratio_of_image:1,app_route:"",show:!1},formRef:"baseForm",nameLastChangedAt:null,existsId:0,detailApi:{api:{path:"/boss/mall/catalog/brand/find",params:{id:this.$route.params.id,fields:"{id,name,image{origin},sort,show,selling_point,app_route}"}}},findApi:{api:{path:"/boss/mall/catalog/brand/check-name",params:{id:0,name:"",fields:"{id,name}"}}},submitApi:{api:{path:"/boss/mall/catalog/brand/update"}},validateRules:{name:[{required:!0,message:"品牌名称不能为空",trigger:"blur"},{type:"string",max:20,message:"品牌名称不能多于20个字符",trigger:"blur"},{validator:e,trigger:"blur"}],image:[{required:!0,message:"图片不能为空",trigger:"change"},{type:"string",max:300,message:"图片路径不能多于300个字符",trigger:"change"}],selling_point:[{required:!0,message:"品牌卖点不能为空",trigger:"blur"},{validator:a,trigger:"blur"}],app_route:[{required:!0,message:"路由不能为空",trigger:"blur"},{validator:i,trigger:"blur"}]},loadTotal:1,loadedNum:0}},created:function(){var t=this,e=this;this.$nextTick(function(){t.$route.params.id?(bus.$emit("on-loading"),e.loadDetail()):t.$Modal.error({width:260,title:"错误提示",content:"非法操作：缺少必要参数"})})},watch:{loadedNum:function(){this.loadedNum>=this.loadTotal&&(bus.$emit("on-loading"),this.loadedNum=0)},"brand.name":function(){this.existsId=0,this.nameLastChangedAt=(new Date).getTime(),this.brand.name&&setTimeout(this.isNameExists,1e3)}},methods:{handleSelectRoute:function(t){this.brand.app_route=t},loadDetail:function(){var t=this;this.$Util.api.get(this.detailApi,this).then(function(e){t.loadedNum+=1,t.brand=e.data,t.brand.image=e.data.image.origin,t.brand.ratio_of_image=1},function(e){t.loadedNum+=1,t.alertErrorTips(e.message?e.message:"发生了未知的错误",300)})},alertErrorTips:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250;this.$Modal.error({width:e,content:t})},handleUploadSuccess:function(t){this.brand.image=t[0].url;var e=t.length>0?(t[0].width/t[0].height).toFixed(4):0;this.brand.ratio_of_image=e},isNameExists:function(){(new Date).getTime()-1e3>=this.nameLastChangedAt&&this.findByName(this.brand.name)},findByName:function(t){var e=this;this.findApi.api.params.id=this.$route.params.id,this.findApi.api.params.name=t,this.$Util.api.get(this.findApi,this).then(function(t){0===t.error_code&&null!==t.data&&t.data.length>0&&(e.existsId=t.data[0].id)},function(t){e.alertErrorTips(t.message?t.message:"发生了未知的错误",300)})},submit:function(){var t=this;this.$refs[this.formRef].validate(function(e){if(e){bus.$emit("on-loading");var a=t;if(a.brand.ratio_of_image-1!=0)return bus.$emit("on-loading"),void a.alertErrorTips("图片长宽比需要1:1");t.$Util.api.post(t.submitApi,t.brand,a).then(function(t){bus.$emit("on-loading"),0===t.error_code?a.$Modal.success({width:250,content:"提交成功"}):a.alertErrorTips(t.error_description?t.error_description:"提交失败",300)},function(t){bus.$emit("on-loading"),a.alertErrorTips(t.message?t.message:"提交失败",300)})}else t.alertErrorTips("有表单项填写非法")})}}}},jiZw:function(t,e,a){var i=a("yXML");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("775b734b",i,!0)},tWOw:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("m-page",[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("基本信息")]),t._v(" "),a("Button",{attrs:{slot:"extra",type:"primary"},on:{click:t.submit},slot:"extra"},[t._v("提交")]),t._v(" "),a("div",[a("Form",{ref:t.formRef,attrs:{model:t.brand,rules:t.validateRules,"label-width":80}},[a("Form-item",{attrs:{label:"ID"}},[a("span",[t._v(t._s(t.brand.id))])]),t._v(" "),a("Form-item",{attrs:{label:"品牌名称",prop:"name"}},[a("Input",{staticClass:"fixed-width-input",attrs:{placeholder:"请输入品牌名称"},model:{value:t.brand.name,callback:function(e){t.$set(t.brand,"name",e)},expression:"brand.name"}}),t._v(" "),t.existsId?a("a",{staticClass:"input-tips",attrs:{target:"_blank",href:"#/mall/catalog/brand/edit/"+t.existsId}},[t._v("查看同名品牌")]):t._e()],1),t._v(" "),a("Form-item",{attrs:{label:"品牌卖点",prop:"selling_point"}},[a("Input",{staticClass:"fixed-width-input",attrs:{placeholder:"请输入品牌卖点"},model:{value:t.brand.selling_point,callback:function(e){t.$set(t.brand,"selling_point",e)},expression:"brand.selling_point"}})],1),t._v(" "),a("Form-item",{attrs:{label:"品牌图片",prop:"image"}},[a("m-upload-image",{attrs:{"default-images":[{url:t.brand.image}]},on:{"on-success":t.handleUploadSuccess}})],1),t._v(" "),a("Form-item",{attrs:{label:"品牌推荐排序",prop:"sort"}},[a("Input",{staticClass:"fixed-width-input",attrs:{placeholder:"请输入品牌推荐排序"},model:{value:t.brand.sort,callback:function(e){t.$set(t.brand,"sort",e)},expression:"brand.sort"}})],1),t._v(" "),a("Form-item",{attrs:{label:"在商详显示",prop:"show"}},[a("i-switch",{model:{value:t.brand.show,callback:function(e){t.$set(t.brand,"show",e)},expression:"brand.show"}})],1),t._v(" "),t.brand.show?a("div",[a("Form-item",{attrs:{label:"跳转路由",prop:"app_route"}},[a("m-app-route",{attrs:{disabled:t.editDisabled,placeholder:"请输入跳转路由","default-route":t.brand.app_route},on:{"on-ok":t.handleSelectRoute}})],1)],1):t._e()],1)],1)],1)],1)},staticRenderFns:[]}},yXML:function(t,e,a){e=t.exports=a(0)(),e.push([t.i,".ivu-form-item-required[data-v-89e2396c]:not(:last-child){margin-bottom:24px}.fixed-width-input[data-v-89e2396c]{display:inline-block;width:300px}.input-tips[data-v-89e2396c]{margin-left:10px;font-size:12px}",""])}});