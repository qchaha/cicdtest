webpackJsonp([118],{"2fPk":function(t,e,a){var n=a("VU/8")(a("yoyg"),a("aZRh"),null,null);t.exports=n.exports},aZRh:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"padding-top":"20px"}},[a("Form",{ref:"formItem",attrs:{model:t.formItem,"label-width":120,rules:t.ruleValidate}},[a("Form-item",{attrs:{label:"品牌名称",prop:"brand_name"}},[a("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"品牌名称"},model:{value:t.formItem.brand_name,callback:function(e){t.$set(t.formItem,"brand_name",e)},expression:"formItem.brand_name"}})],1),t._v(" "),a("Form-item",{attrs:{label:"品牌图标"}},[a("m-upload-image",{attrs:{"default-images":t.formItem.brand_logo,format:"path"},on:{"on-success":t.setLogoImage}})],1),t._v(" "),a("Form-item",{attrs:{label:"品牌分类名称",prop:"bcate_id"}},[a("Select",{staticStyle:{width:"200px"},model:{value:t.formItem.bcate_id,callback:function(e){t.$set(t.formItem,"bcate_id",e)},expression:"formItem.bcate_id"}},t._l(t.brandCategoryList,function(e){return a("Option",{key:e.bcate_id,attrs:{value:e.bcate_id}},[t._v(t._s(e.bcate_name))])}))],1),t._v(" "),a("Form-item",{attrs:{label:"app链接信息",prop:"link"}},[a("div",[a("m-app-route",{attrs:{"default-route":t.formItem.link},on:{"on-ok":t.handleRoute}}),t._v("（如果该品牌有专业的H5品牌页，请填写链接，格式：openurl2/http://mli.so/page/baowang_brand_zone/，无则不填）\n            ")],1)]),t._v(" "),"edit"==t.usage?a("Form-item",{attrs:{label:"APP路由链接(2.8.4版本及以下)"}},[a("div",[t._v("meijiabang://goods?filterby=brand&&id="+t._s(t.formItem.id)+"&&name="+t._s(encodeURIComponent(t.formItem.brand_name)))])]):t._e(),t._v(" "),"edit"==t.usage?a("Form-item",{attrs:{label:"APP路由链接(2.8.5版本及以上)"}},[a("div",[t._v("meijiabang://goods_search?keyword="+t._s(encodeURIComponent(t.formItem.brand_name)))])]):t._e(),t._v(" "),a("Form-item",{staticStyle:{"margin-top":"20px"}},[a("i-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("提交")]),t._v(" "),a("i-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:t.back}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]}},ar87:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("m-page-edit",{attrs:{"is-loading":t.loadingState}},[a("m-brand-form",{attrs:{usage:"add"},on:{loading:t.changeLoadingState}})],1)},staticRenderFns:[]}},gw4j:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("2fPk"),i=a.n(n);e.default={name:"app",components:{MBrandForm:i.a},data:function(){return{loadingState:!1}},methods:{changeLoadingState:function(){this.loadingState=!this.loadingState}}}},jo74:function(t,e,a){var n=a("VU/8")(a("gw4j"),a("ar87"),null,null);t.exports=n.exports},yoyg:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={create:{api:{path:"/boss/mall/catalog/deprecated-brand/create"}},update:{api:{path:"/boss/mall/catalog/deprecated-brand/update"}},find:{api:{path:"/boss/mall/catalog/deprecated-brand/find",params:{fields:"{brand_id,brand_name,brand_logo(w:80,h:80){url,origin},sort_order,recommended,tag,category{bcate_id,bcate_name},link,create_time,update_time}",id:0}},responseHandle:function(t){return t}},resource:{api:{path:"/boss/mall/catalog/deprecated-brand-category/find-list",params:{fields:"{bcate_id,bcate_name}",offset:0,limit:200}},responseHandle:function(t){return t}}};e.default={name:"MBrandForm",props:{id:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{formItem:{id:0,brand_name:"",brand_logo:[],bcate_id:"",link:""},brandCategoryList:{},ruleValidate:{brand_name:[{required:!0,message:"品牌名称不能为空",trigger:"blur"},{type:"string",max:20,message:"品牌名称不能超过20字",trigger:"blur"}],bcate_id:[{required:!0,type:"number",message:"品牌分类不能为空",trigger:"blur"}]}}},methods:{back:function(){location.hash="/mall/catalog/deprecated-brand/list"},setLogoImage:function(t){this.formItem.brand_logo=t},handleRoute:function(t){this.formItem.link=t},submit:function(){var t=this;this.$refs.formItem.validate(function(e){if(e){if(!t.validateFormData())return;var a=t.getRequestParams(),i=n.create;"edit"===t.usage&&(i=n.update),t.submitRequest(a,i)}else t.$Message.error("表单验证失败!")})},validateFormData:function(){return!0},getRequestParams:function(){return{id:this.formItem.id,brand_name:this.formItem.brand_name,brand_logo:this.formItem.brand_logo.length>0?this.formItem.brand_logo[0].url:"",bcate_id:this.formItem.bcate_id,link:this.formItem.link}},submitRequest:function(t,e){bus.$emit("on-loading");var a=this;vm.$Util.api.post(e,t,a).then(function(t){a.$Notice.success({title:"请求成功",desc:""}),a.back()},function(t){bus.$emit("on-loading"),a.$Notice.warning({title:"请求失败",desc:""})})},loadResource:function(){bus.$emit("on-loading");var t=this;this.$Util.api.get(n.resource,t).then(function(e){bus.$emit("on-loading"),this.brandCategoryList=e.data,"edit"===t.usage&&t.$nextTick(function(){t.loadBrand()})},function(e){bus.$emit("on-loading"),t.$Notice.warning({title:"加载资源失败",desc:""})})},loadBrand:function(){bus.$emit("on-loading");var t=this;this.$Util.api.get(n.find,t).then(function(e){bus.$emit("on-loading"),t.formItem.id=e.data.brand_id,t.formItem.brand_name=e.data.brand_name,t.formItem.brand_logo=[{url:e.data.brand_logo.origin}],t.formItem.bcate_id=e.data.category.bcate_id,t.formItem.link=e.data.link},function(e){bus.$emit("on-loading"),t.$Notice.warning({title:"加载brand详情失败",desc:""})})},initIds:function(){if("edit"===this.usage){var t=this.id;if(!parseInt(t))return alert("id格式有误"),!1;t=parseInt(t),this.formItem.id=t,n.find.api.params.id=t}}},created:function(){this.initIds(),this.$nextTick(function(){this.loadResource()})}}}});