webpackJsonp([16],{"/8iU":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=s("RvU2"),a=s.n(o),i=s("bsNq"),n=s.n(i),c=s("A8mJ"),r=s.n(c);e.default={name:"MGoodsSpecForm",components:{"m-goods-info":a.a,"m-spec-list":n.a,"m-form":r.a},props:{id:{type:String,default:""},goods_id:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{goodsSpec:{},goods:{},loadNum:0,loadTotalNum:2}},created:function(){var t=this;this.$nextTick(function(){t.goods_id?t.id?(bus.$emit("on-loading"),t.loadGoodsData(t.goods_id),t.loadGoodsSpecData(t.id)):(bus.$emit("on-loading"),t.loadNum+=1,t.loadGoodsData(t.goods_id)):t.$Modal.error({width:260,title:"错误提示",content:"非法操作：缺少必要参数"})})},watch:{loadNum:function(t){t>=this.loadTotalNum&&bus.$emit("on-loading")}},methods:{loadGoodsData:function(t){var e=this;this.$Util.api.get({api:{path:"/boss/mall/catalog/goods/find?id="+t,params:{fields:"{goods_id,goods_name,if_show,mall_price,original_price,price_grade,delete_time,cover{image_url{origin}},spec_name_1,spec_name_2,spec_name_3,spec_name_4,spec_name_5,specs{id,spec_1,spec_2,spec_3,spec_4,spec_5}}"}}}).then(function(t){e.loadNum+=1,e.goods=t.data,e.goods.cover&&(e.goods.image=e.goods.cover.image_url.origin)},function(t){e.loadNum+=1,e.$Modal.error({width:300,title:"错误提示",content:t.error_description?t.error_description:t.error_message})})},loadGoodsSpecData:function(t){var e=this;this.loadNum>=this.loadTotalNum&&bus.$emit("on-loading"),this.$Util.api.get({api:{path:"/boss/mall/catalog/goods-spec/find",params:{id:t,fields:"{id,goods_id,spec_1,spec_2,spec_3,spec_4,spec_5,status,price,price_origin,spec_category_id,color_tag_id,sku,stock,image,image_url{s(w:80,h:80){url,origin}}}"}}}).then(function(t){e.loadNum+=1,e.goodsSpec=t.data},function(t){e.loadNum+=1,e.$Modal.error({width:300,title:"错误提示",content:t.error_description?t.error_description:t.error_message})})}}}},"5SSU":function(t,e,s){s("RjFR");var o=s("VU/8")(s("/8iU"),s("Fg4z"),"data-v-4826c5db",null);t.exports=o.exports},A8mJ:function(t,e,s){s("wEc4");var o=s("VU/8")(s("npt1"),s("F5bF"),"data-v-64260264",null);t.exports=o.exports},BEGV:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"mSpecList",props:["goodsSpec","goods"],data:function(){return{loadFinshed:!1,btnClassList:[]}},created:function(){var t=this;this.$nextTick(function(){var e=t;bus.$on("sync-spec-val",function(t){for(var s=t[0],o=t[1],a=0;a<e.goods.specs.length;a++)e.goods.specs[a].id===s&&e.goods.specs.splice(a,1,Object.assign(e.goods.specs[a],o))})})},methods:{selectSpec:function(t){this.$emit("select-spec",t)},setActiveClass:function(t){for(var e=0;e<this.goods.specs.length;e++)this.goods.specs[e].id==t?this.btnClassList.splice(e,1,{class:"info-ghost-btn-active"}):this.btnClassList.splice(e,1,{class:"info-ghost-btn"})}},filters:{specText:function(t){for(var e=[],s=1;s<6;s++)t["spec_"+s]&&e.push(t["spec_"+s]);return e.join("，")}},watch:{goods:function(){this.goods.specs&&this.goods.specs.length>0&&(this.setActiveClass(this.$route.params.id),this.loadFinshed=!0)},goodsSpec:function(){this.goodsSpec&&this.goods.specs&&this.goods.specs.length>0&&this.setActiveClass(this.goodsSpec.id)}}}},ETZL:function(t,e,s){e=t.exports=s(0)(),e.push([t.i,".ivu-card[data-v-4826c5db]{margin-bottom:15px}",""])},F5bF:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Card",[s("h3",[t._v("规格信息")]),t._v(" "),s("Form",{ref:"formValidate",staticClass:"fixed-width-form",attrs:{model:t.spec,"label-width":100,rules:t.validateRules}},[t._l(t.specNameOptions,function(e,o){return s("Form-item",{attrs:{label:e.label,prop:e.key,rules:{required:!0,type:"string",message:e.label+"不能为空",trigger:"blur"}}},[s("Input",{model:{value:t.spec[e.key],callback:function(s){t.$set(t.spec,e.key,s)},expression:"spec[item.key]"}})],1)}),t._v(" "),s("Form-item",{attrs:{label:"规格图片"}},[s("m-upload-image",{attrs:{"default-images":[{url:t.spec.image}]},on:{"on-success":t.syncImages}})],1),t._v(" "),s("Form-item",{attrs:{label:"规格状态",prop:"status"}},[s("Select",{model:{value:t.spec.status,callback:function(e){t.$set(t.spec,"status",e)},expression:"spec.status"}},t._l(t.statusOptions,function(e){return s("Option",{attrs:{value:e.value}},[t._v(t._s(e.label))])}))],1),t._v(" "),s("Form-item",{staticClass:"append-form-item",attrs:{label:"规格分类",prop:"spec_category_id"}},[s("Select",{attrs:{filterable:"",clearable:"",placeholder:"搜索规格分类"},model:{value:t.spec.spec_category_id,callback:function(e){t.$set(t.spec,"spec_category_id",e)},expression:"spec.spec_category_id"}},t._l(t.specCategoryOptions,function(e){return s("Option",{attrs:{value:e.id}},[t._v(t._s(e.name))])})),t._v(" "),s("Tooltip",{attrs:{content:"点击新增规格分类",placement:"right"}},[s("a",{staticClass:"append-text",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.addSpecCategory(e)}}},[t._v("添加规格分类")])])],1),t._v(" "),s("Form-item",{attrs:{label:"颜色标签"}},[s("Select",{attrs:{filterable:"",clearable:"",placeholder:"搜索颜色标签"},model:{value:t.spec.color_tag_id,callback:function(e){t.$set(t.spec,"color_tag_id",e)},expression:"spec.color_tag_id"}},t._l(t.colorTagOptions,function(e){return s("Option",{attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1),t._v(" "),s("Form-item",{attrs:{label:"SKU条码",prop:"sku"}},[s("Input",{model:{value:t.spec.sku,callback:function(e){t.$set(t.spec,"sku",e)},expression:"spec.sku"}})],1),t._v(" "),"edit"===t.usage?s("Form-item",{staticClass:"append-form-item",attrs:{label:"库存",prop:"stock"}},[s("Input-number",{staticClass:"number-input",attrs:{disabled:!0},model:{value:t.spec.stock,callback:function(e){t.$set(t.spec,"stock",e)},expression:"spec.stock"}}),t._v(" "),s("Input",{model:{value:t.spec.change_stock,callback:function(e){t.$set(t.spec,"change_stock",e)},expression:"spec.change_stock"}},[s("Select",{staticStyle:{width:"80px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:t.spec.update_stock_type,callback:function(e){t.$set(t.spec,"update_stock_type",e)},expression:"spec.update_stock_type"}},[s("Option",{attrs:{value:"add"}},[t._v("增加")]),t._v(" "),s("Option",{attrs:{value:"minus"}},[t._v("减少")])],1)],1),t._v(" "),s("span",{staticClass:"append-text input-tips"},[t._v("请填写非负整数")])],1):t._e(),t._v(" "),"add"===t.usage?s("Form-item",{staticClass:"append-form-item",attrs:{label:"库存",prop:"stock"}},[s("Input-number",{staticClass:"number-input",attrs:{min:0},model:{value:t.spec.stock,callback:function(e){t.$set(t.spec,"stock",e)},expression:"spec.stock"}}),t._v(" "),s("span",{staticClass:"append-text input-tips"},[t._v("请填写非负整数")])],1):t._e(),t._v(" "),s("Form-item",[s("Button",{attrs:{type:"primary"},on:{click:function(e){t.isExists("formValidate",!0)}}},[t._v("提交")]),t._v(" "),s("Button",{staticClass:"btn-blue-border",attrs:{type:"ghost"},on:{click:function(e){t.isExists("formValidate",!1)}}},[t._v("提交并新建")])],1)],2),t._v(" "),s("Modal",{attrs:{title:"添加规格分类",width:"250","mask-closable":!1,loading:!0},on:{"on-ok":t.submitAddSpecCategory},model:{value:t.showAddSpecCatgeoryModal,callback:function(e){t.showAddSpecCatgeoryModal=e},expression:"showAddSpecCatgeoryModal"}},[s("section",[s("label",[s("span",{staticClass:"modal-input-label"},[t._v("规格分类")]),t._v(" "),s("Input",{staticClass:"modal-input",model:{value:t.category_name,callback:function(e){t.category_name=e},expression:"category_name"}})],1)])])],1)},staticRenderFns:[]}},Fg4z:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("m-page",[s("m-goods-info",{attrs:{goods:t.goods}}),t._v(" "),"edit"===t.usage?s("m-spec-list",{attrs:{goodsSpec:t.goodsSpec,goods:t.goods},on:{"select-spec":t.loadGoodsSpecData}}):t._e(),t._v(" "),s("m-form",{attrs:{goods:t.goods,goodsSpec:t.goodsSpec,usage:t.usage}})],1)},staticRenderFns:[]}},GQZs:function(t,e,s){var o=s("R27X");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);s("rjj0")("9330d0e0",o,!0)},Hthq:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("m-page-edit",{attrs:{"is-loading":t.loadingState}},[s("m-goods-spec-form",{attrs:{usage:"edit",goods_id:t.goods_id,id:t.id},on:{loading:t.changeLoadingState}})],1)},staticRenderFns:[]}},R27X:function(t,e,s){e=t.exports=s(0)(),e.push([t.i,".info-card[data-v-7e2c1170]{margin-bottom:10px}.detail-item[data-v-7e2c1170]{margin-top:5px}.detail-info[data-v-7e2c1170]{color:#666}#price-list li[data-v-7e2c1170]{display:inline-block;margin-right:15px}",""])},RjFR:function(t,e,s){var o=s("ETZL");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);s("rjj0")("67680be0",o,!0)},RvU2:function(t,e,s){s("GQZs");var o=s("VU/8")(s("VaIL"),s("V61T"),"data-v-7e2c1170",null);t.exports=o.exports},V61T:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Card",[s("h3",[t._v("商品信息")]),t._v(" "),s("p",{staticClass:"detail-item"},[t._v("Goods_ID："),s("Tooltip",{attrs:{content:"点击查看商品详情",placement:"right"}},[s("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.toGoodsDetail(e)}}},[t._v(t._s(t.goodsId))])])],1),t._v(" "),s("p",{staticClass:"detail-item"},[t._v("商品名称："),s("span",{staticClass:"detail-info"},[t._v(t._s(t.goodsName))])]),t._v(" "),s("p",{staticClass:"detail-item"},[t._v("状态："),s("span",{staticClass:"detail-info"},[t._v(t._s(t.statusText))])]),t._v(" "),s("p",{staticClass:"detail-item"},[t._v("管理员："),s("span",{staticClass:"detail-info"},[t._v(t._s(t.operator))])]),t._v(" "),s("ul",{staticClass:"detail-item",attrs:{id:"price-list"}},[s("li",[t._v("商城价："),s("span",{staticClass:"detail-info"},[t._v("￥"+t._s(t.mallPrice))])]),t._v(" "),s("li",[t._v("银牌价："),s("span",{staticClass:"detail-info"},[t._v("￥"+t._s(t.silverPrice))])]),t._v(" "),s("li",[t._v("金牌价："),s("span",{staticClass:"detail-info"},[t._v("￥"+t._s(t.goldPrice))])]),t._v(" "),s("li",[t._v("白金价："),s("span",{staticClass:"detail-info"},[t._v("￥"+t._s(t.platinumPrice))])])])])},staticRenderFns:[]}},VaIL:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});s("pb2F");e.default={name:"mGoodsInfo",props:["goods"],data:function(){return{}},computed:{goodsId:function(){return this.goods&&this.goods.goods_id?this.goods.goods_id:""},goodsName:function(){return this.goods&&this.goods.goods_name?this.goods.goods_name:""},statusText:function(){return this.goods&&this.goods.delete_time?"废弃":this.goods&&this.goods.if_show?"上架":this.goods&&!this.goods.if_show?"下架":""},operator:function(){return""},mallPrice:function(){return this.goods&&this.goods.mall_price?this.goods.mall_price:""},silverPrice:function(){if(this.goods&&this.goods.price_grade){return JSON.parse(this.goods.price_grade)[10]}return""},goldPrice:function(){if(this.goods&&this.goods.price_grade){return JSON.parse(this.goods.price_grade)[20]}return""},platinumPrice:function(){if(this.goods&&this.goods.price_grade){return JSON.parse(this.goods.price_grade)[30]}return""}},methods:{toGoodsDetail:function(){location.hash="/mall/catalog/goods/edit/"+this.goods.goods_id}}}},bsNq:function(t,e,s){s("zPxi");var o=s("VU/8")(s("BEGV"),s("gpic"),"data-v-57ad4032",null);t.exports=o.exports},fNaG:function(t,e,s){e=t.exports=s(0)(),e.push([t.i,".sub-title[data-v-57ad4032]{font-size:14px;color:#aaa;margin-left:15px;font-weight:400}.info-ghost-btn[data-v-57ad4032]{margin-top:15px;margin-right:15px;color:#28a3ef;border-color:#28a3ef}.info-ghost-btn-active[data-v-57ad4032]{margin-top:15px;margin-right:15px;color:#fff;border-color:#28a3ef;background-color:#28a3ef}",""])},gpic:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Card",[s("h3",[t._v("规格列表"),s("span",{staticClass:"sub-title"},[t._v("单击将刷新当前页面，展示该规格详情")])]),t._v(" "),t.loadFinshed?s("section",t._l(t.goods.specs,function(e,o){return s("Button",{class:t.btnClassList[o].class,attrs:{type:"ghost",size:"small"},on:{click:function(s){t.selectSpec(e.id)}}},[t._v("\n            "+t._s(t._f("specText")(e,e))+"\n        ")])})):t._e()])},staticRenderFns:[]}},npt1:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});s("pb2F");e.default={name:"mForm",props:{goods:{type:Object,default:{}},goodsSpec:{type:Object,default:{}},usage:{type:String,default:"edit"}},data:function(){return{spec:{goods_id:0,spec_1:"",spec_2:"",spec_3:"",spec_4:"",spec_5:"",image:"",upload_image:[{url:""}],status:1,spec_category_id:0,color_tag_id:0,sku:"",stock:0,change_stock:0,update_stock_type:"add",price:"0.00",price_origin:"0.00"},statusOptions:[{value:1,label:"上架"},{value:-1,label:"下架"},{value:0,label:"废弃"}],colorTagOptions:[],specCategoryOptions:[],validateRules:{status:[{required:!0,type:"integer",message:"状态不能为空",trigger:"blur"}],spec_category_id:[{required:!0,type:"integer",min:1,message:"规格分类不能为空",trigger:"blur"}],sku:[{required:!0,type:"string",message:"SKU条码不能为空",trigger:"blur"}],change_stock:[{type:"integer",min:0,message:"修改库存必须为数字",trigger:"blur"}]},isImgVisible:!1,imgUrl:"",upload:{isFinished:!0,url:"",showProgress:!1,percentage:100},showAddSpecCatgeoryModal:!1,category_name:""}},computed:{specNameOptions:function(){var t=[];if(this.goods)for(var e=1;e<6;e++)this.goods["spec_name_"+e]&&t.push({key:"spec_"+e,label:this.goods["spec_name_"+e]});return t}},created:function(){var t=this;this.$nextTick(function(){t.loadColorTags()})},watch:{goods:function(){this.loadSpecCategories(),this.spec.goods_id=this.goods.goods_id,""===this.spec.image&&(this.spec.image=this.goods.image),this.spec.price=this.goods.mall_price,this.spec.price_origin=this.goods.original_price},goodsSpec:function(){this.spec=this.goodsSpec,this.spec.color_tag_id=parseInt(this.goodsSpec.color_tag_id)}},methods:{syncImages:function(t){this.spec.image=t[0].url},loadColorTags:function(){var t=this;this.$Util.api.get({api:{path:"/boss/mall/catalog/goods-spec/color-tag",params:{fields:"{id,name}"}}}).then(function(e){return t.colorTagOptions=e.data})},loadSpecCategories:function(){var t=this;this.$Util.api.get({api:{path:"/boss/mall/catalog/goods-spec/categories",params:{goods_id:this.goods.goods_id,fields:"{id,name}"}}}).then(function(e){if(t.specCategoryOptions=e.data,"add"===t.usage)for(var s=0;s<e.data.length;s++)"基本分类"===e.data[s].name&&(t.spec.spec_category_id=e.data[s].id)})},addSpecCategory:function(){this.showAddSpecCatgeoryModal=!0},submitAddSpecCategory:function(){var t=this,e=this;this.category_name?this.$Util.api.post({api:{path:"/boss/mall/catalog/goods-spec/add-category"}},{goods_id:this.goods.goods_id,category_name:this.category_name},this).then(function(s){0===s.error_code?(e.specCategoryOptions.push({id:s.data.id,name:e.category_name}),e.category_name="",e.showAddSpecCatgeoryModal=!1,t.$Modal.success({width:240,content:"添加规格分类成功"}),setTimeout(function(){this.$Modal.remove()},5e3)):t.$Modal.error({width:240,content:"出错了"})},function(e){t.$Modal.error({width:240,content:"出错了"})}):(this.showAddSpecCatgeoryModal=!1,this.$Modal.error({width:240,content:"规格分类名不能为空",onOk:function(){e.showAddSpecCatgeoryModal=!0}}))},isExists:function(t,e){var s=this,o=this;this.$refs[t].validate(function(t){if(t){if("minus"==s.spec.update_stock_type&&parseInt(s.spec.stock)-parseInt(s.spec.change_stock)<0)return void o.$Modal.error({width:240,content:"库存不能为负数"});bus.$emit("on-loading"),o.$Util.api.get({api:{path:"/boss/mall/catalog/goods-spec/find-by-spec-items",params:{goods_id:o.goods.goods_id,spec_1:o.spec.spec_1,spec_2:o.spec.spec_2,spec_3:o.spec.spec_3,spec_4:o.spec.spec_4,spec_5:o.spec.spec_5,fields:"{goods_id,id}"}}},o).then(function(t){if(0!==t.error_code||null===t.data||1===t.data.length&&t.data[0].id==s.goodsSpec.id){var a={};a="add"===s.usage?{api:{path:"/boss/mall/catalog/goods-spec/create"}}:{api:{path:"/boss/mall/catalog/goods-spec/update"}},o.handleSubmit(a,e)}else bus.$emit("on-loading"),o.$Modal.error({width:280,content:"规格名称与该商品其他规格重名"})},function(t){s.spec.image=[],s.spec.image[0].url=s.spec.image,bus.$emit("on-loading"),o.$Modal.error({width:240,content:"出错了"})})}})},handleSubmit:function(t,e){var s=this;this.$Util.api.post(t,this.spec).then(function(t){bus.$emit("on-loading");var o=s;if(0===t.error_code)if(e){var a=0;"edit"===o.usage?(s.$Modal.success({width:240,content:"修改规格成功"}),setTimeout(function(){location.reload()},1e3)):(s.$Modal.success({width:240,content:"添加规格成功"}),a=t.data.id,setTimeout(function(){location.hash="/mall/catalog/goods-spec/edit/"+a+"?goods_id="+o.goods.goods_id},1e3))}else s.$Modal.success({width:240,content:"添加规格成功"}),setTimeout(function(){location.hash="/mall/catalog/goods-spec/add?goods_id="+o.goods.goods_id},1e3);else s.spec.image=[],s.spec.image[0].url=s.spec.image,o.$Modal.error({width:300,title:"错误提示",content:t.error_description?t.error_description:t.error_message})},function(t){s.spec.image=[],s.spec.image[0].url=s.spec.image,bus.$emit("on-loading"),s.$Modal.error({width:300,title:"错误提示",content:t.message?t.message:"发生了未知的错误"})})},syncSpecVal:function(t){for(var e={},s=1;s<6;s++)e["spec_"+s]=this.spec["spec_"+s];bus.$emit("sync-spec-val",[t,e])}}}},rVYi:function(t,e,s){e=t.exports=s(0)(),e.push([t.i,".fixed-width-form[data-v-64260264]{width:300px}.ivu-form-item[data-v-64260264]{margin-top:24px}.append-form-item[data-v-64260264]{width:400px}.append-form-item .ivu-input-wrapper[data-v-64260264],.append-form-item .ivu-select[data-v-64260264]{width:200px}.append-text[data-v-64260264]{margin-left:10px}.append-text.input-tips[data-v-64260264]{color:#aaa}.btn-blue-border[data-v-64260264]{margin-left:15px;color:#2d8cf0;border-color:#2d8cf0}.upload-drag-area[data-v-64260264]{display:inline-block;width:70px;height:70px;line-height:70px}.upload-list[data-v-64260264]{display:inline-block;width:72px;height:72px;text-align:center;line-height:70px;border:1px solid transparent;border-radius:4px;overflow:hidden;background:#fff;position:relative;box-shadow:0 1px 1px rgba(0,0,0,.2);margin-right:5px}.upload-list img[data-v-64260264]{width:100%;height:100%}.upload-list-cover[data-v-64260264]{display:none;position:absolute;top:0;bottom:0;left:0;right:0;background:rgba(0,0,0,.6)}.upload-list:hover .upload-list-cover[data-v-64260264]{display:block}.upload-list-cover i[data-v-64260264]{color:#fff;font-size:20px;cursor:pointer;margin:0 2px}.modal-input-label[data-v-64260264]{font-weight:700;font-size:14px;margin-right:10px}.modal-input[data-v-64260264]{max-width:147px}.number-input[data-v-64260264]{width:200px}",""])},vViY:function(t,e,s){var o=s("VU/8")(s("yc9T"),s("Hthq"),null,null);t.exports=o.exports},wEc4:function(t,e,s){var o=s("rVYi");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);s("rjj0")("4ccfb4fb",o,!0)},yc9T:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=s("5SSU"),a=s.n(o);e.default={name:"goodsSpec",components:{MGoodsSpecForm:a.a},data:function(){return{id:this.$route.params.id,goods_id:this.$route.query.goods_id,loadingState:!1}},methods:{changeLoadingState:function(){this.loadingState=!this.loadingState}}}},zPxi:function(t,e,s){var o=s("fNaG");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);s("rjj0")("6f240df5",o,!0)}});