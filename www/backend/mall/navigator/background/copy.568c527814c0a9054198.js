webpackJsonp([108],{"1pCi":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={create:{api:{path:"/boss/mall/navigator/background/create"}},update:{api:{path:"/boss/mall/navigator/background/update"}},find:{api:{path:"/boss/mall/navigator/background/find",params:{id:0,fields:"{id,memo,start_time,end_time,audience,source}"}},responseHandle:function(e,t){var i=new Date;i.setTime(1e3*e.data.start_time),e.data.start_time=i;var a=new Date;if(a.setTime(1e3*e.data.end_time),e.data.end_time=a,e.data.show_time>0){var r=new Date;a.setTime(1e3*e.data.show_time),e.data.show_time=r}return e}},getAudienceList:{api:{path:"/boss/mall/navigator/background/get-audience-list"}}};t.default={name:"MBackgroundForm",props:{id:{type:String,default:""},usage:{type:String,default:"edit"}},data:function(){return{formItem:{id:0,memo:"",start_time:"",end_time:"",image:[],audience:"",color:""},audienceTypes:[{title:"不限",audience:""}],colors:[{color:"white",name:"白色"},{color:"black",name:"黑色"}],modal:!1,ruleValidate:{memo:[{required:!0,message:"标题不能为空",trigger:"blur"}],image:[{required:!0,type:"array",message:"请选择背景图",trigger:"blur"}],start_time:[{required:!0,type:"date",message:"开始时间不能为空",trigger:"blur"}],end_time:[{required:!0,type:"date",message:"结束时间不能为空",trigger:"blur"}],color:[{required:!0,message:"请选择颜色",trigger:"blur"}],audience:[{required:!0,message:"请选择展示对象",trigger:"blur"}]}}},methods:{back:function(){location.hash="/mall/navigator/background/list"},reset:function(){this.$refs.myForm.resetFields()},submit:function(){if(this.validateFormData()){var e=this.getRequestParams(),t=a.create;"edit"===this.usage&&(t=a.update),this.submitRequest(e,t)}},validateFormData:function(){var e=this,t=!0;return this.$refs.myForm.validate(function(i){i||(e.$Message.error("表单验证失败!"),t=!1)}),t&&this.formItem.start_time.getTime()>this.formItem.end_time.getTime()&&(this.$Message.error("开始时间不能大于结束时间!"),t=!1),t},getRequestParams:function(){var e={};return e.id=this.formItem.id,e.memo=this.formItem.memo,e.audience=this.formItem.audience,e.color=this.formItem.color,e.start_time=Math.round(this.formItem.start_time.getTime()/1e3),e.end_time=Math.round(this.formItem.end_time.getTime()/1e3),this.formItem.image.length>0&&(e.image=this.formItem.image[0]),e},submitRequest:function(e,t){bus.$emit("on-loading");var i=this;this.$Util.api.post(t,e,i).then(function(e){i.$Notice.success({title:"请求成功",desc:""}),i.back()},function(e){bus.$emit("on-loading"),i.$Notice.warning({title:"请求失败",desc:""})})},loadResource:function(){},loadAudienceTypes:function(){var e=this;return this.$Util.api.get(a.getAudienceList,e).then(function(t){e.audienceTypes=t.data},function(t){e.$Notice.warning({title:"加载详情失败",desc:""})})},loadEditFormData:function(){bus.$emit("on-loading");var e=this;this.$Util.api.get(a.find,e).then(function(t){bus.$emit("on-loading"),e.formItem=t.data,e.formItem.color=t.data.source.color;var i=e.audienceTypes.find(function(t){return t.audience==e.formItem.audience});e.formItem.audience=i?i.title:"",e.formItem.image=[t.data.source.picture],"copy"==e.usage&&(e.formItem.id=0)},function(t){bus.$emit("on-loading"),e.$Notice.warning({title:"加载详情失败",desc:""})})},initIds:function(){if("edit"===this.usage||"copy"===this.usage){var e=this.id;if(!parseInt(e))return alert("id格式有误"),!1;e=parseInt(e),this.formItem.id=e,a.find.api.params.id=e}}},created:function(){this.initIds(),this.$nextTick(function(){this.loadAudienceTypes().then(function(){"edit"!==this.usage&&"copy"!==this.usage||this.loadEditFormData()})})}}},SJ4H:function(e,t,i){var a=i("VU/8")(i("1pCi"),i("cXQK"),null,null);e.exports=a.exports},cXQK:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"padding-top":"20px"}},[i("Form",{ref:"myForm",attrs:{model:e.formItem,"label-width":120,rules:e.ruleValidate}},[""!=e.formItem.id&&"copy"!=e.usage?i("div",{staticStyle:{width:"100px","text-align":"right","padding-right":"20px"}},[e._v("ID:"+e._s(e.formItem.id))]):e._e(),e._v(" "),i("Form-item",{attrs:{label:"页面标题",prop:"memo"}},[i("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"页面标题"},model:{value:e.formItem.memo,callback:function(t){e.$set(e.formItem,"memo",t)},expression:"formItem.memo"}})],1),e._v(" "),i("Form-item",{attrs:{label:"开始时间",prop:"start_time"}},[i("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:"选择开始时间"},model:{value:e.formItem.start_time,callback:function(t){e.$set(e.formItem,"start_time",t)},expression:"formItem.start_time"}})],1),e._v(" "),i("Form-item",{attrs:{label:"结束时间",prop:"end_time"}},[i("Date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:"选择结束时间"},model:{value:e.formItem.end_time,callback:function(t){e.$set(e.formItem,"end_time",t)},expression:"formItem.end_time"}})],1),e._v(" "),i("Form-item",{attrs:{label:"展示对象",prop:"audience"}},[i("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择展示对象"},model:{value:e.formItem.audience,callback:function(t){e.$set(e.formItem,"audience",t)},expression:"formItem.audience"}},e._l(e.audienceTypes,function(t){return i("Option",{key:t,attrs:{value:t.title}},[e._v(e._s(t.title))])}))],1),e._v(" "),i("Form-item",{attrs:{label:"icon颜色",prop:"color"}},[i("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择颜色"},model:{value:e.formItem.color,callback:function(t){e.$set(e.formItem,"color",t)},expression:"formItem.color"}},e._l(e.colors,function(t){return i("Option",{key:t,attrs:{value:t.color}},[e._v(e._s(t.name))])}))],1),e._v(" "),i("Form-item",{attrs:{label:"背景图",prop:"image"}},[i("m-upload-image",{model:{value:e.formItem.image,callback:function(t){e.$set(e.formItem,"image",t)},expression:"formItem.image"}}),e._v("\n            背景图片长宽比："+e._s(e.formItem.image[0]?e.formItem.image[0].width:0)+" / "+e._s(e.formItem.image[0]?e.formItem.image[0].height:0)+"\n        ")],1),e._v(" "),i("Form-item",[i("i-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("提交")]),e._v(" "),i("i-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:e.back}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]}},nHIx:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("m-page-edit",{attrs:{"is-loading":e.loadingState}},[i("m-background-form",{attrs:{usage:"copy",id:e.id},on:{loading:e.changeLoadingState}})],1)},staticRenderFns:[]}},opYb:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("SJ4H"),r=i.n(a);t.default={name:"app",components:{MBackgroundForm:r.a},data:function(){return{id:this.$route.params.id,loadingState:!1}},methods:{changeLoadingState:function(){this.loadingState=!this.loadingState}}}},pqWf:function(e,t,i){var a=i("VU/8")(i("opYb"),i("nHIx"),null,null);e.exports=a.exports}});